[{"filePath":"/Users/anderschan/thepsychology-ai/components/ui/use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n// Inspired by react-hot-toast library\nimport * as React from 'react'\n\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: 'ADD_TOAST',\n  UPDATE_TOAST: 'UPDATE_TOAST',\n  DISMISS_TOAST: 'DISMISS_TOAST',\n  REMOVE_TOAST: 'REMOVE_TOAST',\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType['ADD_TOAST']\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType['UPDATE_TOAST']\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType['DISMISS_TOAST']\n      toastId?: ToasterToast['id']\n    }\n  | {\n      type: ActionType['REMOVE_TOAST']\n      toastId?: ToasterToast['id']\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: 'REMOVE_TOAST',\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case 'ADD_TOAST':\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case 'UPDATE_TOAST':\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\n        ),\n      }\n\n    case 'DISMISS_TOAST': {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t,\n        ),\n      }\n    }\n    case 'REMOVE_TOAST':\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, 'id'>\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: 'UPDATE_TOAST',\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\n\n  dispatch({\n    type: 'ADD_TOAST',\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\n  }\n}\n\nexport { useToast, toast }\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/assign-exam/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1586,1589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1586,1589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7150,7153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7150,7153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9275,9278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9275,9278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { existsSync, readFileSync } from 'fs'\nimport { join } from 'path'\nimport { parseExamFile } from '@/lib/exam-file-manager'\nimport { inferIsOrgPsych } from '@/lib/org-psych-utils'\nimport { getSupabaseClient } from '@/lib/supabase-server'\n\n/**\n * Assign an exam file to a user\n * POST /api/assign-exam\n * Body: { userId: string, examType: 'diagnostic' | 'practice' }\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const { userId, examType } = await request.json()\n\n    if (!userId || !examType) {\n      return NextResponse.json(\n        { error: 'Missing userId or examType' },\n        { status: 400 }\n      )\n    }\n\n    if (!['diagnostic', 'practice'].includes(examType)) {\n      return NextResponse.json(\n        { error: 'Invalid exam type' },\n        { status: 400 }\n      )\n    }\n\n    const supabase = getSupabaseClient(undefined, { requireServiceRole: true })\n    if (!supabase) {\n      return NextResponse.json(\n        { error: 'Supabase is not configured' },\n        { status: 500 }\n      )\n    }\n\n    // Query which exam files the user has already completed\n    const { data: completedAssignments, error: queryError } = await supabase\n      .from('user_exam_assignments')\n      .select('exam_file')\n      .eq('user_id', userId)\n      .eq('exam_type', examType)\n      .eq('completed', true)\n\n    if (queryError) {\n      console.error('Error querying completed assignments:', queryError)\n      throw queryError\n    }\n\n    const completedFiles = new Set(\n      (completedAssignments || []).map((a: any) => a.exam_file)\n    )\n\n    // TODO: Get list of available exam files for this type\n    // For now, we'll need to implement a function to list available exam files\n    // This could be done by:\n    // 1. Reading from a static list\n    // 2. Querying GitHub API\n    // 3. Reading from filesystem in development\n\n    // For MVP, we'll use a fallback approach:\n    // Try common exam file naming patterns\n    const availableFiles = getAvailableExamFilesList(examType)\n\n    // Find an unused exam file\n    const unusedFile = availableFiles.find(file => !completedFiles.has(file))\n\n    if (!unusedFile) {\n      // All exams have been used - need to fall back to on-demand generation\n      return NextResponse.json({\n        success: false,\n        message: 'No unused exam files available',\n        fallbackRequired: true,\n        action: 'generate_on_demand',\n      })\n    }\n\n    // Check if user has already been assigned this file (incomplete)\n    const { data: existingAssignment, error: existingError } = await supabase\n      .from('user_exam_assignments')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('exam_file', unusedFile)\n      .eq('completed', false)\n      .single()\n\n    if (existingError && existingError.code !== 'PGRST116') {\n      console.error('Error checking existing assignment:', existingError)\n      throw existingError\n    }\n\n    if (existingAssignment) {\n      // User already has this exam assigned but not completed\n      // Load it from disk\n      const { metadata, questions } = loadExamFromDisk(\n        unusedFile,\n        examType\n      )\n\n      return NextResponse.json({\n        success: true,\n        assignmentId: existingAssignment.id,\n        examFile: unusedFile,\n        metadata,\n        questions,\n      })\n    }\n\n    // Create new assignment\n    const { data: assignment, error: insertError } = await supabase\n      .from('user_exam_assignments')\n      .insert({\n        user_id: userId,\n        exam_type: examType,\n        exam_file: unusedFile,\n        assigned_at: new Date().toISOString(),\n      })\n      .select()\n      .single()\n\n    if (insertError) {\n      console.error('Error creating assignment:', insertError)\n      throw insertError\n    }\n\n    // Load exam data from disk\n    const { metadata, questions } = loadExamFromDisk(\n      unusedFile,\n      examType\n    )\n\n    return NextResponse.json({\n      success: true,\n      assignmentId: assignment.id,\n      examFile: unusedFile,\n      metadata,\n      questions,\n    })\n  } catch (error) {\n    console.error('Error assigning exam:', error)\n    return NextResponse.json(\n      {\n        error: 'Failed to assign exam',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Get list of available exam files for a type\n * Now using standardized naming convention (001-004)\n * Matches the exam generation system and allows for quick rotation\n *\n * NOTE: Only practice-exam-001.md is available for practice exams.\n * practice-exam-002.md, 003.md, and 004.md are temporarily disabled due to format issues.\n * They will be regenerated and re-enabled in a future update.\n */\nfunction getAvailableExamFilesList(examType: 'diagnostic' | 'practice'): string[] {\n  if (examType === 'diagnostic') {\n    return [\n      'diagnostic-exam-001.md',\n      'diagnostic-exam-002.md',\n      'diagnostic-exam-003.md',\n      'diagnostic-exam-004.md',\n    ]\n  } else {\n    // Temporarily only serve practice-exam-001.md\n    // practice-exam-002, 003, 004 will be regenerated\n    return [\n      'practice-exam-001.md',\n    ]\n  }\n}\n\n/**\n * Load exam directly from disk (no HTTP round-trip needed)\n * This is much faster and more reliable than the previous HTTP fetch approach\n * For split exams (version 3+), also loads explanations from separate file\n */\nfunction loadExamFromDisk(\n  examFile: string,\n  examType: 'diagnostic' | 'practice'\n) {\n  // First, try to load from examsGPT JSON if available.\n  // This lets us use the new GPT-generated exams while keeping\n  // the legacy exams/ markdown files as a safe fallback.\n  try {\n    const gptExam = loadExamFromGptJson(examFile, examType)\n    if (gptExam) {\n      return gptExam\n    }\n  } catch (gptError) {\n    console.warn(\n      `[Assign Exam] Failed to load GPT exam for ${examType} ${examFile}, falling back to legacy exams/:`,\n      gptError\n    )\n  }\n\n  try {\n    const examsDir = join(process.cwd(), 'exams', examType)\n    const filePath = join(examsDir, examFile)\n\n    console.log(`[Assign Exam] Loading exam from disk: ${filePath}`)\n\n    const content = readFileSync(filePath, 'utf-8')\n    const examData = parseExamFile(content)\n\n    console.log(`[Assign Exam] Successfully loaded ${examData.questions.length} questions from ${examFile}`)\n\n    // Check if this is a split exam (version 3+) that needs explanations loaded separately\n    if (examData.metadata.version >= 3 || examData.metadata.format === 'split') {\n      try {\n        // Load explanations from separate file\n        const explanationsDir = join(process.cwd(), 'exams', 'explanations')\n        const explanationFile = examFile.replace('.md', '-explanations.json')\n        const explanationPath = join(explanationsDir, explanationFile)\n\n        console.log(`[Assign Exam] Loading explanations from: ${explanationPath}`)\n\n        const explanationContent = readFileSync(explanationPath, 'utf-8')\n        const explanationData = JSON.parse(explanationContent)\n\n        // Merge explanations into questions\n        const questionsWithExplanations = examData.questions.map((q: any, idx: number) => ({\n          ...q,\n          explanation: explanationData.explanations[String(idx + 1)] || 'Explanation not available',\n        }))\n\n        console.log(`[Assign Exam] Successfully merged ${Object.keys(explanationData.explanations).length} explanations`)\n\n        return {\n          metadata: examData.metadata,\n          questions: questionsWithExplanations,\n        }\n      } catch (explanationError) {\n        console.warn(`[Assign Exam] Could not load explanations, using questions without explanations:`, explanationError)\n        // Fall back to questions without explanations (old format)\n        return {\n          metadata: examData.metadata,\n          questions: examData.questions,\n        }\n      }\n    }\n\n    // Legacy format (version 1-2) - questions already include explanations\n    return {\n      metadata: examData.metadata,\n      questions: examData.questions,\n    }\n  } catch (error) {\n    console.error(`[Assign Exam] Error loading exam file ${examFile}:`, error)\n    throw new Error(`Failed to load exam file: ${examFile}`)\n  }\n}\n\n/**\n * Try to load a GPT-generated exam from the examsGPT directory.\n * Returns null if no matching JSON file exists so callers can fall back.\n */\n\nfunction loadExamFromGptJson(\n  examFile: string,\n  examType: 'diagnostic' | 'practice'\n) {\n  // Expect examFile patterns like \"practice-exam-001.md\" or \"diagnostic-exam-002.md\"\n  const match = examFile.match(/(\\d+)/)\n  const examNumber = match ? parseInt(match[1], 10) : 1\n\n  const gptDir =\n    examType === 'practice'\n      ? join(process.cwd(), 'examsGPT')\n      : join(process.cwd(), 'diagnosticGPT')\n  const jsonFileName =\n    examType === 'practice'\n      ? `practice-exam-${examNumber}.json`\n      : `diagnostic-exam-${examNumber}.json`\n  const jsonPath = join(gptDir, jsonFileName)\n\n  if (!existsSync(jsonPath)) {\n    // No GPT exam yet for this slot â€“ let caller fall back\n    return null\n  }\n\n  const raw = readFileSync(jsonPath, 'utf-8')\n  const parsed = JSON.parse(raw)\n\n  const questions = Array.isArray(parsed.questions) ? parsed.questions : []\n\n  const mappedQuestions = questions.map((q: any, idx: number) => {\n    const sourceFile = q.sourceFile ?? q.source_file\n    const sourceFolder = q.sourceFolder ?? q.source_folder\n    const inferredOrgPsych = inferIsOrgPsych({\n      explicitFlag: typeof q.is_org_psych === 'boolean' ? q.is_org_psych : undefined,\n      sourceFile,\n      sourceFolder,\n    })\n\n    const domainNumber =\n      typeof q.domain === 'number'\n        ? q.domain\n        : typeof q.domain === 'string'\n        ? parseInt(q.domain, 10)\n        : undefined\n\n    return {\n      id: idx + 1,\n      question: q.stem ?? q.question ?? '',\n      options: q.options ?? [],\n      correct_answer: q.answer ?? q.correct_answer ?? '',\n      explanation: q.explanation ?? '',\n      // Store domain in a consistent string format so prioritizer\n      // can extract the domain number (e.g., \"Domain 6\")\n      domain: domainNumber && !Number.isNaN(domainNumber) ? `Domain ${domainNumber}` : q.domain ?? '',\n      difficulty:\n        q.difficulty === 'easy' || q.difficulty === 'medium' || q.difficulty === 'hard'\n          ? q.difficulty\n          : 'medium',\n      isScored: typeof q.scored === 'boolean' ? q.scored : q.isScored,\n      knId: q.kn ?? q.knId,\n      type: q.type ?? 'standard',\n      // Preserve any extra metadata if present\n      source_file: sourceFile,\n      source_folder: sourceFolder,\n      question_type: q.question_type,\n      // Prefer explicit flag, but infer from Org Psych source folder/path when missing\n      is_org_psych: inferredOrgPsych,\n    }\n  })\n\n  const metadata = {\n    exam_id: `${examType}-gpt-${examNumber}`,\n    exam_type: examType,\n    generated_at: parsed.meta?.generatedAt ?? new Date().toISOString(),\n    question_count: mappedQuestions.length,\n    version: 1,\n  }\n\n  console.log(\n    `[Assign Exam] Loaded GPT ${examType} exam from examsGPT: ${jsonFileName} (${mappedQuestions.length} questions)`\n  )\n\n  return {\n    metadata,\n    questions: mappedQuestions,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/exam-generator/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7394,7397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7394,7397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12502,12505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12502,12505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":419,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15210,15213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15210,15213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17467,17470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17467,17470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Anthropic from '@anthropic-ai/sdk'\nimport { NextRequest, NextResponse } from 'next/server'\nimport { existsSync, readFileSync, readdirSync } from 'fs'\nimport { join } from 'path'\nimport { inferIsOrgPsych } from '@/lib/org-psych-utils'\nimport { deriveTopicMetaFromQuestionSource } from '@/lib/topic-source-utils'\nimport { loadFullTopicContent } from '@/lib/topic-content-manager'\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY,\n})\n\n// DIAGNOSTIC EXAM: 71 Questions (1 per KN)\nconst DIAGNOSTIC_EXAM_PROMPT = `You are an expert EPPP (Examination for Professional Practice in Psychology) exam creator.\n\nYour task is to generate a 71-question diagnostic exam based on the 71 ASPPB Knowledge Statements.\n\nThe exam should include:\n- 71 questions total (1 per Knowledge Statement, KN1-KN71)\n- Proper domain distribution maintaining EPPP weights:\n  - Domain 1: 5 questions\n  - Domain 2: 8 questions\n  - Domain 3: 7 questions\n  - Domain 4: 8 questions\n  - Domain 5: 13 questions\n  - Domain 6: 11 questions\n  - Domain 7: 5 questions (rounded from 7%)\n  - Domain 8: 9 questions (rounded from 16%)\n- Multiple choice format with 4 options each\n- All questions scored (isScored: true)\n- Balanced difficulty levels\n\nCRITICAL RANDOMIZATION REQUIREMENT:\n- The correct answer MUST be randomized across all positions (A, B, C, D)\n- DO NOT place the correct answer always in position A\n- Aim for roughly 25% of correct answers in each position (A, B, C, D)\n- Randomize answer option positions for each question independently\n- Verify that across all 71 questions, correct answers appear in different positions\n\nCRITICAL ANSWER LENGTH VARIATION:\n- Vary the length of answer choices to avoid length bias (where longer answers appear more correct)\n- Ensure that about 25% of correct answers are the longest option, 25% are medium length, 25% are shortest, and 25% are medium-short\n- For incorrect distractor options, ensure they have varied lengths - some should be longer, some shorter than the correct answer\n- Do NOT make the correct answer consistently the longest or shortest option\n- This makes test-taking more rigorous and prevents test-takers from using answer length as a cue\n\nGenerate the exam in JSON format with this structure:\n{\n  \"questions\": [\n    {\n      \"id\": number,\n      \"question\": \"Question text\",\n      \"options\": [\"Option 1\", \"Option 2\", \"Option 3\", \"Option 4\"],\n      \"correct_answer\": \"Option text that matches one of the options exactly\",\n      \"explanation\": \"Why this is correct\",\n      \"domain\": \"Domain 1-8\",\n      \"difficulty\": \"easy|medium|hard\",\n      \"isScored\": true,\n      \"knId\": \"KN1\"\n    }\n  ]\n}\n\nIMPORTANT: The \"correct_answer\" field must contain the actual option text (not A, B, C, or D), and the options array must contain the option text, not letters. This allows proper randomization.\n\nStart generating the exam now. Format each question clearly. Generate exactly 71 questions as specified above. Remember to randomize answer positions!`\n\n// PRACTICE EXAM: 225 Questions\nconst PRACTICE_EXAM_PROMPT = `You are an expert EPPP (Examination for Professional Practice in Psychology) exam creator.\n\nYour task is to generate a comprehensive 225-question practice exam following official ASPPB specifications.\n\nThe exam should include:\n- 225 questions total\n- Proper domain distribution following EPPP weights\n- 180 scored questions (80%) - standard and medium difficulty questions that count toward score\n- 45 unscored experimental questions (20%) - harder questions for research/development that DO NOT count toward score\n- Multiple choice format with 4 options each\n- Answer key with brief explanations\n- Questions distributed across all 8 EPPP domains\n\nCRITICAL RANDOMIZATION REQUIREMENT:\n- The correct answer MUST be randomized across all positions (A, B, C, D)\n- DO NOT place the correct answer always in position A\n- Aim for roughly 25% of correct answers in each position (A, B, C, D)\n- Randomize answer option positions for each question independently\n- Verify that across all 225 questions, correct answers appear in different positions\n\nCRITICAL ANSWER LENGTH VARIATION:\n- Vary the length of answer choices to avoid length bias (where longer answers appear more correct)\n- Ensure that about 25% of correct answers are the longest option, 25% are medium length, 25% are shortest, and 25% are medium-short\n- For incorrect distractor options, ensure they have varied lengths - some should be longer, some shorter than the correct answer\n- Do NOT make the correct answer consistently the longest or shortest option\n- This makes test-taking more rigorous and prevents test-takers from using answer length as a cue\n\nIMPORTANT: Mark the unscored questions clearly with \"isScored\": false. These should be noticeably harder than the scored questions and are used for data collection. Users will see their score calculated only from the 180 scored questions, not the 45 unscored ones.\n\nGenerate the exam in JSON format with this structure:\n{\n  \"questions\": [\n    {\n      \"id\": number,\n      \"question\": \"Question text\",\n      \"options\": [\"Option 1\", \"Option 2\", \"Option 3\", \"Option 4\"],\n      \"correct_answer\": \"Option text that matches one of the options exactly\",\n      \"explanation\": \"Why this is correct\",\n      \"domain\": \"Domain 1-8\",\n      \"difficulty\": \"easy|medium|hard\",\n      \"isScored\": true,\n      \"type\": \"standard\"\n    }\n  ]\n}\n\nIMPORTANT: The \"correct_answer\" field must contain the actual option text (not A, B, C, or D), and the options array must contain the option text, not letters. This allows proper randomization.\n\nStart generating the exam now. Format each question clearly. Remember: exactly 180 questions with \"isScored\": true, and 45 questions with \"isScored\": false. Most importantly, randomize answer positions throughout the exam!`\n\n// --- Section matching helpers for exam questions ---\ntype SectionInfo = { title: string; text: string }\nconst topicSectionCache = new Map<string, SectionInfo[]>()\n\nfunction getTopicSections(topicName: string, domainId?: string | null): SectionInfo[] {\n  const key = `${topicName}__${domainId || ''}`\n  if (topicSectionCache.has(key)) return topicSectionCache.get(key)!\n\n  const content = loadFullTopicContent(topicName, domainId || '')\n  if (!content) {\n    topicSectionCache.set(key, [])\n    return []\n  }\n\n  const lines = content.split('\\n')\n  const sections: SectionInfo[] = []\n  let current: SectionInfo | null = null\n\n  for (const line of lines) {\n    const headingMatch = line.match(/^(#{2,3})\\s+(.*)$/)\n    if (headingMatch) {\n      if (current) sections.push(current)\n      current = { title: headingMatch[2].trim(), text: '' }\n    } else if (current) {\n      current.text += line + '\\n'\n    }\n  }\n  if (current) sections.push(current)\n\n  topicSectionCache.set(key, sections)\n  return sections\n}\n\nfunction normalizeTokens(text: string): string[] {\n  return text\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]+/g, ' ')\n    .split(/\\s+/)\n    .filter((w) => w.length > 3)\n}\n\nfunction jaccardSimilarity(a: string[], b: string[]): number {\n  if (a.length === 0 || b.length === 0) return 0\n  const setA = new Set(a)\n  const setB = new Set(b)\n  let intersection = 0\n  setA.forEach((token) => {\n    if (setB.has(token)) intersection++\n  })\n  const union = setA.size + setB.size - intersection\n  return union === 0 ? 0 : intersection / union\n}\n\nfunction attachRelatedSections(question: any) {\n  const meta = deriveTopicMetaFromQuestionSource(question)\n  if (!meta || !meta.topicName) return question\n\n  const sections = getTopicSections(meta.topicName, meta.domainId)\n  if (!sections || sections.length === 0) return question\n\n  const questionText = `${question.stem ?? question.question ?? ''} ${question.explanation ?? ''}`\n  const qTokens = normalizeTokens(questionText)\n\n  const scoredSections = sections\n    .map((section) => {\n      const sectionTokens = normalizeTokens(section.title + ' ' + section.text)\n      const score = jaccardSimilarity(qTokens, sectionTokens)\n      return { title: section.title, score }\n    })\n    .filter((s) => s.score > 0)\n    .sort((a, b) => b.score - a.score)\n\n  const top = scoredSections.slice(0, 2).filter((s) => s.score >= 0.05)\n  if (top.length > 0) {\n    question.relatedSections = top.map((s) => s.title)\n  }\n\n  return question\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const examType = searchParams.get('type') || 'practice' // 'diagnostic' or 'practice'\n    const source = searchParams.get('source') || 'default'\n\n    // Free-tier exams: always load from free-examsGPT and never call Anthropic\n    if (source === 'free') {\n      try {\n        const examData = loadFreeExamFromGpt(examType === 'diagnostic' ? 'diagnostic' : 'practice')\n        return NextResponse.json(examData)\n      } catch (freeError) {\n        console.error('[Exam Generator] Failed to load free exam from free-examsGPT:', freeError)\n        return NextResponse.json(\n          { error: 'Failed to load free exam' },\n          { status: 500 },\n        )\n      }\n    }\n\n    // For diagnostic exams, prefer pre-generated GPT exams from diagnosticGPT\n    if (examType === 'diagnostic') {\n      try {\n        const examData = loadDiagnosticFromGpt()\n        return NextResponse.json(examData)\n      } catch (gptError) {\n        console.warn(\n          '[Exam Generator] Failed to load diagnostic exam from diagnosticGPT, falling back to Anthropic generation:',\n          gptError\n        )\n      }\n    }\n\n    // For practice exams, try loading from cached GPT JSON exams first\n    if (examType === 'practice') {\n      try {\n        const examData = loadPracticeFromGpt()\n        return NextResponse.json(examData)\n      } catch (practiceError) {\n        console.warn(\n          '[Exam Generator] Failed to load practice exam from examsGPT, falling back to Anthropic generation:',\n          practiceError\n        )\n      }\n    }\n\n    const prompt = examType === 'diagnostic' ? DIAGNOSTIC_EXAM_PROMPT : PRACTICE_EXAM_PROMPT\n\n    const response = await client.messages.create({\n      model: 'claude-haiku-4-5-20251001',\n      max_tokens: 32000,\n      stream: true,\n      messages: [\n        {\n          role: 'user',\n          content: prompt,\n        },\n      ],\n    })\n\n    // Convert stream to ReadableStream for NextResponse\n    const stream = new ReadableStream({\n      async start(controller) {\n        try {\n          for await (const event of response) {\n            if (\n              event.type === 'content_block_delta' &&\n              event.delta.type === 'text_delta'\n            ) {\n              controller.enqueue(\n                new TextEncoder().encode(event.delta.text)\n              )\n            }\n          }\n          controller.close()\n        } catch (error) {\n          controller.error(error)\n        }\n      },\n    })\n\n    return new NextResponse(stream, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n      },\n    })\n  } catch (error) {\n    console.error('Error generating exam:', error)\n    return NextResponse.json(\n      { error: 'Failed to generate exam' },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Load a free exam from the free-examsGPT folder.\n * For now, free exams are JSON files in free-examsGPT generated from free-questionsGPT.\n * This is used for the \"free\" subscription tier so they never hit Anthropic\n * or the full examsGPT pool.\n */\nfunction loadFreeExamFromGpt(examType: 'diagnostic' | 'practice') {\n  const freeDir = join(process.cwd(), 'free-examsGPT')\n  if (!existsSync(freeDir)) {\n    throw new Error(`free-examsGPT directory not found at ${freeDir}`)\n  }\n\n  // Prefer type-specific patterns if available, otherwise fall back to any JSON file\n  let files = readdirSync(freeDir).filter((name) => name.endsWith('.json'))\n\n  const typePrefix =\n    examType === 'practice'\n      ? 'practice-exam-'\n      : 'diagnostic-exam-'\n\n  const typeSpecific = files.filter((name) => name.startsWith(typePrefix))\n  if (typeSpecific.length > 0) {\n    files = typeSpecific\n  }\n\n  if (files.length === 0) {\n    throw new Error('No exam JSON files found in free-examsGPT')\n  }\n\n  const chosen = files[Math.floor(Math.random() * files.length)]\n  const fullPath = join(freeDir, chosen)\n\n  const raw = readFileSync(fullPath, 'utf-8')\n  const parsed = JSON.parse(raw)\n  const questions = Array.isArray(parsed.questions) ? parsed.questions : []\n\n  const mappedQuestions = questions.map((q: any, idx: number) => {\n    const domainNumber =\n      typeof q.domain === 'number'\n        ? q.domain\n        : typeof q.domain === 'string'\n        ? parseInt(q.domain, 10)\n        : undefined\n\n    const questionId = typeof q.id === 'number' ? q.id : idx + 1\n    const options = Array.isArray(q.options) ? q.options : []\n    const sourceFile = q.sourceFile ?? q.source_file\n    const sourceFolder = q.sourceFolder ?? q.source_folder\n    const explicitOrgPsych =\n      typeof q.isOrgPsych === 'boolean'\n        ? q.isOrgPsych\n        : typeof q.is_org_psych === 'boolean'\n        ? q.is_org_psych\n        : undefined\n\n    const isOrgPsych = inferIsOrgPsych({\n      explicitFlag: explicitOrgPsych,\n      sourceFile,\n      sourceFolder,\n    })\n\n    const isScored =\n      typeof q.scored === 'boolean'\n        ? q.scored\n        : typeof q.isScored === 'boolean'\n        ? q.isScored\n        : true\n\n    const mapped = {\n      id: questionId,\n      question: q.stem ?? q.question ?? '',\n      options,\n      correct_answer: q.answer ?? q.correct_answer ?? '',\n      explanation: q.explanation ?? q.rationale ?? '',\n      domain: domainNumber && !Number.isNaN(domainNumber) ? `Domain ${domainNumber}` : q.domain ?? '',\n      difficulty:\n        q.difficulty === 'easy' || q.difficulty === 'medium' || q.difficulty === 'hard'\n          ? q.difficulty\n          : 'medium',\n      isScored,\n      knId: q.kn ?? q.knId,\n      type: q.type ?? (isScored ? 'standard' : 'experimental'),\n      source_file: sourceFile,\n      source_folder: sourceFolder,\n      is_org_psych: isOrgPsych,\n    }\n\n    return attachRelatedSections(mapped)\n  })\n\n  return {\n    questions: mappedQuestions,\n    metadata: parsed.meta ?? null,\n  }\n}\n\n/**\n * Load a diagnostic exam from the diagnosticGPT folder.\n * Chooses a random diagnostic-exam-*.json file and maps it into the\n * question shape expected by the exam generator page.\n */\nfunction loadDiagnosticFromGpt() {\n  const diagnosticDir = join(process.cwd(), 'diagnosticGPT')\n  if (!existsSync(diagnosticDir)) {\n    throw new Error(`diagnosticGPT directory not found at ${diagnosticDir}`)\n  }\n\n  const files = readdirSync(diagnosticDir).filter(\n    (name) => name.startsWith('diagnostic-exam-') && name.endsWith('.json')\n  )\n\n  if (files.length === 0) {\n    throw new Error('No diagnostic-exam-*.json files found in diagnosticGPT')\n  }\n\n  // Pick a random diagnostic exam\n  const chosen = files[Math.floor(Math.random() * files.length)]\n  const fullPath = join(diagnosticDir, chosen)\n\n  const raw = readFileSync(fullPath, 'utf-8')\n  const parsed = JSON.parse(raw)\n  const questions = Array.isArray(parsed.questions) ? parsed.questions : []\n\n  const mappedQuestions = questions.map((q: any, idx: number) => {\n    const domainNumber =\n      typeof q.domain === 'number'\n        ? q.domain\n        : typeof q.domain === 'string'\n        ? parseInt(q.domain, 10)\n        : undefined\n    const sourceFile = q.sourceFile ?? q.source_file\n    const sourceFolder = q.sourceFolder ?? q.source_folder\n    const isOrgPsych = inferIsOrgPsych({\n      explicitFlag: typeof q.is_org_psych === 'boolean' ? q.is_org_psych : undefined,\n      sourceFile,\n      sourceFolder,\n    })\n\n    const mapped = {\n      id: idx + 1,\n      question: q.stem ?? q.question ?? '',\n      options: q.options ?? [],\n      correct_answer: q.answer ?? q.correct_answer ?? '',\n      explanation: q.explanation ?? '',\n      domain: domainNumber && !Number.isNaN(domainNumber) ? `Domain ${domainNumber}` : q.domain ?? '',\n      difficulty:\n        q.difficulty === 'easy' || q.difficulty === 'medium' || q.difficulty === 'hard'\n          ? q.difficulty\n          : 'medium',\n      isScored: typeof q.scored === 'boolean' ? q.scored : q.isScored ?? true,\n      knId: q.kn ?? q.knId,\n      type: q.type ?? 'standard',\n      source_file: sourceFile,\n      source_folder: sourceFolder,\n      is_org_psych: isOrgPsych,\n    }\n\n    return attachRelatedSections(mapped)\n  })\n\n  return {\n    questions: mappedQuestions,\n  }\n}\n\n/**\n * Load a practice exam from the examsGPT folder (practice-exam-*.json files)\n * This avoids needing to call Anthropic if we already have cached practice exams.\n */\nfunction loadPracticeFromGpt() {\n  const practiceDir = join(process.cwd(), 'examsGPT')\n  if (!existsSync(practiceDir)) {\n    throw new Error(`examsGPT directory not found at ${practiceDir}`)\n  }\n\n  const files = readdirSync(practiceDir).filter(\n    (name) => name.startsWith('practice-exam-') && name.endsWith('.json')\n  )\n\n  if (files.length === 0) {\n    throw new Error('No practice-exam-*.json files found in examsGPT')\n  }\n\n  // Randomize the exam selection to keep attempts fresh\n  const chosen = files[Math.floor(Math.random() * files.length)]\n  const fullPath = join(practiceDir, chosen)\n\n  const raw = readFileSync(fullPath, 'utf-8')\n  const parsed = JSON.parse(raw)\n  const questions = Array.isArray(parsed.questions) ? parsed.questions : []\n\n  const mappedQuestions = questions.map((q: any, idx: number) => {\n    const domainNumber =\n      typeof q.domain === 'number'\n        ? q.domain\n        : typeof q.domain === 'string'\n        ? parseInt(q.domain, 10)\n        : undefined\n\n    const questionId = typeof q.id === 'number' ? q.id : idx + 1\n    const options = Array.isArray(q.options) ? q.options : []\n    const sourceFile = q.sourceFile ?? q.source_file\n    const sourceFolder = q.sourceFolder ?? q.source_folder\n    const isOrgPsych = inferIsOrgPsych({\n      explicitFlag: typeof q.is_org_psych === 'boolean' ? q.is_org_psych : undefined,\n      sourceFile,\n      sourceFolder,\n    })\n\n    const isScored =\n      typeof q.scored === 'boolean'\n        ? q.scored\n        : typeof q.isScored === 'boolean'\n        ? q.isScored\n        : true\n\n    const mapped = {\n      id: questionId,\n      question: q.stem ?? q.question ?? '',\n      options,\n      correct_answer: q.answer ?? q.correct_answer ?? '',\n      explanation: q.explanation ?? q.rationale ?? '',\n      domain: domainNumber && !Number.isNaN(domainNumber) ? `Domain ${domainNumber}` : q.domain ?? '',\n      difficulty:\n        q.difficulty === 'easy' || q.difficulty === 'medium' || q.difficulty === 'hard'\n          ? q.difficulty\n          : 'medium',\n      isScored,\n      knId: q.kn ?? q.knId,\n      type: q.type ?? (isScored ? 'standard' : 'experimental'),\n      source_file: sourceFile,\n      source_folder: sourceFolder,\n      is_org_psych: isOrgPsych,\n    }\n\n    return attachRelatedSections(mapped)\n  })\n\n  return {\n    questions: mappedQuestions,\n    metadata: parsed.meta ?? null,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/fetch-exam-from-github/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fsError' is defined but never used.","line":57,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3931,3934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3931,3934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { parseExamFile } from '@/lib/exam-file-manager'\nimport { existsSync, readFileSync } from 'fs'\nimport { join } from 'path'\n\n/**\n * Fetch exam file from local filesystem (fast, instant access)\n * Previously fetched from GitHub which added network latency (200-500ms)\n * GET /api/fetch-exam-from-github?examFile=diagnostic-2025-01-14.md&examType=diagnostic\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const examFile = searchParams.get('examFile')\n    const examType = searchParams.get('examType') as 'diagnostic' | 'practice' | null\n\n    if (!examFile || !examType) {\n      return NextResponse.json(\n        { error: 'Missing examFile or examType query parameters' },\n        { status: 400 }\n      )\n    }\n\n    // Validate exam type\n    if (!['diagnostic', 'practice'].includes(examType)) {\n      return NextResponse.json(\n        { error: 'Invalid exam type' },\n        { status: 400 }\n      )\n    }\n\n    // Validate exam file name (prevent directory traversal)\n    if (examFile.includes('..') || examFile.includes('/')) {\n      return NextResponse.json(\n        { error: 'Invalid exam file name' },\n        { status: 400 }\n      )\n    }\n\n    // First try to load from examsGPT JSON if available\n    const gptResult = loadExamFromGptJson(examFile, examType)\n    let examData\n\n    if (gptResult) {\n      examData = gptResult\n      console.log(\n        `[Exam Load] Loaded GPT ${examType} exam from examsGPT for review: ${examFile} (${examData.questions.length} questions)`\n      )\n    } else {\n      // Fall back to legacy exams/ markdown files\n      const examsDir = join(process.cwd(), 'exams', examType)\n      const filePath = join(examsDir, examFile)\n\n      let content: string\n      try {\n        content = readFileSync(filePath, 'utf-8')\n      } catch (fsError) {\n        console.warn(`Exam file not found locally: ${filePath}`)\n        return NextResponse.json(\n          { error: 'Exam file not found', fileExists: false },\n          { status: 404 }\n        )\n      }\n\n      examData = parseExamFile(content)\n\n      console.log(\n        `[Exam Load] Loaded ${examType} exam from local filesystem: ${examFile} (${examData.questions.length} questions)`\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      fileExists: true,\n      ...examData,\n    })\n  } catch (error) {\n    console.error('Error fetching exam from filesystem:', error)\n    return NextResponse.json(\n      {\n        error: 'Failed to fetch exam file',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Try to load a GPT-generated exam from the examsGPT directory for review.\n * Mirrors the mapping logic used by /api/assign-exam so review-exams sees the same content.\n * Returns null if no matching GPT exam exists.\n */\n\nfunction isOrgPsychSource(sourcePath?: string | null): boolean {\n  if (!sourcePath) return false\n  return sourcePath.includes('2 3 5 6 Organizational Psychology')\n}\n\nfunction loadExamFromGptJson(\n  examFile: string,\n  examType: 'diagnostic' | 'practice'\n) {\n  // Expect examFile patterns like \"practice-exam-001.md\" or \"diagnostic-exam-002.md\"\n  const match = examFile.match(/(\\d+)/)\n  const examNumber = match ? parseInt(match[1], 10) : 1\n\n  const gptDir =\n    examType === 'practice'\n      ? join(process.cwd(), 'examsGPT')\n      : join(process.cwd(), 'diagnosticGPT')\n  const jsonFileName =\n    examType === 'practice'\n      ? `practice-exam-${examNumber}.json`\n      : `diagnostic-exam-${examNumber}.json`\n  const jsonPath = join(gptDir, jsonFileName)\n\n  if (!existsSync(jsonPath)) {\n    return null\n  }\n\n  const raw = readFileSync(jsonPath, 'utf-8')\n  const parsed = JSON.parse(raw)\n\n  const questions = Array.isArray(parsed.questions) ? parsed.questions : []\n\n  const mappedQuestions = questions.map((q: any, idx: number) => {\n    const sourceFile = q.sourceFile ?? q.source_file\n    const sourceFolder = q.sourceFolder ?? q.source_folder\n    const inferredOrgPsych = isOrgPsychSource(sourceFolder) || isOrgPsychSource(sourceFile)\n\n    const domainNumber =\n      typeof q.domain === 'number'\n        ? q.domain\n        : typeof q.domain === 'string'\n        ? parseInt(q.domain, 10)\n        : undefined\n\n    return {\n      id: idx + 1,\n      question: q.stem ?? q.question ?? '',\n      options: q.options ?? [],\n      correct_answer: q.answer ?? q.correct_answer ?? '',\n      explanation: q.explanation ?? '',\n      domain: domainNumber && !Number.isNaN(domainNumber) ? `Domain ${domainNumber}` : q.domain ?? '',\n      difficulty:\n        q.difficulty === 'easy' || q.difficulty === 'medium' || q.difficulty === 'hard'\n          ? q.difficulty\n          : 'medium',\n      isScored: typeof q.scored === 'boolean' ? q.scored : q.isScored,\n      knId: q.kn ?? q.knId,\n      type: q.type ?? 'standard',\n      source_file: sourceFile,\n      source_folder: sourceFolder,\n      question_type: q.question_type,\n      // Prefer explicit flag, but infer from Org Psych source folder/path when missing\n      is_org_psych: typeof q.is_org_psych === 'boolean' ? q.is_org_psych : inferredOrgPsych,\n    }\n  })\n\n  const metadata = {\n    exam_id: `${examType}-gpt-${examNumber}`,\n    exam_type: examType,\n    generated_at: parsed.meta?.generatedAt ?? new Date().toISOString(),\n    question_count: mappedQuestions.length,\n    version: 1,\n  }\n\n  return {\n    metadata,\n    questions: mappedQuestions,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/quizzer/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3918,3921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3918,3921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":271,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8988,8991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8988,8991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Anthropic from '@anthropic-ai/sdk'\nimport { NextRequest, NextResponse } from 'next/server'\nimport { loadTopicQuestions, TopicQuestion } from '@/lib/topic-question-loader'\nimport { loadFullTopicContent } from '@/lib/topic-content-manager'\nimport { deriveTopicMetaFromSourceFile } from '@/lib/topic-source-utils'\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY,\n})\n\nconst QUIZZER_PROMPT = `You are an expert EPPP quiz generator. Your task is to generate exactly 10 multiple-choice questions on the given topic.\n\nRequirements:\n- 10 questions total (8 scored + 2 unscored experimental)\n- 4 options per question (A, B, C, D)\n- Scored questions (8): Mix of medium difficulty questions that count toward the score\n- Unscored questions (2): Noticeably harder experimental questions that DO NOT count toward score\n- Focus on concepts that might appear on the EPPP exam\n- Include one correct answer per question\n- Provide brief explanations for why the correct answer is right\n- Include \"relatedSections\" - a list of 1-2 key concepts/section names that this question is about\n  * Use specific, concise terms (3-5 words max)\n  * These should be main topics or subtopics from the lesson\n  * Examples: \"Classical Conditioning\", \"Operant Conditioning\", \"Reinforcement Schedules\"\n  * Be consistent - reuse section names across multiple questions when appropriate\n- Mark unscored questions with \"isScored\": false (these 2 questions should be the hardest)\n- Mark scored questions with \"isScored\": true (default for all others)\n\nReturn the quiz in this exact JSON format:\n{\n  \"questions\": [\n    {\n      \"id\": 1,\n      \"question\": \"Question text\",\n      \"options\": [\"Option A\", \"Option B\", \"Option C\", \"Option D\"],\n      \"correctAnswer\": \"Option A\",\n      \"explanation\": \"Brief explanation of why this is correct\",\n      \"relatedSections\": [\"Main Concept\", \"Sub-concept\"],\n      \"isScored\": true\n    }\n  ]\n}\n\nIMPORTANT: Include exactly 2 questions with \"isScored\": false (the hardest ones). All others should have \"isScored\": true or omit the field (defaults to true).\n\nGenerate a quiz now. Return ONLY the JSON, no other text.`\n\ntype SectionInfo = { title: string; text: string }\nconst topicSectionCache = new Map<string, SectionInfo[]>()\n\nfunction getTopicSections(topicName: string, domainId?: string | null) {\n  const key = `${topicName}__${domainId || ''}`\n  if (topicSectionCache.has(key)) return topicSectionCache.get(key)!\n\n  const content = loadFullTopicContent(topicName, domainId || '')\n  if (!content) {\n    topicSectionCache.set(key, [])\n    return []\n  }\n\n  const lines = content.split('\\n')\n  const sections: SectionInfo[] = []\n  let current: SectionInfo | null = null\n\n  for (const line of lines) {\n    const headingMatch = line.match(/^(#{2,3})\\s+(.*)$/)\n    if (headingMatch) {\n      if (current) sections.push(current)\n      current = { title: headingMatch[2].trim(), text: '' }\n    } else if (current) {\n      current.text += line + '\\n'\n    }\n  }\n  if (current) sections.push(current)\n\n  topicSectionCache.set(key, sections)\n  return sections\n}\n\nconst normalizeTokens = (text: string) =>\n  text\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]+/g, ' ')\n    .split(/\\s+/)\n    .filter((w) => w.length > 3)\n\nconst jaccardSimilarity = (a: string[], b: string[]): number => {\n  if (a.length === 0 || b.length === 0) return 0\n  const setA = new Set(a)\n  const setB = new Set(b)\n  let intersection = 0\n  setA.forEach((token) => {\n    if (setB.has(token)) intersection++\n  })\n  const union = setA.size + setB.size - intersection\n  return union === 0 ? 0 : intersection / union\n}\n\nfunction isMeaningfulSection(section: string, topicName: string) {\n  const normalizedSection = section.trim().toLowerCase()\n  const normalizedTopic = topicName.trim().toLowerCase()\n  if (!normalizedSection) return false\n  return normalizedSection !== normalizedTopic\n}\n\nfunction attachSectionsToQuestion(\n  question: any,\n  topicName: string,\n  domainId?: string | null\n) {\n  if (!topicName) return question\n\n  const hasMeaningful =\n    Array.isArray(question.relatedSections) &&\n    question.relatedSections.some((section: string) =>\n      section && isMeaningfulSection(section, topicName)\n    )\n\n  if (hasMeaningful) {\n    return question\n  }\n\n  const sections = getTopicSections(topicName, domainId)\n  if (!sections || sections.length === 0) {\n    question.relatedSections = [topicName]\n    return question\n  }\n\n  const questionText = `${question.question ?? ''} ${question.explanation ?? ''}`\n  const qTokens = normalizeTokens(questionText)\n\n  const scoredSections = sections\n    .map((section) => {\n      const sectionTokens = normalizeTokens(`${section.title} ${section.text}`)\n      const score = jaccardSimilarity(qTokens, sectionTokens)\n      return { title: section.title, score }\n    })\n    .filter((s) => s.score > 0)\n    .sort((a, b) => b.score - a.score)\n\n  const topMatches = scoredSections.slice(0, 2).filter((s) => s.score >= 0.05)\n  if (topMatches.length > 0) {\n    question.relatedSections = topMatches.map((s) => s.title)\n  } else {\n    question.relatedSections = [topicName]\n  }\n\n  return question\n}\n\nfunction safeDecode(value: string): string {\n  try {\n    return decodeURIComponent(value)\n  } catch {\n    return value\n  }\n}\n\nfunction normalizeDomain(domain?: string | null): string | undefined {\n  if (!domain) return undefined\n  return domain.split(':')[0].trim()\n}\n\nfunction shuffleArray<T>(input: T[]): T[] {\n  const arr = [...input]\n  for (let i = arr.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1))\n    ;[arr[i], arr[j]] = [arr[j], arr[i]]\n  }\n  return arr\n}\n\nfunction buildQuizFromLocalQuestions(topicName: string, domain?: string) {\n  const loaded = loadTopicQuestions(topicName, domain)\n  if (!loaded) return null\n\n  const fileMeta = deriveTopicMetaFromSourceFile(loaded.filePath)\n  const derivedTopicName = fileMeta?.topicName || topicName\n  const derivedDomainId = fileMeta?.domainId || domain\n\n  const validQuestions = loaded.questions.filter((q: TopicQuestion) => {\n    const prompt = q.stem ?? q.question\n    const options = Array.isArray(q.options) ? q.options.filter((opt) => typeof opt === 'string' && opt.trim().length > 0) : []\n    const answer = q.answer ?? q.correct_answer\n    return (\n      typeof prompt === 'string' &&\n      prompt.trim().length > 0 &&\n      options.length >= 2 &&\n      typeof answer === 'string' &&\n      options.includes(answer)\n    )\n  })\n\n  if (validQuestions.length < 10) {\n    console.warn(`[Quizzer] Not enough valid questions for topic \"${topicName}\" (found ${validQuestions.length})`)\n    return null\n  }\n\n  const selected = shuffleArray(validQuestions).slice(0, 10)\n  const unscoredIndices = new Set<number>()\n\n  while (unscoredIndices.size < Math.min(2, selected.length)) {\n    unscoredIndices.add(Math.floor(Math.random() * selected.length))\n  }\n\n  return selected.map((q, idx) => {\n    const baseOptions = shuffleArray(\n      (Array.isArray(q.options) ? q.options : []).filter((opt) => typeof opt === 'string' && opt.trim().length > 0)\n    )\n    const correctAnswer = q.answer ?? q.correct_answer ?? baseOptions[0]\n\n    const question = {\n      id: idx + 1,\n      question: q.stem ?? q.question ?? '',\n      options: baseOptions,\n      correctAnswer,\n      explanation: q.explanation ?? '',\n      relatedSections: q.relatedSections && q.relatedSections.length > 0 ? q.relatedSections : [derivedTopicName],\n      isScored: !unscoredIndices.has(idx),\n    }\n\n    return attachSectionsToQuestion(question, derivedTopicName, derivedDomainId)\n  })\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { topic, domain } = body\n\n    if (!topic) {\n      return NextResponse.json(\n        { error: 'Topic required' },\n        { status: 400 }\n      )\n    }\n\n    const decodedTopic = safeDecode(topic)\n    const normalizedDomain = normalizeDomain(domain)\n\n    const localQuiz = decodedTopic ? buildQuizFromLocalQuestions(decodedTopic, normalizedDomain) : null\n    if (localQuiz) {\n      console.log(`[Quizzer] Serving local quiz for topic \"${decodedTopic}\" (${normalizedDomain ?? 'any domain'})`)\n      return NextResponse.json({ questions: localQuiz })\n    }\n\n    const response = await client.messages.create({\n      model: 'claude-haiku-4-5-20251001',\n      max_tokens: 4000,\n      messages: [\n        {\n          role: 'user',\n          content: `${QUIZZER_PROMPT}\\n\\nTopic: ${decodedTopic}`,\n        },\n      ],\n    })\n\n    const textContent = response.content.find((c) => c.type === 'text')\n    if (!textContent || textContent.type !== 'text') {\n      throw new Error('No text content in response')\n    }\n\n    const jsonMatch = textContent.text.match(/\\{[\\s\\S]*\\}/)\n    if (!jsonMatch) {\n      throw new Error('Could not parse quiz JSON from response')\n    }\n\n    const quizData = JSON.parse(jsonMatch[0])\n\n    if (decodedTopic && Array.isArray(quizData.questions)) {\n      quizData.questions = quizData.questions.map((question: any, idx: number) => {\n        const withId = { id: question.id ?? idx + 1, ...question }\n        return attachSectionsToQuestion(withId, decodedTopic, normalizedDomain)\n      })\n    }\n\n    return NextResponse.json(quizData)\n  } catch (error) {\n    console.error('Error generating quiz:', error)\n    return NextResponse.json(\n      { error: 'Failed to generate quiz' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/save-exam-results/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2101,2104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2101,2104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient, SupabaseClient } from '@supabase/supabase-js'\nimport { saveDevExamResult } from '@/lib/dev-exam-results-store'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\nconst supabase: SupabaseClient | null =\n  supabaseUrl && supabaseServiceRoleKey\n    ? createClient(supabaseUrl, supabaseServiceRoleKey)\n    : null\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      userId,\n      examType,\n      examMode,\n      questions,\n      selectedAnswers,\n      flaggedQuestions,\n      score,\n      totalQuestions,\n      topPriorities,\n      allResults,\n      assignmentId,\n    } = body\n\n    // Validate required fields\n    if (!userId || !examType || !examMode || !questions || !selectedAnswers) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      )\n    }\n\n    // Prepare record payload for Supabase or local storage fallback\n    const recordPayload = {\n      user_id: userId,\n      exam_type: examType,\n      exam_mode: examMode,\n      questions,\n      selected_answers: selectedAnswers,\n      flagged_questions: flaggedQuestions || {},\n      score,\n      total_questions: totalQuestions,\n      top_priorities: topPriorities || null,\n      all_results: allResults || null,\n      created_at: new Date().toISOString(),\n    }\n\n    let resultId: string | null = null\n\n    if (supabase) {\n      const { data, error } = await supabase\n        .from('exam_results')\n        .insert(recordPayload)\n        .select('id')\n        .single()\n\n      if (error) {\n        console.error('Error saving exam results to Supabase:', error)\n      } else {\n        resultId = data.id\n\n        // Also upsert study_priorities so dashboard/topic-selector\n        // can immediately reflect the latest priority focus areas.\n        if (userId && topPriorities && Array.isArray(topPriorities)) {\n          try {\n            const topDomains = (topPriorities as any[]).slice(0, 3)\n            const { error: prioritiesError } = await supabase\n              .from('study_priorities')\n              .upsert(\n                {\n                  user_id: userId,\n                  top_domains: topDomains,\n                  exam_score: score,\n                  total_questions: totalQuestions,\n                  created_at: new Date().toISOString(),\n                },\n                { onConflict: 'user_id' },\n              )\n\n            if (prioritiesError) {\n              console.error('Error upserting study_priorities in save-exam-results:', prioritiesError)\n            }\n          } catch (prioritiesException) {\n            console.error('Exception upserting study_priorities in save-exam-results:', prioritiesException)\n          }\n        }\n\n        // If assignmentId is provided, mark the assignment as completed\n        if (assignmentId) {\n          const { error: assignmentError } = await supabase\n            .from('user_exam_assignments')\n            .update({\n              completed: true,\n              completed_at: new Date().toISOString(),\n              exam_result_id: data.id,\n            })\n            .eq('id', assignmentId)\n\n          if (assignmentError) {\n            console.error('Error updating assignment:', assignmentError)\n            // Don't fail the entire request if assignment update fails\n          }\n        }\n      }\n    } else {\n      console.warn(\n        '[save-exam-results] SUPABASE_SERVICE_ROLE_KEY not configured. Falling back to local in-memory storage.'\n      )\n    }\n\n    if (!resultId) {\n      resultId = saveDevExamResult(recordPayload)\n    }\n\n    return NextResponse.json({\n      success: true,\n      resultId,\n      storage: supabase ? 'supabase' : 'local',\n    })\n  } catch (error) {\n    console.error('Error in save-exam-results:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/api/user-completed-exams/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1418,1421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1418,1421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { getSupabaseClient } from '@/lib/supabase-server'\n\n/**\n * Get user's completed exams with all details\n * GET /api/user-completed-exams?userId=xxxxx\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userId = searchParams.get('userId')\n\n    if (!userId) {\n      return NextResponse.json(\n        { error: 'Missing userId query parameter' },\n        { status: 400 }\n      )\n    }\n\n    const supabase = getSupabaseClient(undefined, { requireServiceRole: true })\n    if (!supabase) {\n      return NextResponse.json(\n        { error: 'Supabase is not configured' },\n        { status: 500 }\n      )\n    }\n\n    // Query completed assignments\n    const { data: assignments, error: queryError } = await supabase\n      .from('user_exam_assignments')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('completed', true)\n      .order('completed_at', { ascending: false })\n\n    if (queryError) {\n      console.error('Error querying completed assignments:', queryError)\n      throw queryError\n    }\n\n    if (!assignments || assignments.length === 0) {\n      return NextResponse.json({\n        success: true,\n        completedExams: [],\n      })\n    }\n\n    // Fetch exam details for each completed exam\n    const completedExams = await Promise.all(\n      assignments.map(async (assignment: any) => {\n        try {\n          const examData = await fetchExamFromGitHub(\n            assignment.exam_file,\n            assignment.exam_type\n          )\n\n          return {\n            assignmentId: assignment.id,\n            examFile: assignment.exam_file,\n            examType: assignment.exam_type,\n            assignedAt: assignment.assigned_at,\n            completedAt: assignment.completed_at,\n            score: assignment.score,\n            metadata: examData.metadata,\n            questions: examData.questions,\n          }\n        } catch (error) {\n          console.error(\n            `Error fetching exam ${assignment.exam_file}:`,\n            error\n          )\n          return {\n            assignmentId: assignment.id,\n            examFile: assignment.exam_file,\n            examType: assignment.exam_type,\n            assignedAt: assignment.assigned_at,\n            completedAt: assignment.completed_at,\n            score: assignment.score,\n            error: 'Failed to load exam details',\n          }\n        }\n      })\n    )\n\n    return NextResponse.json({\n      success: true,\n      completedExams,\n    })\n  } catch (error) {\n    console.error('Error getting completed exams:', error)\n    return NextResponse.json(\n      {\n        error: 'Failed to get completed exams',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    )\n  }\n}\n\n/**\n * Fetch exam from GitHub\n */\nasync function fetchExamFromGitHub(\n  examFile: string,\n  examType: 'diagnostic' | 'practice'\n) {\n  const response = await fetch(\n    `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/fetch-exam-from-github?examFile=${examFile}&examType=${examType}`\n  )\n\n  if (!response.ok) {\n    throw new Error(`Failed to fetch exam: ${response.statusText}`)\n  }\n\n  const data = await response.json()\n  return {\n    metadata: data.metadata,\n    questions: data.questions,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/dashboard/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectContent' is defined but never used.","line":13,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectGroup' is defined but never used.","line":13,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectItem' is defined but never used.","line":13,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectLabel' is defined but never used.","line":13,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectTrigger' is defined but never used.","line":13,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectValue' is defined but never used.","line":13,"column":86,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":97},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Ripple' is defined but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LogOut' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3277,3280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3277,3280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7071,7074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7071,7074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8093,8096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8093,8096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9271,9274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9271,9274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":478,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":478,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSignOut' is assigned a value but never used.","line":489,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":489,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'studyPace' is assigned a value but never used.","line":511,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":511,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":609,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":609,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21972,21975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21972,21975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":613,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":613,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22204,22207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22204,22207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useRouter } from 'next/navigation'\nimport { useAuth } from '@/context/auth-context'\nimport { useEffect, useState, useCallback } from 'react'\nimport { getAllQuizResults } from '@/lib/quiz-results-storage'\nimport { supabase } from '@/lib/supabase'\nimport { Button } from '@/components/ui/button'\nimport { Progress } from '@/components/ui/progress'\nimport { Badge } from '@/components/ui/badge'\nimport { Calendar } from '@/components/ui/calendar'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { Select, SelectContent, SelectGroup, SelectItem, SelectLabel, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Carousel, CarouselContent, CarouselItem, CarouselPrevious, CarouselNext } from '@/components/ui/carousel'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { NumberTicker } from '@/components/ui/number-ticker'\nimport { BentoCard, BentoGrid } from '@/components/ui/bento-grid'\nimport { Marquee } from '@/components/ui/marquee'\nimport { Ripple } from '@/components/ui/ripple'\nimport { BreathingAnimation } from '@/components/ui/breathing-animation'\nimport { ProgressiveBlur } from '@/components/ui/progressive-blur'\nimport { CalendarIcon, FileTextIcon, PersonIcon } from '@radix-ui/react-icons'\nimport { LogOut, GraduationCap, Droplets, Target, Flame, AlertCircle, History, X, MessageSquare } from 'lucide-react'\nimport { calculateStudyStats, calculateStudyPace, getDailyGoal, getTodayQuizCount, setDailyGoal } from '@/lib/dashboard-utils'\nimport { EPPP_DOMAINS } from '@/lib/eppp-data'\nimport { getTopPriorities, getAllLatestRecommendations } from '@/lib/priority-storage'\nimport { triggerBackgroundPreGeneration } from '@/lib/pre-generated-exams'\nimport { siteConfig } from '@/lib/config'\nimport { Switch } from '@/components/ui/switch'\nimport { FeedbackInputBox } from '@/components/ui/feedback-input-box'\nimport { InteractiveHoverButton } from '@/components/ui/interactive-hover-button'\n\nexport default function DashboardPage() {\n  const router = useRouter()\n  const { user, userProfile, loading, signOut, refreshProfile } = useAuth()\n  const getBaseUrl = () => {\n    if (typeof window !== 'undefined') {\n      return window.location.origin\n    }\n    return (process.env.NEXT_PUBLIC_APP_URL || siteConfig.url || '').replace(/\\/$/, '')\n  }\n  const prioritizeHref = `${getBaseUrl()}/prioritize`\n  const [mounted, setMounted] = useState(false)\n  const [progressData, setProgressData] = useState({\n    totalCompletion: 0,\n    completedTopics: 0,\n    totalTopics: 81,\n    completedDomains: 0,\n    totalDomains: 12,\n    domainProgress: Array(12).fill(0),\n  })\n  const [daysRemaining, setDaysRemaining] = useState<number | null>(null)\n  const [examDate, setExamDate] = useState<string | null>(null)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(undefined)\n  const [isExamDatePopoverOpen, setIsExamDatePopoverOpen] = useState(false)\n  const [studyStats, setStudyStats] = useState(calculateStudyStats())\n  const [dailyGoal, setDailyGoalState] = useState(getDailyGoal())\n  const [todayQuizCount, setTodayQuizCount] = useState(0)\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false)\n  const [priorityDomains, setPriorityDomains] = useState<any[]>([])\n  const [hasPausedExam, setHasPausedExam] = useState(false)\n  const [isPricingCarouselOpen, setIsPricingCarouselOpen] = useState(false)\n  const [isFeedbackOpen, setIsFeedbackOpen] = useState(false)\n  const [feedbackMessage, setFeedbackMessage] = useState('')\n  const [feedbackStatus, setFeedbackStatus] = useState<'success' | 'error' | null>(null)\n  const [isFeedbackSubmitting, setIsFeedbackSubmitting] = useState(false)\n  const [isAnonymousFeedback, setIsAnonymousFeedback] = useState(false)\n\n  const handleDailyGoalChange = (newGoal: number) => {\n    setDailyGoalState(newGoal)\n    setDailyGoal(newGoal)\n    setIsPopoverOpen(false)\n  }\n\n  useEffect(() => {\n    if (!isFeedbackOpen) {\n      setFeedbackMessage('')\n      setFeedbackStatus(null)\n      setIsAnonymousFeedback(false)\n    }\n  }, [isFeedbackOpen])\n\n  const handleSendFeedback = async (message: string, screenshotFile?: File | null) => {\n    const trimmedMessage = message.trim()\n    if ((!trimmedMessage && !screenshotFile) || !user) return\n    const payloadMessage = trimmedMessage || (screenshotFile ? '[Screenshot attached]' : '')\n\n    setIsFeedbackSubmitting(true)\n    setFeedbackStatus(null)\n    setFeedbackMessage('')\n\n    try {\n      let screenshotPath: string | null = null\n\n      if (screenshotFile) {\n        const extensionFromType = screenshotFile.type?.split('/').pop()\n        const extensionFromName = screenshotFile.name.split('.').pop()\n        const extension = extensionFromType || extensionFromName || 'png'\n        const uniqueSuffix = `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\n        const storagePath = `${user.id}/${uniqueSuffix}.${extension}`\n        const { data: uploadData, error: uploadError } = await supabase.storage\n          .from('feedback-screenshot')\n          .upload(storagePath, screenshotFile, {\n            cacheControl: '3600',\n            upsert: false,\n            contentType: screenshotFile.type || undefined,\n          })\n\n        if (uploadError) {\n          throw uploadError\n        }\n\n        screenshotPath = uploadData?.path || storagePath\n      }\n\n      const pagePath = typeof window !== 'undefined' ? window.location.pathname : '/dashboard'\n      const { error } = await supabase.from('feedback').insert({\n        user_id: isAnonymousFeedback ? null : user.id,\n        user_email: isAnonymousFeedback ? null : user.email || null,\n        message: payloadMessage,\n        page_path: pagePath,\n        screenshot_path: screenshotPath,\n        is_anonymous: isAnonymousFeedback,\n        status: 'new',\n      })\n\n      if (error) {\n        throw error\n      }\n\n      console.log('Feedback successfully saved for user:', user.id)\n      setFeedbackMessage('Thank you for your feedback!')\n      setFeedbackStatus('success')\n\n      setTimeout(() => {\n        setFeedbackMessage('')\n        setFeedbackStatus(null)\n        setIsFeedbackOpen(false)\n      }, 2000)\n    } catch (err) {\n      console.error('Error submitting feedback:', err)\n      setFeedbackMessage('Failed to send feedback. Please try again.')\n      setFeedbackStatus('error')\n      throw err\n    } finally {\n      setIsFeedbackSubmitting(false)\n    }\n  }\n\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  const storeExamDateLocally = useCallback((dateString: string) => {\n    if (typeof window === 'undefined') return\n\n    try {\n      if (user?.id) {\n        localStorage.setItem(`examDate_${user.id}`, dateString)\n      }\n\n      // Legacy fallback structure for older users\n      const currentUser = localStorage.getItem('currentUser')\n      if (currentUser) {\n        const userData = JSON.parse(currentUser)\n        const usersData = localStorage.getItem('users')\n        if (usersData) {\n          const users = JSON.parse(usersData)\n          const userIndex = users.findIndex((u: any) => u.id === userData.id)\n          if (userIndex !== -1) {\n            if (!users[userIndex].goals) {\n              users[userIndex].goals = {}\n            }\n            users[userIndex].goals.examDate = dateString\n            localStorage.setItem('users', JSON.stringify(users))\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Error updating exam date in localStorage:', e)\n    }\n  }, [user?.id])\n\n  const loadExamDateFromLocalStorage = useCallback(() => {\n    if (typeof window === 'undefined') return null\n\n    try {\n      if (user?.id) {\n        const storedValue = localStorage.getItem(`examDate_${user.id}`)\n        if (storedValue) {\n          return storedValue\n        }\n      }\n\n      const currentUser = localStorage.getItem('currentUser')\n      if (currentUser) {\n        const userData = JSON.parse(currentUser)\n        const usersData = localStorage.getItem('users')\n        if (usersData) {\n          const users = JSON.parse(usersData)\n          const userRecord = users.find((u: any) => u.id === userData.id)\n          if (userRecord?.goals?.examDate) {\n            return userRecord.goals.examDate\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Error retrieving exam date from localStorage:', e)\n    }\n\n    return null\n  }, [user?.id])\n\n  // Load exam date when userProfile changes\n  useEffect(() => {\n    if (userProfile?.exam_date) {\n      console.log('[Dashboard] Loading exam date from userProfile:', userProfile.exam_date)\n      setExamDate(userProfile.exam_date)\n      if (user?.id) {\n        storeExamDateLocally(userProfile.exam_date)\n      }\n      return\n    }\n\n    const localExamDate = loadExamDateFromLocalStorage()\n    if (localExamDate) {\n      setExamDate(localExamDate)\n    }\n  }, [userProfile, loadExamDateFromLocalStorage, storeExamDateLocally, user?.id])\n\n  // Load priority recommendations from Supabase\n  useEffect(() => {\n    const loadPriorities = async () => {\n      const applyLocalPriorityFallback = () => {\n        const { diagnostic, practice } = getAllLatestRecommendations()\n        const available = [diagnostic, practice].filter(Boolean) as Array<{\n          timestamp: number\n          topPriorities: any[]\n        }>\n\n        if (available.length === 0) {\n          const localDiagnostic = getTopPriorities('diagnostic')\n          if (localDiagnostic && localDiagnostic.length > 0) {\n            setPriorityDomains(localDiagnostic)\n          } else {\n            setPriorityDomains([])\n          }\n          return\n        }\n\n        available.sort((a, b) => b.timestamp - a.timestamp)\n        const latest = available[0]\n        setPriorityDomains(latest.topPriorities || [])\n      }\n\n      if (!user?.id) {\n        applyLocalPriorityFallback()\n        return\n      }\n\n      try {\n        const { data, error } = await supabase\n          .from('study_priorities')\n          .select('top_domains')\n          .eq('user_id', user.id)\n          .single()\n\n        if (data && !error) {\n          setPriorityDomains(data.top_domains || [])\n        } else {\n          applyLocalPriorityFallback()\n        }\n      } catch (err) {\n        console.error('Failed to load priorities from Supabase:', err)\n        applyLocalPriorityFallback()\n      }\n    }\n\n    loadPriorities()\n  }, [user?.id])\n\n  // Pre-generate exams in background for faster exam loading\n  useEffect(() => {\n    if (user?.id) {\n      triggerBackgroundPreGeneration(user.id, 'diagnostic')\n      triggerBackgroundPreGeneration(user.id, 'practice')\n    }\n  }, [user?.id])\n\n  // Check for paused exam on mount\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const pausedState = localStorage.getItem('pausedExamState')\n      setHasPausedExam(!!pausedState)\n    }\n  }, [])\n\n  // Memoized update progress function\n  const updateProgress = useCallback(() => {\n    const allResults = getAllQuizResults()\n\n    // Build topic-to-domain mapping dynamically from EPPP_DOMAINS\n    const topicsByDomain: Record<number, string[]> = {}\n    EPPP_DOMAINS.forEach((domain, idx) => {\n      topicsByDomain[idx] = domain.topics.map(t => t.name)\n    })\n\n    // Calculate domain progress based on quiz results\n    const domainProgress: number[] = new Array(EPPP_DOMAINS.length).fill(0)\n    const topicScores: Record<number, Record<string, number>> = {}\n\n    // Initialize topic scores for each domain\n    EPPP_DOMAINS.forEach((_, domainIdx) => {\n      topicScores[domainIdx] = {}\n      topicsByDomain[domainIdx]?.forEach(topic => {\n        topicScores[domainIdx][topic] = 0\n      })\n    })\n\n    // Process all quiz results\n    let totalScore = 0\n    let totalQuizzes = 0\n    const completedTopics = new Set<string>()\n\n    allResults.forEach((result) => {\n      const percentage = (result.score / result.totalQuestions) * 100\n      completedTopics.add(result.topic)\n      totalScore += percentage\n      totalQuizzes++\n\n      // Find which domain this topic belongs to\n      for (let domainIdx = 0; domainIdx < EPPP_DOMAINS.length; domainIdx++) {\n        const topics = topicsByDomain[domainIdx] || []\n        const matchedTopic = topics.find(t => t.toLowerCase() === result.topic.toLowerCase())\n        if (matchedTopic) {\n          topicScores[domainIdx][matchedTopic] = percentage\n          break\n        }\n      }\n    })\n\n    // Calculate domain progress as average of all topics in domain\n    EPPP_DOMAINS.forEach((_, domainIdx) => {\n      const topicsInDomain = topicsByDomain[domainIdx] || []\n      if (topicsInDomain.length === 0) {\n        domainProgress[domainIdx] = 0\n        return\n      }\n\n      const scores = topicsInDomain.map(t => topicScores[domainIdx][t] || 0)\n      const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length\n      domainProgress[domainIdx] = avgScore\n    })\n\n    // Calculate overall completion\n    const totalCompletion = totalQuizzes > 0 ? Math.round(totalScore / totalQuizzes) : 0\n    const completedDomainsCount = domainProgress.filter(p => p >= 80).length\n    const totalTopics = Object.values(topicsByDomain).reduce((sum, topics) => sum + topics.length, 0)\n\n    setProgressData({\n      totalCompletion,\n      completedTopics: completedTopics.size,\n      totalTopics,\n      completedDomains: completedDomainsCount,\n      totalDomains: EPPP_DOMAINS.length,\n      domainProgress,\n    })\n  }, [])\n\n  // Calculate progress based on quiz results\n  useEffect(() => {\n    if (!mounted) return\n\n    // Initial update\n    updateProgress()\n\n    // Listen for storage changes and quiz results updates\n    window.addEventListener('storage', updateProgress)\n    window.addEventListener('quiz-results-updated', updateProgress)\n    return () => {\n      window.removeEventListener('storage', updateProgress)\n      window.removeEventListener('quiz-results-updated', updateProgress)\n    }\n  }, [mounted, updateProgress])\n\n  // Memoized update stats function\n  const updateStats = useCallback(() => {\n    setStudyStats(calculateStudyStats())\n    setTodayQuizCount(getTodayQuizCount())\n  }, [])\n\n  // Memoized update priorities function\n  const updatePriorities = useCallback(() => {\n    const priorities = getTopPriorities('diagnostic')\n    setPriorityDomains(priorities || [])\n  }, [])\n\n  // Update study stats and today's quiz count\n  useEffect(() => {\n    if (!mounted) return\n\n    updateStats()\n    updatePriorities()\n\n    // Listen for storage changes and quiz/priority results updates\n    window.addEventListener('storage', updateStats)\n    window.addEventListener('quiz-results-updated', updateStats)\n    window.addEventListener('quiz-results-updated', updatePriorities)\n    window.addEventListener('priority-recommendations-updated', updatePriorities)\n    return () => {\n      window.removeEventListener('storage', updateStats)\n      window.removeEventListener('quiz-results-updated', updateStats)\n      window.removeEventListener('quiz-results-updated', updatePriorities)\n      window.removeEventListener('priority-recommendations-updated', updatePriorities)\n    }\n  }, [mounted, updateStats, updatePriorities])\n\n  // Calculate days remaining to exam\n  useEffect(() => {\n    if (examDate) {\n      // Parse date components and create at midnight UTC to match react-day-picker\n      const [year, month, day] = examDate.split('-').map(Number)\n      const exam = new Date(Date.UTC(year, month - 1, day))\n      const today = new Date()\n      today.setHours(0, 0, 0, 0)\n      const diffTime = exam.getTime() - today.getTime()\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\n      setDaysRemaining(diffDays)\n      setSelectedDate(exam)\n    }\n  }, [examDate])\n\n  const handleSaveExamDate = async (date: Date | undefined) => {\n    if (date && user) {\n      // Use local date methods to extract the date the user clicked\n      // Calendar component passes Date in local timezone, so use local methods\n      const year = date.getFullYear()\n      const month = date.getMonth()\n      const day = date.getDate()\n\n      // Create date string (YYYY-MM-DD)\n      const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`\n      console.log('[Dashboard] Saving exam date:', dateString, 'for user:', user.id)\n      setExamDate(dateString)\n      storeExamDateLocally(dateString)\n\n      // Save to Supabase\n      try {\n        const { data, error } = await supabase\n          .from('users')\n          .update({ exam_date: dateString })\n          .eq('id', user.id)\n          .select()\n\n        if (error) {\n          const supabaseMessage = error?.message || error || 'Unknown error'\n          console.warn('[Dashboard] Supabase exam date update skipped (using local cache):', supabaseMessage)\n        } else {\n          console.log('[Dashboard] Exam date saved to Supabase successfully:', dateString, 'Response:', data)\n          // Refresh the user profile to get the updated exam date\n          await refreshProfile()\n        }\n      } catch (error) {\n        console.error('[Dashboard] Supabase save failed:', error)\n      }\n\n      setIsExamDatePopoverOpen(false)\n    }\n  }\n\n  // Helper function to format date as \"MMM DD\"\n  const formatDateShort = (dateString: string): string => {\n    try {\n      const [year, month, day] = dateString.split('-').map(Number)\n      const date = new Date(year, month - 1, day)\n      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\n      return `${monthNames[date.getMonth()]} ${date.getDate()}`\n    } catch (e) {\n      return dateString\n    }\n  }\n\n  useEffect(() => {\n    if (mounted && !loading && !user) {\n      router.push('/login')\n    }\n  }, [user, loading, mounted, router])\n\n  const handleSignOut = async () => {\n    try {\n      await signOut()\n      router.push('/')\n    } catch (error) {\n      console.error('Sign out error:', error)\n    }\n  }\n\n  if (!mounted || loading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-sm text-muted-foreground\">Loading...</div>\n      </div>\n    )\n  }\n\n  if (!user) {\n    return null\n  }\n\n  // Calculate study pace\n  const studyPace = calculateStudyPace(examDate, progressData.completedTopics)\n\n  // ACTION BUTTONS - Bigger, more prominent\n  const actionCards = [\n    {\n      Icon: GraduationCap,\n      name: \"Practice\",\n      description: hasPausedExam ? \"Resume your paused practice exam\" : \"Take practice exams to test your knowledge\",\n      href: \"/exam-generator\",\n      cta: hasPausedExam ? \"Resume?\" : \"Start Exam\",\n      className: \"lg:col-start-1 lg:col-end-3 lg:row-start-1 lg:row-end-5\",\n      background: (\n        <Marquee className=\"absolute inset-0 opacity-20\" repeat={2}>\n          <div className=\"flex gap-6 whitespace-nowrap px-4\">\n            <span>Build confidence</span>\n            <span>â€¢</span>\n            <span>225 questions</span>\n            <span>â€¢</span>\n            <span>Master content</span>\n            <span>â€¢</span>\n            <span>4h 15min timer</span>\n            <span>â€¢</span>\n            <span>Study smarter</span>\n            <span>â€¢</span>\n            <span>Realistic exam experience</span>\n            <span>â€¢</span>\n            <span>Track progress</span>\n            <span>â€¢</span>\n            <span>Study & Test modes</span>\n          </div>\n        </Marquee>\n      ),\n    },\n    {\n      Icon: History,\n      name: \"Prioritize\",\n      description: \"Review exams results\",\n      href: prioritizeHref,\n      cta: \"View Results\",\n      className: \"lg:col-start-1 lg:col-end-2 lg:row-start-5 lg:row-end-7\",\n    },\n    {\n      Icon: Droplets,\n      name: \"Recover\",\n      description: \"Improve focus and reduce burnout\",\n      href: \"#\",\n      cta: \"Coming Soon\",\n      className: \"lg:col-start-2 lg:col-end-3 lg:row-start-5 lg:row-end-7 group cursor-not-allowed opacity-75\",\n      background: (\n        <div className=\"absolute inset-0 overflow-hidden\">\n          <BreathingAnimation speed={0.596} />\n        </div>\n      ),\n    },\n    {\n      Icon: FileTextIcon,\n      name: \"Study\",\n      description: `${studyStats.totalQuizzes} quizzes â€¢ ${progressData.completedTopics}/${progressData.totalTopics} topics`,\n      href: \"/topic-selector\",\n      cta: \"Start Studying\",\n      className: \"lg:col-start-3 lg:col-end-5 lg:row-start-1 lg:row-end-7\",\n      background: (\n        <div className=\"absolute inset-0 flex flex-col items-start justify-start pt-4 p-4 h-full\">\n          {/* Priority Badges Section */}\n          {priorityDomains.length > 0 && (\n            <div className=\"w-full mb-3 pb-3 border-b border-border/40\">\n              <div className=\"text-xs font-semibold text-foreground/70 mb-2 flex items-center gap-1\">\n                <AlertCircle className=\"w-3 h-3\" style={{ color: '#c46685' }} />\n                Priority Focus\n              </div>\n              <div className=\"flex flex-wrap gap-1\">\n                {priorityDomains.slice(0, 3).map((domain, idx) => {\n                  const colors = ['#bdd1ca', '#788c5d', '#d87758']\n                  const color = colors[idx]\n                  return (\n                    <Badge\n                      key={idx}\n                      variant=\"outline\"\n                      className=\"text-xs\"\n                      style={{\n                        borderColor: color,\n                        backgroundColor: `${color}20`,\n                        color: color,\n                      }}\n                    >\n                      #{idx + 1}: {domain.domainName.split(':')[0]}\n                    </Badge>\n                  )\n                })}\n              </div>\n            </div>\n          )}\n\n          <ScrollArea className=\"w-full h-full pr-4\">\n            <div className=\"w-full space-y-2 opacity-60\">\n              {EPPP_DOMAINS.map((domain, idx) => {\n                const [prefix] = domain.id.split('-')\n                const domainNumber = parseInt(prefix, 10)\n                const hasOrgPsychPriority = priorityDomains.some((p: any) => p.type === 'org_psych')\n                const isOrgPsychDomain = domain.id === '3-5-6'\n                const isPriority = isOrgPsychDomain\n                  ? hasOrgPsychPriority\n                  : priorityDomains.some((p: any) => typeof p.domainNumber === 'number' && p.domainNumber === domainNumber)\n                return (\n                  <div key={idx} className={`space-y-1 pr-2 ${isPriority ? 'opacity-100' : ''}`}>\n                    <div className=\"flex items-center justify-between text-xs\">\n                      <div className=\"flex items-center gap-1 truncate\">\n                        {isPriority && <AlertCircle className=\"w-3 h-3 flex-shrink-0\" style={{ color: '#c46685' }} />}\n                        <span className=\"text-foreground/80 truncate\">{domain.name}</span>\n                      </div>\n                      <span className=\"text-foreground/60 ml-1 flex-shrink-0\">{Math.round(progressData.domainProgress[idx] || 0)}%</span>\n                    </div>\n                    <Progress value={progressData.domainProgress[idx] || 0} className=\"h-1\" />\n                  </div>\n                )\n              })}\n            </div>\n          </ScrollArea>\n        </div>\n      ),\n    },\n  ]\n\n  // INFO CARDS - Smaller, secondary information (narrow, on right side)\n  const infoCards = [\n    {\n      Icon: CalendarIcon,\n      name: examDate ? formatDateShort(examDate) : \"Exam Date\",\n      description: examDate && daysRemaining !== null\n        ? `${daysRemaining} ${daysRemaining === 1 ? 'day' : 'days'} remaining`\n        : \"Set your exam date\",\n      href: \"#\",\n      cta: isExamDatePopoverOpen ? \"\" : \"Edit Date\", // Hide CTA when calendar is open\n      className: \"lg:col-start-5 lg:col-end-6 lg:row-start-1 lg:row-end-3\",\n      background: (\n        <div\n          className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-auto cursor-pointer\"\n          onClick={() => !isExamDatePopoverOpen && setIsExamDatePopoverOpen(true)}\n        >\n          {isExamDatePopoverOpen ? (\n            <div className=\"relative w-full h-full pointer-events-auto overflow-hidden rounded-lg\" onClick={(e) => e.stopPropagation()}>\n              {/* Close button */}\n              <button\n                onClick={() => setIsExamDatePopoverOpen(false)}\n                className=\"absolute top-2 right-2 z-10 w-6 h-6 flex items-center justify-center rounded-full bg-background/80 hover:bg-background border border-border text-foreground/60 hover:text-foreground transition-colors\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n              <div className=\"flex items-center justify-center p-1 h-full overflow-auto\">\n                <Calendar\n                  mode=\"single\"\n                  selected={selectedDate}\n                  onSelect={(date) => {\n                    handleSaveExamDate(date)\n                    setIsExamDatePopoverOpen(false)\n                  }}\n                  captionLayout=\"dropdown\"\n                  fromYear={new Date().getFullYear()}\n                  toYear={new Date().getFullYear() + 5}\n                  className=\"rounded-lg border scale-[0.65] origin-center\"\n                  fixedWeeks\n                />\n              </div>\n            </div>\n          ) : null}\n        </div>\n      ),\n    },\n    {\n      Icon: Flame,\n      name: \"Study Streak\",\n      description: \"\",\n      href: \"/topic-selector\",\n      cta: \"Keep it going\",\n      className: \"lg:col-start-5 lg:col-end-6 lg:row-start-3 lg:row-end-5\",\n      background: (\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center gap-2\">\n          <NumberTicker\n            value={studyStats.studyStreak}\n            duration={1.5}\n            className=\"text-4xl font-bold text-primary\"\n          />\n          <span className=\"text-xs text-muted-foreground\">{studyStats.studyStreak === 1 ? 'day' : 'days'}</span>\n        </div>\n      ),\n    },\n    {\n      Icon: Target,\n      name: \"Daily Goal\",\n      description: `${dailyGoal} topic${dailyGoal > 1 ? 's' : ''}/day`,\n      href: \"#\",\n      cta: \"Edit\",\n      className: \"lg:col-start-5 lg:col-end-6 lg:row-start-5 lg:row-end-7\",\n      background: (\n        <div\n          className=\"absolute inset-0 flex flex-col items-center justify-center gap-3 pointer-events-auto cursor-pointer\"\n          onClick={() => !isPopoverOpen && setIsPopoverOpen(true)}\n        >\n          {!isPopoverOpen ? (\n            <div className=\"absolute inset-0 flex flex-col items-center justify-start pt-8 gap-2\">\n              <div className=\"relative w-24 h-24 opacity-30\">\n                <svg className=\"w-24 h-24 transform -rotate-90\" viewBox=\"0 0 128 128\">\n                  <circle\n                    cx=\"64\"\n                    cy=\"64\"\n                    r=\"56\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"8\"\n                    className=\"text-border/50\"\n                  />\n                  <circle\n                    cx=\"64\"\n                    cy=\"64\"\n                    r=\"56\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"8\"\n                    className=\"text-primary transition-all duration-500\"\n                    strokeDasharray={`${(Math.min(todayQuizCount / dailyGoal, 1)) * (56 * 2 * Math.PI)} ${56 * 2 * Math.PI}`}\n                  />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center text-lg font-bold text-white\">\n                  {Math.round((todayQuizCount / dailyGoal) * 100)}%\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"relative w-full h-full pointer-events-auto overflow-hidden rounded-lg\" onClick={(e) => e.stopPropagation()}>\n              <ScrollArea className=\"relative w-full h-full\">\n                <div className=\"flex flex-col gap-2 p-4 min-h-full\">\n                  {[1, 2, 3, 4, 5, 6, 7].map((goal) => (\n                    <Button\n                      key={goal}\n                      variant={dailyGoal === goal ? \"default\" : \"outline\"}\n                      className=\"w-full justify-center text-lg\"\n                      onClick={() => {\n                        handleDailyGoalChange(goal)\n                        setIsPopoverOpen(false)\n                      }}\n                    >\n                      {goal}\n                    </Button>\n                  ))}\n                </div>\n                <ProgressiveBlur position=\"bottom\" height=\"30%\" />\n              </ScrollArea>\n            </div>\n          )}\n        </div>\n      ),\n    },\n  ]\n\n  return (\n    <main className=\"min-h-screen bg-background\">\n      <div className=\"max-w-6xl mx-auto px-6 py-12 space-y-8\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Dashboard</h1>\n          <p className=\"text-muted-foreground\">Welcome back, {userProfile?.email?.split('@')[0]}</p>\n        </div>\n\n        {/* Bento Grid - Practice above, Review Exams and Prioritize side-by-side, Recover below, Study on right, Info cards on far right */}\n        <BentoGrid className=\"lg:grid-rows-6 lg:grid-cols-5\">\n          {/* Action Cards */}\n          {actionCards.map((feature, idx) => (\n            <BentoCard\n              key={`action-${idx}`}\n              {...feature}\n              onClick={feature.name === \"Study\" ? undefined : undefined}\n            />\n          ))}\n\n          {/* Info Cards */}\n          {infoCards.map((feature, idx) => (\n            <BentoCard\n              key={`info-${idx}`}\n              {...feature}\n              onClick={\n                (examDate ? formatDateShort(examDate) : \"Exam Date\") === feature.name\n                  ? () => setIsExamDatePopoverOpen(true)\n                  : undefined\n              }\n              classNameHeader={\n                (feature.name === \"Daily Goal\" && isPopoverOpen) ||\n                ((examDate ? formatDateShort(examDate) : \"Exam Date\") === feature.name && isExamDatePopoverOpen)\n                  ? \"opacity-0 transition-opacity duration-300\"\n                  : \"transition-opacity duration-300\"\n              }\n              showHeader={\n                !(feature.name === \"Daily Goal\" && isPopoverOpen) &&\n                !((examDate ? formatDateShort(examDate) : \"Exam Date\") === feature.name && isExamDatePopoverOpen)\n              }\n            />\n          ))}\n        </BentoGrid>\n\n        {/* Account Status Box */}\n        <div className=\"border border-border/50 rounded-lg p-6 bg-white dark:bg-black backdrop-blur-sm\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n              <PersonIcon className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3\n                className=\"font-semibold text-foreground cursor-pointer hover:text-primary transition-colors\"\n                onClick={() => {\n                  const newName = prompt('Enter your name:', userProfile?.email?.split('@')[0] || '')\n                  if (newName && newName.trim()) {\n                    // TODO: Save name to user profile\n                    console.log('Saving name:', newName)\n                  }\n                }}\n              >\n                {userProfile?.email?.split('@')[0]}\n              </h3>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <p className=\"text-sm text-muted-foreground\">{userProfile?.email}</p>\n              </div>\n              <div className=\"flex items-center gap-2 flex-nowrap\">\n                <Badge\n                  variant=\"outline\"\n                  className=\"text-xs\"\n                  style={{\n                    borderColor: userProfile?.subscription_tier === 'pro_coaching' ? '#c46685' :\n                                 userProfile?.subscription_tier === 'pro' ? '#6a9bcc' :\n                                 userProfile?.subscription_tier === 'basic' ? '#bdd1ca' : '#cbc9db',\n                    backgroundColor: userProfile?.subscription_tier === 'pro_coaching' ? 'rgba(196, 102, 133, 0.1)' :\n                                     userProfile?.subscription_tier === 'pro' ? 'rgba(106, 155, 204, 0.1)' :\n                                     userProfile?.subscription_tier === 'basic' ? 'rgba(189, 209, 202, 0.1)' : 'rgba(203, 201, 219, 0.1)',\n                    color: userProfile?.subscription_tier === 'pro_coaching' ? '#c46685' :\n                           userProfile?.subscription_tier === 'pro' ? '#6a9bcc' :\n                           userProfile?.subscription_tier === 'basic' ? '#bdd1ca' : '#cbc9db',\n                  }}\n                >\n                  {userProfile?.subscription_tier === 'pro_coaching' ? 'Pro + Coaching' :\n                   userProfile?.subscription_tier === 'pro' ? 'Pro' :\n                   userProfile?.subscription_tier === 'basic' ? 'Basic' : 'Free Trial'}\n                </Badge>\n                <InteractiveHoverButton\n                  text=\"Change Tier\"\n                  hoverText=\"Upgrade\"\n                  size=\"sm\"\n                  onClick={() => setIsPricingCarouselOpen(true)}\n                />\n              </div>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"gap-2\"\n              onClick={() => setIsFeedbackOpen(true)}\n            >\n              <MessageSquare className=\"w-4 h-4\" />\n              Feedback\n            </Button>\n          </div>\n        </div>\n\n        {/* Pricing Tier Carousel Modal */}\n        {isPricingCarouselOpen && (\n          <div\n            className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\"\n            onClick={() => setIsPricingCarouselOpen(false)}\n          >\n            <div className=\"relative w-full max-w-md px-4\" onClick={(e) => e.stopPropagation()}>\n              <button\n                onClick={() => setIsPricingCarouselOpen(false)}\n                className=\"absolute top-2 right-2 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-background/80 hover:bg-background border border-border text-foreground/60 hover:text-foreground transition-colors\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n              <Carousel className=\"w-full px-12\">\n                <CarouselContent>\n                  {siteConfig.pricing.pricingItems.map((tier, index) => {\n                    const [displayAmount, displayPeriod] = tier.displayPrice\n                      ? tier.displayPrice.split(\"/\").map((part) => part.trim())\n                      : [tier.price, tier.period]\n\n                    return (\n                      <CarouselItem key={index}>\n                        <div className=\"p-1\">\n                          <Card className=\"border-2\">\n                            <CardContent className=\"flex flex-col p-6 h-[500px]\">\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center justify-between mb-4\">\n                                  <h3 className=\"text-2xl font-bold\">{tier.name}</h3>\n                                  {tier.isPopular && (\n                                    <Badge className=\"bg-primary text-primary-foreground\">Popular</Badge>\n                                  )}\n                                </div>\n                                <div className=\"mb-6\">\n                                  <div className=\"text-4xl font-bold mb-2\">\n                                    {displayAmount}\n                                    {displayPeriod && (\n                                      <span className=\"text-lg font-medium text-muted-foreground ml-2\">\n                                        /{displayPeriod}\n                                      </span>\n                                    )}\n                                  </div>\n                                  <p className=\"text-sm text-muted-foreground\">{tier.description}</p>\n                                </div>\n                                <div className=\"space-y-3 mb-6\">\n                                  <p className=\"text-sm font-semibold text-muted-foreground\">\n                                    {tier.featuresLabel}\n                                  </p>\n                                  {tier.features.map((feature, idx) => (\n                                    <div key={idx} className=\"flex items-start gap-2\">\n                                      <div className=\"w-5 h-5 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5\">\n                                        <svg\n                                          className=\"w-3 h-3 text-primary\"\n                                          fill=\"none\"\n                                          viewBox=\"0 0 24 24\"\n                                          stroke=\"currentColor\"\n                                        >\n                                          <path\n                                            strokeLinecap=\"round\"\n                                            strokeLinejoin=\"round\"\n                                            strokeWidth={2}\n                                            d=\"M5 13l4 4L19 7\"\n                                          />\n                                        </svg>\n                                      </div>\n                                      <span className=\"text-sm\">{feature}</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                              <Button\n                                className={tier.buttonColor}\n                                onClick={() => {\n                                  // TODO: Save tier to user profile\n                                  console.log('Selected tier:', tier.name)\n                                  setIsPricingCarouselOpen(false)\n                                }}\n                              >\n                                {tier.buttonText}\n                              </Button>\n                            </CardContent>\n                          </Card>\n                        </div>\n                      </CarouselItem>\n                    )\n                  })}\n                </CarouselContent>\n                <CarouselPrevious className=\"-left-12\" />\n                <CarouselNext className=\"-right-12\" />\n              </Carousel>\n            </div>\n          </div>\n        )}\n\n        {/* Feedback Chat Modal */}\n        {isFeedbackOpen && (\n          <div\n            className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\"\n            onClick={() => setIsFeedbackOpen(false)}\n          >\n            <div className=\"relative w-full max-w-md mx-4\" onClick={(e) => e.stopPropagation()}>\n              <button\n                onClick={() => setIsFeedbackOpen(false)}\n                className=\"absolute top-2 right-2 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-background/80 hover:bg-background border border-border text-foreground/60 hover:text-foreground transition-colors\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"w-5 h-5\" />\n                    Send Feedback\n                  </CardTitle>\n                  <CardDescription>\n                    Share quick thoughts, ideas, or issues.\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-start gap-3 rounded-2xl border border-border/60 bg-muted/10 p-3\">\n                      <Switch\n                        id=\"anonymous-feedback\"\n                        checked={isAnonymousFeedback}\n                        onCheckedChange={setIsAnonymousFeedback}\n                      />\n                      <div>\n                        <label htmlFor=\"anonymous-feedback\" className=\"text-sm font-semibold\">\n                          Submit anonymously\n                        </label>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Feedback is stored without your name or email.\n                        </p>\n                      </div>\n                    </div>\n                    <FeedbackInputBox\n                      onSend={handleSendFeedback}\n                      isLoading={isFeedbackSubmitting}\n                      placeholder=\"Share a quick note or screenshot...\"\n                    />\n                    {feedbackMessage && (\n                      <p\n                        className={`text-sm font-medium ${\n                          feedbackStatus === 'success' ? 'text-green-500' : 'text-red-400'\n                        }`}\n                      >\n                        {feedbackMessage}\n                      </p>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/dashboard/performance/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExamResults'. Either include it or remove the dependency array.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [fetchExamResults, mounted, user, userProfile]","fix":{"range":[1055,1083],"text":"[fetchExamResults, mounted, user, userProfile]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useRouter } from 'next/navigation'\nimport { useAuth } from '@/context/auth-context'\nimport { useEffect, useState } from 'react'\nimport { supabase } from '@/lib/supabase'\n\ninterface ExamResult {\n  id: string\n  score: number\n  percentage: number\n  date: string\n  section_scores?: {\n    [key: string]: number\n  }\n}\n\nexport default function PerformanceDashboard() {\n  const { user, userProfile, loading } = useAuth()\n  const router = useRouter()\n  const [mounted, setMounted] = useState(false)\n  const [results, setResults] = useState<ExamResult[]>([])\n  const [loadingResults, setLoadingResults] = useState(true)\n\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  useEffect(() => {\n    if (mounted && !loading && !user) {\n      router.push('/login')\n    }\n  }, [user, loading, mounted, router])\n\n  useEffect(() => {\n    if (mounted && user && userProfile?.subscription_tier === 'pro') {\n      fetchExamResults()\n    } else if (mounted && user && userProfile?.subscription_tier !== 'pro') {\n      setLoadingResults(false)\n    }\n  }, [mounted, user, userProfile])\n\n  const fetchExamResults = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('user_scores')\n        .select('*')\n        .eq('user_id', user?.id)\n        .order('created_at', { ascending: false })\n\n      if (error) throw error\n      setResults(data || [])\n    } catch (error) {\n      console.error('Error fetching results:', error)\n    } finally {\n      setLoadingResults(false)\n    }\n  }\n\n  if (!mounted || loading) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"text-lg text-slate-400 animate-breath\">Loading...</div>\n      </div>\n    )\n  }\n\n  if (!user) {\n    return null\n  }\n\n  if (userProfile?.subscription_tier !== 'pro' && userProfile?.subscription_tier !== 'premium') {\n    return (\n      <div className=\"min-h-screen bg-black text-white overflow-hidden relative\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-black to-slate-900 opacity-80\"></div>\n        <div className=\"absolute top-0 right-0 w-96 h-96 bg-blue-500 rounded-full mix-blend-screen filter blur-3xl opacity-10 animate-breath\"></div>\n        <div className=\"absolute bottom-0 left-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-screen filter blur-3xl opacity-10 animate-breath\" style={{animationDelay: '7.5s'}}></div>\n\n        <div className=\"relative z-10 min-h-screen p-8 flex items-center justify-center\">\n          <div className=\"max-w-2xl\">\n            <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl p-12 shadow-2xl text-center\">\n              <div className=\"text-5xl mb-4\">ðŸ”’</div>\n              <h1 className=\"text-3xl font-bold text-white mb-4\">Pro Feature</h1>\n              <p className=\"text-slate-400 mb-8 text-lg\">\n                Performance analytics are available for Pro tier members who upload exam results.\n              </p>\n              <button\n                onClick={() => router.push('/dashboard')}\n                className=\"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold rounded-lg transition duration-200 shadow-lg hover:shadow-blue-500/50\"\n              >\n                Back to Dashboard\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  const averageScore = results.length > 0\n    ? Math.round(results.reduce((sum, r) => sum + r.percentage, 0) / results.length)\n    : 0\n  const highestScore = results.length > 0\n    ? Math.max(...results.map(r => r.percentage))\n    : 0\n  const lowestScore = results.length > 0\n    ? Math.min(...results.map(r => r.percentage))\n    : 0\n\n  return (\n    <div className=\"min-h-screen bg-black text-white overflow-hidden relative\">\n      {/* Animated gradient background */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-black to-slate-900 opacity-80\"></div>\n      <div className=\"absolute top-0 right-0 w-96 h-96 bg-blue-500 rounded-full mix-blend-screen filter blur-3xl opacity-10 animate-breath\"></div>\n      <div className=\"absolute bottom-0 left-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-screen filter blur-3xl opacity-10 animate-breath\" style={{animationDelay: '7.5s'}}></div>\n\n      <div className=\"relative z-10 min-h-screen p-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* Header */}\n          <div className=\"mb-12 flex items-center justify-between\">\n            <div>\n              <div className=\"inline-block mb-4\">\n                <span className=\"text-sm font-medium text-cyan-400 px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/20\">\n                  Performance Analytics\n                </span>\n              </div>\n              <h1 className=\"text-5xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent\">\n                Your Results\n              </h1>\n              <p className=\"text-slate-400 mt-2\">Track your exam performance over time</p>\n            </div>\n            <button\n              onClick={() => router.push('/dashboard')}\n              className=\"px-4 py-2 text-sm bg-slate-900/40 hover:bg-slate-800/40 border border-slate-800/50 rounded-lg transition duration-200\"\n            >\n              â† Back\n            </button>\n          </div>\n\n          {/* Stats Overview */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\n            <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl p-6 shadow-2xl\">\n              <p className=\"text-sm text-slate-400 mb-2\">Total Exams</p>\n              <p className=\"text-4xl font-bold text-white\">{results.length}</p>\n            </div>\n            <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl p-6 shadow-2xl\">\n              <p className=\"text-sm text-slate-400 mb-2\">Average Score</p>\n              <p className=\"text-4xl font-bold text-cyan-400\">{averageScore}%</p>\n            </div>\n            <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl p-6 shadow-2xl\">\n              <p className=\"text-sm text-slate-400 mb-2\">Highest Score</p>\n              <p className=\"text-4xl font-bold text-green-400\">{highestScore}%</p>\n            </div>\n            <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl p-6 shadow-2xl\">\n              <p className=\"text-sm text-slate-400 mb-2\">Lowest Score</p>\n              <p className=\"text-4xl font-bold text-red-400\">{lowestScore}%</p>\n            </div>\n          </div>\n\n          {/* Results List */}\n          <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl shadow-2xl overflow-hidden\">\n            <div className=\"p-6 border-b border-slate-800/50\">\n              <h2 className=\"text-2xl font-bold text-white\">Exam History</h2>\n            </div>\n\n            {loadingResults ? (\n              <div className=\"p-12 text-center\">\n                <div className=\"text-slate-400 animate-breath\">Loading results...</div>\n              </div>\n            ) : results.length === 0 ? (\n              <div className=\"p-12 text-center\">\n                <div className=\"text-5xl mb-4\">ðŸ“Š</div>\n                <p className=\"text-slate-400 text-lg\">No exam results yet</p>\n                <p className=\"text-slate-500 text-sm mt-2\">Upload exam screenshots to track your performance</p>\n              </div>\n            ) : (\n              <div className=\"divide-y divide-slate-800/50\">\n                {results.map((result, index) => (\n                  <div key={result.id} className=\"p-6 hover:bg-slate-800/20 transition-colors\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold\">\n                          #{results.length - index}\n                        </div>\n                        <div>\n                          <p className=\"text-white font-semibold\">Exam Attempt</p>\n                          <p className=\"text-sm text-slate-400\">\n                            {new Date(result.date).toLocaleDateString('en-US', {\n                              weekday: 'short',\n                              month: 'short',\n                              day: 'numeric',\n                              year: 'numeric',\n                            })}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-3xl font-bold text-white\">{result.percentage}%</p>\n                        <p className=\"text-sm text-slate-400\">{result.score} points</p>\n                      </div>\n                    </div>\n\n                    {result.section_scores && Object.keys(result.section_scores).length > 0 && (\n                      <div className=\"mt-4 pt-4 border-t border-slate-800/30\">\n                        <p className=\"text-sm text-slate-400 mb-3\">Section Breakdown</p>\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                          {Object.entries(result.section_scores).map(([section, score]) => (\n                            <div key={section} className=\"bg-slate-800/30 rounded-lg p-3 text-center\">\n                              <p className=\"text-xs text-slate-400 capitalize mb-1\">{section}</p>\n                              <p className=\"text-lg font-bold text-cyan-400\">{score}%</p>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Progress Tips */}\n          <div className=\"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"bg-gradient-to-br from-blue-600/20 to-cyan-600/20 backdrop-blur-xl border border-blue-500/20 rounded-2xl p-6 shadow-2xl\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"text-3xl\">ðŸ“ˆ</div>\n                <div>\n                  <h3 className=\"text-white font-bold mb-2\">Keep Improving</h3>\n                  <p className=\"text-slate-400 text-sm\">Track your progress across multiple attempts to identify improvement areas</p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-gradient-to-br from-purple-600/20 to-pink-600/20 backdrop-blur-xl border border-purple-500/20 rounded-2xl p-6 shadow-2xl\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"text-3xl\">ðŸŽ¯</div>\n                <div>\n                  <h3 className=\"text-white font-bold mb-2\">Focus on Weak Areas</h3>\n                  <p className=\"text-slate-400 text-sm\">Review section scores to prioritize studying topics where you need the most improvement</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/exam-generator/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used.","line":7,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getExamHistory' is defined but never used.","line":25,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'recommendedMode' is assigned a value but never used.","line":66,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingPreGen' is assigned a value but never used.","line":67,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":342,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13143,13146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13143,13146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":405,"column":38,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":405,"endColumn":67},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":417,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":417,"endColumn":77},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":418,"column":48,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":418,"endColumn":81},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'assignmentId'. Either include it or remove the dependency array.","line":480,"column":6,"nodeType":"ArrayExpression","endLine":480,"endColumn":103,"suggestions":[{"desc":"Update the dependencies array to be: [userId, examType, mode, questions, selectedAnswers, recordExamQuestionResults, flaggedQuestions, assignmentId]","fix":{"range":[17645,17742],"text":"[userId, examType, mode, questions, selectedAnswers, recordExamQuestionResults, flaggedQuestions, assignmentId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'state' is assigned a value but never used.","line":517,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":517,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'examType', 'mode', 'questions.length', and 'timeRemaining'. Either include them or remove the dependency array.","line":693,"column":6,"nodeType":"ArrayExpression","endLine":693,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [examType, isExamStarted, mode, questions.length, timeRemaining]","fix":{"range":[24174,24189],"text":"[examType, isExamStarted, mode, questions.length, timeRemaining]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleEndExam'. Either include it or remove the dependency array.","line":714,"column":6,"nodeType":"ArrayExpression","endLine":714,"endColumn":80,"suggestions":[{"desc":"Update the dependencies array to be: [isExamStarted, timeRemaining, questions, selectedAnswers, examType, mode, handleEndExam]","fix":{"range":[24673,24747],"text":"[isExamStarted, timeRemaining, questions, selectedAnswers, examType, mode, handleEndExam]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isTimeWarning' is assigned a value but never used.","line":723,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":723,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":833,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":833,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29251,29254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29251,29254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleShowExplanation' is assigned a value but never used.","line":880,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":880,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'optionIsCorrect' is assigned a value but never used.","line":1545,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":1545,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isShowingCorrect' is assigned a value but never used.","line":1546,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":1546,"endColumn":45}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useCallback, useRef } from 'react'\nimport Link from 'next/link'\nimport { Clock, BadgeCheck } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Progress } from '@/components/ui/progress'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel'\nimport { motion } from 'motion/react'\nimport { LoadingAnimation } from '@/components/ui/loading-animation'\nimport { useAuth } from '@/context/auth-context'\nimport {\n  Breadcrumb,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbList,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n} from '@/components/ui/breadcrumb'\nimport { getRecommendedDefaults, getExamHistory } from '@/lib/exam-history'\nimport { triggerBackgroundPreGeneration } from '@/lib/pre-generated-exams'\nimport { createClient } from '@supabase/supabase-js'\nimport { deriveTopicMetaFromQuestionSource } from '@/lib/topic-source-utils'\nimport { saveQuestionResult, addSectionResult, resolveSectionResult } from '@/lib/unified-question-results'\n\ninterface Question {\n  id: number\n  question: string\n  options: string[]\n  correct_answer: string\n  explanation: string\n  domain: number | string\n  difficulty: string\n  type: string\n  isScored?: boolean\n  scored?: boolean\n  knId?: string\n  sourceFile?: string\n  source_file?: string\n  topicName?: string\n  domainId?: string\n  relatedSections?: string[]\n}\n\nexport default function ExamGeneratorPage() {\n  const { userProfile } = useAuth()\n  const subscriptionTier = userProfile?.subscription_tier\n  const isFreeTier = subscriptionTier === 'free' || !subscriptionTier\n  const [isGenerating, setIsGenerating] = useState(false)\n  const [questions, setQuestions] = useState<Question[]>([])\n  const [currentQuestion, setCurrentQuestion] = useState(0)\n  const [selectedAnswers, setSelectedAnswers] = useState<Record<number, string>>({})\n  const [showExplanation, setShowExplanation] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [examType, setExamType] = useState<'diagnostic' | 'practice' | null>(null)\n  const [mode, setMode] = useState<'study' | 'test' | null>(null)\n  const [timeRemaining, setTimeRemaining] = useState(0)\n\tconst [isExamStarted, setIsExamStarted] = useState(false)\n\tconst [selectedMode, setSelectedMode] = useState<'study' | 'test' | null>(null)\n  const [recommendedExamType, setRecommendedExamType] = useState<'diagnostic' | 'practice'>('diagnostic')\n  const [recommendedMode, setRecommendedMode] = useState<'study' | 'test'>('study')\n  const [isLoadingPreGen, setIsLoadingPreGen] = useState(false)\n  const [userId, setUserId] = useState<string | null>(null)\n  const [flaggedQuestions, setFlaggedQuestions] = useState<Record<number, boolean>>({})\n  const [textFormats, setTextFormats] = useState<Record<number, { question: string; options: string[] }>>({})\n  const [assignmentId, setAssignmentId] = useState<string | null>(null)\n  const [isSavingResults, setIsSavingResults] = useState(false)\n  const [isPaused, setIsPaused] = useState(false)\n  const [hasPausedExam, setHasPausedExam] = useState(false)\n  const [shouldScrollToStep2, setShouldScrollToStep2] = useState(false)\n  const diagnosticQuestionLabel = isFreeTier ? 'â‰ˆ60 questions' : '71 questions'\n  const diagnosticHighlights = isFreeTier\n    ? [\n        'Covers all EPPP domains',\n        'Fast 60-minute readiness check',\n        'See exact focus areas to study next',\n      ]\n    : [\n        'Identify knowledge gaps',\n        'Quick assessment (30-45 minutes)',\n        'Get priority recommendations',\n      ]\n  const practiceHighlights = [\n    'Comprehensive knowledge check',\n    'Full exam preparation (4-5 hours)',\n    'Includes experimental questions',\n  ]\n  const practiceLockMessage = 'Upgrade to Pro to unlock the complete 225-question practice exam.'\n  const questionContentRef = useRef<HTMLDivElement | null>(null)\n  const lastSelectionRef = useRef<{ text: string; questionIndex: number } | null>(null)\n  const step2Ref = useRef<HTMLDivElement | null>(null)\n\n  const resolveSelectionText = useCallback(() => {\n    if (typeof window === 'undefined') return null\n\n    const selection = window.getSelection()\n    const container = questionContentRef.current\n\n    if (selection && container && selection.rangeCount > 0) {\n      const selectedText = selection.toString()\n      if (selectedText.trim()) {\n        const anchorInside = selection.anchorNode ? container.contains(selection.anchorNode) : false\n        const focusInside = selection.focusNode ? container.contains(selection.focusNode) : false\n        if (anchorInside || focusInside) {\n          lastSelectionRef.current = {\n            text: selectedText,\n            questionIndex: currentQuestion,\n          }\n          return selectedText\n        }\n      }\n    }\n\n    if (lastSelectionRef.current?.questionIndex === currentQuestion) {\n      return lastSelectionRef.current.text\n    }\n\n    return null\n  }, [currentQuestion])\n\n  useEffect(() => {\n    const handleSelectionChange = () => {\n      const container = questionContentRef.current\n      if (!container) return\n\n      const selection = window.getSelection()\n      if (!selection || selection.rangeCount === 0) return\n\n      const selectedText = selection.toString()\n      if (!selectedText.trim()) return\n\n      const anchorInside = selection.anchorNode ? container.contains(selection.anchorNode) : false\n      const focusInside = selection.focusNode ? container.contains(selection.focusNode) : false\n\n      if (anchorInside || focusInside) {\n        lastSelectionRef.current = {\n          text: selectedText,\n          questionIndex: currentQuestion,\n        }\n      }\n    }\n\n    document.addEventListener('selectionchange', handleSelectionChange)\n    return () => document.removeEventListener('selectionchange', handleSelectionChange)\n  }, [currentQuestion])\n\n  useEffect(() => {\n    lastSelectionRef.current = null\n  }, [currentQuestion])\n\n  // Apply highlight to selected text (question and answer choices)\n  const handleHighlightText = useCallback(() => {\n    const selectedText = resolveSelectionText()\n    if (selectedText && currentQuestion !== undefined) {\n      const question = questions[currentQuestion]\n      if (question) {\n        // Get current formatted text or original\n        const oldQuestion = textFormats[currentQuestion]?.question || question.question\n\n        // Create a temporary div to work with HTML\n        const tempDiv = document.createElement('div')\n        tempDiv.innerHTML = oldQuestion\n\n        // Function to wrap matching text nodes with <mark>\n        const highlightTextNode = (node: Node) => {\n          if (node.nodeType === Node.TEXT_NODE && node.textContent) {\n            const text = node.textContent\n            if (text.includes(selectedText)) {\n              const parts = text.split(selectedText)\n              const fragment = document.createDocumentFragment()\n\n              parts.forEach((part, index) => {\n                if (part) fragment.appendChild(document.createTextNode(part))\n                if (index < parts.length - 1) {\n                  const mark = document.createElement('mark')\n                  // Keep font consistent with surrounding text; only change highlight color\n                  mark.style.backgroundColor = 'yellow'\n                  mark.style.color = 'black'\n                  mark.style.fontFamily = 'inherit'\n                  mark.style.fontSize = 'inherit'\n                  mark.style.fontWeight = 'inherit'\n                  mark.style.lineHeight = 'inherit'\n                  mark.textContent = selectedText\n                  fragment.appendChild(mark)\n                }\n              })\n\n              node.parentNode?.replaceChild(fragment, node)\n            }\n          } else if (node.nodeType === Node.ELEMENT_NODE) {\n            // Recursively process child nodes\n            Array.from(node.childNodes).forEach(highlightTextNode)\n          }\n        }\n\n        highlightTextNode(tempDiv)\n        const newQuestion = tempDiv.innerHTML\n\n        // Do the same for options\n        const formattedOptions = textFormats[currentQuestion]?.options\n        const currentOptions = Array.isArray(formattedOptions) ? formattedOptions : question.options\n        const newOptions = currentOptions.map((option: string) => {\n          const optDiv = document.createElement('div')\n          optDiv.innerHTML = option\n          highlightTextNode(optDiv)\n          return optDiv.innerHTML\n        })\n\n        setTextFormats(prev => ({\n          ...prev,\n          [currentQuestion]: {\n            question: newQuestion,\n            options: newOptions\n          }\n        }))\n        lastSelectionRef.current = null\n      }\n    }\n  }, [currentQuestion, questions, textFormats, resolveSelectionText])\n\n  // Apply strikethrough to selected text (question and answer choices)\n  const handleStrikethroughText = useCallback(() => {\n    const selectedText = resolveSelectionText()\n    if (selectedText && currentQuestion !== undefined) {\n      const question = questions[currentQuestion]\n      if (question) {\n        // Get current formatted text or original\n        const oldQuestion = textFormats[currentQuestion]?.question || question.question\n\n        // Create a temporary div to work with HTML\n        const tempDiv = document.createElement('div')\n        tempDiv.innerHTML = oldQuestion\n\n        // Function to wrap matching text nodes with <del>\n        const strikeTextNode = (node: Node) => {\n          if (node.nodeType === Node.TEXT_NODE && node.textContent) {\n            const text = node.textContent\n            if (text.includes(selectedText)) {\n              const parts = text.split(selectedText)\n              const fragment = document.createDocumentFragment()\n\n              parts.forEach((part, index) => {\n                if (part) fragment.appendChild(document.createTextNode(part))\n                if (index < parts.length - 1) {\n                  const del = document.createElement('del')\n                  // Keep font consistent; only add line-through\n                  del.style.textDecoration = 'line-through'\n                  del.style.fontFamily = 'inherit'\n                  del.style.fontSize = 'inherit'\n                  del.style.fontWeight = 'inherit'\n                  del.style.lineHeight = 'inherit'\n                  del.textContent = selectedText\n                  fragment.appendChild(del)\n                }\n              })\n\n              node.parentNode?.replaceChild(fragment, node)\n            }\n          } else if (node.nodeType === Node.ELEMENT_NODE) {\n            // Recursively process child nodes\n            Array.from(node.childNodes).forEach(strikeTextNode)\n          }\n        }\n\n        strikeTextNode(tempDiv)\n        const newQuestion = tempDiv.innerHTML\n\n        // Do the same for options\n        const formattedOptions = textFormats[currentQuestion]?.options\n        const currentOptions = Array.isArray(formattedOptions) ? formattedOptions : question.options\n        const newOptions = currentOptions.map((option: string) => {\n          const optDiv = document.createElement('div')\n          optDiv.innerHTML = option\n          strikeTextNode(optDiv)\n          return optDiv.innerHTML\n        })\n\n        setTextFormats(prev => ({\n          ...prev,\n          [currentQuestion]: {\n            question: newQuestion,\n            options: newOptions\n          }\n        }))\n        lastSelectionRef.current = null\n      }\n    }\n  }, [currentQuestion, questions, textFormats, resolveSelectionText])\n\n  // Save paused exam state to localStorage\n  const savePausedExamState = () => {\n    if (!examType || !mode || questions.length === 0) return\n\n    const pausedState = {\n      examType,\n      mode,\n      currentQuestion,\n      selectedAnswers,\n      flaggedQuestions,\n      textFormats,\n      questions,\n      timeRemaining,\n      assignmentId,\n      pausedAt: new Date().toISOString(),\n    }\n\n    localStorage.setItem('pausedExamState', JSON.stringify(pausedState))\n  }\n\n  // Handle pause button click\n  const handlePause = () => {\n    savePausedExamState()\n    setIsPaused(true)\n  }\n\n  // Resume paused exam\n  const handleResume = () => {\n    setIsPaused(false)\n  }\n\n  // Save and return to dashboard\n  const handleSaveAndReturn = () => {\n    savePausedExamState()\n    window.location.href = '/dashboard'\n  }\n\n  // Record per-question results for unified highlighting (Topic Teacher)\n  const recordExamQuestionResults = useCallback(() => {\n    if (!examType) return\n\n    questions.forEach((question, index) => {\n      if (!question) return\n      const selectedAnswer = selectedAnswers[index]\n      if (!selectedAnswer) return\n      if (question.isScored === false || question.scored === false) return\n\n      const meta = deriveTopicMetaFromQuestionSource(question as any)\n      const topicName = question.topicName || meta?.topicName\n      if (!topicName) return\n\n      const domainId =\n        question.domainId || meta?.domainId || (question.domain ? String(question.domain) : 'unknown')\n\n      // For exam-derived highlights, treat the whole topic as needing review.\n      // This ensures Topic Teacher shows apples even when we don't have\n      // granular section labels for each exam question.\n      const sections = ['__ALL__']\n\n      const isCorrect = selectedAnswer === question.correct_answer\n      const questionId = question.id?.toString() || `${topicName}_q${index}`\n\n      saveQuestionResult({\n        questionId,\n        question: question.question,\n        examType,\n        topic: topicName,\n        domain: domainId,\n        selectedAnswer,\n        correctAnswer: question.correct_answer,\n        isCorrect,\n        timestamp: Date.now(),\n      })\n\n      if (!isCorrect) {\n        sections.forEach((sectionName) =>\n          addSectionResult({\n            sectionName,\n            topicName,\n            domain: domainId,\n            wrongCount: 1,\n            lastAttempted: Date.now(),\n            isResolved: false,\n          }),\n        )\n      } else {\n        sections.forEach((sectionName) => resolveSectionResult(topicName, sectionName))\n      }\n    })\n  }, [examType, questions, selectedAnswers])\n\n  // Handle end exam - save results to Supabase and navigate\n  const handleEndExam = useCallback(async () => {\n    if (!userId || !examType || !mode) {\n      console.error('Missing required data for exam completion')\n      return\n    }\n\n    setIsSavingResults(true)\n\n    try {\n      const scoredQuestions = questions.filter(q => q.isScored !== false)\n      const score = Object.entries(selectedAnswers).filter(([qIdx, answer]) => {\n        const q = questions[parseInt(qIdx)]\n        return q && q.isScored !== false && answer === q.correct_answer\n      }).length\n\n      recordExamQuestionResults()\n\n      // Save exam completion to local storage\n      const { saveExamCompletion } = require('@/lib/exam-history')\n      saveExamCompletion({\n        examType: examType || 'practice',\n        examMode: mode || 'study',\n        score: (score / scoredQuestions.length) * 100,\n        totalQuestions: scoredQuestions.length,\n        correctAnswers: score,\n      })\n\n      // Generate priority recommendations for diagnostic/practice exams\n      let priorityData = null\n      if (examType === 'diagnostic' || examType === 'practice') {\n        const { calculatePriorities } = require('@/lib/priority-calculator')\n        const { savePriorityRecommendation } = require('@/lib/priority-storage')\n\n        // Use unified priority calculation so dashboard, topic-selector,\n        // and prioritizer all share the same priority model (including org psych).\n        const priorityResult = calculatePriorities({\n          questions,\n          selectedAnswers,\n          totalQuestions: scoredQuestions.length,\n        })\n\n        const { topPriorities, allResults } = priorityResult\n\n        priorityData = {\n          topPriorities,\n          allResults,\n        }\n\n        // Save to local storage\n        savePriorityRecommendation({\n          examType: examType,\n          examMode: mode || 'study',\n          topPriorities,\n          allResults,\n        })\n      }\n\n      // Save to Supabase\n      const response = await fetch('/api/save-exam-results', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          userId,\n          examType,\n          examMode: mode,\n          questions,\n          selectedAnswers,\n          flaggedQuestions,\n          score,\n          totalQuestions: scoredQuestions.length,\n          topPriorities: priorityData?.topPriorities || null,\n          allResults: priorityData?.allResults || null,\n          assignmentId: assignmentId || null,\n        }),\n      })\n\n      const data = await response.json()\n\n      if (!data.success) {\n        throw new Error('Failed to save exam results')\n      }\n\n      // Clear paused exam state since exam is now completed\n      localStorage.removeItem('pausedExamState')\n      setHasPausedExam(false)\n\n      // Navigate with just the result ID (no more URI_TOO_LONG!)\n      window.location.href = `/prioritize?id=${data.resultId}`\n    } catch (error) {\n      console.error('Error saving exam results:', error)\n      setError('Failed to save exam results. Please try again.')\n      setIsSavingResults(false)\n    }\n  }, [userId, examType, mode, questions, selectedAnswers, flaggedQuestions, recordExamQuestionResults])\n\n  // Resume last paused exam (manual resume via button)\n  const handleResumeLastExam = () => {\n    const pausedState = localStorage.getItem('pausedExamState')\n    if (!pausedState) {\n      setHasPausedExam(false)\n      return\n    }\n\n    try {\n      const state = JSON.parse(pausedState)\n      // Restore all exam state\n      setExamType(state.examType)\n      setMode(state.mode)\n      setQuestions(state.questions)\n      setCurrentQuestion(state.currentQuestion)\n      setSelectedAnswers(state.selectedAnswers)\n      setFlaggedQuestions(state.flaggedQuestions || {})\n      setTextFormats(state.textFormats || {})\n      setTimeRemaining(state.timeRemaining)\n      setAssignmentId(state.assignmentId)\n      setIsExamStarted(true)\n      setHasPausedExam(false)\n      // Don't show pause modal on manual resume - user explicitly clicked to resume\n    } catch (error) {\n      console.error('Failed to restore paused exam:', error)\n      localStorage.removeItem('pausedExamState')\n      setHasPausedExam(false)\n    }\n  }\n\n  // Check for paused exam on mount (detect only, don't auto-restore)\n  useEffect(() => {\n    const pausedState = localStorage.getItem('pausedExamState')\n    if (pausedState && !isExamStarted) {\n      try {\n        const state = JSON.parse(pausedState)\n        // Just detect the paused exam, don't auto-restore\n        setHasPausedExam(true)\n      } catch (error) {\n        console.error('Failed to parse paused exam:', error)\n        localStorage.removeItem('pausedExamState')\n        setHasPausedExam(false)\n      }\n    } else if (!pausedState) {\n      setHasPausedExam(false)\n    }\n  }, [isExamStarted])\n\n  // Detect if user is on Mac\n  const isMac = typeof navigator !== 'undefined' && navigator.platform.toUpperCase().indexOf('MAC') >= 0\n\n  const scrollToStep2 = useCallback(() => {\n    if (step2Ref.current) {\n      step2Ref.current.scrollIntoView({ behavior: 'smooth', block: 'start' })\n    }\n  }, [])\n\n  const handleExamTypeSelect = useCallback(\n    (type: 'diagnostic' | 'practice') => {\n      if (isFreeTier && type === 'practice') {\n        setError('Practice exams are part of the Pro plan. Upgrade to unlock the full 225-question simulation.')\n        return\n      }\n      if (examType === type) {\n        scrollToStep2()\n        return\n      }\n\n      setExamType(type)\n      setSelectedMode(null)\n      if (step2Ref.current) {\n        scrollToStep2()\n      } else {\n        setShouldScrollToStep2(true)\n      }\n    },\n    [examType, isFreeTier, scrollToStep2],\n  )\n\n  useEffect(() => {\n    if (examType && shouldScrollToStep2) {\n      setShouldScrollToStep2(false)\n      scrollToStep2()\n    }\n  }, [examType, shouldScrollToStep2, scrollToStep2])\n\n  const handleNext = useCallback(() => {\n    if (currentQuestion < questions.length - 1) {\n      setCurrentQuestion((prev) => prev + 1)\n      setShowExplanation(false)\n    }\n  }, [currentQuestion, questions.length])\n\n  const handlePrevious = useCallback(() => {\n    if (currentQuestion > 0) {\n      setCurrentQuestion((prev) => prev - 1)\n      setShowExplanation(false)\n    }\n  }, [currentQuestion])\n\n  const handlePracticeCardClick = () => {\n    if (isFreeTier) {\n      setError(practiceLockMessage)\n      return\n    }\n    handleExamTypeSelect('practice')\n  }\n\n  // Keyboard shortcuts for exam navigation\n  useEffect(() => {\n    if (!isExamStarted) return\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      const modifier = e.altKey // Use Option/Alt for both Mac and Windows\n\n      if (!modifier) return\n\n      const normalizedKey = (e.code || e.key || '').toLowerCase()\n\n      switch (normalizedKey) {\n        case 'keyp':\n        case 'p':\n          e.preventDefault()\n          if (currentQuestion > 0) handlePrevious()\n          break\n        case 'keyn':\n        case 'n':\n          e.preventDefault()\n          if (currentQuestion < questions.length - 1) handleNext()\n          break\n        case 'keyh':\n        case 'h':\n          e.preventDefault()\n          handleHighlightText()\n          break\n        case 'keys':\n        case 's':\n          e.preventDefault()\n          handleStrikethroughText()\n          break\n        case 'keye':\n        case 'e':\n          if (currentQuestion === questions.length - 1) {\n            e.preventDefault()\n            handleEndExam()\n          }\n          break\n        default:\n          break\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [isExamStarted, currentQuestion, questions.length, handleNext, handlePrevious, handleHighlightText, handleStrikethroughText, handleEndExam])\n\n\t// Initialize recommended defaults from exam history\n\tuseEffect(() => {\n\t\tconst defaults = getRecommendedDefaults()\n    if (isFreeTier) {\n      setRecommendedExamType('diagnostic')\n      setExamType('diagnostic')\n    } else {\n      setRecommendedExamType(defaults.examType)\n      setExamType(defaults.examType)\n    }\n\t\tsetRecommendedMode(defaults.examMode)\n\t}, [isFreeTier])\n\n  // Get current user ID for pre-generation\n  useEffect(() => {\n    const initializeUser = async () => {\n      const supabase = createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n      )\n      const { data: { session } } = await supabase.auth.getSession()\n      if (session?.user?.id) {\n        setUserId(session.user.id)\n      }\n    }\n    initializeUser()\n  }, [])\n\n  // Pre-generate exams on page load for faster loading\n  useEffect(() => {\n    if (userId && !examType) {\n      triggerBackgroundPreGeneration(userId, 'diagnostic')\n      triggerBackgroundPreGeneration(userId, 'practice')\n    }\n  }, [userId, examType])\n\n  // Auto-show explanation in Study Mode\n  useEffect(() => {\n    if (selectedAnswers[currentQuestion] && mode === 'study' && !showExplanation) {\n      setShowExplanation(true)\n    }\n  }, [selectedAnswers, currentQuestion, mode, showExplanation])\n\n  // Timer effect: time per question based on exam type\n  useEffect(() => {\n    if (!isExamStarted || questions.length === 0 || mode !== 'test') return\n\n    // 68 seconds per question for practice (225q = 4h 15m), 50 seconds per question for diagnostic (71q = ~1h)\n    const secondsPerQuestion = examType === 'diagnostic' ? 50 : 68\n    const totalSeconds = questions.length * secondsPerQuestion\n\n    // Only initialize on first run\n    if (timeRemaining > 0) return\n\n    setTimeRemaining(totalSeconds)\n  }, [isExamStarted])\n\n  // Separate effect for timer countdown\n  useEffect(() => {\n    if (!isExamStarted || questions.length === 0 || mode !== 'test' || timeRemaining === 0) return\n\n    const timer = setInterval(() => {\n      setTimeRemaining((prev) => {\n        const newTime = prev - 1\n\n        // Auto-submit if time runs out\n        if (newTime <= 0) {\n          handleEndExam()\n          return 0\n        }\n\n        return newTime\n      })\n    }, 1000)\n\n    return () => clearInterval(timer)\n  }, [isExamStarted, timeRemaining, questions, selectedAnswers, examType, mode])\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600)\n    const minutes = Math.floor((seconds % 3600) / 60)\n    const secs = seconds % 60\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n\n  const isTimeWarning = timeRemaining > 0 && timeRemaining <= 300\n\n  const handleGenerateExam = async (chosenExamType: 'diagnostic' | 'practice', chosenMode: 'study' | 'test') => {\n    if (isFreeTier && chosenExamType !== 'diagnostic') {\n      setError('Practice exams are part of the Pro plan. Upgrade to unlock the full 225-question simulation.')\n      return\n    }\n\n    try {\n      const startTime = performance.now()\n      console.log(`[Exam Gen] Starting exam generation for ${chosenExamType}...`)\n\n      setIsGenerating(true)\n      setError(null)\n      setQuestions([])\n      setCurrentQuestion(0)\n      setSelectedAnswers({})\n      setShowExplanation(false)\n      setTimeRemaining(0)\n      setExamType(chosenExamType)\n      setMode(chosenMode)\n      setAssignmentId(null)\n\n      let examData = null\n\n      // For paid tiers, try to fetch Git-backed exams first.\n      // Free tier always uses free-examsGPT and skips assignments.\n      if (!isFreeTier && userId) {\n        setIsLoadingPreGen(true)\n        try {\n          console.time('[Exam Gen] Assignment API call')\n          const assignResponse = await fetch('/api/assign-exam', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ userId, examType: chosenExamType }),\n          })\n          console.timeEnd('[Exam Gen] Assignment API call')\n\n          const assignData = await assignResponse.json()\n\n          if (assignData.success && assignData.questions) {\n            console.log('[Exam Gen] Using Git-backed exam:', assignData.examFile)\n            console.log(`[Exam Gen] Loaded ${assignData.questions.length} questions from cached file`)\n            examData = { questions: assignData.questions }\n            setAssignmentId(assignData.assignmentId)\n            setIsLoadingPreGen(false)\n          } else if (assignData.fallbackRequired) {\n            console.log('[Exam Gen] No Git-backed exams available, falling back to on-demand generation')\n          }\n        } catch (gitExamError) {\n          console.log('[Exam Gen] Git-backed exam fetch failed, falling back to on-demand:', gitExamError)\n        }\n        setIsLoadingPreGen(false)\n      }\n\n      // Fall back to on-demand generation if no Git-backed exam available\n      if (!examData) {\n        console.log('[Exam Gen] Generating exam on-demand (this may take 30-60 seconds)')\n        console.time('[Exam Gen] On-demand generation')\n        let jsonContent = ''\n        const params = new URLSearchParams()\n        params.set('type', chosenExamType)\n        if (isFreeTier) {\n          params.set('source', 'free')\n        }\n        const response = await fetch(`/api/exam-generator?${params.toString()}`, {\n          method: 'POST',\n        })\n\n        if (!response.ok) {\n          throw new Error('Failed to generate exam')\n        }\n\n        if (!response.body) {\n          throw new Error('No response body')\n        }\n\n        const reader = response.body.getReader()\n        const decoder = new TextDecoder()\n\n        while (true) {\n          const { done, value } = await reader.read()\n\n          if (done) break\n\n          const text = decoder.decode(value)\n          jsonContent += text\n        }\n        console.timeEnd('[Exam Gen] On-demand generation')\n\n        // Parse JSON from the content\n        const jsonMatch = jsonContent.match(/\\{[\\s\\S]*\\}/)\n        if (!jsonMatch) {\n          throw new Error('Could not parse exam data')\n        }\n\n        examData = JSON.parse(jsonMatch[0])\n        console.log(`[Exam Gen] On-demand generation produced ${examData.questions?.length || 0} questions`)\n      }\n\n      // Fisher-Yates shuffle to ensure question randomization\n      console.time('[Exam Gen] Question shuffle')\n      const questionsToUse = examData.questions || []\n      for (let i = questionsToUse.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [questionsToUse[i], questionsToUse[j]] = [questionsToUse[j], questionsToUse[i]]\n      }\n      console.timeEnd('[Exam Gen] Question shuffle')\n\n      const enrichedQuestions = questionsToUse.map((question) => {\n        const meta = deriveTopicMetaFromQuestionSource(question as any)\n        const derivedDomainId = meta?.domainId ?? (question.domain ? String(question.domain) : undefined)\n        const derivedSections =\n          question.relatedSections && question.relatedSections.length > 0\n            ? question.relatedSections\n            : meta\n              ? [meta.sectionName]\n              : undefined\n\n        return {\n          ...question,\n          topicName: question.topicName || meta?.topicName,\n          domainId: derivedDomainId,\n          relatedSections: derivedSections,\n        }\n      })\n\n      setQuestions(enrichedQuestions as Question[])\n      setIsExamStarted(true)\n\n      const endTime = performance.now()\n      const totalTime = ((endTime - startTime) / 1000).toFixed(2)\n      console.log(`[Exam Gen] âœ“ Total exam load time: ${totalTime}s`)\n    } catch (err) {\n      console.error('Error generating exam:', err)\n      setError(err instanceof Error ? err.message : 'Failed to generate exam')\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  const handleSelectAnswer = (option: string) => {\n    setSelectedAnswers((prev) => {\n      // Allow unclicking - if clicking the same option, remove it\n      if (prev[currentQuestion] === option) {\n        const newAnswers = { ...prev }\n        delete newAnswers[currentQuestion]\n        return newAnswers\n      }\n      return {\n        ...prev,\n        [currentQuestion]: option,\n      }\n    })\n    setShowExplanation(false)\n  }\n\n  const handleShowExplanation = () => {\n    setShowExplanation(true)\n  }\n\n  if (questions.length === 0) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background exam-ui\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink asChild>\n                  <Link href=\"/dashboard\">Dashboard</Link>\n                </BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Exam Generator</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3 }}\n          >\n            <div className=\"text-center py-12\">\n              <h1 className=\"text-5xl md:text-6xl font-bold mb-4 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70\">\n                EPPP Exam\n              </h1>\n              {!isGenerating && (\n                <p className=\"text-muted-foreground mb-12 text-lg md:text-xl max-w-2xl mx-auto leading-relaxed\">\n                  Choose an exam type to get started.\n                </p>\n              )}\n\n              {/* Resume Last Exam Button */}\n              {hasPausedExam && !isGenerating && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.3 }}\n                  className=\"max-w-2xl mx-auto mb-8\"\n                >\n                  <Button\n                    onClick={handleResumeLastExam}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"w-full rounded-none\"\n                  >\n                    Resume Last Exam\n                  </Button>\n                </motion.div>\n              )}\n\n\t              {!isGenerating && (\n\t                <div>\n\t                  {/* Step 1: Exam Type Selection (Diagnostic vs Practice) */}\n\t                  <div className=\"max-w-2xl mx-auto mb-8\">\n\t                    <p className=\"text-sm font-semibold text-muted-foreground mb-4\">Step 1: Select Exam Type</p>\n                    {isFreeTier && (\n                      <div className=\"mb-4 text-xs text-muted-foreground\">\n                        Practice exams are included in the Pro plan. Your free trial includes the diagnostic experience below.\n                      </div>\n                    )}\n\t                    {/* Mobile: carousel with peek */}\n\t                    <div className=\"md:hidden\">\n\t                      <Carousel className=\"w-full\" opts={{ align: 'start' }}>\n\t                        <CarouselContent className=\"pl-2 sm:pl-4 gap-4\">\n\t                          <CarouselItem className=\"basis-[85%] sm:basis-[70%]\">\n\t                            <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                              <Card\n\t                                className={`cursor-pointer transition-all border-2 h-full ${\n\t                                  examType === 'diagnostic'\n\t                                    ? 'bg-[#bdd1ca]/20 dark:bg-[#bdd1ca]/10'\n\t                                    : 'border-border'\n\t                                }`}\n\t                                style={examType === 'diagnostic' ? { borderColor: '#bdd1ca' } : {}}\n\t                                onClick={() => handleExamTypeSelect('diagnostic')}\n\t                              >\n\t                                <CardHeader className=\"text-center\">\n\t                                  <div className=\"flex items-center justify-center flex-col\">\n\t\t                              <div className=\"flex items-center gap-2 mb-2\">\n\t\t                                <CardTitle className=\"text-xl font-semibold\">Diagnostic Exam</CardTitle>\n\t\t                                {recommendedExamType === 'diagnostic' && (\n\t\t                                  <Badge\n\t\t                                    variant=\"secondary\"\n\t\t                                    className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n\t\t                                    style={{\n\t\t                                      backgroundColor: '#bdd1ca',\n\t\t                                      borderColor: '#bdd1ca',\n\t\t                                      color: '#1a2b24',\n\t\t                                    }}\n\t\t                                  >\n\t\t                                    <BadgeCheck className=\"h-3 w-3\" />\n\t\t                                    Recommended\n\t\t                                  </Badge>\n\t\t                                )}\n\t\t                              </div>\n\t                                    <CardDescription>{diagnosticQuestionLabel}</CardDescription>\n\t                                  </div>\n\t                                </CardHeader>\n\t                                <CardContent className=\"space-y-3\">\n\t                                  <ul className=\"space-y-2 text-sm text-left\">\n                                      {diagnosticHighlights.map((highlight, idx) => (\n                                        <li key={idx} className=\"flex items-center gap-2\">\n                                          <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                          {highlight}\n                                        </li>\n                                      ))}\n\t                                  </ul>\n\t                                </CardContent>\n\t                              </Card>\n\t                            </motion.div>\n\t                          </CarouselItem>\n\n\t                          <CarouselItem className=\"basis-[85%] sm:basis-[70%]\">\n\t                            <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                              <Card\n\t                                className={`transition-all border-2 h-full ${\n\t                                  examType === 'practice'\n\t                                    ? 'bg-[#788c5d]/20 dark:bg-[#788c5d]/10'\n\t                                    : 'border-border'\n\t                                } ${isFreeTier ? 'cursor-not-allowed opacity-70' : 'cursor-pointer'}`}\n\t                                style={examType === 'practice' ? { borderColor: '#788c5d' } : {}}\n\t                                onClick={handlePracticeCardClick}\n\t                              >\n\t                                <CardHeader className=\"text-center\">\n\t                                  <div className=\"flex items-center justify-center flex-col\">\n\t\t                              <div className=\"flex items-center gap-2 mb-2\">\n\t\t                                <CardTitle className=\"text-xl font-semibold\">Practice Exam</CardTitle>\n\t\t                                {isFreeTier ? (\n                                      <Badge\n                                        variant=\"secondary\"\n                                        className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n                                        style={{\n                                          backgroundColor: '#1f1f1f',\n                                          borderColor: '#1f1f1f',\n                                          color: '#ffffff',\n                                        }}\n                                      >\n                                        Pro Only\n                                      </Badge>\n                                    ) : recommendedExamType === 'practice' && (\n                                      <Badge\n                                        variant=\"secondary\"\n                                        className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n                                        style={{\n                                          backgroundColor: '#788c5d',\n                                          borderColor: '#788c5d',\n                                          color: '#ffffff',\n                                        }}\n                                      >\n                                        <BadgeCheck className=\"h-3 w-3\" />\n                                        Recommended\n                                      </Badge>\n                                    )}\n\t\t                              </div>\n\t                                    <CardDescription>225 questions</CardDescription>\n\t                                  </div>\n\t                                </CardHeader>\n\t                                <CardContent className=\"space-y-3\">\n\t                                  <ul className=\"space-y-2 text-sm text-left\">\n                                      {practiceHighlights.map((highlight, idx) => (\n                                        <li key={idx} className=\"flex items-center gap-2\">\n\t                                      <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                      {highlight}\n\t                                    </li>\n                                      ))}\n\t                                  </ul>\n                                  {isFreeTier && (\n                                    <div className=\"text-sm text-muted-foreground border border-dashed border-border rounded-md p-3\">\n                                      {practiceLockMessage}\n                                    </div>\n                                  )}\n\t                                </CardContent>\n\t                              </Card>\n\t                            </motion.div>\n\t                          </CarouselItem>\n\t                        </CarouselContent>\n\t                        <CarouselPrevious\n\t                          className=\"flex md:hidden h-8 w-8 rounded-full border border-border/40 left-2 top-1/2 -translate-y-1/2\"\n\t                          aria-label=\"Previous exam type\"\n\t                        />\n\t                        <CarouselNext\n\t                          className=\"flex md:hidden h-8 w-8 rounded-full border border-border/40 right-2 top-1/2 -translate-y-1/2\"\n\t                          aria-label=\"Next exam type\"\n\t                        />\n\t                      </Carousel>\n\t                    </div>\n\n\t                    {/* Desktop: static side-by-side cards */}\n\t                    <div className=\"hidden md:grid md:grid-cols-2 gap-4\">\n\t                      <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                        <Card\n\t                          className={`cursor-pointer transition-all border-2 ${\n\t                            examType === 'diagnostic'\n\t                              ? 'bg-[#bdd1ca]/20 dark:bg-[#bdd1ca]/10'\n\t                              : 'border-border'\n\t                          }`}\n\t                          style={examType === 'diagnostic' ? { borderColor: '#bdd1ca' } : {}}\n\t                          onClick={() => handleExamTypeSelect('diagnostic')}\n\t                        >\n\t                          <CardHeader className=\"text-center\">\n\t                            <div className=\"flex items-center justify-center flex-col\">\n\t\t                              <div className=\"flex items-center gap-2 mb-2\">\n\t\t                                <CardTitle className=\"text-xl font-semibold\">Diagnostic Exam</CardTitle>\n\t\t                                {recommendedExamType === 'diagnostic' && (\n\t\t                                  <Badge\n\t\t                                    variant=\"secondary\"\n\t\t                                    className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n\t\t                                    style={{\n\t\t                                      backgroundColor: '#bdd1ca',\n\t\t                                      borderColor: '#bdd1ca',\n\t\t                                      color: '#1a2b24',\n\t\t                                    }}\n\t\t                                  >\n\t\t                                    <BadgeCheck className=\"h-3 w-3\" />\n\t\t                                    Recommended\n\t\t                                  </Badge>\n\t\t                                )}\n\t\t                              </div>\n\t                              <CardDescription>{diagnosticQuestionLabel}</CardDescription>\n\t                            </div>\n\t                          </CardHeader>\n\t                          <CardContent className=\"space-y-3\">\n\t                            <ul className=\"space-y-2 text-sm text-left\">\n                                {diagnosticHighlights.map((highlight, idx) => (\n                                  <li key={idx} className=\"flex items-center gap-2\">\n\t                                <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                {highlight}\n\t                              </li>\n                                ))}\n\t                            </ul>\n\t                          </CardContent>\n\t                        </Card>\n\t                      </motion.div>\n\n\t                      <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                        <Card\n\t                          className={`transition-all border-2 ${\n\t                            examType === 'practice'\n\t                              ? 'bg-[#788c5d]/20 dark:bg-[#788c5d]/10'\n\t                              : 'border-border'\n\t                          } ${isFreeTier ? 'cursor-not-allowed opacity-70' : 'cursor-pointer'}`}\n\t                          style={examType === 'practice' ? { borderColor: '#788c5d' } : {}}\n\t                          onClick={handlePracticeCardClick}\n\t                        >\n\t                          <CardHeader className=\"text-center\">\n\t                            <div className=\"flex items-center justify-center flex-col\">\n\t\t                              <div className=\"flex items-center gap-2 mb-2\">\n\t\t                                <CardTitle className=\"text-xl font-semibold\">Practice Exam</CardTitle>\n\t\t                                {isFreeTier ? (\n                                    <Badge\n                                      variant=\"secondary\"\n                                      className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n                                      style={{\n                                        backgroundColor: '#1f1f1f',\n                                        borderColor: '#1f1f1f',\n                                        color: '#ffffff',\n                                      }}\n                                    >\n                                      Pro Only\n                                    </Badge>\n                                  ) : recommendedExamType === 'practice' && (\n                                    <Badge\n                                      variant=\"secondary\"\n                                      className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-semibold\"\n                                      style={{\n                                        backgroundColor: '#788c5d',\n                                        borderColor: '#788c5d',\n                                        color: '#ffffff',\n                                      }}\n                                    >\n                                      <BadgeCheck className=\"h-3 w-3\" />\n                                      Recommended\n                                    </Badge>\n                                  )}\n\t\t                              </div>\n\t                              <CardDescription>225 questions</CardDescription>\n\t                            </div>\n\t                          </CardHeader>\n\t                          <CardContent className=\"space-y-3\">\n\t                            <ul className=\"space-y-2 text-sm text-left\">\n                                {practiceHighlights.map((highlight, idx) => (\n                                  <li key={idx} className=\"flex items-center gap-2\">\n\t                                <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                {highlight}\n\t                              </li>\n                                ))}\n\t                            </ul>\n                            {isFreeTier && (\n                              <div className=\"text-sm text-muted-foreground border border-dashed border-border rounded-md p-3\">\n                                {practiceLockMessage}\n                              </div>\n                            )}\n\t                          </CardContent>\n\t                        </Card>\n\t                      </motion.div>\n\t                    </div>\n\t                  </div>\n\n\t                  {/* Step 2: Mode Selection (Study vs Test) */}\n\t                  {examType && (\n\t                    <motion.div\n\t                      ref={step2Ref}\n\t                      initial={{ opacity: 0, y: -20, scaleY: 0 }}\n\t                      animate={{ opacity: 1, y: 0, scaleY: 1 }}\n                    transition={{ duration: 0.4, ease: 'easeOut' }}\n                    style={{ originY: 0 }}\n                    className=\"max-w-2xl mx-auto\"\n\t                    >\n\t                      <p className=\"text-sm font-semibold text-muted-foreground mb-4\">Step 2: Select Mode</p>\n\t                      {/* Mobile: carousel with peek */}\n\t                      <div className=\"md:hidden\">\n\t                        <Carousel className=\"w-full\" opts={{ align: 'start' }}>\n                        <CarouselContent className=\"pl-2 sm:pl-4 gap-4\">\n\t                            <CarouselItem className=\"basis-[85%] sm:basis-[70%]\">\n\t                              <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                                <Card\n\t                                  className={`cursor-pointer transition-all border-2 h-full ${\n\t                                    selectedMode === 'study'\n\t                                      ? 'bg-[#d87758]/20 dark:bg-[#d87758]/10'\n\t                                      : 'border-border'\n\t                                  }`}\n\t                                  style={selectedMode === 'study' ? { borderColor: '#d87758' } : {}}\n\t                                  onClick={() => setSelectedMode('study')}\n\t                                >\n\t                                  <CardHeader className=\"text-center\">\n\t                                    <CardTitle className=\"text-xl font-semibold\">Study Mode</CardTitle>\n\t                                    <CardDescription>\n\t                                      Learn at your own pace with immediate feedback\n\t                                    </CardDescription>\n\t                                  </CardHeader>\n\t                                  <CardContent className=\"space-y-3\">\n\t                                    <ul className=\"space-y-2 text-sm text-left\">\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        Correct answers turn green immediately\n\t                                      </li>\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        Learn from mistakes with explanations\n\t                                      </li>\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        No time pressure\n\t                                      </li>\n\t                                    </ul>\n\t                                  </CardContent>\n                              </Card>\n                            </motion.div>\n                          </CarouselItem>\n\n\t                            <CarouselItem className=\"basis-[85%] sm:basis-[70%]\">\n\t                              <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n\t                                <Card\n\t                                  className={`cursor-pointer transition-all border-2 h-full ${\n\t                                    selectedMode === 'test'\n\t                                      ? 'bg-[#c46685]/20 dark:bg-[#c46685]/10'\n\t                                      : 'border-border'\n\t                                  }`}\n\t                                  style={selectedMode === 'test' ? { borderColor: '#c46685' } : {}}\n\t                                  onClick={() => setSelectedMode('test')}\n\t                                >\n\t                                  <CardHeader className=\"text-center\">\n\t                                    <CardTitle className=\"text-xl font-semibold\">Test Mode</CardTitle>\n\t                                    <CardDescription>\n\t                                      Simulate real exam conditions\n\t                                    </CardDescription>\n\t                                  </CardHeader>\n\t                                  <CardContent className=\"space-y-3\">\n\t                                    <ul className=\"space-y-2 text-sm text-left\">\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        See all answers only at the end\n\t                                      </li>\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        Timed exam with countdown\n\t                                      </li>\n\t                                      <li className=\"flex items-center gap-2\">\n\t                                        <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n\t                                        Realistic EPPP exam experience\n\t                                      </li>\n\t                                    </ul>\n\t                                  </CardContent>\n                              </Card>\n                            </motion.div>\n                          </CarouselItem>\n\t                          </CarouselContent>\n\t                          <CarouselPrevious\n\t                            className=\"flex md:hidden h-8 w-8 rounded-full border border-border/40 left-2 top-1/2 -translate-y-1/2\"\n\t                            aria-label=\"Previous mode\"\n\t                          />\n\t                          <CarouselNext\n\t                            className=\"flex md:hidden h-8 w-8 rounded-full border border-border/40 right-2 top-1/2 -translate-y-1/2\"\n\t                            aria-label=\"Next mode\"\n\t                          />\n\t                        </Carousel>\n\t                      </div>\n\n                      {/* Desktop: static side-by-side cards */}\n                      <div className=\"hidden md:grid md:grid-cols-2 gap-4\">\n                        <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n                          <Card\n                            className={`cursor-pointer transition-all border-2 h-full ${\n                              selectedMode === 'study'\n                                ? 'bg-[#d87758]/20 dark:bg-[#d87758]/10'\n                                : 'border-border'\n                            }`}\n                            style={selectedMode === 'study' ? { borderColor: '#d87758' } : {}}\n                            onClick={() => setSelectedMode('study')}\n                          >\n                            <CardHeader className=\"text-center\">\n                              <CardTitle className=\"text-xl font-semibold\">Study Mode</CardTitle>\n                              <CardDescription>\n                                Learn at your own pace with immediate feedback\n                              </CardDescription>\n                            </CardHeader>\n                            <CardContent className=\"space-y-3\">\n                              <ul className=\"space-y-2 text-sm text-left\">\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  Correct answers turn green immediately\n                                </li>\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  Learn from mistakes with explanations\n                                </li>\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  No time pressure\n                                </li>\n                              </ul>\n                            </CardContent>\n                          </Card>\n                        </motion.div>\n\n                        <motion.div whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>\n                          <Card\n                            className={`cursor-pointer transition-all border-2 h-full ${\n                              selectedMode === 'test'\n                                ? 'bg-[#c46685]/20 dark:bg-[#c46685]/10'\n                                : 'border-border'\n                            }`}\n                            style={selectedMode === 'test' ? { borderColor: '#c46685' } : {}}\n                            onClick={() => setSelectedMode('test')}\n                          >\n                            <CardHeader className=\"text-center\">\n                              <CardTitle className=\"text-xl font-semibold\">Test Mode</CardTitle>\n                              <CardDescription>\n                                Simulate real exam conditions\n                              </CardDescription>\n                            </CardHeader>\n                            <CardContent className=\"space-y-3\">\n                              <ul className=\"space-y-2 text-sm text-left\">\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  See all answers only at the end\n                                </li>\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  Timed exam with countdown\n                                </li>\n                                <li className=\"flex items-center gap-2\">\n                                  <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: '#e2dacd' }} />\n                                  Realistic EPPP exam experience\n                                </li>\n                              </ul>\n                            </CardContent>\n                          </Card>\n                        </motion.div>\n                      </div>\n                      {selectedMode && (\n                        <motion.div\n                          initial={{ opacity: 0, y: -20, scaleY: 0 }}\n                          animate={{ opacity: 1, y: 0, scaleY: 1 }}\n                          transition={{ duration: 0.4, ease: 'easeOut' }}\n                          style={{ originY: 0 }}\n                          className=\"mt-6 max-w-sm mx-auto\"\n                        >\n                          <Button\n                            onClick={() => handleGenerateExam(examType, selectedMode)}\n                            className=\"w-full px-8 py-6\"\n                            size=\"lg\"\n                          >\n                            Start {examType === 'diagnostic' ? 'Diagnostic' : 'Practice'} -{' '}\n                            {selectedMode === 'study' ? 'Study Mode' : 'Test Mode'}\n                          </Button>\n                        </motion.div>\n                      )}\n\t                    </motion.div>\n\t                  )}\n\t                </div>\n\t              )}\n            </div>\n\n            {isGenerating && (\n              <div className=\"flex flex-col items-center justify-center py-20 gap-4\">\n                <LoadingAnimation size=\"lg\" />\n                <p className=\"text-muted-foreground\">\n                  Generating your {examType === 'diagnostic' ? 'Diagnostic' : 'Practice'} exam...\n                </p>\n                <p className=\"text-sm text-muted-foreground/60\">This may take a moment</p>\n              </div>\n            )}\n\n\t            {error && (\n\t              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"mb-8\"\n              >\n\t                <Alert variant=\"destructive\">\n\t                  <AlertDescription className=\"space-y-3\">\n                    <div>\n                      <h3 className=\"font-semibold mb-1\">Error</h3>\n                      <p className=\"text-sm\">{error}</p>\n                    </div>\n\t                    <Button\n\t                      onClick={() => handleGenerateExam(examType || 'practice', selectedMode || 'study')}\n\t                      variant=\"outline\"\n\t                      size=\"sm\"\n                    >\n                      Try Again\n                    </Button>\n                  </AlertDescription>\n                </Alert>\n              </motion.div>\n            )}\n          </motion.div>\n        </div>\n      </main>\n    )\n  }\n\n  const question = questions[currentQuestion]\n  const selectedAnswer = selectedAnswers[currentQuestion]\n\n  // Find which option is correct by matching the letter or text\n  const correctOptionIndex = (() => {\n    // Check if correct_answer is a letter (A, B, C, D)\n    if (/^[A-D]$/.test(question.correct_answer)) {\n      return question.correct_answer.charCodeAt(0) - 65 // Convert A->0, B->1, etc\n    }\n    // Otherwise find by matching the text\n    return question.options.findIndex(opt => opt === question.correct_answer)\n  })()\n\n  const correctOption = question.options[correctOptionIndex]\n  const correctLetter = String.fromCharCode(65 + correctOptionIndex)\n  const isCorrect = selectedAnswer === correctOption\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background exam-ui\">\n      <div className=\"max-w-3xl mx-auto\">\n        <Breadcrumb className=\"mb-8\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink asChild>\n                <Link href=\"/dashboard\">Dashboard</Link>\n              </BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>Exam Generator</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ duration: 0.3 }}\n          className={`space-y-6 ${isPaused ? 'blur-sm pointer-events-none' : ''}`}\n        >\n          {/* Header with Question Number, Progress, and Timer */}\n          <div className=\"sticky top-0 z-40 bg-background border-b border-border pb-4 mb-6\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"flex flex-col gap-2\">\n                <div className=\"flex gap-2\">\n                  <Badge variant=\"outline\">\n                    {examType === 'diagnostic' ? 'Diagnostic' : 'Practice'}\n                  </Badge>\n                  <Badge variant=\"outline\">\n                    {mode === 'study' ? 'Study' : 'Test'}\n                  </Badge>\n                </div>\n                <p className=\"text-base font-normal text-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                  Question {currentQuestion + 1} of {questions.length}\n                </p>\n              </div>\n              {mode === 'test' && timeRemaining > 0 && (\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex items-center gap-2 text-base font-normal text-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                    <Clock className=\"w-4 h-4\" />\n                    {formatTime(timeRemaining)}\n                  </div>\n                  <Button\n                    onClick={handlePause}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-none hover:bg-accent transition-colors\"\n                  >\n                    Pause\n                  </Button>\n                </div>\n              )}\n            </div>\n            <Progress value={((currentQuestion + 1) / questions.length) * 100} className=\"h-1\" />\n          </div>\n\n          {/* Highlight and Strikeout Buttons - Above Question */}\n          <div className=\"flex gap-4 mb-4\">\n            <div className=\"flex flex-col gap-1\">\n              <Button\n                onClick={handleHighlightText}\n                onMouseDown={(e) => e.preventDefault()}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"rounded-none hover:bg-accent transition-colors\"\n                style={{ fontFamily: 'Tahoma' }}\n              >\n                Highlight\n              </Button>\n              <span className=\"text-xs text-muted-foreground pl-2\" style={{ fontFamily: 'Tahoma' }}>{isMac ? 'Option' : 'Alt'} + H</span>\n            </div>\n            <div className=\"flex flex-col gap-1\">\n              <Button\n                onClick={handleStrikethroughText}\n                onMouseDown={(e) => e.preventDefault()}\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"rounded-none hover:bg-accent transition-colors\"\n                style={{ fontFamily: 'Tahoma' }}\n              >\n                Strikeout\n              </Button>\n              <span className=\"text-xs text-muted-foreground pl-2\" style={{ fontFamily: 'Tahoma' }}>{isMac ? 'Option' : 'Alt'} + S</span>\n            </div>\n          </div>\n\n          {/* Question - Wrapped with min-height to keep nav box position consistent */}\n          <div className=\"min-h-[calc(100vh-320px)] flex flex-col\">\n            <div ref={questionContentRef} className=\"flex-1 flex flex-col\">\n              <Card className=\"rounded-none flex-1 flex flex-col\">\n                <CardHeader>\n                  <CardTitle className=\"text-base font-normal leading-relaxed text-foreground select-text exam-question-text\" style={{ fontFamily: 'Tahoma' }}>\n                    {textFormats[currentQuestion]?.question ? (\n                      <div dangerouslySetInnerHTML={{ __html: textFormats[currentQuestion].question }} />\n                    ) : (\n                      question.question\n                    )}\n                  </CardTitle>\n                </CardHeader>\n                <Separator />\n                <CardContent className=\"pt-6 flex-1 flex flex-col\">\n                  {/* Answer Options - Radio Style */}\n                  <div className=\"space-y-3\">\n                    {question.options.map((option, idx) => {\n                      const isSelected = selectedAnswer === option\n                      const isAnswered = selectedAnswer !== undefined\n                      const optionLetter = String.fromCharCode(65 + idx)\n                      const optionIsCorrect = option === question.correct_answer\n                      const isShowingCorrect = (mode === 'study' && isAnswered) || (mode === 'test' && currentQuestion === questions.length - 1)\n\n                      return (\n                        <div key={idx} className=\"flex items-start gap-3 p-2\">\n                          {/* Radio Button - Only This is Clickable */}\n                          <motion.button\n                            whileHover={!isAnswered ? { scale: 1.15 } : {}}\n                            onClick={() => (mode === 'test' || !isAnswered) && handleSelectAnswer(option)}\n                            disabled={mode === 'study' && isAnswered}\n                            className={`flex-shrink-0 mt-2 transition-all cursor-pointer disabled:cursor-not-allowed ${\n                              isSelected ? 'scale-110' : ''\n                            }`}\n                          >\n                            <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all ${\n                              isSelected\n                                ? 'border-foreground bg-foreground'\n                                : 'border-muted-foreground bg-transparent hover:border-foreground'\n                            }`}>\n                              {isSelected && (\n                                <div className=\"w-2 h-2 bg-white rounded-full\" />\n                              )}\n                            </div>\n                          </motion.button>\n\n                          {/* Option Text - Not Clickable */}\n                          <div className=\"flex-1 min-w-0 pt-1\">\n                            <div className=\"text-base text-foreground exam-question-text\" style={{ fontFamily: 'Tahoma' }}>\n                              <span style={{ fontFamily: 'Tahoma' }}>{optionLetter}.</span>{' '}\n                              {textFormats[currentQuestion]?.options?.[idx] ? (\n                                <span dangerouslySetInnerHTML={{ __html: textFormats[currentQuestion].options[idx] }} />\n                              ) : (\n                                option\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      )\n                    })}\n                  </div>\n\n                  {/* Explanation - Only shown in Study Mode or after test is complete */}\n                  {showExplanation && (mode === 'study' || (mode === 'test' && currentQuestion === questions.length - 1)) && (\n                    <motion.div\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className=\"mt-6 p-4 rounded-none border bg-muted/50 border-border\"\n                    >\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <p className=\"font-semibold\">\n                          {isCorrect ? 'Correct' : 'Incorrect'}\n                        </p>\n                        <div className=\"text-right\">\n                          <p className=\"text-xs text-muted-foreground mb-1\">Correct Answer</p>\n                          <p className=\"text-2xl font-bold\" style={{ fontFamily: 'Tahoma' }}>\n                            {correctLetter}\n                          </p>\n                        </div>\n                      </div>\n                      <Separator className=\"my-3\" />\n                      <p className=\"text-sm text-muted-foreground\">\n                        {question.explanation}\n                      </p>\n                    </motion.div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Navigation - Sticky Bottom */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"sticky bottom-0 bg-card border-t border-border shadow-lg p-6\"\n          >\n            <div className=\"flex items-center justify-between gap-4\">\n              {/* Flag Checkbox on Left */}\n              <label className=\"flex items-center gap-3 cursor-pointer group hover:bg-accent p-2 rounded transition-colors\">\n                <Checkbox\n                  checked={flaggedQuestions[currentQuestion] || false}\n                  onCheckedChange={(checked) => {\n                    setFlaggedQuestions(prev => ({\n                      ...prev,\n                      [currentQuestion]: checked === true\n                    }))\n                  }}\n                  id={`flag-q${currentQuestion}`}\n                />\n                <span className=\"text-sm font-medium text-foreground group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\" style={{ fontFamily: 'Tahoma' }}>\n                  Flag for review\n                </span>\n              </label>\n\n              {/* Navigation Buttons on Right */}\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex flex-col gap-1 items-center\">\n                  <Button\n                    onClick={handlePrevious}\n                    disabled={currentQuestion === 0}\n                    variant=\"outline\"\n                    className=\"min-w-[100px] rounded-none\"\n                    style={{ fontFamily: 'Tahoma' }}\n                  >\n                    Previous\n                  </Button>\n                  <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>{isMac ? 'Option' : 'Alt'} + P</span>\n                </div>\n\n                {currentQuestion === questions.length - 1 ? (\n                  <div className=\"flex flex-col gap-1 items-center\">\n                    <Button\n                      onClick={handleEndExam}\n                      disabled={isSavingResults}\n                      className=\"min-w-[100px] rounded-none\"\n                      style={{ fontFamily: 'Tahoma' }}\n                    >\n                      {isSavingResults ? 'Saving...' : 'End Exam'}\n                    </Button>\n                    <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                      {isMac ? 'Option' : 'Alt'} + E\n                    </span>\n                  </div>\n                ) : (\n                  <div className=\"flex flex-col gap-1 items-center\">\n                    <Button onClick={handleNext} className=\"min-w-[100px] rounded-none\" style={{ fontFamily: 'Tahoma' }}>\n                      Next\n                    </Button>\n                    <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>{isMac ? 'Option' : 'Alt'} + N</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </motion.div>\n\n        </motion.div>\n\n        {/* Pause Modal Overlay - Outside the blurred container */}\n        {isPaused && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.2 }}\n            className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              transition={{ duration: 0.2 }}\n              className=\"bg-card border border-border rounded-lg shadow-lg p-8 max-w-md w-full mx-4\"\n            >\n              <h2 className=\"text-xl font-semibold mb-4 text-foreground\">Exam Paused</h2>\n              <p className=\"text-sm text-muted-foreground mb-6\">\n                You can resume where you left off at Question {currentQuestion + 1} of {questions.length}.\n              </p>\n\n              <div className=\"flex flex-col gap-3\">\n                <Button\n                  onClick={handleResume}\n                  className=\"rounded-none w-full\"\n                >\n                  Resume Exam\n                </Button>\n                <Button\n                  onClick={handleSaveAndReturn}\n                  variant=\"outline\"\n                  className=\"rounded-none w-full\"\n                >\n                  Save Place & Return to Dashboard\n                </Button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/login/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":7,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":67},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":125,"column":20,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3788,3827],"text":"\n                Don&apos;t have an account?"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3788,3827],"text":"\n                Don&lsquo;t have an account?"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3788,3827],"text":"\n                Don&#39;t have an account?"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3788,3827],"text":"\n                Don&rsquo;t have an account?"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { supabase } from '@/lib/supabase'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Button } from '@/components/ui/button'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { TypographyH1, TypographyMuted } from '@/components/ui/typography'\n\nexport default function LoginPage() {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n  })\n\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target\n    setFormData((prev) => ({\n      ...prev,\n      [name]: value,\n    }))\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError(null)\n\n    if (!formData.email || !formData.password) {\n      setError('Email and password are required')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // Start the sign-in process (don't await it since it hangs)\n      supabase.auth.signInWithPassword({\n        email: formData.email,\n        password: formData.password,\n      }).catch(err => {\n        setError(err.message || 'Login failed')\n        setLoading(false)\n      })\n\n      // Redirect to dashboard after a delay (auth context will handle setting the user)\n      setTimeout(() => {\n        router.push('/dashboard')\n      }, 2000)\n\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Login failed'\n      setError(message)\n      setLoading(false)\n    }\n  }\n\n  return (\n    <main className=\"min-h-screen bg-background flex items-start justify-center p-4 pt-16\">\n      <div className=\"w-full max-w-md\">\n        <Card>\n          <CardHeader className=\"space-y-2\">\n            <TypographyH1>Welcome Back</TypographyH1>\n            <CardDescription>\n              Log in to your EPPP Skills account\n            </CardDescription>\n          </CardHeader>\n\n          <CardContent className=\"space-y-6\">\n            {error && (\n              <Alert variant=\"destructive\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <label htmlFor=\"email\" className=\"text-sm font-medium\">\n                  Email Address\n                </label>\n                <Input\n                  type=\"email\"\n                  id=\"email\"\n                  name=\"email\"\n                  value={formData.email}\n                  onChange={handleInputChange}\n                  placeholder=\"your@email.com\"\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label htmlFor=\"password\" className=\"text-sm font-medium\">\n                  Password\n                </label>\n                <Input\n                  type=\"password\"\n                  id=\"password\"\n                  name=\"password\"\n                  value={formData.password}\n                  onChange={handleInputChange}\n                  placeholder=\"Your password\"\n                  required\n                />\n              </div>\n\n              <Button\n                type=\"submit\"\n                disabled={loading}\n                className=\"w-full mt-6\"\n                size=\"lg\"\n              >\n                {loading ? 'Logging in...' : 'Log In'}\n              </Button>\n            </form>\n\n            <div className=\"text-center\">\n              <TypographyMuted>\n                Don't have an account?{' '}\n                <Link href=\"/signup\" className=\"text-primary hover:underline font-medium\">\n                  Sign up\n                </Link>\n              </TypographyMuted>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/portfolio/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Github' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":81,"column":19,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2874,3393],"text":"\n              Here&apos;s the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here&lsquo;s the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2874,3393],"text":"\n              Here&#39;s the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here&rsquo;s the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":84,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The &quot;traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The &ldquo;traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The &#34;traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The &rdquo;traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":96,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional&quot; way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional&ldquo; way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional&#34; way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional&rdquo; way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":180,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on &quot;misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on &ldquo;misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on &#34;misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on &rdquo;misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":81,"column":205,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations&quot; that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations&ldquo; that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations&#34; that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations&rdquo; that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":81,"column":278,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don&apos;t have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don&lsquo;t have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don&#39;t have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don&rsquo;t have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":81,"column":471,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don&apos;t have time for a broken system.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don&lsquo;t have time for a broken system.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don&#39;t have time for a broken system.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2874,3393],"text":"\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don&rsquo;t have time for a broken system.\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":84,"column":222,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3420,3669],"text":"\n              I used LLMs to accelerate my learning. I built a blueprint that allowed me to pass in 30 days, live a full life outside of psychology, and still gain knowledge that makes me a better clinician because I didn&apos;t burn out.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3420,3669],"text":"\n              I used LLMs to accelerate my learning. I built a blueprint that allowed me to pass in 30 days, live a full life outside of psychology, and still gain knowledge that makes me a better clinician because I didn&lsquo;t burn out.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3420,3669],"text":"\n              I used LLMs to accelerate my learning. I built a blueprint that allowed me to pass in 30 days, live a full life outside of psychology, and still gain knowledge that makes me a better clinician because I didn&#39;t burn out.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3420,3669],"text":"\n              I used LLMs to accelerate my learning. I built a blueprint that allowed me to pass in 30 days, live a full life outside of psychology, and still gain knowledge that makes me a better clinician because I didn&rsquo;t burn out.\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":219,"column":118,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[9262,9416],"text":"\n                  Interested in collaborating on educational technology, clinical innovation, or the EPPP platform? I&apos;d love to connect.\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[9262,9416],"text":"\n                  Interested in collaborating on educational technology, clinical innovation, or the EPPP platform? I&lsquo;d love to connect.\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[9262,9416],"text":"\n                  Interested in collaborating on educational technology, clinical innovation, or the EPPP platform? I&#39;d love to connect.\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[9262,9416],"text":"\n                  Interested in collaborating on educational technology, clinical innovation, or the EPPP platform? I&rsquo;d love to connect.\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport Link from \"next/link\"\nimport { Github, Linkedin, Mail, ExternalLink } from \"lucide-react\"\nimport { motion } from \"motion/react\"\nimport Image from \"next/image\"\nimport { ResumeCard } from \"@/components/resume-card\"\n\nconst BLUR_FADE_DELAY = 0.04\n\nconst BlurFadeText = ({ text, className, delay }: { text: string; className?: string; delay: number }) => (\n  <motion.h1\n    initial={{ opacity: 0, y: 8 }}\n    animate={{ opacity: 1, y: 0 }}\n    transition={{ delay, duration: 0.5 }}\n    className={className}\n  >\n    {text}\n  </motion.h1>\n)\n\nconst BlurFade = ({ children, delay }: { children: React.ReactNode; delay: number }) => (\n  <motion.div\n    initial={{ opacity: 0, y: 8 }}\n    animate={{ opacity: 1, y: 0 }}\n    transition={{ delay, duration: 0.5 }}\n  >\n    {children}\n  </motion.div>\n)\n\nexport default function PortfolioPage() {\n  return (\n    <main className=\"flex flex-col min-h-[100dvh] space-y-10 bg-background py-20\">\n      <div className=\"mx-auto w-full max-w-2xl space-y-8 px-4\">\n        {/* Hero Section */}\n        <section id=\"hero\">\n          <div className=\"gap-2 flex justify-between\">\n            <div className=\"flex-col flex flex-1 space-y-1.5\">\n              <BlurFadeText\n                delay={BLUR_FADE_DELAY}\n                className=\"text-3xl font-bold tracking-tighter sm:text-5xl xl:text-6xl/none\"\n                text=\"Anders H. Chan, PsyD\"\n              />\n              <BlurFadeText\n                delay={BLUR_FADE_DELAY * 2}\n                className=\"max-w-[600px] md:text-xl text-muted-foreground\"\n                text=\"Clinical Psychologist\"\n              />\n            </div>\n            <BlurFade delay={BLUR_FADE_DELAY * 3}>\n              <div className=\"flex items-center justify-center size-28 rounded-full border-2 border-primary/20 flex-shrink-0 overflow-hidden\">\n                <Image\n                  src=\"/images/profilepic.png\"\n                  alt=\"Anders H. Chan\"\n                  width={112}\n                  height={112}\n                  className=\"w-full h-full object-cover\"\n                />\n              </div>\n            </BlurFade>\n          </div>\n        </section>\n\n        {/* About Section */}\n        <section id=\"about\">\n          <BlurFade delay={BLUR_FADE_DELAY * 4}>\n            <h2 className=\"text-xl font-bold\">About</h2>\n          </BlurFade>\n          <BlurFade delay={BLUR_FADE_DELAY * 5}>\n            <p className=\"text-pretty font-sans text-sm text-muted-foreground\">\n              Right after finishing my postdoc, I took my first EPPP diagnostic. I scored a 19%.\n              <br />\n              <br />\n              Even with years of schooling and wide clinical experience, the traditional study model failed me.\n              <br />\n              <br />\n              A month later, I passed on my first try with a 588.\n              <br />\n              <br />\n              Here's the brutal truth: The EPPP industry is built on friction. The \"traditional\" way of studying is designed to be miserable, and paid programs are often built on \"misdirected calculations\" that lead you to study the wrong material. They waste the money you don't have after paying the f*cking registration fee, and time between sessions and at home. That is a miserable scam. Life happens. People get sick, they transition, they experience loss. You don't have time for a broken system.\n              <br />\n              <br />\n              I used LLMs to accelerate my learning. I built a blueprint that allowed me to pass in 30 days, live a full life outside of psychology, and still gain knowledge that makes me a better clinician because I didn't burn out.\n              <br />\n              <br />\n              I give away this entire blueprint for free on TikTok. I built an AI to execute it even more efficiently. If I can go from 19% to a 588 in one month, I have a feeling that so can others.\n            </p>\n          </BlurFade>\n        </section>\n\n        {/* Work Experience Section */}\n        <section id=\"work\">\n          <div className=\"flex min-h-0 flex-col gap-y-3\">\n            <BlurFade delay={BLUR_FADE_DELAY * 6}>\n              <h2 className=\"text-xl font-bold\">Work Experience</h2>\n            </BlurFade>\n\n            {[\n              {\n                company: \"David Geffen School of Medicine at UCLA\",\n                title: \"Postdoctoral Fellow\",\n                period: \"Sep 2024 - Sep 2025\",\n                location: \"Los Angeles, California\",\n              },\n              {\n                company: \"NYU Langone Health\",\n                title: \"Psychology Intern\",\n                period: \"Sep 2023 - Aug 2024\",\n                location: \"Brooklyn, New York\",\n              },\n              {\n                company: \"TherapyMyWay\",\n                title: \"Psychotherapist\",\n                period: \"Aug 2022 - Jul 2023\",\n                location: \"Remote\",\n              },\n              {\n                company: \"Brooklyn Center for Psychotherapy\",\n                title: \"Psychotherapist\",\n                period: \"Sep 2021 - Jul 2023\",\n                location: \"Brooklyn, New York\",\n              },\n              {\n                company: \"Montefiore Einstein - Supporting Healthy Relationships\",\n                title: \"Psychology Extern\",\n                period: \"Jul 2020 - Jun 2021\",\n                location: \"Bronx, New York\",\n              },\n              {\n                company: \"Long Island University\",\n                title: \"Graduate Research Assistant & Therapist\",\n                period: \"Sep 2018 - Sep 2020\",\n                location: \"Brooklyn, New York\",\n              },\n            ].map((work, idx) => (\n              <BlurFade key={work.company} delay={BLUR_FADE_DELAY * 7 + idx * 0.05}>\n                <ResumeCard\n                  title={work.company}\n                  subtitle={work.title}\n                  period={work.period}\n                  description={work.location}\n                />\n              </BlurFade>\n            ))}\n          </div>\n        </section>\n\n        {/* Education Section */}\n        <section id=\"education\">\n          <div className=\"flex min-h-0 flex-col gap-y-3\">\n            <BlurFade delay={BLUR_FADE_DELAY * 13}>\n              <h2 className=\"text-xl font-bold\">Education</h2>\n            </BlurFade>\n\n            {[\n              {\n                school: \"Long Island University\",\n                degree: \"Psy.D. (Doctor of Psychology)\",\n                period: \"2018 - 2024\",\n                description: \"Dissertation: Acceptability and Cultural Considerations of DBT-A for Chinese Mental Health Professionals\",\n              },\n            ].map((edu, idx) => (\n              <BlurFade key={edu.school} delay={BLUR_FADE_DELAY * 14 + idx * 0.05}>\n                <ResumeCard\n                  title={edu.school}\n                  subtitle={edu.degree}\n                  period={edu.period}\n                  description={edu.description}\n                />\n              </BlurFade>\n            ))}\n          </div>\n        </section>\n\n        {/* Publications Section */}\n        <section id=\"publications\">\n          <div className=\"flex min-h-0 flex-col gap-y-3\">\n            <BlurFade delay={BLUR_FADE_DELAY * 15}>\n              <h2 className=\"text-xl font-bold\">Publications</h2>\n            </BlurFade>\n\n            {[\n              {\n                title: \"Visual attentional differences in psychology students with and without disabilities: a pilot study assessing the flanker task for prescriptive visual accommodative technologies\",\n                venue: \"Frontiers in Psychology\",\n                year: \"2025\",\n                href: \"https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2025.1484536/full\",\n              },\n            ].map((pub, idx) => (\n              <BlurFade key={pub.title} delay={BLUR_FADE_DELAY * 16 + idx * 0.05}>\n                <Link\n                  href={pub.href}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"group flex items-start justify-between gap-4 rounded-lg border border-border/50 hover:border-primary/40 hover:shadow-lg transition-all duration-300 p-4\"\n                >\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg group-hover:text-primary transition-colors\">\n                      {pub.title}\n                    </h3>\n                    <p className=\"text-sm text-muted-foreground\">{pub.venue}</p>\n                    <p className=\"text-sm text-muted-foreground\">{pub.year}</p>\n                  </div>\n                  <ExternalLink className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors flex-shrink-0 mt-1\" />\n                </Link>\n              </BlurFade>\n            ))}\n          </div>\n        </section>\n\n        {/* Contact Section */}\n        <section id=\"contact\">\n          <div className=\"grid items-center justify-center gap-4 text-center w-full py-12\">\n            <BlurFade delay={BLUR_FADE_DELAY * 21}>\n              <div className=\"space-y-3\">\n                <h2 className=\"text-3xl font-bold tracking-tighter\">Get in Touch</h2>\n                <p className=\"mx-auto max-w-[600px] text-muted-foreground\">\n                  Interested in collaborating on educational technology, clinical innovation, or the EPPP platform? I'd love to connect.\n                </p>\n              </div>\n            </BlurFade>\n\n            <BlurFade delay={BLUR_FADE_DELAY * 22}>\n              <div className=\"flex gap-4 justify-center flex-wrap\">\n                <Link\n                  href=\"https://www.linkedin.com/in/anders-h-chan/\"\n                  target=\"_blank\"\n                  className=\"inline-flex items-center gap-2 px-6 py-2 rounded-lg border border-border/50 hover:border-primary/40 hover:shadow-lg transition-all duration-300\"\n                >\n                  <Linkedin className=\"w-4 h-4\" />\n                  LinkedIn\n                </Link>\n                <Link\n                  href=\"mailto:contact@example.com\"\n                  className=\"inline-flex items-center gap-2 px-6 py-2 rounded-lg bg-primary text-primary-foreground hover:opacity-90 transition-all duration-300\"\n                >\n                  <Mail className=\"w-4 h-4\" />\n                  Email\n                </Link>\n              </div>\n            </BlurFade>\n          </div>\n        </section>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/prioritize/prioritize-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lightbulb' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":5,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":5,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":5,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Switch' is defined but never used.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReactMarkdown' is defined but never used.","line":23,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remarkGfm' is defined but never used.","line":24,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Table' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableBody' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableCell' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableHead' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableHeader' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableRow' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalysisData' is defined but never used.","line":38,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":81,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":81,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2824,2827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2824,2827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedResultId'. Either include it or remove the dependency array.","line":225,"column":6,"nodeType":"ArrayExpression","endLine":225,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [userId, resultsParam, selectedResultId]","fix":{"range":[7214,7236],"text":"[userId, resultsParam, selectedResultId]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'analyzeResults'. Either include it or remove the dependency array.","line":338,"column":6,"nodeType":"ArrayExpression","endLine":338,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [analyzeResults, examResults, isLoadingResults]","fix":{"range":[10561,10592],"text":"[analyzeResults, examResults, isLoadingResults]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sections' is assigned a value but never used.","line":534,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":534,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":706,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":706,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26423,26426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26423,26426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":758,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":758,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28870,28873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28870,28873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":763,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":763,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29337,29340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29337,29340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":818,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":818,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32595,32598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32595,32598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useMemo, useRef, useState } from 'react'\nimport Link from 'next/link'\nimport { Lightbulb, TrendingDown, BookOpen, Target, Zap, AlertTriangle, FileText, ChevronDown } from 'lucide-react'\nimport { motion, AnimatePresence } from 'motion/react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Separator } from '@/components/ui/separator'\nimport { Badge } from '@/components/ui/badge'\nimport { Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb'\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from '@/components/ui/carousel'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport * as animations from '@/lib/animations'\nimport { calculateStudyStats, type StudyStats } from '@/lib/dashboard-utils'\nimport { Switch } from '@/components/ui/switch'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { useAuth } from '@/context/auth-context'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport { ExpandableDomainAnalysis } from '@/components/expandable-domain-analysis'\nimport { getAllQuizResults } from '@/lib/quiz-results-storage'\nimport { Progress } from '@/components/ui/progress'\n\ninterface AnalysisData {\n  overallScore?: number\n  domainBreakdown?: Record<string, { score: number; weight: number }>\n  recommendations?: string[]\n  topics?: string[]\n}\n\ninterface ResultHistoryItem {\n  id: string\n  examType: string\n  examMode: string\n  score: number | null\n  totalQuestions: number | null\n  createdAt: string\n}\n\nconst HISTORY_PAGE_SIZE = 4\n\nconst fallbackStudyStats: StudyStats = {\n  totalQuizzes: 0,\n  averageScore: 0,\n  studyStreak: 0,\n  lastStudyDate: null,\n  bestPerformingDomain: '',\n  recentScores: [],\n  weakTopics: [],\n  lastStudiedTopic: null,\n  studyDays: [],\n}\n\nexport function PrioritizeContent() {\n  const searchParams = useSearchParams()\n  const resultId = searchParams.get('id')\n  const resultsParam = searchParams.get('results')\n  const router = useRouter()\n  const { user } = useAuth()\n  const userId = user?.id ?? null\n\n  const [analysis, setAnalysis] = useState('')\n  const [isAnalyzing, setIsAnalyzing] = useState(false)\n  const [isLoadingResults, setIsLoadingResults] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [studyStats, setStudyStats] = useState<StudyStats>(fallbackStudyStats)\n  const [viewMode, setViewMode] = useState<'overview' | 'detailed'>('overview')\n  const [examResults, setExamResults] = useState<string | null>(null)\n  const [priorityData, setPriorityData] = useState<any>(null)\n  const [expandedRecommendations, setExpandedRecommendations] = useState<number[]>([])\n  const [resultHistory, setResultHistory] = useState<ResultHistoryItem[]>([])\n  const [isLoadingHistory, setIsLoadingHistory] = useState(false)\n  const [historyError, setHistoryError] = useState<string | null>(null)\n  const [selectedResultId, setSelectedResultId] = useState<string | null>(resultId)\n  const [topicScores, setTopicScores] = useState<Record<string, number>>({})\n  const skipNextResultFetch = useRef(false)\n  const historyPages = useMemo(() => {\n    if (resultHistory.length === 0) return []\n\n    const pages: ResultHistoryItem[][] = []\n    for (let i = 0; i < resultHistory.length; i += HISTORY_PAGE_SIZE) {\n      pages.push(resultHistory.slice(i, i + HISTORY_PAGE_SIZE))\n    }\n    return pages\n  }, [resultHistory])\n\n  const handleHistorySelect = (historyId: string, options?: { updateUrl?: boolean }) => {\n    if (!historyId || historyId === selectedResultId) return\n\n    setError(null)\n    setExamResults(null)\n    setSelectedResultId(historyId)\n\n    if (options?.updateUrl === false) {\n      return\n    }\n\n    const params = new URLSearchParams(searchParams.toString())\n    params.set('id', historyId)\n    const queryString = params.toString()\n    router.replace(queryString ? `/prioritize?${queryString}` : '/prioritize', { scroll: false })\n  }\n\n  const formatHistoryLabel = (item: ResultHistoryItem) => {\n    const type = item.examType === 'diagnostic' ? 'Diagnostic' : 'Practice'\n    const mode = item.examMode === 'test' ? 'Test Mode' : 'Study Mode'\n    return `${type} â€¢ ${mode}`\n  }\n\n  const formatHistoryScore = (item: ResultHistoryItem) => {\n    if (\n      typeof item.score !== 'number' ||\n      typeof item.totalQuestions !== 'number' ||\n      item.totalQuestions === 0\n    ) {\n      return 'Score pending'\n    }\n\n    const percent = Math.round((item.score / item.totalQuestions) * 100)\n    return `${percent}%`\n  }\n\n  const formatHistoryDate = (item: ResultHistoryItem) => {\n    const date = new Date(item.createdAt)\n    if (Number.isNaN(date.getTime())) return ''\n    const day = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })\n    const time = date.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' })\n    return `${day} â€¢ ${time}`\n  }\n\n  useEffect(() => {\n    if (resultId) {\n      setSelectedResultId(resultId)\n    }\n  }, [resultId])\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n    setStudyStats(calculateStudyStats())\n  }, [])\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n    const results = getAllQuizResults()\n    const scores: Record<string, number> = {}\n\n    results.forEach((result) => {\n      if (!result?.topic) return\n      const normalized = result.topic.replace(/^[\\d\\s]+/, '').toLowerCase()\n      if (!normalized) return\n\n      const percentage =\n        result.totalQuestions > 0 ? (result.score / result.totalQuestions) * 100 : 0\n      scores[normalized] = percentage\n    })\n\n    setTopicScores(scores)\n  }, [])\n\n  // Fetch exam history for quick navigation\n  useEffect(() => {\n    if (!userId) {\n      setResultHistory([])\n      return\n    }\n\n    let isMounted = true\n\n    const fetchHistory = async () => {\n      try {\n        setIsLoadingHistory(true)\n        setHistoryError(null)\n\n        const response = await fetch(`/api/exam-history?userId=${userId}&limit=10`)\n        if (!response.ok) {\n          const errorText = await response.text()\n          throw new Error(errorText || 'Failed to load exam history')\n        }\n\n        const data = await response.json()\n        if (!data.success) {\n          throw new Error(data.error || 'Failed to load exam history')\n        }\n\n        if (!isMounted) return\n\n        setResultHistory(data.history || [])\n\n        if (!resultsParam && !selectedResultId && data.history && data.history.length > 0) {\n          setError(null)\n          setExamResults(null)\n          setSelectedResultId(data.history[0].id)\n        }\n      } catch (err) {\n        console.error('Error fetching exam history:', err)\n        if (isMounted) {\n          setHistoryError(err instanceof Error ? err.message : 'Failed to load exam history')\n        }\n      } finally {\n        if (isMounted) {\n          setIsLoadingHistory(false)\n        }\n      }\n    }\n\n    fetchHistory()\n\n    return () => {\n      isMounted = false\n    }\n  }, [userId, resultsParam])\n\n  // Fetch results (specific ID, legacy param, or latest exam)\n  useEffect(() => {\n    const fetchResults = async () => {\n      if (!selectedResultId && resultsParam) {\n        setExamResults(resultsParam)\n        return\n      }\n\n      if (!selectedResultId) {\n        if (!userId) {\n          return\n        }\n\n        try {\n          setIsLoadingResults(true)\n          setError(null)\n\n          const response = await fetch(`/api/get-exam-results/latest?userId=${userId}`)\n\n          if (response.status === 404) {\n            setExamResults(null)\n            return\n          }\n\n          if (!response.ok) {\n            const errorText = await response.text()\n            throw new Error(errorText || 'Failed to load latest exam results')\n          }\n\n          const data = await response.json()\n\n          if (!data.success) {\n            throw new Error(data.error || 'Failed to load latest exam results')\n          }\n\n          const resultData = {\n            questions: data.results.questions,\n            selectedAnswers: data.results.selectedAnswers,\n            score: data.results.score,\n            totalQuestions: data.results.totalQuestions,\n            examType: data.results.examType,\n            examMode: data.results.examMode,\n            topPriorities: data.results.topPriorities,\n            allResults: data.results.allResults,\n          }\n\n          setExamResults(JSON.stringify(resultData))\n\n          if (!selectedResultId && data.resultId) {\n            skipNextResultFetch.current = true\n            setSelectedResultId(data.resultId)\n          }\n        } catch (err) {\n          console.error('Error loading latest exam results:', err)\n          setError(err instanceof Error ? err.message : 'Failed to load results')\n        } finally {\n          setIsLoadingResults(false)\n        }\n        return\n      }\n\n      if (skipNextResultFetch.current) {\n        skipNextResultFetch.current = false\n        return\n      }\n\n      try {\n        setIsLoadingResults(true)\n        setError(null)\n\n        const response = await fetch(`/api/get-exam-results?id=${selectedResultId}`)\n\n        if (!response.ok) {\n          const errorText = await response.text()\n          throw new Error(errorText || 'Failed to load exam results')\n        }\n\n        const data = await response.json()\n\n        if (!data.success) {\n          throw new Error(data.error || 'Failed to load exam results')\n        }\n\n        const resultData = {\n          questions: data.results.questions,\n          selectedAnswers: data.results.selectedAnswers,\n          score: data.results.score,\n          totalQuestions: data.results.totalQuestions,\n          examType: data.results.examType,\n          examMode: data.results.examMode,\n          topPriorities: data.results.topPriorities,\n          allResults: data.results.allResults,\n        }\n\n        setExamResults(JSON.stringify(resultData))\n      } catch (err) {\n        console.error('Error loading results:', err)\n        setError(err instanceof Error ? err.message : 'Failed to load results')\n      } finally {\n        setIsLoadingResults(false)\n      }\n    }\n\n    fetchResults()\n  }, [selectedResultId, resultsParam, userId])\n\n  // Analyze results once they're loaded\n  useEffect(() => {\n    if (examResults && !isLoadingResults) {\n      analyzeResults()\n    }\n  }, [examResults, isLoadingResults])\n\n  const analyzeResults = async () => {\n    if (!examResults) return\n\n    try {\n      setIsAnalyzing(true)\n      setError(null)\n      setAnalysis('')\n\n      const response = await fetch('/api/prioritize', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ examResults, userId: user?.id }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to analyze exam results')\n      }\n\n      const data = await response.json()\n\n      setAnalysis(data.markdown || '')\n      setPriorityData(data.structured || null)\n    } catch (err) {\n      console.error('Error analyzing results:', err)\n      setError(err instanceof Error ? err.message : 'Failed to analyze results')\n    } finally {\n      setIsAnalyzing(false)\n    }\n  }\n\n  const toggleRecommendation = (index: number) => {\n    setExpandedRecommendations((prev) =>\n      prev.includes(index)\n        ? prev.filter((i) => i !== index)\n        : [...prev, index]\n    )\n  }\n\n  const getTopicScore = (topicName?: string | null) => {\n    if (!topicName) return null\n    const normalized = topicName.replace(/^[\\d\\s]+/, '').toLowerCase()\n    return typeof topicScores[normalized] === 'number' ? topicScores[normalized] : null\n  }\n\n  const parseAnalysis = () => {\n    const lines = analysis.split('\\n')\n    const sections: Record<string, string[]> = {}\n    let currentSection = 'overview'\n\n    for (const line of lines) {\n      if (line.startsWith('#')) {\n        currentSection = line.toLowerCase().replace(/[^a-z0-9]/g, ' ').trim().split(' ')[0]\n        sections[currentSection] = []\n      } else if (line.trim()) {\n        if (!sections[currentSection]) sections[currentSection] = []\n        sections[currentSection].push(line)\n      }\n    }\n\n    return sections\n  }\n\n  // Show loading state while fetching results from Supabase\n  if (isLoadingResults) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"text-center py-20\">\n            <div className=\"w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin mx-auto mb-4\" />\n            <p className=\"text-muted-foreground\">\n              Loading exam results...\n            </p>\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  if (!examResults && !selectedResultId && !resultsParam) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Prioritizer</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n\n          <div>\n            <div className=\"text-center py-12\">\n              <h1 className=\"text-5xl md:text-6xl font-bold mb-4 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70\">\n                Prioritize\n              </h1>\n              <p className=\"text-muted-foreground mb-12 text-lg md:text-xl max-w-2xl mx-auto leading-relaxed\">\n                AI-powered study recommendations based on your exam performance\n              </p>\n\n              {/* Current Progress Section */}\n              {studyStats.weakTopics.length > 0 || studyStats.totalQuizzes > 0 ? (\n                <div className=\"max-w-3xl mx-auto mb-12\">\n                  {/* Weak Areas Alert */}\n                  {studyStats.weakTopics.length > 0 ? (\n                    <div className=\"mb-8\">\n                      <Card className=\"border-orange-500/30 bg-orange-500/5\">\n                        <CardHeader>\n                          <div className=\"flex items-center gap-3\">\n                            <AlertTriangle size={24} className=\"text-orange-500 flex-shrink-0\" />\n                            <div className=\"text-left\">\n                              <CardTitle className=\"text-xl\">Topics Needing Focus</CardTitle>\n                              <CardDescription>\n                                These topics scored below 60% - prioritize them in your study plan\n                              </CardDescription>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <Separator />\n                        <CardContent className=\"pt-6\">\n                          <div className=\"space-y-3\">\n                            {studyStats.weakTopics.slice(0, 3).map((topic, idx) => (\n                              <div\n                                key={idx}\n                                className=\"flex items-center justify-between p-3 rounded-lg bg-background border border-border hover:border-orange-500/50 transition-colors\"\n                              >\n                                <div className=\"flex items-center gap-3 flex-1\">\n                                  <div className=\"w-2 h-2 rounded-full bg-orange-500 flex-shrink-0\" />\n                                  <div className=\"text-left\">\n                                    <p className=\"font-medium text-sm\">{topic.topic}</p>\n                                    <p className=\"text-xs text-muted-foreground\">\n                                      Average: {topic.score}%\n                                    </p>\n                                  </div>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  ) : studyStats.totalQuizzes > 0 ? (\n                    <div className=\"mb-8\">\n                      <Card className=\"border-green-500/30 bg-green-500/5\">\n                        <CardHeader>\n                          <div className=\"flex items-center gap-3\">\n                            <BookOpen size={24} className=\"text-green-500 flex-shrink-0\" />\n                            <div className=\"text-left\">\n                              <CardTitle className=\"text-xl\">Great Progress!</CardTitle>\n                              <CardDescription>\n                                All your topics are scoring above 60%. Keep up the excellent work!\n                              </CardDescription>\n                            </div>\n                          </div>\n                        </CardHeader>\n                      </Card>\n                    </div>\n                  ) : null}\n                </div>\n              ) : null}\n\n              {/* CTA Section */}\n              <div>\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-2xl\">Ready for a Practice Exam?</CardTitle>\n                    <CardDescription>\n                      Take a practice exam to get detailed AI-powered analysis and personalized recommendations\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex gap-4 justify-center\">\n                      <Link href=\"/exam-generator\">\n                        <Button size=\"lg\">Take Practice Exam</Button>\n                      </Link>\n                      <Link href=\"/topic-selector\">\n                        <Button size=\"lg\" variant=\"outline\">Study Topics</Button>\n                      </Link>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  const sections = parseAnalysis()\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Breadcrumb className=\"mb-8\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>Prioritizer</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n        >\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-5xl md:text-6xl font-bold mb-4 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70\">\n              Prioritize\n            </h1>\n            <p className=\"text-muted-foreground text-lg md:text-xl max-w-2xl mx-auto leading-relaxed\">\n              Your personalized study plan based on exam performance\n            </p>\n          </div>\n\n          {isAnalyzing && !analysis && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\"\n            >\n              <div className=\"bg-background border border-border rounded-lg p-8 text-center\">\n                <div className=\"w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin mx-auto mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  Analyzing your performance...\n                </p>\n              </div>\n            </motion.div>\n          )}\n\n          {userId && (isLoadingHistory || historyError || resultHistory.length > 0) && (\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.3 }}\n              className=\"mb-8\"\n            >\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-xl\">Recent Exam Attempts</CardTitle>\n                  <CardDescription>Jump between your last results.</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {historyError ? (\n                    <p className=\"text-sm text-destructive\">{historyError}</p>\n                  ) : isLoadingHistory ? (\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <div className=\"w-4 h-4 border-2 border-border border-t-primary rounded-full animate-spin\" />\n                      Loading recent attempts...\n                    </div>\n                  ) : historyPages.length > 0 ? (\n                    <div className=\"relative\">\n                      <Carousel className=\"w-full\">\n                        <CarouselContent className=\"flex gap-3 pl-2 pr-6\">\n                          {historyPages.map((page, pageIndex) => (\n                            <CarouselItem key={`history-page-${pageIndex}`} className=\"w-full\">\n                              <div className=\"flex gap-3 overflow-hidden\">\n                                {page.map((item) => {\n                                  const isActive = selectedResultId === item.id\n                                  return (\n                                    <button\n                                      key={item.id}\n                                      type=\"button\"\n                                      onClick={() => handleHistorySelect(item.id)}\n                                      className={`flex-1 min-w-[180px] p-4 rounded-lg border text-left transition-colors ${\n                                        isActive\n                                          ? 'border-primary bg-primary/10'\n                                          : 'border-border hover:border-primary/50'\n                                      }`}\n                                    >\n                                      <div className=\"text-xs uppercase tracking-wide text-muted-foreground mb-1\">\n                                        {formatHistoryLabel(item)}\n                                      </div>\n                                      <div className=\"text-xl font-semibold\">{formatHistoryScore(item)}</div>\n                                      <div className=\"text-xs text-muted-foreground mt-1\">\n                                        {formatHistoryDate(item)}\n                                      </div>\n                                    </button>\n                                  )\n                                })}\n                              </div>\n                            </CarouselItem>\n                          ))}\n                        </CarouselContent>\n                        <CarouselPrevious\n                          className=\"absolute top-1/2 -translate-y-1/2 rounded-full border border-border/40 h-10 w-10\"\n                          aria-label=\"Previous exam\"\n                          style={{ left: '-1.5rem' }}\n                        />\n                        <CarouselNext\n                          className=\"absolute top-1/2 -translate-y-1/2 rounded-full border border-border/40 h-10 w-10\"\n                          aria-label=\"Next exam\"\n                          style={{ right: '-1.5rem' }}\n                        />\n                      </Carousel>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">\n                      No completed exams yet. Take a diagnostic or practice exam to see your progress here.\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n            </motion.div>\n          )}\n\n          {error && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-6 mb-8\"\n            >\n              <h3 className=\"font-semibold text-destructive mb-2\">Error</h3>\n              <p className=\"text-sm text-destructive/80\">{error}</p>\n              <Button\n                onClick={analyzeResults}\n                variant=\"outline\"\n                className=\"mt-4\"\n              >\n                Try Again\n              </Button>\n            </motion.div>\n          )}\n\n          {analysis && (\n            <motion.div\n              initial=\"hidden\"\n              animate=\"visible\"\n              variants={animations.containerVariants}\n              className=\"space-y-8\"\n            >\n              {/* Score Display */}\n              {priorityData && (\n                <motion.div\n                  variants={animations.itemVariants}\n                  className=\"grid grid-cols-1 md:grid-cols-2 gap-6\"\n                >\n                  <Card style={{ borderColor: '#bdd1ca', backgroundColor: 'rgba(189, 209, 202, 0.08)' }}>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg\">Your Score</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-4xl font-bold\">\n                        {Math.round((priorityData.score / priorityData.totalQuestions) * 100)}%\n                      </div>\n                      <div className=\"text-sm text-muted-foreground mt-2\">\n                        {priorityData.score}/{priorityData.totalQuestions}\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card style={{ borderColor: '#788c5d', backgroundColor: 'rgba(120, 140, 93, 0.08)' }}>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg\">Domains to Focus</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      {priorityData.topPriorities && priorityData.topPriorities.slice(0, 3).map((item: any, idx: number) => {\n                        const isOrgPsych = item.type === 'org_psych'\n                        const displayName = isOrgPsych ? item.domainName : (item.domainName.split(': ')[1] || item.domainName)\n                        return (\n                          <div key={idx} className=\"text-sm mb-2\">\n                            <div className=\"font-medium\">{idx + 1}. {displayName}</div>\n                          </div>\n                        )\n                      })}\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              )}\n\n              {/* Domain Performance Accordion */}\n              {priorityData && priorityData.examQuestions && (\n                <motion.div\n                  variants={animations.itemVariants}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.6 }}\n                >\n                  <ExpandableDomainAnalysis\n                    allResults={priorityData.allResults || []}\n                    examQuestions={priorityData.examQuestions || []}\n                    selectedAnswers={priorityData.selectedAnswers || {}}\n                    orgPsychPerformance={priorityData.orgPsychPerformance}\n                  />\n                </motion.div>\n              )}\n\n              {/* Recommended Study Files */}\n              {priorityData && priorityData.topPriorities && priorityData.topPriorities.length > 0 && (\n                <motion.div\n                  variants={animations.itemVariants}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.8 }}\n                >\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-2xl flex items-center gap-2\">\n                        <FileText size={24} className=\"text-muted-foreground\" />\n                        Recommended Topics to Study\n                      </CardTitle>\n                      <CardDescription>\n                        Focus on these areas based on your performance\n                      </CardDescription>\n                    </CardHeader>\n                    <Separator />\n                    <CardContent className=\"pt-6\">\n                      <div className=\"space-y-3\">\n                        {priorityData.topPriorities.slice(0, 3).map((item: any, idx: number) => {\n                          const isExpanded = expandedRecommendations.includes(idx)\n                          const isOrgPsych = item.type === 'org_psych'\n                          const displayName = isOrgPsych ? item.domainName : (item.domainName.split(': ')[1] || item.domainName)\n                          const recommendedTopics = item.recommendedTopics || []\n                          const reviewTopics = recommendedTopics.filter((topic: any) => {\n                            const topicName = topic.topicName || topic.sourceFile\n                            const score = getTopicScore(topicName)\n                            return !(score !== null && score >= 70)\n                          })\n                          const topicCount = reviewTopics.length\n                          const topicLabel = topicCount === 1 ? 'topic' : 'topics'\n                          const descriptionText =\n                            topicCount > 0\n                              ? `${topicCount} ${topicLabel} to review`\n                              : 'All recommended topics completed'\n\n                          return (\n                            <Card key={idx} className=\"overflow-hidden hover:bg-accent/50 transition-colors\">\n                              <button\n                                onClick={() => toggleRecommendation(idx)}\n                                className=\"w-full text-left\"\n                              >\n                                <CardHeader>\n                                  <div className=\"flex items-center justify-between\">\n                                    <div className=\"flex items-center gap-3\">\n                                      <span className=\"text-lg font-semibold\">{idx + 1}.</span>\n                                      <div>\n                                        <CardTitle className=\"text-base\">{displayName}</CardTitle>\n                                        <CardDescription>\n                                          {descriptionText}\n                                        </CardDescription>\n                                      </div>\n                                    </div>\n                                    <motion.div\n                                      animate={{ rotate: isExpanded ? 180 : 0 }}\n                                      transition={{ duration: 0.3 }}\n                                    >\n                                      <ChevronDown size={20} className=\"text-muted-foreground flex-shrink-0\" />\n                                    </motion.div>\n                                  </div>\n                                </CardHeader>\n                              </button>\n\n                              <AnimatePresence initial={false}>\n                                {isExpanded && (\n                                  <motion.div\n                                    initial={{ height: 0, opacity: 0 }}\n                                    animate={{ height: 'auto', opacity: 1 }}\n                                    exit={{ height: 0, opacity: 0 }}\n                                    transition={{\n                                      duration: 0.3,\n                                      ease: 'easeInOut',\n                                      opacity: { duration: 0.2 },\n                                    }}\n                                    style={{ overflow: 'hidden' }}\n                                  >\n                                    <CardContent className=\"pt-0\">\n                                      {recommendedTopics.length > 0 ? (\n                                        <ul className=\"text-sm space-y-3\">\n                                          {recommendedTopics.map((topic: any, topicIdx: number) => {\n                                            const topicName = topic.topicName || topic.sourceFile\n                                            const topicParam = topic.topicName || topic.sourceFile || ''\n                                            const topicScore = getTopicScore(topicName)\n                                            const isCompleted = topicScore !== null && topicScore >= 70\n                                            const progressValue =\n                                              topicScore !== null\n                                                ? Math.max(0, Math.min(100, Math.round(topicScore)))\n                                                : null\n\n                                            return (\n                                              <li key={topicIdx} className=\"space-y-1\">\n                                                <div className=\"flex items-center justify-between gap-3\">\n                                                  <Link\n                                                    href={`/topic-teacher?domain=${encodeURIComponent(topic.domainId)}&topic=${encodeURIComponent(topicParam)}&hasQuizResults=true&hasExamResults=true`}\n                                                    className={`hover:underline ${\n                                                      isCompleted ? 'text-muted-foreground' : 'text-foreground'\n                                                    }`}\n                                                    style={{ color: isCompleted ? undefined : '#6a9bcc' }}\n                                                    target=\"_blank\"\n                                                    rel=\"noopener noreferrer\"\n                                                  >\n                                                    {topicName}\n                                                  </Link>\n                                                  {topicScore !== null && (\n                                                    <div className=\"flex items-center gap-2 text-xs\">\n                                                      <span\n                                                        className={`font-semibold ${\n                                                          isCompleted ? 'text-emerald-500' : 'text-amber-500'\n                                                        }`}\n                                                      >\n                                                        {isCompleted\n                                                          ? `Completed (${Math.round(topicScore)}%)`\n                                                          : `${Math.round(topicScore)}%`}\n                                                      </span>\n                                                      {progressValue !== null && (\n                                                        <div className=\"w-20\">\n                                                          <Progress value={progressValue} className=\"h-1\" />\n                                                        </div>\n                                                      )}\n                                                    </div>\n                                                  )}\n                                                </div>\n                                              </li>\n                                            )\n                                          })}\n                                        </ul>\n                                      ) : (\n                                        <p className=\"text-sm text-muted-foreground\">\n                                          {isOrgPsych ? 'Review all Organizational Psychology topics' : 'Review all topics in this domain'}\n                                        </p>\n                                      )}\n                                    </CardContent>\n                                  </motion.div>\n                                )}\n                              </AnimatePresence>\n                            </Card>\n                          )\n                        })}\n                      </div>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              )}\n\n              {/* Action Buttons */}\n              <motion.div\n                variants={animations.itemVariants}\n                className=\"flex gap-4 justify-center pt-4\"\n              >\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setAnalysis('')\n                    setError(null)\n                    setPriorityData(null)\n                  }}\n                >\n                  Take Another Exam\n                </Button>\n                <Link href=\"/topic-selector\">\n                  <Button>\n                    Start Studying\n                  </Button>\n                </Link>\n              </motion.div>\n            </motion.div>\n          )}\n        </motion.div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/prioritizer/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getDomainById' is defined but never used.","line":12,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getKNsForTopic' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":24},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":35,"column":58,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":35,"endColumn":91},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":144,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5375,5556],"text":"\n              Based on your exam results, here are the top 3 domains you should focus on. We&apos;ve identified the specific knowledge gaps and recommended topics to study.\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5375,5556],"text":"\n              Based on your exam results, here are the top 3 domains you should focus on. We&lsquo;ve identified the specific knowledge gaps and recommended topics to study.\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5375,5556],"text":"\n              Based on your exam results, here are the top 3 domains you should focus on. We&#39;ve identified the specific knowledge gaps and recommended topics to study.\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5375,5556],"text":"\n              Based on your exam results, here are the top 3 domains you should focus on. We&rsquo;ve identified the specific knowledge gaps and recommended topics to study.\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { ArrowLeft, TrendingUp, BookOpen } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Progress } from '@/components/ui/progress'\nimport { Separator } from '@/components/ui/separator'\nimport { motion } from 'motion/react'\nimport { getTopicById, getDomainById } from '@/lib/eppp-data'\nimport { getKNsForTopic } from '@/lib/kn-topic-mapping'\nimport { getTopPriorities } from '@/lib/priority-storage'\nimport type { PriorityDomainRecommendation } from '@/lib/priority-storage'\nimport { triggerBackgroundPreGeneration } from '@/lib/pre-generated-exams'\nimport { createClient } from '@supabase/supabase-js'\n\nexport default function PrioritizerPage() {\n  const [recommendations, setRecommendations] = useState<PriorityDomainRecommendation[] | null>(null)\n  const [expandedDomain, setExpandedDomain] = useState<number | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    // Get recommendations from URL params or localStorage\n    const params = new URLSearchParams(window.location.search)\n    const resultsParam = params.get('results')\n\n    if (resultsParam) {\n      try {\n        const data = JSON.parse(decodeURIComponent(resultsParam))\n        setRecommendations(data.topPriorities || [])\n\n        // Save to localStorage for persistence\n        const { savePriorityRecommendationToSupabase } = require('@/lib/priority-storage')\n        if (data.topPriorities) {\n          savePriorityRecommendationToSupabase({\n            examType: data.examType,\n            examMode: data.examMode,\n            topPriorities: data.topPriorities,\n            allResults: data.allResults || [],\n          }, '')\n        }\n\n        // Trigger background pre-generation of next exam type\n        const triggerPreGen = async () => {\n          try {\n            const supabase = createClient(\n              process.env.NEXT_PUBLIC_SUPABASE_URL!,\n              process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n            )\n            const { data: { session } } = await supabase.auth.getSession()\n            if (session?.user?.id && data.examType) {\n              console.log('[Prioritizer] Triggering background pre-generation')\n              await triggerBackgroundPreGeneration(session.user.id, data.examType)\n            }\n          } catch (preGenError) {\n            console.log('[Prioritizer] Background pre-gen trigger failed (non-critical):', preGenError)\n          }\n        }\n        triggerPreGen()\n      } catch (error) {\n        console.error('Error parsing recommendations:', error)\n      }\n    } else {\n      // Try to load from localStorage (latest recommendations)\n      const priorities = getTopPriorities('diagnostic')\n      if (priorities && priorities.length > 0) {\n        setRecommendations(priorities)\n      }\n    }\n\n    setLoading(false)\n  }, [])\n\n  if (loading) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"text-center py-20\">\n            <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            <p className=\"mt-4 text-muted-foreground\">Loading recommendations...</p>\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  if (!recommendations || recommendations.length === 0) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Link\n            href=\"/dashboard\"\n            className=\"flex items-center gap-2 text-primary hover:underline mb-8\"\n          >\n            <ArrowLeft size={18} />\n            Back to Dashboard\n          </Link>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"text-center py-20\"\n          >\n            <h1 className=\"text-3xl font-bold mb-4\">No Recommendations Yet</h1>\n            <p className=\"text-muted-foreground mb-6\">\n              Complete a diagnostic or practice exam to get personalized recommendations.\n            </p>\n            <Link href=\"/exam-generator\">\n              <Button size=\"lg\">Start an Exam</Button>\n            </Link>\n          </motion.div>\n        </div>\n      </main>\n    )\n  }\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Link\n          href=\"/dashboard\"\n          className=\"flex items-center gap-2 text-primary hover:underline mb-8\"\n        >\n          <ArrowLeft size={18} />\n          Back to Dashboard\n        </Link>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n          className=\"space-y-8\"\n        >\n          {/* Header */}\n          <div className=\"text-center py-8\">\n            <div className=\"flex items-center justify-center gap-3 mb-4\">\n              <TrendingUp className=\"w-8 h-8 text-blue-500\" />\n              <h1 className=\"text-4xl font-bold\">Your Priority Recommendations</h1>\n            </div>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              Based on your exam results, here are the top 3 domains you should focus on. We've identified the specific knowledge gaps and recommended topics to study.\n            </p>\n          </div>\n\n          {/* Priority Domains */}\n          <div className=\"space-y-4\">\n            {recommendations.map((domain, index) => (\n              <motion.div\n                key={domain.domainNumber}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: index * 0.1 }}\n              >\n                <Card\n                  className=\"cursor-pointer transition-all hover:shadow-lg overflow-hidden\"\n                  onClick={() => setExpandedDomain(expandedDomain === domain.domainNumber ? null : domain.domainNumber)}\n                >\n                  <CardHeader className=\"pb-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          <Badge className=\"bg-gradient-to-r from-blue-500 to-purple-500\">\n                            #{index + 1} Priority\n                          </Badge>\n                          <CardTitle className=\"text-xl\">\n                            {domain.domainName}\n                          </CardTitle>\n                        </div>\n                        <CardDescription className=\"text-base mt-2\">\n                          {domain.percentageWrong}% of questions answered incorrectly\n                        </CardDescription>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                          {domain.priorityScore.toFixed(2)}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground\">Priority Score</p>\n                      </div>\n                    </div>\n                  </CardHeader>\n\n                  <CardContent className=\"space-y-4\">\n                    {/* Progress Bar */}\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-muted-foreground\">Knowledge Gap</span>\n                        <span className=\"font-semibold\">{domain.percentageWrong}%</span>\n                      </div>\n                      <Progress value={domain.percentageWrong} className=\"h-2\" />\n                    </div>\n\n                    {/* Expandable Content */}\n                    {expandedDomain === domain.domainNumber && (\n                      <motion.div\n                        initial={{ opacity: 0, height: 0 }}\n                        animate={{ opacity: 1, height: 'auto' }}\n                        exit={{ opacity: 0, height: 0 }}\n                        className=\"space-y-4 pt-4\"\n                      >\n                        <Separator />\n\n                        {/* Wrong Knowledge Statements */}\n                        {domain.wrongKNs && domain.wrongKNs.length > 0 && (\n                          <div className=\"space-y-3\">\n                            <h4 className=\"font-semibold text-sm\">Knowledge Gaps Identified</h4>\n                            <div className=\"space-y-2\">\n                              {domain.wrongKNs.map((kn) => (\n                                <div key={kn.knId} className=\"flex items-start gap-3 p-3 bg-red-50 dark:bg-red-950/30 rounded-lg border border-red-200 dark:border-red-900\">\n                                  <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center text-xs font-bold\">\n                                    âœ•\n                                  </div>\n                                  <div className=\"flex-1\">\n                                    <p className=\"font-semibold text-sm\">{kn.knId}: {kn.knName}</p>\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Recommended Topics */}\n                        {domain.recommendedTopicIds && domain.recommendedTopicIds.length > 0 && (\n                          <div className=\"space-y-3\">\n                            <h4 className=\"font-semibold text-sm\">Recommended Topics to Study</h4>\n                            <div className=\"space-y-2\">\n                              {domain.recommendedTopicIds.map((topicId) => {\n                                const topic = getTopicById(topicId)\n                                return (\n                                  <Link\n                                    key={topicId}\n                                    href={`/topic-teacher?topicId=${topicId}&fromPrioritizer=true`}\n                                  >\n                                    <motion.div\n                                      whileHover={{ scale: 1.02 }}\n                                      className=\"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-900 cursor-pointer hover:shadow-md transition-shadow\"\n                                    >\n                                      <BookOpen className=\"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0\" />\n                                      <div className=\"flex-1 min-w-0\">\n                                        <p className=\"font-semibold text-sm text-blue-900 dark:text-blue-100 truncate\">\n                                          {topic?.name || topicId}\n                                        </p>\n                                      </div>\n                                      <Badge variant=\"outline\" className=\"text-xs flex-shrink-0\">\n                                        Study\n                                      </Badge>\n                                    </motion.div>\n                                  </Link>\n                                )\n                              })}\n                            </div>\n                          </div>\n                        )}\n\n                        {/* Study Strategy */}\n                        <div className=\"p-3 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-900\">\n                          <p className=\"text-sm font-semibold text-green-900 dark:text-green-100 mb-2\">\n                            Recommended Study Strategy\n                          </p>\n                          <ul className=\"text-sm space-y-1 text-green-800 dark:text-green-200\">\n                            {domain.percentageWrong > 50 ? (\n                              <>\n                                <li>â€¢ This is a major knowledge gap - prioritize immediate study</li>\n                                <li>â€¢ Spend 2-3 sessions studying the recommended topics</li>\n                                <li>â€¢ Retake the diagnostic exam after studying to measure improvement</li>\n                              </>\n                            ) : domain.percentageWrong > 30 ? (\n                              <>\n                                <li>â€¢ This domain needs focused review</li>\n                                <li>â€¢ Study the recommended topics over 1-2 sessions</li>\n                                <li>â€¢ Review weak knowledge statements multiple times</li>\n                              </>\n                            ) : (\n                              <>\n                                <li>â€¢ Minor gaps detected - light review recommended</li>\n                                <li>â€¢ Focus on the specific wrong knowledge statements</li>\n                                <li>â€¢ One study session should be sufficient</li>\n                              </>\n                            )}\n                          </ul>\n                        </div>\n                      </motion.div>\n                    )}\n                  </CardContent>\n                </Card>\n              </motion.div>\n            ))}\n          </div>\n\n          {/* Bottom Actions */}\n          <div className=\"flex gap-3 justify-center pt-8\">\n            <Link href=\"/topic-selector\">\n              <Button size=\"lg\" variant=\"outline\">\n                Browse All Topics\n              </Button>\n            </Link>\n            <Link href=\"/exam-generator\">\n              <Button size=\"lg\">\n                Start Another Exam\n              </Button>\n            </Link>\n          </div>\n        </motion.div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/quizzer/quizzer-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TypographySmall' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10585,10588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10585,10588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'questionsData' is never reassigned. Use 'const' instead.","line":396,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":396,"endColumn":24,"fix":{"range":[12278,12318],"text":"const questionsData = data.questions || []"}},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'generateQuiz', 'isLoading', and 'questions.length'. Either include them or remove the dependency array.","line":451,"column":6,"nodeType":"ArrayExpression","endLine":451,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [generateQuiz, isLoading, questions.length, topic]","fix":{"range":[13999,14006],"text":"[generateQuiz, isLoading, questions.length, topic]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleNext'. Either include it or remove the dependency array.","line":489,"column":6,"nodeType":"ArrayExpression","endLine":489,"endColumn":85,"suggestions":[{"desc":"Update the dependencies array to be: [quizStarted, quizState.showResults, questions.length, quizState.timeRemaining, handleNext]","fix":{"range":[14920,14999],"text":"[quizStarted, quizState.showResults, questions.length, quizState.timeRemaining, handleNext]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":670,"column":24,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20999,21093],"text":"\n                    You&apos;ve demonstrated mastery of this topic. Great work!\n                  "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20999,21093],"text":"\n                    You&lsquo;ve demonstrated mastery of this topic. Great work!\n                  "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20999,21093],"text":"\n                    You&#39;ve demonstrated mastery of this topic. Great work!\n                  "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20999,21093],"text":"\n                    You&rsquo;ve demonstrated mastery of this topic. Great work!\n                  "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef, useCallback } from 'react'\nimport Link from 'next/link'\nimport { Zap, CheckCircle2, XCircle, Clock } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Progress } from '@/components/ui/progress'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { motion } from 'motion/react'\nimport { useSearchParams } from 'next/navigation'\nimport { saveQuizResults, getQuizResults, WrongAnswer, getAllQuizResults } from '@/lib/quiz-results-storage'\nimport { PulseSpinner } from '@/components/PulseSpinner'\nimport { Confetti, type ConfettiRef } from '@/components/ui/confetti'\nimport {\n  Breadcrumb,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbList,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n} from '@/components/ui/breadcrumb'\nimport {\n  TypographyH1,\n  TypographyH2,\n  TypographyMuted,\n  TypographyP,\n  TypographySmall,\n} from '@/components/ui/typography'\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from '@/components/ui/accordion'\n\ninterface QuizQuestion {\n  id: number\n  question: string\n  options: string[]\n  correctAnswer: string\n  explanation: string\n  relatedSections?: string[]\n}\n\ninterface QuizState {\n  question: number\n  score: number\n  selectedAnswers: Record<number, string>\n  showResults: boolean\n  timeRemaining: number\n}\n\nconst BRAND_COLORS = {\n  softSage: '#bdd1ca',\n  coral: '#d87758',\n  olive: '#788c5d',\n  lavenderGray: '#cbc9db',\n  softBlue: '#6a9bcc',\n  dustRose: '#c46685',\n}\n\nconst escapeHtml = (value: string): string => {\n  return value\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;')\n}\n\nexport function QuizzerContent() {\n  const searchParams = useSearchParams()\n  const topic = searchParams.get('topic')\n  const domain = searchParams.get('domain')\n  const decodeParam = (value: string | null): string => {\n    if (!value) return ''\n    try {\n      return decodeURIComponent(value)\n    } catch {\n      return value\n    }\n  }\n  const decodedTopic = decodeParam(topic)\n  const isMac = typeof navigator !== 'undefined' && navigator.platform.toUpperCase().includes('MAC')\n  const modifierLabel = isMac ? 'Option' : 'Alt'\n  const confettiRef = useRef<ConfettiRef>(null)\n  const questionContentRef = useRef<HTMLDivElement | null>(null)\n  const [textFormats, setTextFormats] = useState<Record<number, { question: string; options: string[] }>>({})\n  const lastSelectionRef = useRef<{ text: string; questionIndex: number } | null>(null)\n\n  const [questions, setQuestions] = useState<QuizQuestion[]>([])\n  const [quizState, setQuizState] = useState<QuizState>({\n    question: 0,\n    score: 0,\n    selectedAnswers: {},\n    showResults: false,\n    timeRemaining: 0,\n  })\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [quizStarted, setQuizStarted] = useState(false)\n  const [isFirstQuiz, setIsFirstQuiz] = useState(false)\n  const [recentQuizSectionsParam, setRecentQuizSectionsParam] = useState('')\n\n  const quizStateRef = useRef<QuizState>(quizState)\n  useEffect(() => {\n    quizStateRef.current = quizState\n  }, [quizState])\n\n  const shuffleArray = <T,>(array: T[]): T[] => {\n    const shuffled = [...array]\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]\n    }\n    return shuffled\n  }\n\n  const resolveSelectionText = useCallback(() => {\n    if (typeof window === 'undefined') return null\n\n    const selection = window.getSelection()\n    const container = questionContentRef.current\n    if (!selection || !container) return null\n    if (selection.rangeCount === 0) return null\n\n    const selectedText = selection.toString()\n    if (!selectedText.trim()) return lastSelectionRef.current?.questionIndex === quizState.question ? lastSelectionRef.current.text : null\n\n    const anchorInside = selection.anchorNode ? container.contains(selection.anchorNode) : false\n    const focusInside = selection.focusNode ? container.contains(selection.focusNode) : false\n\n    if (anchorInside || focusInside) {\n      lastSelectionRef.current = {\n        text: selectedText,\n        questionIndex: quizState.question,\n      }\n      return selectedText\n    }\n\n    if (lastSelectionRef.current?.questionIndex === quizState.question) {\n      return lastSelectionRef.current.text\n    }\n\n    return null\n  }, [quizState.question])\n\n  useEffect(() => {\n    const handleSelectionChange = () => {\n      const selection = window.getSelection()\n      const container = questionContentRef.current\n      if (!selection || !container || selection.rangeCount === 0) return\n      const selectedText = selection.toString()\n      if (!selectedText.trim()) return\n      const anchorInside = selection.anchorNode ? container.contains(selection.anchorNode) : false\n      const focusInside = selection.focusNode ? container.contains(selection.focusNode) : false\n\n      if (anchorInside || focusInside) {\n        lastSelectionRef.current = {\n          text: selectedText,\n          questionIndex: quizState.question,\n        }\n      }\n    }\n\n    document.addEventListener('selectionchange', handleSelectionChange)\n    return () => document.removeEventListener('selectionchange', handleSelectionChange)\n  }, [quizState.question])\n\n  useEffect(() => {\n    lastSelectionRef.current = null\n  }, [quizState.question])\n\n  const applyTextFormat = useCallback(\n    (selectedText: string, tagName: 'mark' | 'del') => {\n      const question = questions[quizState.question]\n      if (!question) return\n\n      const currentFormat = textFormats[quizState.question]\n      const baseQuestion = currentFormat?.question ?? escapeHtml(question.question)\n      const baseOptions = currentFormat?.options ?? question.options.map(escapeHtml)\n\n      const wrapTag = () => {\n        const el = document.createElement(tagName)\n        el.style.fontFamily = 'inherit'\n        el.style.fontSize = 'inherit'\n        el.style.fontWeight = 'inherit'\n        el.style.lineHeight = 'inherit'\n        if (tagName === 'mark') {\n          el.style.backgroundColor = BRAND_COLORS.softSage\n          el.style.color = '#0b1f13'\n        } else {\n          el.style.textDecoration = 'line-through'\n        }\n        el.textContent = selectedText\n        return el\n      }\n\n      const processNode = (node: Node) => {\n        if (node.nodeType === Node.TEXT_NODE && node.textContent) {\n          const text = node.textContent\n          if (text.includes(selectedText)) {\n            const parts = text.split(selectedText)\n            const fragment = document.createDocumentFragment()\n\n            parts.forEach((part, index) => {\n              if (part) fragment.appendChild(document.createTextNode(part))\n              if (index < parts.length - 1) {\n                fragment.appendChild(wrapTag())\n              }\n            })\n\n            node.parentNode?.replaceChild(fragment, node)\n          }\n        } else if (node.nodeType === Node.ELEMENT_NODE) {\n          Array.from(node.childNodes).forEach(processNode)\n        }\n      }\n\n      const tempQuestion = document.createElement('div')\n      tempQuestion.innerHTML = baseQuestion\n      processNode(tempQuestion)\n\n      const updatedOptions = baseOptions.map((option) => {\n        const optDiv = document.createElement('div')\n        optDiv.innerHTML = option\n        processNode(optDiv)\n        return optDiv.innerHTML\n      })\n\n      setTextFormats((prev) => ({\n        ...prev,\n        [quizState.question]: {\n          question: tempQuestion.innerHTML,\n          options: updatedOptions,\n        },\n      }))\n      lastSelectionRef.current = null\n    },\n    [questions, quizState.question, textFormats]\n  )\n\n  const handleHighlightText = useCallback(() => {\n    const selectedText = resolveSelectionText()\n    if (!selectedText) return\n    applyTextFormat(selectedText, 'mark')\n  }, [applyTextFormat, resolveSelectionText])\n\n  const handleStrikethroughText = useCallback(() => {\n    const selectedText = resolveSelectionText()\n    if (!selectedText) return\n    applyTextFormat(selectedText, 'del')\n  }, [applyTextFormat, resolveSelectionText])\n\n  const handlePrevious = useCallback(() => {\n    setQuizState((prev) => ({\n      ...prev,\n      question: Math.max(0, prev.question - 1),\n    }))\n    setError(null)\n  }, [])\n\n  const handleNext = useCallback(() => {\n    const state = quizStateRef.current\n    const currentIndex = state.question\n    if (currentIndex >= questions.length) return\n\n    const selectedAnswer = state.selectedAnswers[currentIndex]\n    if (!selectedAnswer) {\n      setError('Please select an answer')\n      return\n    }\n\n    const currentQuestion = questions[currentIndex]\n    const isCorrect = selectedAnswer === currentQuestion.correctAnswer\n\n    if (currentIndex < questions.length - 1) {\n      setQuizState((prev) => ({\n        ...prev,\n        question: prev.question + 1,\n        score: prev.score + (isCorrect ? 1 : 0),\n      }))\n      setError(null)\n      return\n    }\n\n    const finalScore = state.score + (isCorrect ? 1 : 0)\n    const wrongAnswers: WrongAnswer[] = []\n    const correctAnswers = []\n\n    questions.forEach((q) => {\n      const selected = state.selectedAnswers[q.id] ?? ''\n      const questionWasCorrect = selected === q.correctAnswer\n\n      if (!questionWasCorrect) {\n        wrongAnswers.push({\n          questionId: q.id,\n          question: q.question,\n          selectedAnswer: selected,\n          correctAnswer: q.correctAnswer,\n          relatedSections: q.relatedSections || [],\n          timestamp: Date.now(),\n        })\n      } else {\n        correctAnswers.push({\n          questionId: q.id,\n          question: q.question,\n          relatedSections: q.relatedSections || [],\n          timestamp: Date.now(),\n        })\n      }\n    })\n\n    const previousResults = getQuizResults(topic || '')\n    if (previousResults) {\n      wrongAnswers.forEach((wa) => {\n        const wasPreviouslyCorrect = previousResults.correctAnswers.some(\n          (ca) => ca.questionId === wa.questionId\n        )\n        if (wasPreviouslyCorrect) {\n          wa.previouslyWrong = false\n        }\n      })\n\n      correctAnswers.forEach((ca) => {\n        const wasPreviouslyWrong = previousResults.wrongAnswers.some(\n          (wa) => wa.questionId === ca.questionId\n        )\n        if (wasPreviouslyWrong) {\n          ;(ca as any).wasPreviouslyWrong = true\n        }\n      })\n    }\n\n    const recentSections = Array.from(\n      new Set(wrongAnswers.flatMap((wa) => wa.relatedSections || []))\n    )\n\n    const quizResults = {\n      topic: decodedTopic,\n      timestamp: Date.now(),\n      score: finalScore,\n      totalQuestions: questions.length,\n      wrongAnswers,\n      correctAnswers,\n    }\n\n    saveQuizResults(quizResults)\n\n    const resultsParam = encodeURIComponent(JSON.stringify(quizResults))\n    const sectionsParam = encodeURIComponent(JSON.stringify(recentSections))\n    window.history.replaceState(\n      null,\n      '',\n      `?topic=${encodeURIComponent(topic || '')}&quizResults=${resultsParam}&recentQuizWrongSections=${sectionsParam}`\n    )\n    setRecentQuizSectionsParam(sectionsParam)\n\n    setQuizState((prev) => ({\n      ...prev,\n      showResults: true,\n      score: finalScore,\n    }))\n  }, [questions, topic, decodedTopic])\n\n  const formatTime = (seconds: number): string => {\n    const minutes = Math.floor(seconds / 60)\n    const secs = seconds % 60\n    return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`\n  }\n\n  const isTimeWarning = quizState.timeRemaining > 0 && quizState.timeRemaining <= 120\n\n  const generateQuiz = async () => {\n    if (!topic) return\n\n    try {\n      setIsLoading(true)\n      setError(null)\n\n      const response = await fetch('/api/quizzer', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ topic, domain }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to generate quiz')\n      }\n\n      const data = await response.json()\n      let questionsData = data.questions || []\n\n      const shuffled = shuffleArray(questionsData).map((q: QuizQuestion, idx: number) => ({\n        ...q,\n        options: shuffleArray(q.options),\n        id: idx,\n      }))\n\n      const finalQuestions = shuffled.slice(0, 10)\n      setQuestions(finalQuestions)\n      const initialFormats: Record<number, { question: string; options: string[] }> = {}\n      finalQuestions.forEach((q, idx) => {\n        initialFormats[idx] = {\n          question: escapeHtml(q.question),\n          options: q.options.map(escapeHtml),\n        }\n      })\n      setTextFormats(initialFormats)\n      lastSelectionRef.current = null\n    } catch (err) {\n      console.error('Error generating quiz:', err)\n      setError(\n        err instanceof Error ? err.message : 'Failed to generate quiz'\n      )\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  // Check if this is the user's first quiz ever\n  useEffect(() => {\n    const allResults = getAllQuizResults()\n    setIsFirstQuiz(allResults.length === 0)\n  }, [])\n\n  // Fire confetti on quiz completion\n  useEffect(() => {\n    if (quizState.showResults) {\n      const passed = quizState.score >= 8\n      // Fire confetti if: first quiz (regardless of pass/fail) OR passed (subsequent quizzes)\n      if (isFirstQuiz || passed) {\n        setTimeout(() => {\n          confettiRef.current?.fire({})\n        }, 500)\n      }\n    }\n  }, [quizState.showResults, isFirstQuiz, quizState.score])\n\n  // Auto-generate quiz when page loads with a topic\n  useEffect(() => {\n    if (topic && questions.length === 0 && !isLoading) {\n      generateQuiz()\n    } else if (!topic && questions.length === 0 && !isLoading) {\n      setError('No topic provided')\n    }\n  }, [topic])\n\n  // Timer effect: 68 seconds per question\n  useEffect(() => {\n    if (!quizStarted || quizState.showResults || questions.length === 0) return\n\n    const totalSeconds = questions.length * 68\n\n    // Initialize time remaining on quiz start\n    if (quizState.timeRemaining === 0) {\n      setQuizState((prev) => ({\n        ...prev,\n        timeRemaining: totalSeconds,\n      }))\n      return\n    }\n\n    const timer = setInterval(() => {\n      setQuizState((prev) => {\n        const newTime = prev.timeRemaining - 1\n\n        // Auto-submit if time runs out\n        if (newTime <= 0) {\n          // Mark quiz as finished without calling handleNext (which has issues)\n          setTimeout(() => {\n            handleNext()\n          }, 0)\n          return prev\n        }\n\n        return {\n          ...prev,\n          timeRemaining: newTime,\n        }\n      })\n    }, 1000)\n\n    return () => clearInterval(timer)\n  }, [quizStarted, quizState.showResults, questions.length, quizState.timeRemaining])\n\n  useEffect(() => {\n    if (!quizStarted || questions.length === 0) return\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      const modifier = e.altKey\n      if (!modifier) return\n\n      const key = (e.code || e.key || '').toLowerCase()\n      if (key === 'keyp' || key === 'p') {\n        e.preventDefault()\n        handlePrevious()\n        return\n      }\n\n      if ((key === 'keyn' || key === 'n') && quizStateRef.current.selectedAnswers[quizStateRef.current.question]) {\n        e.preventDefault()\n        handleNext()\n        return\n      }\n\n      if (\n        (key === 'keye' || key === 'e') &&\n        quizStateRef.current.question === questions.length - 1 &&\n        quizStateRef.current.selectedAnswers[quizStateRef.current.question]\n      ) {\n        e.preventDefault()\n        handleNext()\n        return\n      }\n\n      if (key === 'keyh' || key === 'h') {\n        e.preventDefault()\n        handleHighlightText()\n        return\n      }\n\n      if (key === 'keys' || key === 's') {\n        e.preventDefault()\n        handleStrikethroughText()\n        return\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [quizStarted, questions.length, handleNext, handlePrevious, handleHighlightText, handleStrikethroughText])\n\n  const handleSelectAnswer = (option: string) => {\n    if (quizState.showResults) return\n\n    setQuizState((prev) => ({\n      ...prev,\n      selectedAnswers: {\n        ...prev.selectedAnswers,\n        [quizState.question]: option,\n      },\n    }))\n  }\n\n  if (!topic) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background exam-ui\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink asChild>\n                  <Link href=\"/dashboard\">Dashboard</Link>\n                </BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbLink asChild>\n                  <Link href=\"/topic-selector\">Topic Selector</Link>\n                </BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Quiz</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n          <div className=\"text-center py-20 space-y-3\">\n            <TypographyH1 className=\"text-center\">No topic selected</TypographyH1>\n            <TypographyMuted className=\"text-base text-center\">\n              Please select a topic first\n            </TypographyMuted>\n            <Link href=\"/topic-selector\">\n              <Button>Go to Topics</Button>\n            </Link>\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background relative exam-ui\">\n      {/* Confetti Canvas */}\n      <Confetti\n        ref={confettiRef}\n        className=\"fixed top-0 left-0 z-50 size-full pointer-events-none\"\n      />\n\n      <div className=\"max-w-2xl mx-auto\">\n        <Breadcrumb className=\"mb-8\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink asChild>\n                <Link href=\"/dashboard\">Dashboard</Link>\n              </BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbLink asChild>\n                <Link href=\"/topic-selector\">Topic Selector</Link>\n              </BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>{decodedTopic || 'Quiz'}</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n        >\n          {isLoading ? (\n            <PulseSpinner message=\"Generating your quiz...\" />\n          ) : questions.length === 0 ? (\n            <div className=\"text-center py-20\">\n              <div className=\"text-muted-foreground\">\n                <p>No quiz available. Please go back and select a topic.</p>\n              </div>\n            </div>\n          ) : !quizStarted ? (\n            <div className=\"text-center py-20 space-y-3\">\n              <TypographyH1 className=\"text-center\">\n                Quiz - {decodedTopic || 'Selected Topic'}\n              </TypographyH1>\n              <TypographyMuted className=\"text-lg text-center\">\n                10 questions Â· Total time: {formatTime(questions.length * 68)}\n              </TypographyMuted>\n              <Button\n                onClick={() => setQuizStarted(true)}\n                size=\"lg\"\n                variant=\"minimal\"\n                className=\"gap-2\"\n              >\n                Start\n              </Button>\n            </div>\n          ) : quizState.showResults ? (\n            <div className=\"py-10\">\n              {/* Score Summary */}\n              <div className=\"text-center mb-6\">\n                <div className=\"text-6xl font-bold text-primary mb-2\">\n                  {quizState.score}/{questions.length}\n                </div>\n                <p className=\"text-muted-foreground\">\n                  {Math.round(\n                    (quizState.score / questions.length) * 100\n                  )}% Correct\n                </p>\n              </div>\n\n              {quizState.score >= 8 ? (\n                <div className=\"rounded-lg p-6 mb-6\">\n                  <CheckCircle2\n                    className=\"mx-auto mb-3\"\n                    style={{ color: BRAND_COLORS.softBlue }}\n                  />\n                  <h3 className=\"font-semibold mb-2\" style={{ color: BRAND_COLORS.softBlue }}>\n                    Excellent! Topic Mastered\n                  </h3>\n                  <TypographyMuted>\n                    You've demonstrated mastery of this topic. Great work!\n                  </TypographyMuted>\n                </div>\n              ) : (\n                <div className=\"rounded-lg p-6 mb-6\">\n                  <h3 className=\"font-semibold mb-2\" style={{ color: BRAND_COLORS.coral }}>\n                    Keep Practicing\n                  </h3>\n                  <TypographyMuted>\n                    Review the material and try again to improve your score.\n                  </TypographyMuted>\n                </div>\n              )}\n\n              {/* Detailed Question Breakdown */}\n              <div className=\"space-y-4 mb-6\">\n                <TypographyH2 className=\"text-center border-none\">Review Your Answers</TypographyH2>\n                {questions.map((q, idx) => {\n                  const selectedAnswer = quizState.selectedAnswers[q.id]\n                  const isCorrect = selectedAnswer === q.correctAnswer\n\n                  return (\n                    <motion.div\n                      key={idx}\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ delay: idx * 0.1 }}\n                      className=\"rounded-lg p-6 border border-border\"\n                    >\n                      {/* Question Header */}\n                      <div className=\"flex items-start gap-3 mb-4\">\n                        {isCorrect ? (\n                          <CheckCircle2\n                            className=\"flex-shrink-0 mt-1\"\n                            size={20}\n                            style={{ color: BRAND_COLORS.softSage }}\n                          />\n                        ) : (\n                          <XCircle\n                            className=\"flex-shrink-0 mt-1\"\n                            size={20}\n                            style={{ color: BRAND_COLORS.coral }}\n                          />\n                        )}\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                            <span className=\"text-sm font-semibold text-muted-foreground\">\n                              Question {idx + 1}\n                            </span>\n                            {!q.isScored && (\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-xs px-2 py-0.5 rounded border\"\n                                style={{\n                                  borderColor: BRAND_COLORS.lavenderGray,\n                                  color: BRAND_COLORS.lavenderGray,\n                                }}\n                              >\n                                Unscored\n                              </Badge>\n                            )}\n                            <Badge\n                              variant=\"outline\"\n                              className=\"text-xs px-2 py-0.5 rounded border\"\n                              style={{\n                                borderColor: isCorrect ? BRAND_COLORS.softSage : BRAND_COLORS.coral,\n                                color: isCorrect ? BRAND_COLORS.softSage : BRAND_COLORS.coral,\n                              }}\n                            >\n                              {isCorrect ? 'Correct' : 'Incorrect'}\n                            </Badge>\n                          </div>\n                          <p className=\"text-base font-medium mb-4\">{q.question}</p>\n\n                          {/* Answer Options */}\n                          <div className=\"space-y-2 mb-4\">\n                            {q.options.map((option, optIdx) => {\n                              const optionLetter = String.fromCharCode(65 + optIdx)\n                              const isThisCorrect = option === q.correctAnswer\n                              const isThisSelected = option === selectedAnswer\n\n                              return (\n                                <div\n                                  key={optIdx}\n                                  className=\"p-3 rounded-lg border\"\n                                  style={{\n                                    borderColor: isThisCorrect\n                                      ? BRAND_COLORS.softSage\n                                      : isThisSelected\n                                      ? BRAND_COLORS.coral\n                                      : 'var(--border)',\n                                  }}\n                                >\n                                  <div className=\"flex items-start gap-2\">\n                                    <span className=\"font-semibold\">{optionLetter}.</span>\n                                    <span className=\"flex-1\">{option}</span>\n                                    {isThisCorrect && (\n                                      <Badge\n                                        variant=\"outline\"\n                                        className=\"text-xs px-2 py-0.5 rounded border flex-shrink-0\"\n                                        style={{\n                                          borderColor: BRAND_COLORS.softSage,\n                                          color: BRAND_COLORS.softSage,\n                                        }}\n                                      >\n                                        Correct Answer\n                                      </Badge>\n                                    )}\n                                    {isThisSelected && !isThisCorrect && (\n                                      <Badge\n                                        variant=\"outline\"\n                                        className=\"text-xs px-2 py-0.5 rounded border flex-shrink-0\"\n                                        style={{\n                                          borderColor: BRAND_COLORS.coral,\n                                          color: BRAND_COLORS.coral,\n                                        }}\n                                      >\n                                        Your Answer\n                                      </Badge>\n                                    )}\n                                  </div>\n                                </div>\n                              )\n                            })}\n                          </div>\n\n                          {/* Explanation */}\n                          <Accordion type=\"single\" collapsible className=\"w-full border border-border rounded-lg\">\n                            <AccordionItem value={`exp-${q.id}`}>\n                              <AccordionTrigger className=\"text-sm font-semibold\">\n                                Explanation\n                              </AccordionTrigger>\n                              <AccordionContent className=\"p-0\">\n                                <TypographyP className=\"text-sm text-muted-foreground px-1 pt-2 pb-4\">\n                                  {q.explanation}\n                                </TypographyP>\n                              </AccordionContent>\n                            </AccordionItem>\n                          </Accordion>\n                        </div>\n                      </div>\n                    </motion.div>\n                  )\n                })}\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"space-y-2\">\n                <Link href=\"/topic-selector\" className=\"block\">\n                  <Button variant=\"minimal\" className=\"w-full\">\n                    Select Another Topic\n                  </Button>\n                </Link>\n                <Link\n                  href={`/topic-teacher?topic=${encodeURIComponent(decodedTopic || '')}&hasQuizResults=true${\n                    recentQuizSectionsParam\n                      ? `&recentQuizWrongSections=${recentQuizSectionsParam}`\n                      : ''\n                  }`}\n                  className=\"block\"\n                >\n                  <Button className=\"w-full\">Relearn the Topic</Button>\n                </Link>\n              </div>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              {/* Header with Question Number, Progress, and Timer */}\n              <div className=\"sticky top-0 z-40 bg-background border-b border-border pb-4 mb-6\">\n                <div className=\"flex justify-between items-start mb-4\">\n                  <div className=\"flex flex-col gap-2\">\n                    <div className=\"flex gap-2\">\n                      <Badge variant=\"outline\" style={{ fontFamily: 'Tahoma' }}>Quiz</Badge>\n                    </div>\n                    <p className=\"text-base font-normal text-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                      Question {quizState.question + 1} of {questions.length}\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-base font-normal text-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                    <Clock className=\"w-4 h-4\" />\n                    <span className={isTimeWarning ? 'text-red-500' : ''}>\n                      {formatTime(quizState.timeRemaining)}\n                    </span>\n                  </div>\n                </div>\n                <Progress value={((quizState.question + 1) / questions.length) * 100} className=\"h-1\" />\n              </div>\n\n              <div className=\"flex gap-4 mb-4\">\n                <div className=\"flex flex-col gap-1 items-start\">\n                  <Button\n                    onClick={handleHighlightText}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-none hover:bg-accent transition-colors\"\n                    style={{ fontFamily: 'Tahoma' }}\n                    onMouseDown={(e) => e.preventDefault()}\n                  >\n                    Highlight\n                  </Button>\n                  <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                    {modifierLabel} + H\n                  </span>\n                </div>\n                <div className=\"flex flex-col gap-1 items-start\">\n                  <Button\n                    onClick={handleStrikethroughText}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"rounded-none hover:bg-accent transition-colors\"\n                    style={{ fontFamily: 'Tahoma' }}\n                    onMouseDown={(e) => e.preventDefault()}\n                  >\n                    Strikeout\n                  </Button>\n                  <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                    {modifierLabel} + S\n                  </span>\n                </div>\n              </div>\n\n              {/* Question Card */}\n              {(() => {\n                const currentQuestion = questions[quizState.question]\n                const currentFormat = textFormats[quizState.question]\n                const questionHtml = currentFormat?.question ?? escapeHtml(currentQuestion?.question ?? '')\n                const optionHtml = currentFormat?.options ?? currentQuestion?.options.map(escapeHtml) ?? []\n\n                return (\n                  <div ref={questionContentRef}>\n                    <Card className=\"rounded-none\">\n                      <CardHeader>\n                        <CardTitle\n                          className=\"text-base font-normal leading-relaxed text-foreground select-text\"\n                          style={{ fontFamily: 'Tahoma' }}\n                          dangerouslySetInnerHTML={{ __html: questionHtml }}\n                        />\n                      </CardHeader>\n                      <Separator />\n                      <CardContent className=\"pt-6\">\n                        {/* Answer Options - Radio Style */}\n                        <div className=\"space-y-3\">\n                          {questions[quizState.question]?.options.map((option, idx) => {\n                            const isSelected = quizState.selectedAnswers[quizState.question] === option\n                            const optionLetter = String.fromCharCode(65 + idx)\n                            const optionContent = optionHtml[idx] ?? escapeHtml(option)\n\n                            return (\n                              <div key={idx} className=\"flex items-start gap-3 p-2\">\n                                {/* Radio Button - Only This is Clickable */}\n                                <motion.button\n                                  whileHover={!quizState.showResults ? { scale: 1.15 } : {}}\n                                  onClick={() => !quizState.showResults && handleSelectAnswer(option)}\n                                  disabled={quizState.showResults}\n                                  className={`flex-shrink-0 mt-2 transition-all cursor-pointer disabled:cursor-not-allowed ${\n                                    isSelected ? 'scale-110' : ''\n                                  }`}\n                                >\n                                  <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all ${\n                                    isSelected\n                                      ? 'border-foreground bg-foreground'\n                                      : 'border-muted-foreground bg-transparent hover:border-foreground'\n                                  }`}>\n                                    {isSelected && (\n                                      <div className=\"w-2 h-2 bg-white rounded-full\" />\n                                    )}\n                                  </div>\n                                </motion.button>\n\n                                {/* Option Text - Not Clickable */}\n                                <div className=\"flex-1 min-w-0 pt-1\">\n                                  <div className=\"text-base text-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                                    <span>{optionLetter}.</span>{' '}\n                                    <span dangerouslySetInnerHTML={{ __html: optionContent }} />\n                                  </div>\n                                </div>\n                              </div>\n                            )\n                          })}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                )\n              })()}\n\n              {error && (\n                <motion.div\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-4\"\n                >\n                  <p className=\"text-sm text-destructive\">{error}</p>\n                </motion.div>\n              )}\n\n              {/* Navigation - Sticky Bottom */}\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"sticky bottom-0 bg-card border-t border-border shadow-lg p-6 mt-8\"\n              >\n                <div className=\"flex items-center justify-between gap-6\">\n                  <div className=\"flex flex-col gap-1 items-center\">\n                    <Button\n                      onClick={handlePrevious}\n                      disabled={quizState.question === 0}\n                      className=\"min-w-[120px] rounded-none\"\n                      variant=\"outline\"\n                      style={{ fontFamily: 'Tahoma' }}\n                    >\n                      Previous\n                    </Button>\n                    <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                      {modifierLabel} + P\n                    </span>\n                  </div>\n\n                  <div className=\"flex flex-col gap-1 items-center\">\n                    <Button\n                      onClick={handleNext}\n                      disabled={!quizState.selectedAnswers[quizState.question]}\n                      className=\"min-w-[120px] rounded-none\"\n                      style={{ fontFamily: 'Tahoma' }}\n                    >\n                      {quizState.question === questions.length - 1 ? 'Finish Quiz' : 'Next'}\n                    </Button>\n                    <span className=\"text-xs text-muted-foreground\" style={{ fontFamily: 'Tahoma' }}>\n                      {modifierLabel} + {quizState.question === questions.length - 1 ? 'E' : 'N'}\n                    </span>\n                  </div>\n                </div>\n              </motion.div>\n            </div>\n          )}\n        </motion.div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/review-exams/page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":178,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5377,5449],"text":"\n                  You haven&apos;t completed any exams yet.\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5377,5449],"text":"\n                  You haven&lsquo;t completed any exams yet.\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5377,5449],"text":"\n                  You haven&#39;t completed any exams yet.\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5377,5449],"text":"\n                  You haven&rsquo;t completed any exams yet.\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport { ArrowLeft, RefreshCw } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Separator } from '@/components/ui/separator'\nimport { motion } from 'motion/react'\nimport { LoadingAnimation } from '@/components/ui/loading-animation'\nimport {\n  Breadcrumb,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbList,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n} from '@/components/ui/breadcrumb'\nimport { createClient } from '@supabase/supabase-js'\n\ninterface CompletedExam {\n  assignmentId: string\n  examFile: string\n  examType: 'diagnostic' | 'practice'\n  assignedAt: string\n  completedAt: string\n  score?: number\n  metadata?: {\n    exam_id: string\n    question_count: number\n  }\n  questions?: Array<{\n    id: number\n    question: string\n    options: string[]\n    correct_answer: string\n    explanation: string\n    domain: string\n  }>\n  error?: string\n}\n\nexport default function ReviewExamsPage() {\n  const [completedExams, setCompletedExams] = useState<CompletedExam[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [userId, setUserId] = useState<string | null>(null)\n  const [expandedExam, setExpandedExam] = useState<string | null>(null)\n\n  // Get current user\n  useEffect(() => {\n    const initializeUser = async () => {\n      const supabase = createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n      )\n      const { data: { session } } = await supabase.auth.getSession()\n      if (session?.user?.id) {\n        setUserId(session.user.id)\n      } else {\n        setError('Please log in to view your completed exams')\n        setIsLoading(false)\n      }\n    }\n    initializeUser()\n  }, [])\n\n  // Fetch completed exams\n  useEffect(() => {\n    if (!userId) return\n\n    const fetchCompletedExams = async () => {\n      try {\n        setIsLoading(true)\n        const response = await fetch(`/api/user-completed-exams?userId=${userId}`)\n        const data = await response.json()\n\n        if (data.success) {\n          setCompletedExams(data.completedExams || [])\n        } else {\n          setError('Failed to load completed exams')\n        }\n      } catch (err) {\n        console.error('Error fetching completed exams:', err)\n        setError('Failed to load completed exams')\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    fetchCompletedExams()\n  }, [userId])\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    })\n  }\n\n  const diagnosticExams = completedExams.filter(e => e.examType === 'diagnostic')\n  const practiceExams = completedExams.filter(e => e.examType === 'practice')\n\n  if (isLoading) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink asChild>\n                  <Link href=\"/dashboard\">Dashboard</Link>\n                </BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Review Exams</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n\n          <div className=\"flex items-center justify-center py-20\">\n            <LoadingAnimation size=\"lg\" />\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Breadcrumb className=\"mb-8\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink asChild>\n                <Link href=\"/dashboard\">Dashboard</Link>\n              </BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>Review Exams</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n          className=\"space-y-8\"\n        >\n          <div>\n            <div className=\"flex items-center gap-3 mb-2\">\n              <h1 className=\"text-4xl font-bold\">Review Your Exams</h1>\n            </div>\n            <p className=\"text-muted-foreground\">\n              Review your completed exams with explanations for all questions.\n            </p>\n          </div>\n\n          {error && (\n            <Card className=\"border-red-500/50 bg-red-500/10\">\n              <CardContent className=\"pt-6\">\n                <p className=\"text-red-600 dark:text-red-400\">{error}</p>\n              </CardContent>\n            </Card>\n          )}\n\n          {completedExams.length === 0 ? (\n            <Card>\n              <CardContent className=\"pt-12 pb-12 text-center\">\n                <p className=\"text-muted-foreground mb-4\">\n                  You haven't completed any exams yet.\n                </p>\n                <Button asChild>\n                  <Link href=\"/exam-generator\">Take an Exam</Link>\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-8\">\n              {/* Diagnostic Exams */}\n              {diagnosticExams.length > 0 && (\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-2xl font-semibold\">Diagnostic Exams</h2>\n                  <div className=\"grid gap-4\">\n                    {diagnosticExams.map((exam) => (\n                      <Card\n                        key={exam.assignmentId}\n                        className=\"cursor-pointer hover:shadow-lg transition-shadow\"\n                        style={{\n                          borderColor: '#bdd1ca',\n                          backgroundColor: 'rgba(189, 209, 202, 0.03)',\n                        }}\n                        onClick={() =>\n                          setExpandedExam(\n                            expandedExam === exam.assignmentId ? null : exam.assignmentId\n                          )\n                        }\n                      >\n                        <CardHeader>\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <CardTitle className=\"text-lg\">{exam.examFile}</CardTitle>\n                              <CardDescription>\n                                Completed on {formatDate(exam.completedAt || exam.assignedAt)}\n                              </CardDescription>\n                            </div>\n                            {exam.score !== undefined && (\n                              <div className=\"text-right\">\n                                <div className=\"text-3xl font-bold\" style={{ color: '#bdd1ca' }}>\n                                  {Math.round(exam.score)}%\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Score</p>\n                              </div>\n                            )}\n                          </div>\n                        </CardHeader>\n\n                        {expandedExam === exam.assignmentId && exam.questions && (\n                          <>\n                            <Separator />\n                            <CardContent className=\"pt-6\">\n                              <div className=\"space-y-6\">\n                                {exam.questions.map((question, idx) => (\n                                  <div key={question.id} className=\"space-y-3 pb-6 border-b last:border-b-0\">\n                                    <div className=\"flex items-start gap-3\">\n                                      <span className=\"font-semibold text-muted-foreground min-w-[2rem]\">\n                                        {idx + 1}.\n                                      </span>\n                                      <div className=\"flex-1\">\n                                        <p className=\"font-serif text-base leading-relaxed\">\n                                          {question.question}\n                                        </p>\n                                      </div>\n                                    </div>\n\n                                    <div className=\"ml-8 space-y-2\">\n                                      {question.options.map((option, optIdx) => {\n                                        const optionLetter = String.fromCharCode(65 + optIdx)\n                                        const isCorrect = option === question.correct_answer\n\n                                        return (\n                                          <div\n                                            key={optIdx}\n                                            className={`p-3 rounded border-2 ${\n                                              isCorrect\n                                                ? 'border-green-500 bg-green-500/10'\n                                                : 'border-border bg-background'\n                                            }`}\n                                          >\n                                            <span className=\"font-semibold\">{optionLetter}.</span> {option}\n                                            {isCorrect && (\n                                              <Badge className=\"ml-2 bg-green-600\">Correct Answer</Badge>\n                                            )}\n                                          </div>\n                                        )\n                                      })}\n                                    </div>\n\n                                    <div className=\"ml-8 mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded\">\n                                      <p className=\"font-semibold text-sm mb-2\">Explanation:</p>\n                                      <p className=\"text-sm text-muted-foreground\">\n                                        {question.explanation}\n                                      </p>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            </CardContent>\n                          </>\n                        )}\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Practice Exams */}\n              {practiceExams.length > 0 && (\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-2xl font-semibold\">Practice Exams</h2>\n                  <div className=\"grid gap-4\">\n                    {practiceExams.map((exam) => (\n                      <Card\n                        key={exam.assignmentId}\n                        className=\"cursor-pointer hover:shadow-lg transition-shadow\"\n                        style={{\n                          borderColor: '#788c5d',\n                          backgroundColor: 'rgba(120, 140, 93, 0.03)',\n                        }}\n                        onClick={() =>\n                          setExpandedExam(\n                            expandedExam === exam.assignmentId ? null : exam.assignmentId\n                          )\n                        }\n                      >\n                        <CardHeader>\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <CardTitle className=\"text-lg\">{exam.examFile}</CardTitle>\n                              <CardDescription>\n                                Completed on {formatDate(exam.completedAt || exam.assignedAt)}\n                              </CardDescription>\n                            </div>\n                            {exam.score !== undefined && (\n                              <div className=\"text-right\">\n                                <div className=\"text-3xl font-bold\" style={{ color: '#788c5d' }}>\n                                  {Math.round(exam.score)}%\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">Score</p>\n                              </div>\n                            )}\n                          </div>\n                        </CardHeader>\n\n                        {expandedExam === exam.assignmentId && exam.questions && (\n                          <>\n                            <Separator />\n                            <CardContent className=\"pt-6\">\n                              <div className=\"space-y-6\">\n                                {exam.questions.map((question, idx) => (\n                                  <div key={question.id} className=\"space-y-3 pb-6 border-b last:border-b-0\">\n                                    <div className=\"flex items-start gap-3\">\n                                      <span className=\"font-semibold text-muted-foreground min-w-[2rem]\">\n                                        {idx + 1}.\n                                      </span>\n                                      <div className=\"flex-1\">\n                                        <p className=\"font-serif text-base leading-relaxed\">\n                                          {question.question}\n                                        </p>\n                                      </div>\n                                    </div>\n\n                                    <div className=\"ml-8 space-y-2\">\n                                      {question.options.map((option, optIdx) => {\n                                        const optionLetter = String.fromCharCode(65 + optIdx)\n                                        const isCorrect = option === question.correct_answer\n\n                                        return (\n                                          <div\n                                            key={optIdx}\n                                            className={`p-3 rounded border-2 ${\n                                              isCorrect\n                                                ? 'border-green-500 bg-green-500/10'\n                                                : 'border-border bg-background'\n                                            }`}\n                                          >\n                                            <span className=\"font-semibold\">{optionLetter}.</span> {option}\n                                            {isCorrect && (\n                                              <Badge className=\"ml-2 bg-green-600\">Correct Answer</Badge>\n                                            )}\n                                          </div>\n                                        )\n                                      })}\n                                    </div>\n\n                                    <div className=\"ml-8 mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded\">\n                                      <p className=\"font-semibold text-sm mb-2\">Explanation:</p>\n                                      <p className=\"text-sm text-muted-foreground\">\n                                        {question.explanation}\n                                      </p>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            </CardContent>\n                          </>\n                        )}\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          <div className=\"flex gap-4\">\n            <Button asChild variant=\"outline\">\n              <Link href=\"/dashboard\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Dashboard\n              </Link>\n            </Button>\n            <Button asChild>\n              <Link href=\"/exam-generator\">\n                <RefreshCw className=\"w-4 h-4 mr-2\" />\n                Take Another Exam\n              </Link>\n            </Button>\n          </div>\n        </motion.div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/signup/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":11,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":416,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[15532,15641],"text":"\n                Once you verify your email, you&apos;ll be able to log in and access your account.\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[15532,15641],"text":"\n                Once you verify your email, you&lsquo;ll be able to log in and access your account.\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[15532,15641],"text":"\n                Once you verify your email, you&#39;ll be able to log in and access your account.\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[15532,15641],"text":"\n                Once you verify your email, you&rsquo;ll be able to log in and access your account.\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, Suspense, useRef } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport Link from 'next/link'\nimport { supabase } from '@/lib/supabase'\nimport { validatePromoCode } from '@/lib/promo-codes'\nimport { Confetti, type ConfettiRef } from '@/components/ui/confetti'\n\nfunction SignUpContent() {\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const confettiRef = useRef<ConfettiRef>(null)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n    confirmPassword: '',\n    fullName: '',\n    promoCode: '',\n  })\n  const [tierFromPricing, setTierFromPricing] = useState<string | null>(null)\n\n  // Get email and tier from URL parameters\n  useEffect(() => {\n    const email = searchParams.get('email')\n    const tier = searchParams.get('tier')\n    if (email) {\n      setFormData((prev) => ({ ...prev, email }))\n    }\n    if (tier) {\n      setTierFromPricing(tier)\n    }\n  }, [searchParams])\n\n  // Fire confetti on successful signup\n  useEffect(() => {\n    if (success) {\n      confettiRef.current?.fire({})\n    }\n  }, [success])\n\n  const [promoStatus, setPromoStatus] = useState<{\n    message: string\n    type: 'success' | 'error' | null\n  }>({ message: '', type: null })\n\n  const tiers = [\n    { name: 'Week Trial', value: 'free', price: '$0', description: 'Limited Access' },\n    { name: 'Pro', value: 'pro', price: '$20/mo', description: 'Full Access' },\n    { name: 'Pro + Coaching', value: 'pro_coaching', price: '$200/mo', description: 'Full + Calls' },\n  ]\n\n  // Set initial tier from URL, default to first tier if not specified\n  const selectedTier = tierFromPricing || tiers[0].value\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target\n    setFormData((prev) => ({\n      ...prev,\n      [name]: value,\n    }))\n  }\n\n  const validatePromoCodeField = async () => {\n    if (!formData.promoCode) {\n      setPromoStatus({ message: '', type: null })\n      return true\n    }\n\n    const result = await validatePromoCode(formData.promoCode)\n    if (result.isValid) {\n      setPromoStatus({\n        message: result.message || 'Promo code valid!',\n        type: 'success',\n      })\n      return true\n    } else {\n      setPromoStatus({\n        message: result.error || 'Invalid promo code',\n        type: 'error',\n      })\n      return false\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError(null)\n    setSuccess(false)\n\n    // Validation\n    if (!formData.email || !formData.password) {\n      setError('Email and password are required')\n      return\n    }\n\n    if (formData.password.length < 6) {\n      setError('Password must be at least 6 characters')\n      return\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      setError('Passwords do not match')\n      return\n    }\n\n    // Validate promo code if provided\n    if (formData.promoCode && !promoStatus.type) {\n      await validatePromoCodeField()\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      // Create auth user\n      const { data: authData, error: signUpError } = await supabase.auth.signUp({\n        email: formData.email,\n        password: formData.password,\n      })\n\n      console.log('Supabase signup response:', { authData, signUpError })\n\n      if (signUpError) {\n        console.error('Sign up error:', signUpError)\n\n        // Handle rate limit error with helpful message\n        if (signUpError.message?.includes('rate limit') || signUpError.message?.includes('Email rate limit exceeded')) {\n          throw new Error('Too many signup attempts. Please wait an hour and try again, or contact support if you need immediate assistance.')\n        }\n\n        throw signUpError\n      }\n\n      // Check if user was actually created (Supabase sometimes returns success but no user when rate limited)\n      if (authData.user && authData.user.identities && authData.user.identities.length === 0) {\n        console.warn('User created but no identities - likely already exists or rate limited')\n        throw new Error('This email may already be registered, or signup limit reached. Please try logging in instead.')\n      }\n\n      if (!authData.user) {\n        console.error('No user returned from signup')\n        throw new Error('User creation failed - no user returned from Supabase')\n      }\n\n      console.log('User created successfully:', authData.user.id)\n\n      // Create user profile via server API endpoint\n      // Use tier from pricing form if available, otherwise use promo code or free tier\n      const subscriptionTier = tierFromPricing || (formData.promoCode ? 'pro' : 'free')\n\n      console.log('Starting profile creation for user:', authData.user.id)\n      try {\n        const profileBody = {\n          userId: authData.user.id,\n          email: formData.email,\n          fullName: formData.fullName || null,\n          subscriptionTier,\n          promoCodeUsed: formData.promoCode || null,\n        }\n        console.log('Profile creation request body:', profileBody)\n\n        const profileResponse = await fetch('/api/auth/create-profile', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(profileBody),\n        })\n\n        console.log('Profile creation response status:', profileResponse.status)\n\n        if (!profileResponse.ok) {\n          const errorData = await profileResponse.json()\n          console.error('Profile creation API error:', {\n            status: profileResponse.status,\n            error: errorData,\n          })\n          // Don't throw - account is created, profile creation can be retried\n        } else {\n          const profileData = await profileResponse.json()\n          console.log('Profile created successfully:', profileData)\n        }\n      } catch (err) {\n        console.error('Profile creation request error:', err)\n        // Don't throw - account is created even if profile creation fails\n      }\n\n      // If promo code was provided, apply it in background\n      if (formData.promoCode && promoStatus.type === 'success') {\n        supabase\n          .from('promo_codes')\n          .update({ usage_count: supabase.rpc('increment', { amount: 1 }) })\n          .eq('code', formData.promoCode.toUpperCase())\n          .catch((err) => console.error('Promo code update error:', err))\n      }\n\n      // Show success message after auth and profile creation\n      setSuccess(true)\n      setFormData({\n        email: '',\n        password: '',\n        confirmPassword: '',\n        fullName: '',\n        promoCode: '',\n      })\n\n      // Don't redirect - user needs to verify email first\n    } catch (err) {\n      console.error('Signup error details:', err)\n\n      let message = 'Sign up failed'\n\n      if (err instanceof Error) {\n        message = err.message\n      } else if (typeof err === 'string') {\n        message = err\n      } else if (err && typeof err === 'object') {\n        // Handle object errors (like from Supabase)\n        message = JSON.stringify(err)\n        console.error('Object error:', err)\n      }\n\n      setError(message)\n      setLoading(false)\n      return\n    }\n\n    // Reset loading state after success\n    setLoading(false)\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Confetti Canvas */}\n      <Confetti\n        ref={confettiRef}\n        className=\"absolute top-0 left-0 z-50 size-full pointer-events-none\"\n      />\n\n      {/* Gradient background effects - 4 breaths per minute (15s cycle) */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-black to-slate-900 opacity-80\"></div>\n      <div className=\"absolute top-0 left-1/4 w-96 h-96 bg-blue-500 rounded-full mix-blend-screen filter blur-3xl opacity-20 animate-breath\"></div>\n      <div className=\"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-screen filter blur-3xl opacity-20 animate-breath\" style={{animationDelay: '7.5s'}}></div>\n\n      {/* Card */}\n      <div className=\"relative w-full max-w-md\">\n        <div className=\"bg-slate-900/40 backdrop-blur-xl border border-slate-800/50 rounded-2xl shadow-2xl p-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-4xl font-bold text-white mb-2\">Create Account</h1>\n            <p className=\"text-slate-400\">Join EPPP Skills Platform</p>\n          </div>\n\n          {/* Success Message */}\n          {success && (\n            <div className=\"mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg\">\n              <p className=\"text-green-400 font-medium mb-2\">\n                Account created successfully!\n              </p>\n              <p className=\"text-green-400 text-sm\">\n                Please check your email to verify your account. You should receive a confirmation email shortly.\n              </p>\n            </div>\n          )}\n\n          {/* Tier Selection */}\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-slate-300 mb-3\">\n              Choose Your Plan\n            </label>\n            <div className=\"grid grid-cols-3 gap-2\">\n              {tiers.map((tier) => (\n                <button\n                  key={tier.value}\n                  type=\"button\"\n                  onClick={() => setTierFromPricing(tier.value)}\n                  className={`p-3 rounded-lg border-2 transition-all text-center text-xs ${\n                    selectedTier === tier.value\n                      ? 'border-blue-500 bg-blue-500/10'\n                      : 'border-slate-700 bg-slate-800/30 hover:border-slate-600'\n                  }`}\n                >\n                  <div className=\"font-semibold text-slate-200\">{tier.name}</div>\n                  <div className=\"text-blue-400 font-bold text-sm mt-1\">{tier.price}</div>\n                  <div className=\"text-slate-400 text-xs mt-1\">{tier.description}</div>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg\">\n              <p className=\"text-red-400 font-medium\">{error}</p>\n            </div>\n          )}\n\n          {/* Form */}\n          {!success && <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {/* Full Name */}\n            <div>\n              <label htmlFor=\"fullName\" className=\"block text-sm font-medium text-slate-300 mb-2\">\n                Full Name (optional)\n              </label>\n              <input\n                type=\"text\"\n                id=\"fullName\"\n                name=\"fullName\"\n                value={formData.fullName}\n                onChange={handleInputChange}\n                placeholder=\"Your name\"\n                className=\"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition\"\n              />\n            </div>\n\n            {/* Email */}\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-slate-300 mb-2\">\n                Email Address\n              </label>\n              <input\n                type=\"email\"\n                id=\"email\"\n                name=\"email\"\n                value={formData.email}\n                onChange={handleInputChange}\n                placeholder=\"your@email.com\"\n                required\n                className=\"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition\"\n              />\n            </div>\n\n            {/* Password */}\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-slate-300 mb-2\">\n                Password\n              </label>\n              <input\n                type=\"password\"\n                id=\"password\"\n                name=\"password\"\n                value={formData.password}\n                onChange={handleInputChange}\n                placeholder=\"Minimum 6 characters\"\n                required\n                className=\"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition\"\n              />\n            </div>\n\n            {/* Confirm Password */}\n            <div>\n              <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-slate-300 mb-2\">\n                Confirm Password\n              </label>\n              <input\n                type=\"password\"\n                id=\"confirmPassword\"\n                name=\"confirmPassword\"\n                value={formData.confirmPassword}\n                onChange={handleInputChange}\n                placeholder=\"Confirm password\"\n                required\n                className=\"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition\"\n              />\n            </div>\n\n            {/* Promo Code */}\n            <div>\n              <label htmlFor=\"promoCode\" className=\"block text-sm font-medium text-slate-300 mb-2\">\n                Promo Code (optional)\n              </label>\n              <input\n                type=\"text\"\n                id=\"promoCode\"\n                name=\"promoCode\"\n                value={formData.promoCode}\n                onChange={handleInputChange}\n                onBlur={validatePromoCodeField}\n                placeholder=\"Enter promo code for discount\"\n                className=\"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition\"\n              />\n              {promoStatus.type === 'success' && (\n                <p className=\"text-sm text-green-400 mt-2 font-medium\">{promoStatus.message}</p>\n              )}\n              {promoStatus.type === 'error' && (\n                <p className=\"text-sm text-red-400 mt-2 font-medium\">{promoStatus.message}</p>\n              )}\n            </div>\n\n            {/* Submit Button */}\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full mt-6 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 disabled:from-blue-400 disabled:to-blue-400 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-lg hover:shadow-blue-500/50\"\n            >\n              {loading ? 'Creating account...' : 'Sign Up'}\n            </button>\n          </form>}\n\n          {/* Login Link */}\n          {!success &&\n          <p className=\"text-center text-slate-400 mt-6\">\n            Already have an account?{' '}\n            <Link href=\"/login\" className=\"text-blue-400 hover:text-blue-300 font-medium transition\">\n              Log in\n            </Link>\n          </p>}\n\n          {success && (\n            <div className=\"text-center mt-8\">\n              <p className=\"text-slate-400 mb-4\">\n                Once you verify your email, you'll be able to log in and access your account.\n              </p>\n              <Link href=\"/login\" className=\"text-blue-400 hover:text-blue-300 font-medium transition inline-block\">\n                Go to Login â†’\n              </Link>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default function SignUpPage() {\n  return (\n    <Suspense fallback={<div className=\"min-h-screen bg-black flex items-center justify-center\">Loading...</div>}>\n      <SignUpContent />\n    </Suspense>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/study-optimizer/study-optimizer-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lightbulb' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Switch' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalysisData' is defined but never used.","line":16,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setStudyStats' is assigned a value but never used.","line":30,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used.","line":31,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used.","line":31,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'analyzeResults'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [analyzeResults, resultsParam]","fix":{"range":[1460,1474],"text":"[analyzeResults, resultsParam]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sections' is assigned a value but never used.","line":235,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":235,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport Link from 'next/link'\nimport { Lightbulb, TrendingDown, BookOpen, Target, Zap, AlertTriangle } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Separator } from '@/components/ui/separator'\nimport { Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb'\nimport { motion } from 'motion/react'\nimport { useSearchParams } from 'next/navigation'\nimport * as animations from '@/lib/animations'\nimport { calculateStudyStats } from '@/lib/dashboard-utils'\nimport { Switch } from '@/components/ui/switch'\n\ninterface AnalysisData {\n  overallScore?: number\n  domainBreakdown?: Record<string, { score: number; weight: number }>\n  recommendations?: string[]\n  topics?: string[]\n}\n\nexport function StudyOptimizerContent() {\n  const searchParams = useSearchParams()\n  const resultsParam = searchParams.get('results')\n\n  const [analysis, setAnalysis] = useState('')\n  const [isAnalyzing, setIsAnalyzing] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [studyStats, setStudyStats] = useState(calculateStudyStats())\n  const [viewMode, setViewMode] = useState<'overview' | 'detailed'>('overview')\n\n  useEffect(() => {\n    if (resultsParam) {\n      analyzeResults()\n    }\n  }, [resultsParam])\n\n  const analyzeResults = async () => {\n    if (!resultsParam) return\n\n    try {\n      setIsAnalyzing(true)\n      setError(null)\n      setAnalysis('')\n\n      const response = await fetch('/api/study-optimizer', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ examResults: resultsParam }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to analyze exam results')\n      }\n\n      if (!response.body) {\n        throw new Error('No response body')\n      }\n\n      const reader = response.body.getReader()\n      const decoder = new TextDecoder()\n\n      while (true) {\n        const { done, value } = await reader.read()\n\n        if (done) break\n\n        const text = decoder.decode(value)\n        setAnalysis((prev) => prev + text)\n      }\n    } catch (err) {\n      console.error('Error analyzing results:', err)\n      setError(err instanceof Error ? err.message : 'Failed to analyze results')\n    } finally {\n      setIsAnalyzing(false)\n    }\n  }\n\n  const parseAnalysis = () => {\n    const lines = analysis.split('\\n')\n    const sections: Record<string, string[]> = {}\n    let currentSection = 'overview'\n\n    for (const line of lines) {\n      if (line.startsWith('#')) {\n        currentSection = line.toLowerCase().replace(/[^a-z0-9]/g, ' ').trim().split(' ')[0]\n        sections[currentSection] = []\n      } else if (line.trim()) {\n        if (!sections[currentSection]) sections[currentSection] = []\n        sections[currentSection].push(line)\n      }\n    }\n\n    return sections\n  }\n\n  if (!resultsParam) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Prioritizer</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3 }}\n          >\n            <div className=\"text-center py-12\">\n              <h1 className=\"text-5xl md:text-6xl font-bold mb-4 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70\">\n                Prioritize\n              </h1>\n              <p className=\"text-muted-foreground mb-12 text-lg md:text-xl max-w-2xl mx-auto leading-relaxed\">\n                AI-powered study recommendations based on your exam performance\n              </p>\n\n              {/* Current Progress Section */}\n              {studyStats.weakTopics.length > 0 || studyStats.totalQuizzes > 0 ? (\n                <div className=\"max-w-3xl mx-auto mb-12\">\n                  {/* Weak Areas Alert */}\n                  {studyStats.weakTopics.length > 0 ? (\n                    <motion.div\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ duration: 0.3, delay: 0.1 }}\n                      className=\"mb-8\"\n                    >\n                      <Card className=\"border-orange-500/30 bg-orange-500/5\">\n                        <CardHeader>\n                          <div className=\"flex items-center gap-3\">\n                            <AlertTriangle size={24} className=\"text-orange-500 flex-shrink-0\" />\n                            <div className=\"text-left\">\n                              <CardTitle className=\"text-xl\">Topics Needing Focus</CardTitle>\n                              <CardDescription>\n                                These topics scored below 60% - prioritize them in your study plan\n                              </CardDescription>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <Separator />\n                        <CardContent className=\"pt-6\">\n                          <div className=\"space-y-3\">\n                            {studyStats.weakTopics.slice(0, 3).map((topic, idx) => (\n                              <motion.div\n                                key={idx}\n                                initial={{ opacity: 0, x: -20 }}\n                                animate={{ opacity: 1, x: 0 }}\n                                transition={{ delay: (idx + 2) * 0.1 }}\n                                className=\"flex items-center justify-between p-3 rounded-lg bg-background border border-border hover:border-orange-500/50 transition-colors\"\n                              >\n                                <div className=\"flex items-center gap-3 flex-1\">\n                                  <div className=\"w-2 h-2 rounded-full bg-orange-500 flex-shrink-0\" />\n                                  <div className=\"text-left\">\n                                    <p className=\"font-medium text-sm\">{topic.topic}</p>\n                                    <p className=\"text-xs text-muted-foreground\">\n                                      Average: {topic.score}%\n                                    </p>\n                                  </div>\n                                </div>\n                              </motion.div>\n                            ))}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    </motion.div>\n                  ) : studyStats.totalQuizzes > 0 ? (\n                    <motion.div\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ duration: 0.3, delay: 0.1 }}\n                      className=\"mb-8\"\n                    >\n                      <Card className=\"border-green-500/30 bg-green-500/5\">\n                        <CardHeader>\n                          <div className=\"flex items-center gap-3\">\n                            <BookOpen size={24} className=\"text-green-500 flex-shrink-0\" />\n                            <div className=\"text-left\">\n                              <CardTitle className=\"text-xl\">Great Progress!</CardTitle>\n                              <CardDescription>\n                                All your topics are scoring above 60%. Keep up the excellent work!\n                              </CardDescription>\n                            </div>\n                          </div>\n                        </CardHeader>\n                      </Card>\n                    </motion.div>\n                  ) : null}\n                </div>\n              ) : null}\n\n              {/* CTA Section */}\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.3, delay: 0.2 }}\n              >\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-2xl\">Ready for a Practice Exam?</CardTitle>\n                    <CardDescription>\n                      Take a practice exam to get detailed AI-powered analysis and personalized recommendations\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex gap-4 justify-center\">\n                      <Link href=\"/exam-generator\">\n                        <Button size=\"lg\">Take Practice Exam</Button>\n                      </Link>\n                      <Link href=\"/topic-selector\">\n                        <Button size=\"lg\" variant=\"outline\">Study Topics</Button>\n                      </Link>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            </div>\n          </motion.div>\n        </div>\n      </main>\n    )\n  }\n\n  const sections = parseAnalysis()\n\n  return (\n    <main className=\"min-h-screen p-6 bg-background\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Breadcrumb className=\"mb-8\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>Prioritizer</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n        >\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-5xl md:text-6xl font-bold mb-4 tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70\">\n              Prioritize\n            </h1>\n            <p className=\"text-muted-foreground text-lg md:text-xl max-w-2xl mx-auto leading-relaxed\">\n              Your personalized study plan based on exam performance\n            </p>\n          </div>\n\n          {isAnalyzing && !analysis && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50\"\n            >\n              <div className=\"bg-background border border-border rounded-lg p-8 text-center\">\n                <div className=\"w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin mx-auto mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  Analyzing your performance...\n                </p>\n              </div>\n            </motion.div>\n          )}\n\n          {error && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-6 mb-8\"\n            >\n              <h3 className=\"font-semibold text-destructive mb-2\">Error</h3>\n              <p className=\"text-sm text-destructive/80\">{error}</p>\n              <Button\n                onClick={analyzeResults}\n                variant=\"outline\"\n                className=\"mt-4\"\n              >\n                Try Again\n              </Button>\n            </motion.div>\n          )}\n\n          {analysis && (\n            <motion.div\n              initial=\"hidden\"\n              animate=\"visible\"\n              variants={animations.containerVariants}\n              className=\"space-y-8\"\n            >\n              {/* Performance Overview */}\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <motion.div\n                  variants={animations.itemVariants}\n                  whileHover={{ scale: 1.02 }}\n                  className=\"transition-transform\"\n                >\n                  <Card className=\"hover:bg-accent/50 transition-colors\">\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-base\">Overall Performance</CardTitle>\n                        <motion.div whileHover={{ rotate: 360 }} transition={{ duration: 0.5 }}>\n                          <TrendingDown size={20} className=\"text-muted-foreground\" />\n                        </motion.div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <motion.p\n                        className=\"text-4xl font-bold\"\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.3 }}\n                      >\n                        {analysis.match(/(\\d+)%/)?.[1] || 'â€”'}%\n                      </motion.p>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n\n                <motion.div\n                  variants={animations.itemVariants}\n                  whileHover={{ scale: 1.02 }}\n                  className=\"transition-transform\"\n                >\n                  <Card className=\"hover:bg-accent/50 transition-colors\">\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-base\">Areas to Focus</CardTitle>\n                        <motion.div whileHover={{ rotate: -360 }} transition={{ duration: 0.5 }}>\n                          <Target size={20} className=\"text-muted-foreground\" />\n                        </motion.div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <motion.p\n                        className=\"text-4xl font-bold\"\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.4 }}\n                      >\n                        {analysis.match(/\\d+/)?.[0] || 'â€”'}\n                      </motion.p>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n\n                <motion.div\n                  variants={animations.itemVariants}\n                  whileHover={{ scale: 1.02 }}\n                  className=\"transition-transform\"\n                >\n                  <Card className=\"hover:bg-accent/50 transition-colors\">\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle className=\"text-base\">Study Plan</CardTitle>\n                        <motion.div animate={{ y: [0, -5, 0] }} transition={{ repeat: Infinity, duration: 2 }}>\n                          <BookOpen size={20} className=\"text-muted-foreground\" />\n                        </motion.div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <motion.p\n                        className=\"text-2xl font-bold\"\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.5 }}\n                      >\n                        Ready\n                      </motion.p>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              </div>\n\n              {/* Detailed Analysis */}\n              <motion.div\n                variants={animations.itemVariants}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.6 }}\n              >\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-2xl flex items-center gap-2\">\n                      <Zap size={24} className=\"text-muted-foreground\" />\n                      Detailed Analysis\n                    </CardTitle>\n                    <CardDescription>\n                      Review your performance and personalized recommendations\n                    </CardDescription>\n                  </CardHeader>\n                  <Separator />\n                  <CardContent className=\"pt-6\">\n                    <div className=\"prose prose-invert max-w-none\">\n                      <div className=\"space-y-4 text-sm text-foreground leading-relaxed whitespace-pre-wrap\">\n                        {analysis}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n\n              {/* Action Buttons */}\n              <motion.div\n                variants={animations.itemVariants}\n                className=\"flex gap-4 justify-center pt-4\"\n              >\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setAnalysis('')\n                    setError(null)\n                  }}\n                >\n                  Take Another Exam\n                </Button>\n                <Link href=\"/topic-selector\">\n                  <Button>\n                    Start Studying\n                  </Button>\n                </Link>\n              </motion.div>\n            </motion.div>\n          )}\n        </motion.div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/topic-selector/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4281,4284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4281,4284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5753,5756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5753,5756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6617,6620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6617,6620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":242,"column":6,"nodeType":"ArrayExpression","endLine":242,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [user]","fix":{"range":[8953,8955],"text":"[user]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport Link from 'next/link'\nimport { ChevronDown, Clock, Play, X, AlertCircle, BadgeCheck } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Separator } from '@/components/ui/separator'\nimport { Progress } from '@/components/ui/progress'\nimport { Kbd } from '@/components/ui/kbd'\nimport { Badge } from '@/components/ui/badge'\nimport { Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb'\nimport { motion, AnimatePresence } from 'motion/react'\nimport { getAllQuizResults } from '@/lib/quiz-results-storage'\nimport { calculateStudyStats } from '@/lib/dashboard-utils'\nimport { EPPP_DOMAINS } from '@/lib/eppp-data'\nimport { useAuth } from '@/context/auth-context'\nimport {\n  getUserCurrentInterest,\n  subscribeToUserInterestChanges,\n  unsubscribeFromInterestChanges,\n  updateUserCurrentInterest,\n} from '@/lib/interests'\nimport { getTopPriorities, getAllLatestRecommendations } from '@/lib/priority-storage'\nimport type { RealtimeChannel } from '@supabase/supabase-js'\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\n// Free-tier topics: one curated topic per domain, backed by free-contentGPT\nconst FREE_TOPICS_BY_DOMAIN: Record<string, string[]> = {\n  '1': ['Brain Regions/Functions â€“ Cerebral Cortex'],\n  '2': ['Classical Conditioning'],\n  '3-social': ['Affiliation, Attraction, and Intimacy'],\n  '3-cultural': ['Cross-Cultural Issues â€“ Identity Development Models'],\n  '4': ['Cognitive Development'],\n  '5-assessment': ['Clinical Tests'],\n  '5-diagnosis': ['Anxiety Disorders and Obsessive-Compulsive Disorder'],\n  '5-test': ['Item Analysis and Test Reliability'],\n  '6': ['Cognitive-Behavioral Therapies'],\n  '7': ['Correlation and Regression'],\n  '8': ['APA Ethics Code Over and Standards 1 & 2'],\n  '3-5-6': ['Satisfaction, Commitment, and Stress'],\n}\n\ninterface RecentActivity {\n  topic: string\n  timestamp: number\n  score: number\n}\n\nconst parseInterestList = (interest: string | null) =>\n  interest\n    ? interest\n        .split(',')\n        .map((item) => item.trim())\n        .filter((item) => item.length > 0)\n    : []\n\nconst INTEREST_TAG_PALETTE = [\n  { backgroundColor: '#bdd1ca', borderColor: '#bdd1ca', textColor: '#1a2b24' },\n  { backgroundColor: '#788c5d', borderColor: '#788c5d', textColor: '#ffffff' },\n  { backgroundColor: '#d87758', borderColor: '#d87758', textColor: '#ffffff' },\n  { backgroundColor: '#c46685', borderColor: '#c46685', textColor: '#ffffff' },\n  { backgroundColor: '#6a9bcc', borderColor: '#6a9bcc', textColor: '#ffffff' },\n  { backgroundColor: '#cbc9db', borderColor: '#cbc9db', textColor: '#1b1a1f' },\n]\n\nconst getInterestTagStyle = (index: number) =>\n  INTEREST_TAG_PALETTE[index % INTEREST_TAG_PALETTE.length]\n\nconst getRecentScoreColor = (score: number) => {\n  if (score > 70) return 'text-[#788c5d]' // Olive - strong/ready\n  if (score >= 40) return 'text-[#bdd1ca]' // Soft Sage - okay but needs refinement\n  return 'text-[#d87758]' // Coral - needs attention\n}\n\nfunction getTimeAgo(timestamp: number): string {\n  const now = Date.now()\n  const diff = now - timestamp\n  const seconds = Math.floor(diff / 1000)\n  const minutes = Math.floor(seconds / 60)\n  const hours = Math.floor(minutes / 60)\n  const days = Math.floor(hours / 24)\n\n  if (days > 0) return `${days} ${days === 1 ? 'day' : 'days'} ago`\n  if (hours > 0) return `${hours} ${hours === 1 ? 'hour' : 'hours'} ago`\n  if (minutes > 0) return `${minutes} ${minutes === 1 ? 'minute' : 'minutes'} ago`\n  return 'Just now'\n}\n\nexport default function TopicSelectorPage() {\n  const { user, userProfile } = useAuth()\n  const subscriptionTier = userProfile?.subscription_tier\n  const isFreeTier = subscriptionTier === 'free' || !subscriptionTier\n  const [expandedDomains, setExpandedDomains] = useState<string[]>([])\n  const [currentInput, setCurrentInput] = useState<string>('')\n  const [savedInterests, setSavedInterests] = useState<string[]>([])\n  const [domains, setDomains] = useState<any[]>([])\n  const [recentActivities, setRecentActivities] = useState<RecentActivity[]>([])\n  const [priorityTopicIds, setPriorityTopicIds] = useState<string[]>([])\n  const [recommendedDomainIds, setRecommendedDomainIds] = useState<string[]>([])\n  const subscriptionRef = useRef<RealtimeChannel | null>(null)\n  const studyStats = calculateStudyStats()\n\n  // Calculate progress based on quiz results\n  useEffect(() => {\n    const allResults = getAllQuizResults()\n\n    // Get recent activities (last 5 topics)\n    const sortedResults = [...allResults].sort((a, b) => b.timestamp - a.timestamp)\n    const recentTopics = sortedResults.slice(0, 5).map(result => ({\n      topic: result.topic,\n      timestamp: result.timestamp,\n      score: Math.round((result.score / result.totalQuestions) * 100)\n    }))\n    setRecentActivities(recentTopics)\n\n    // Create a map of topic scores\n    const topicScores: Record<string, number> = {}\n    allResults.forEach((result) => {\n      const percentage = (result.score / result.totalQuestions) * 100\n      topicScores[result.topic] = percentage\n    })\n\n    const mapDomainNumberToIds = (domainNumber?: number | null) => {\n      if (!domainNumber) return []\n      return EPPP_DOMAINS.filter((domain) => {\n        if (domain.id === '3-5-6') return false\n        const [prefix] = domain.id.split('-')\n        return parseInt(prefix, 10) === domainNumber\n      }).map((domain) => domain.id)\n    }\n\n    const derivePriorityState = (topDomains: any[] | null | undefined) => {\n      const topicSet = new Set<string>()\n      const domainSet = new Set<string>()\n\n      ;(topDomains || []).forEach((domain) => {\n        if (Array.isArray(domain?.recommendedTopicIds)) {\n          domain.recommendedTopicIds.forEach((id: string) => topicSet.add(id))\n        }\n\n        if (domain?.type === 'org_psych') {\n          domainSet.add('3-5-6')\n        } else {\n          mapDomainNumberToIds(domain?.domainNumber).forEach((id) => domainSet.add(id))\n        }\n      })\n\n      return {\n        topicIds: Array.from(topicSet),\n        domainIds: Array.from(domainSet),\n      }\n    }\n\n    const applyLocalPriorityFallback = () => {\n      const { diagnostic, practice } = getAllLatestRecommendations()\n      const available = [diagnostic, practice].filter(Boolean) as Array<{\n        timestamp: number\n        topPriorities: any[]\n      }>\n\n      if (available.length === 0) {\n        const localDiagnostic = getTopPriorities('diagnostic')\n        if (localDiagnostic && localDiagnostic.length > 0) {\n          const state = derivePriorityState(localDiagnostic)\n          setPriorityTopicIds(state.topicIds)\n          setRecommendedDomainIds(state.domainIds)\n        } else {\n          setPriorityTopicIds([])\n          setRecommendedDomainIds([])\n        }\n        return\n      }\n\n      available.sort((a, b) => b.timestamp - a.timestamp)\n      const latest = available[0]\n      const state = derivePriorityState(latest.topPriorities || [])\n      setPriorityTopicIds(state.topicIds)\n      setRecommendedDomainIds(state.domainIds)\n    }\n\n    // Load priority recommendations from Supabase\n    const loadPriorities = async () => {\n      if (!user) {\n        applyLocalPriorityFallback()\n        return\n      }\n\n      try {\n        const { data, error } = await supabase\n          .from('study_priorities')\n          .select('top_domains')\n          .eq('user_id', user.id)\n          .single()\n\n        if (data && !error) {\n          const state = derivePriorityState(data.top_domains || [])\n          setPriorityTopicIds(state.topicIds)\n          setRecommendedDomainIds(state.domainIds)\n        } else {\n          applyLocalPriorityFallback()\n        }\n      } catch (err) {\n        console.error('Failed to load priorities from Supabase:', err)\n        applyLocalPriorityFallback()\n      }\n    }\n\n    loadPriorities()\n\n    // Build domains with dynamic progress\n    const domainsWithProgress = EPPP_DOMAINS.map((domain) => {\n      const topicsWithProgress = domain.topics.map((topic) => {\n        // If quiz exists, show actual score; otherwise show 0%\n        const score = topicScores[topic.name] ?? 0\n        return {\n          id: topic.id,\n          name: topic.name,\n          progress: Math.round(score),\n        }\n      })\n\n      // Calculate domain progress as average of all topics\n      const avgProgress = topicsWithProgress.length > 0\n        ? Math.round(topicsWithProgress.reduce((sum, t) => sum + t.progress, 0) / topicsWithProgress.length)\n        : 0\n\n      return {\n        id: domain.id,\n        name: domain.name,\n        progress: avgProgress,\n        topics: topicsWithProgress,\n      }\n    })\n\n    setDomains(domainsWithProgress)\n  }, [])\n\n  // Load previously saved interests so topic-selector mirrors topic-teacher\n  useEffect(() => {\n    let isMounted = true\n\n    const loadInterests = async () => {\n      if (!user?.id) {\n        if (isMounted) {\n          setSavedInterests([])\n          setCurrentInput('')\n        }\n        return\n      }\n\n      try {\n        let currentInterest = await getUserCurrentInterest(user.id)\n\n        if (!currentInterest && typeof window !== 'undefined') {\n          currentInterest = localStorage.getItem(`interests_${user.id}`)\n        }\n\n        if (!isMounted) return\n\n        if (currentInterest) {\n          setSavedInterests(parseInterestList(currentInterest))\n          if (typeof window !== 'undefined') {\n            localStorage.setItem(`interests_${user.id}`, currentInterest)\n          }\n        } else {\n          setSavedInterests([])\n          if (typeof window !== 'undefined') {\n            localStorage.removeItem(`interests_${user.id}`)\n          }\n        }\n\n        setCurrentInput('')\n      } catch (error) {\n        console.debug('Failed to load interests for topic selector:', error)\n      }\n    }\n\n    loadInterests()\n\n    return () => {\n      isMounted = false\n    }\n  }, [user?.id])\n\n  // Subscribe to interest changes from topic-teacher\n  useEffect(() => {\n    if (user?.id) {\n      const channel = subscribeToUserInterestChanges(user.id, (newInterest) => {\n        const interestsList = parseInterestList(newInterest)\n        setSavedInterests(interestsList)\n        setCurrentInput('')\n\n        if (typeof window !== 'undefined') {\n          if (newInterest && newInterest.trim().length > 0) {\n            localStorage.setItem(`interests_${user.id}`, newInterest)\n          } else {\n            localStorage.removeItem(`interests_${user.id}`)\n          }\n        }\n      })\n      subscriptionRef.current = channel\n    }\n\n    return () => {\n      if (subscriptionRef.current) {\n        unsubscribeFromInterestChanges(subscriptionRef.current)\n      }\n    }\n  }, [user?.id])\n\n  const toggleDomain = (domainId: string) => {\n    setExpandedDomains((prev) =>\n      prev.includes(domainId)\n        ? prev.filter((id) => id !== domainId)\n        : [...prev, domainId]\n    )\n  }\n\n  const handleAddInterest = async () => {\n    if (currentInput.trim() && user?.id) {\n      try {\n        const newInterest = currentInput.trim()\n        const updatedInterests = [...savedInterests, newInterest]\n        setSavedInterests(updatedInterests)\n        setCurrentInput('')\n\n        const interestsString = updatedInterests.join(', ')\n\n        if (typeof window !== 'undefined') {\n          localStorage.setItem(`interests_${user.id}`, interestsString)\n        }\n\n        await updateUserCurrentInterest(user.id, interestsString)\n      } catch (error) {\n        console.debug('Failed to save interest:', error)\n      }\n    }\n  }\n\n  const removeInterest = async (index: number) => {\n    const newInterests = savedInterests.filter((_, i) => i !== index)\n    setSavedInterests(newInterests)\n\n    if (user?.id && typeof window !== 'undefined') {\n      if (newInterests.length > 0) {\n        localStorage.setItem(`interests_${user.id}`, newInterests.join(', '))\n      } else {\n        localStorage.removeItem(`interests_${user.id}`)\n      }\n    }\n\n    if (user?.id) {\n      await updateUserCurrentInterest(user.id, newInterests.join(', '))\n    }\n  }\n\n  return (\n    <main className=\"min-h-screen bg-background\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"p-6 border-b\">\n          <Breadcrumb className=\"mb-6\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Topics</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n\n          <div className=\"space-y-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold mb-2\">Topics</h1>\n              <p className=\"text-sm text-muted-foreground\">\n                Select a topic to start studying\n              </p>\n            </div>\n\n            {isFreeTier && (\n              <div className=\"rounded-lg border border-dashed border-border/70 bg-muted/30 p-4 text-sm\">\n                <p className=\"font-medium mb-1\">Youâ€™re on the free plan.</p>\n                <p className=\"text-muted-foreground\">\n                  You have access to one curated topic in each domain. Upgrade to Pro to unlock all topics and advanced tools.\n                </p>\n              </div>\n            )}\n\n            <div className=\"flex-1 max-w-2xl\">\n              <div className=\"relative\">\n                <div className=\"flex flex-wrap items-center gap-2 p-2 pl-3 border border-input rounded-md bg-background focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2\">\n                  {/* Display saved interests as tags */}\n                  {savedInterests.map((interest, index) => {\n                    const tagStyle = getInterestTagStyle(index)\n                    return (\n                      <motion.div\n                        key={interest + index}\n                        initial={{ opacity: 0, scale: 0.8 }}\n                        animate={{ opacity: 1, scale: 1 }}\n                        exit={{ opacity: 0, scale: 0.8 }}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <Badge\n                          variant=\"outline\"\n                          className=\"flex items-center gap-1 px-3 py-1 text-sm font-semibold transition-colors\"\n                          style={{\n                            backgroundColor: tagStyle.backgroundColor,\n                            borderColor: tagStyle.borderColor,\n                            color: tagStyle.textColor,\n                          }}\n                        >\n                          <span className=\"whitespace-nowrap\">{interest}</span>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => {\n                              e.stopPropagation()\n                              removeInterest(index)\n                            }}\n                            aria-label={`Remove interest ${interest}`}\n                            className=\"ml-2 flex h-4 w-4 items-center justify-center rounded-full border border-transparent bg-white/20 text-current transition-colors hover:bg-white/30 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-current\"\n                          >\n                            <X size={12} />\n                          </button>\n                        </Badge>\n                      </motion.div>\n                    )\n                  })}\n\n                  {/* Input field */}\n                  <input\n                    type=\"text\"\n                    placeholder={savedInterests.length === 0 ? \"Add your interests/hobbies/fandoms for study personalization...\" : \"Add another interest...\"}\n                    value={currentInput}\n                    onChange={(e) => setCurrentInput(e.target.value)}\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault()\n                        handleAddInterest()\n                      }\n                    }}\n                    className=\"flex-1 min-w-[200px] bg-transparent outline-none text-sm\"\n                  />\n\n                  {/* Enter key indicator */}\n                  {currentInput.trim().length > 0 && (\n                    <motion.div\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      className=\"flex items-center gap-1 text-xs text-muted-foreground ml-auto\"\n                    >\n                      <Kbd className=\"text-xs px-1.5 py-0.5\">Enter</Kbd>\n                    </motion.div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Recent Activity Section */}\n        {recentActivities.length > 0 && (\n          <div className=\"p-6 border-b\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Clock size={20} />\n                      Recent Activity\n                    </CardTitle>\n                    <CardDescription>\n                      Continue where you left off\n                    </CardDescription>\n                  </div>\n                  {studyStats.lastStudiedTopic && (\n                    <Link href={`/quizzer?topic=${encodeURIComponent(studyStats.lastStudiedTopic)}`}>\n                      <Button size=\"sm\" className=\"gap-2\">\n                        <Play size={16} />\n                        Continue\n                      </Button>\n                    </Link>\n                  )}\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {recentActivities.map((activity, idx) => {\n                    const timeAgo = getTimeAgo(activity.timestamp)\n                    const scoreColor = getRecentScoreColor(activity.score)\n\n                    return (\n                      <motion.div\n                        key={idx}\n                        initial={{ opacity: 0, x: -20 }}\n                        animate={{ opacity: 1, x: 0 }}\n                        transition={{ delay: idx * 0.05 }}\n                      >\n                        <Link href={`/quizzer?topic=${encodeURIComponent(activity.topic)}`}>\n                          <div className=\"flex items-center justify-between p-3 rounded-lg border border-border hover:border-primary hover:bg-accent transition-colors cursor-pointer group\">\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium text-sm group-hover:text-primary transition-colors\">\n                                {activity.topic}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground\">\n                                {timeAgo}\n                              </p>\n                            </div>\n                            <div className=\"flex items-center gap-3\">\n                              <span className={`text-sm font-semibold ${scoreColor}`}>\n                                {activity.score}%\n                              </span>\n                              <ChevronDown size={16} className=\"transform -rotate-90 text-muted-foreground group-hover:text-primary transition-colors\" />\n                            </div>\n                          </div>\n                        </Link>\n                      </motion.div>\n                    )\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        <div className=\"p-6 space-y-3\">\n          {domains.map((domain, index) => (\n            <Card key={domain.id} className=\"border\">\n              <button\n                onClick={() => toggleDomain(domain.id)}\n                className=\"w-full\"\n              >\n                <motion.div\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: index * 0.05 }}\n                  className=\"p-4 hover:bg-accent transition-colors text-left w-full\"\n                >\n                  <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <h3 className=\"text-sm font-medium\">{domain.name}</h3>\n                        {recommendedDomainIds.includes(domain.id) && (\n                          <Badge\n                            variant=\"secondary\"\n                            className=\"flex items-center gap-1 rounded-full px-2.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide\"\n                            style={{\n                              backgroundColor: '#d87758',\n                              borderColor: '#d87758',\n                              color: '#ffffff',\n                            }}\n                          >\n                            <BadgeCheck className=\"h-3 w-3\" />\n                            Recommended\n                          </Badge>\n                        )}\n                      </div>\n                    <div className=\"flex items-center gap-3\">\n                      <span className=\"text-xs text-muted-foreground\">{domain.progress}%</span>\n                      <motion.div\n                        animate={{\n                          rotate: expandedDomains.includes(domain.id) ? 180 : 0,\n                        }}\n                        transition={{ duration: 0.2 }}\n                      >\n                        <ChevronDown size={16} />\n                      </motion.div>\n                    </div>\n                  </div>\n                  <Progress value={domain.progress} className=\"h-1\" />\n                </motion.div>\n              </button>\n\n              <AnimatePresence initial={false}>\n                {expandedDomains.includes(domain.id) && (\n                  <motion.div\n                    initial={{ height: 0, opacity: 0 }}\n                    animate={{ height: 'auto', opacity: 1 }}\n                    exit={{ height: 0, opacity: 0 }}\n                    transition={{\n                      duration: 0.3,\n                      ease: 'easeInOut',\n                      opacity: { duration: 0.2 },\n                    }}\n                    style={{ overflow: 'hidden' }}\n                  >\n                    <Separator />\n                    <CardContent className=\"pt-4 pb-4 space-y-3\">\n                      {domain.topics.map((topic) => {\n                        const isPriority = priorityTopicIds.includes(topic.id)\n                        const isFreeTopic =\n                          !isFreeTier ||\n                          (FREE_TOPICS_BY_DOMAIN[domain.id]?.includes(topic.name) ?? false)\n\n                        if (isFreeTopic) {\n                          return (\n                            <Link\n                              key={topic.name}\n                              href={`/topic-teacher?domain=${domain.id}&topic=${encodeURIComponent(topic.name)}`}\n                              className=\"block hover:opacity-75 transition-opacity\"\n                            >\n                              <div className=\"flex items-center justify-between mb-1\">\n                                <div className=\"flex items-center gap-2 flex-1\">\n                                  <span className=\"text-sm\">{topic.name}</span>\n                                  {isPriority && (\n                                    <Badge\n                                      variant=\"outline\"\n                                      className=\"text-xs flex items-center gap-1\"\n                                      style={{ backgroundColor: '#cbc9db20', color: '#cbc9db', borderColor: '#cbc9db' }}\n                                    >\n                                      <AlertCircle className=\"w-3 h-3\" />\n                                      Focus\n                                    </Badge>\n                                  )}\n                                </div>\n                                <span className=\"text-xs text-muted-foreground flex-shrink-0\">\n                                  {topic.progress}%\n                                </span>\n                              </div>\n                              <Progress value={topic.progress} className=\"h-1.5\" />\n                            </Link>\n                          )\n                        }\n\n                        // Locked (Pro-only) topic for free tier\n                        return (\n                          <div\n                            key={topic.name}\n                            className=\"block opacity-70 cursor-not-allowed\"\n                          >\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <div className=\"flex items-center gap-2 flex-1\">\n                                <span className=\"text-sm\">{topic.name}</span>\n                                <Badge\n                                  variant=\"outline\"\n                                  className=\"text-[10px] uppercase tracking-wide\"\n                                >\n                                  Pro\n                                </Badge>\n                              </div>\n                              <span className=\"text-xs text-muted-foreground flex-shrink-0\">\n                                {topic.progress}%\n                              </span>\n                            </div>\n                            <Progress value={topic.progress} className=\"h-1.5\" />\n                          </div>\n                        )\n                      })}\n                    </CardContent>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/app/topic-teacher/topic-teacher-content.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TypographyMuted' is defined but never used.","line":8,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizedTopicName' is assigned a value but never used.","line":69,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'allowAll' is assigned a value but never used.","line":89,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":89,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isRefreshingMetaphors' is assigned a value but never used.","line":101,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'interestsInput' is assigned a value but never used.","line":105,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":227,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8204,8207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8204,8207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8462,8465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8462,8465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":256,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":256,"endColumn":82},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'normalizeSections'. Either include it or remove the dependency array.","line":295,"column":6,"nodeType":"ArrayExpression","endLine":295,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [decodedTopic, hasExamResults, normalizeSections]","fix":{"range":[10662,10692],"text":"[decodedTopic, hasExamResults, normalizeSections]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initializeLesson'. Either include it or remove the dependency array.","line":302,"column":6,"nodeType":"ArrayExpression","endLine":302,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [topic, initialized, interestsLoaded, initializeLesson]","fix":{"range":[10831,10868],"text":"[topic, initialized, interestsLoaded, initializeLesson]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'baseContent', 'messages.length', 'previousUserInterests', and 'refreshMetaphors'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setMessages' needs the current value of 'baseContent'.","line":329,"column":6,"nodeType":"ArrayExpression","endLine":329,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [savedInterests, initialized, interestsLoaded, previousUserInterests, refreshMetaphors, baseContent, messages.length]","fix":{"range":[11728,11774],"text":"[savedInterests, initialized, interestsLoaded, previousUserInterests, refreshMetaphors, baseContent, messages.length]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState, useRef } from 'react'\nimport Link from 'next/link'\nimport { X } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { SimplePromptInput } from '@/components/ui/simple-prompt-input'\nimport { TypographyH1, TypographyH2, TypographyH3, TypographyMuted } from '@/components/ui/typography'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Kbd } from '@/components/ui/kbd'\nimport { Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb'\nimport { motion } from 'motion/react'\nimport { useSearchParams } from 'next/navigation'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { getUserCurrentInterest, updateUserCurrentInterest, subscribeToUserInterestChanges, unsubscribeFromInterestChanges } from '@/lib/interests'\nimport type { RealtimeChannel } from '@supabase/supabase-js'\nimport { useAuth } from '@/context/auth-context'\nimport { getQuizResults } from '@/lib/quiz-results-storage'\nimport { PulseSpinner } from '@/components/PulseSpinner'\nimport Lottie from 'lottie-react'\nimport textLoadingAnimation from '@/../../public/animations/text-loading.json'\n\ninterface Message {\n  role: 'user' | 'assistant'\n  content: string\n}\n\ninterface HighlightData {\n  recentlyWrongSections: string[]\n  recentlyCorrectSections: string[]\n  previouslyWrongNowCorrectSections: string[]\n  quizWrongSections: string[]\n  examWrongSections: string[]\n}\n\nconst GENERIC_SECTION_NAMES = new Set([\n  'main content',\n  'main concept',\n  'sub-concept',\n  'general overview',\n  'overview',\n  'topic overview',\n  'topic summary',\n  'full topic',\n  'entire topic',\n  'core content',\n  'whole topic',\n  'entire section',\n  'lesson overview',\n])\n\nexport function TopicTeacherContent() {\n  const searchParams = useSearchParams()\n  const { user, userProfile } = useAuth()\n  const domain = searchParams.get('domain')\n  const topic = searchParams.get('topic')\n  const hasExamResults = searchParams.get('hasExamResults') === 'true'\n  const decodeParam = (value: string | null): string => {\n    if (!value) return ''\n    try {\n      return decodeURIComponent(value)\n    } catch {\n      return value\n    }\n  }\n  const decodedTopic = decodeParam(topic)\n  const normalizedTopicName = decodedTopic ? decodedTopic.trim().toLowerCase() : ''\n\n  const normalizeSectionName = (section?: string | null): string | null => {\n    if (!section) return null\n    const trimmed = section.trim()\n    if (!trimmed) return null\n    const normalized = trimmed.toLowerCase()\n\n    // Drop truly generic labels from exam history; they aren't useful\n    if (GENERIC_SECTION_NAMES.has(normalized)) {\n      return null\n    }\n\n    return trimmed\n  }\n\n  const normalizeSections = (\n    sections?: string[],\n    options: { allowAll?: boolean } = {}\n  ): string[] => {\n    const { allowAll = true } = options\n    if (!sections || sections.length === 0) return []\n\n    const normalized = sections\n      .map((section) => normalizeSectionName(section))\n      .filter((section): section is string => Boolean(section))\n\n    return normalized\n  }\n\n  const [messages, setMessages] = useState<Message[]>([])\n  const [isLoading, setIsLoading] = useState(false)\n  const [isRefreshingMetaphors, setIsRefreshingMetaphors] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [initialized, setInitialized] = useState(false)\n  const [showInterestsModal, setShowInterestsModal] = useState(false)\n  const [interestsInput, setInterestsInput] = useState('')\n  const [currentInterestInput, setCurrentInterestInput] = useState('')\n  const [savedInterests, setSavedInterests] = useState<string[]>([])\n  const [userInterests, setUserInterests] = useState<string | null>(null)\n  const [previousUserInterests, setPreviousUserInterests] = useState<string | null>(null)\n  const [interestsLoaded, setInterestsLoaded] = useState(false)\n  const [baseContent, setBaseContent] = useState<string>('')\n  const [personalizedCache, setPersonalizedCache] = useState<Record<string, string>>({})\n  const [highlightData, setHighlightData] = useState<HighlightData>({\n    recentlyWrongSections: [],\n    recentlyCorrectSections: [],\n    previouslyWrongNowCorrectSections: [],\n    quizWrongSections: [],\n    examWrongSections: [],\n  })\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const currentSectionRef = useRef<string>('')\n  const subscriptionRef = useRef<RealtimeChannel | null>(null)\n\n  // Disabled auto-scroll - keep at top of page\n  // const scrollToBottom = () => {\n  //   messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  // }\n\n  // useEffect(() => {\n  //   scrollToBottom()\n  // }, [messages])\n\n  // Check for user interests on mount and subscribe to changes\n  useEffect(() => {\n    const loadUserInterest = async () => {\n      if (!user?.id) {\n        setShowInterestsModal(true)\n        setInterestsLoaded(true)\n        return\n      }\n\n      try {\n        let currentInterest = await getUserCurrentInterest(user.id)\n\n        // Fallback to localStorage if Supabase returns nothing\n        if (!currentInterest && typeof window !== 'undefined') {\n          currentInterest = localStorage.getItem(`interests_${user.id}`)\n        }\n\n        setUserInterests(currentInterest)\n\n        // If user already has an interest, pre-populate the inputs\n        if (currentInterest) {\n          setInterestsInput(currentInterest)\n          // Parse and display as saved interests\n          const interestsList = currentInterest\n            .split(',')\n            .map((i) => i.trim())\n            .filter((i) => i.length > 0)\n          setSavedInterests(interestsList)\n          setCurrentInterestInput('')\n        } else {\n          // Only show modal if user hasn't filled out interests yet\n          setShowInterestsModal(true)\n        }\n\n        // Subscribe to real-time interest changes\n        const channel = subscribeToUserInterestChanges(user.id, (newInterest) => {\n          setUserInterests(newInterest)\n          if (newInterest) {\n            setInterestsInput(newInterest)\n            // Also update localStorage and saved interests display\n            if (typeof window !== 'undefined') {\n              localStorage.setItem(`interests_${user.id}`, newInterest)\n            }\n            const interestsList = newInterest\n              .split(',')\n              .map((i) => i.trim())\n              .filter((i) => i.length > 0)\n            setSavedInterests(interestsList)\n            setCurrentInterestInput('')\n          }\n        })\n        subscriptionRef.current = channel\n      } catch (error) {\n        console.debug('Error loading user interest:', error)\n        setShowInterestsModal(true)\n      } finally {\n        // Mark interests as loaded regardless of outcome\n        setInterestsLoaded(true)\n      }\n    }\n\n    loadUserInterest()\n\n    // Clean up subscription on unmount\n    return () => {\n      if (subscriptionRef.current) {\n        unsubscribeFromInterestChanges(subscriptionRef.current)\n      }\n    }\n  }, [user?.id])\n\n  const formatSectionList = (sections: string[]) => {\n    if (!sections || sections.length === 0) return ''\n    return sections.includes('__ALL__') ? 'All sections' : sections.join('; ')\n  }\n\n  // Load quiz/exam results and compute highlight data\n  useEffect(() => {\n    if (decodedTopic) {\n      let allWrongSections: string[] = []\n      let allCorrectSections: string[] = []\n      let allPreviouslyWrongNowCorrect: string[] = []\n      let hasAnyResults = false\n      let quizWrongSections: string[] = []\n\n\t      // Always check for quiz results\n      const quizResults = getQuizResults(decodedTopic)\n      if (quizResults && quizResults.wrongAnswers && quizResults.wrongAnswers.length > 0) {\n        quizWrongSections = normalizeSections(\n          quizResults.wrongAnswers.flatMap((wa) => wa.relatedSections || []),\n          { allowAll: true }\n        )\n        const quizCorrectSections = normalizeSections(\n          quizResults.correctAnswers\n            .filter((ca) => !(ca as any).wasPreviouslyWrong)\n            .flatMap((ca) => ca.relatedSections || []),\n          { allowAll: false }\n        )\n        const quizPreviouslyWrongNowCorrect = normalizeSections(\n          quizResults.correctAnswers\n            .filter((ca) => (ca as any).wasPreviouslyWrong)\n            .flatMap((ca) => ca.relatedSections || []),\n          { allowAll: false }\n        )\n\n        if (quizWrongSections.length > 0) {\n          allWrongSections = [...allWrongSections, ...quizWrongSections]\n          hasAnyResults = true\n        }\n\n        if (quizCorrectSections.length > 0) {\n          allCorrectSections = [...allCorrectSections, ...quizCorrectSections]\n        }\n\n        if (quizPreviouslyWrongNowCorrect.length > 0) {\n          allPreviouslyWrongNowCorrect = [\n            ...allPreviouslyWrongNowCorrect,\n            ...quizPreviouslyWrongNowCorrect,\n          ]\n        }\n      }\n\n\t      // Always check for exam results (from diagnostic/practice exams)\n\t      const { getExamWrongSections } = require('@/lib/unified-question-results')\n\t      const examWrongSections = normalizeSections(\n\t        getExamWrongSections(decodedTopic),\n\t        { allowAll: true }\n\t      )\n\t      if (examWrongSections.length > 0) {\n\t        allWrongSections = [...allWrongSections, ...examWrongSections]\n\t        hasAnyResults = true\n      }\n\n      // If this topic was reached from exam-based recommendations but\n      // we don't have granular section data, treat the whole topic as\n      // needing review so the content is highlighted.\n      if (hasExamResults && !hasAnyResults) {\n        setHighlightData({\n          recentlyWrongSections: ['__ALL__'],\n          recentlyCorrectSections: [],\n          previouslyWrongNowCorrectSections: [],\n        })\n        return\n      }\n\n      // Set highlight data with combined results\n      if (hasAnyResults && allWrongSections.length > 0) {\n        const dedupedWrong = [...new Set(allWrongSections)]\n        const dedupedQuizWrong = [...new Set(quizWrongSections)]\n        const dedupedExamWrong = [...new Set(examWrongSections)]\n\n        setHighlightData({\n          recentlyWrongSections: dedupedWrong,\n          recentlyCorrectSections: [...new Set(allCorrectSections)],\n          previouslyWrongNowCorrectSections: [\n            ...new Set(allPreviouslyWrongNowCorrect),\n          ],\n          quizWrongSections: dedupedQuizWrong,\n          examWrongSections: dedupedExamWrong,\n        })\n      }\n    }\n  }, [decodedTopic, hasExamResults])\n\n  // Initialize with lesson\n  useEffect(() => {\n    if (!initialized && topic && interestsLoaded) {\n      initializeLesson()\n    }\n  }, [topic, initialized, interestsLoaded])\n\n  // Watch for interest changes and refresh metaphors\n  useEffect(() => {\n    if (!initialized || !interestsLoaded) return\n\n    // Check if interests actually changed\n    const currentInterestsStr = savedInterests.length > 0 ? savedInterests.join(', ') : null\n\n    if (currentInterestsStr !== previousUserInterests) {\n      // Interests changed - refresh metaphors\n      if (currentInterestsStr) {\n        console.log('Interests changed, refreshing metaphors:', currentInterestsStr)\n        refreshMetaphors(currentInterestsStr)\n      } else {\n        // User removed all interests - show base content\n        if (baseContent && messages.length > 0) {\n          setMessages([\n            {\n              role: 'assistant',\n              content: baseContent,\n            },\n          ])\n          setPreviousUserInterests(null)\n        }\n      }\n    }\n  }, [savedInterests, initialized, interestsLoaded])\n\n  const initializeLesson = async () => {\n    if (!topic) return\n    const subscriptionTier = userProfile?.subscription_tier ?? 'free'\n\n    try {\n      setIsLoading(true)\n      setError(null)\n\n      const response = await fetch('/api/topic-teacher', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          topic,\n          domain,\n          messageHistory: [],\n          isInitial: true,\n          userInterests,\n          subscriptionTier,\n        }),\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('API Error:', response.status, errorText)\n        throw new Error(`API Error (${response.status}): ${errorText || 'Unknown error'}`)\n      }\n\n      // Extract base content from response headers\n      const baseContentHeader = response.headers.get('X-Base-Content')\n      if (baseContentHeader) {\n        try {\n          // Decode from base64\n          const decodedBaseContent = atob(baseContentHeader)\n          setBaseContent(decodedBaseContent)\n          console.log('[Topic Teacher] âœ… Stored base content from API headers')\n        } catch (error) {\n          console.warn('[Topic Teacher] Failed to decode base content from headers:', error)\n        }\n      }\n\n      if (!response.body) {\n        throw new Error('No response body')\n      }\n\n      let lessonContent = ''\n      const reader = response.body.getReader()\n      const decoder = new TextDecoder()\n\n      while (true) {\n        const { done, value } = await reader.read()\n\n        if (done) break\n\n        const text = decoder.decode(value)\n        lessonContent += text\n      }\n\n      if (!lessonContent) {\n        throw new Error('No lesson content received from API')\n      }\n\n      setMessages([\n        {\n          role: 'assistant',\n          content: lessonContent,\n        },\n      ])\n      setInitialized(true)\n      setPreviousUserInterests(userInterests)\n    } catch (err) {\n      console.error('Error loading lesson:', err)\n      const errorMessage = err instanceof Error ? err.message : 'Failed to load lesson'\n      setError(errorMessage)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  // Refresh metaphors when interests change (after initial load)\n  const refreshMetaphors = async (newInterests: string) => {\n    if (!topic || !initialized) return\n    const subscriptionTier = userProfile?.subscription_tier ?? 'free'\n\n    // Create cache key from topic + interests\n    const cacheKey = `${topic}__${newInterests}`\n\n    // Check cache first\n    if (personalizedCache[cacheKey]) {\n      console.log('[Topic Teacher] âš¡ Using cached personalized content for:', newInterests)\n      setMessages([\n        {\n          role: 'assistant',\n          content: personalizedCache[cacheKey],\n        },\n      ])\n      setPreviousUserInterests(newInterests)\n      return\n    }\n\n    try {\n      setIsRefreshingMetaphors(true)\n      setError(null)\n\n      // First, show base content with loading placeholder immediately\n      const contentWithPlaceholder = baseContent + '\\n\\n[LOADING_METAPHORS]'\n      setMessages([\n        {\n          role: 'assistant',\n          content: contentWithPlaceholder,\n        },\n      ])\n\n      console.log('[Topic Teacher] ðŸ”„ Generating personalized metaphors for:', newInterests)\n      const startTime = Date.now()\n\n      const response = await fetch('/api/topic-teacher', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          topic,\n          domain,\n          messageHistory: [],\n          isInitial: true,\n          userInterests: newInterests,\n          subscriptionTier,\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to refresh metaphors')\n      }\n\n      if (!response.body) {\n        throw new Error('No response body')\n      }\n\n      let lessonContent = ''\n      const reader = response.body.getReader()\n      const decoder = new TextDecoder()\n\n      while (true) {\n        const { done, value} = await reader.read()\n\n        if (done) break\n\n        const text = decoder.decode(value)\n        lessonContent += text\n      }\n\n      const duration = Date.now() - startTime\n      console.log(`[Topic Teacher] âœ… Personalization complete in ${duration}ms`)\n\n      // Cache the personalized content\n      setPersonalizedCache(prev => ({\n        ...prev,\n        [cacheKey]: lessonContent\n      }))\n\n      // Update the lesson content with new metaphors\n      setMessages([\n        {\n          role: 'assistant',\n          content: lessonContent,\n        },\n      ])\n      setPreviousUserInterests(newInterests)\n    } catch (err) {\n      console.error('Error refreshing metaphors:', err)\n      setError(\n        err instanceof Error ? err.message : 'Failed to refresh metaphors'\n      )\n    } finally {\n      setIsRefreshingMetaphors(false)\n    }\n  }\n\n  const handleSendMessage = async (userMessage: string) => {\n    if (!userMessage.trim() || isLoading || !topic) return\n    const subscriptionTier = userProfile?.subscription_tier ?? 'free'\n\n    // Add user message immediately\n    setMessages((prev) => [...prev, { role: 'user', content: userMessage }])\n\n    try {\n      setIsLoading(true)\n      setError(null)\n\n      const response = await fetch('/api/topic-teacher', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          topic,\n          domain,\n          messageHistory: messages.map((m) => ({\n            role: m.role,\n            content: m.content,\n          })),\n          userMessage,\n          isInitial: false,\n          userInterests,\n          subscriptionTier,\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to get response')\n      }\n\n      if (!response.body) {\n        throw new Error('No response body')\n      }\n\n      let assistantMessage = ''\n      const reader = response.body.getReader()\n      const decoder = new TextDecoder()\n\n      while (true) {\n        const { done, value } = await reader.read()\n\n        if (done) break\n\n        const text = decoder.decode(value)\n        assistantMessage += text\n      }\n\n      setMessages((prev) => [\n        ...prev,\n        { role: 'assistant', content: assistantMessage },\n      ])\n    } catch (err) {\n      console.error('Error sending message:', err)\n      setError(\n        err instanceof Error ? err.message : 'Failed to send message'\n      )\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const normalizeLabel = (value: string): string => {\n    return value\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim()\n  }\n\n  const labelsMatch = (headerText: string, sectionName: string): boolean => {\n    const h = normalizeLabel(headerText)\n    const s = normalizeLabel(sectionName)\n    if (!h || !s) return false\n\n    if (h === s) return true\n    if (h.startsWith(s) || s.startsWith(h)) return true\n\n    return false\n  }\n\n  const getHighlightFlags = (text: string) => {\n    if (!text || text.trim().length === 0) {\n      return {\n        quizWrong: false,\n        examWrong: false,\n        recovered: false,\n        recentlyCorrect: false,\n      }\n    }\n\n    const quizWrong = highlightData.quizWrongSections.some((section) =>\n      labelsMatch(text, section)\n    )\n    const examWrong = highlightData.examWrongSections.some((section) =>\n      labelsMatch(text, section)\n    )\n    const recovered = highlightData.previouslyWrongNowCorrectSections.some((section) =>\n      labelsMatch(text, section)\n    )\n    const recentlyCorrect = highlightData.recentlyCorrectSections.some((section) =>\n      labelsMatch(text, section)\n    )\n\n    return {\n      quizWrong,\n      examWrong,\n      recovered,\n      recentlyCorrect,\n    }\n  }\n\n  if (!topic) {\n    return (\n      <main className=\"min-h-screen p-6 bg-background\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Breadcrumb className=\"mb-8\">\n            <BreadcrumbList>\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbLink href=\"/topic-selector\">Topics</BreadcrumbLink>\n              </BreadcrumbItem>\n              <BreadcrumbSeparator />\n              <BreadcrumbItem>\n                <BreadcrumbPage>Topic Teacher</BreadcrumbPage>\n              </BreadcrumbItem>\n            </BreadcrumbList>\n          </Breadcrumb>\n          <div className=\"text-center py-20\">\n            <h1 className=\"text-2xl font-bold mb-4\">No topic selected</h1>\n            <p className=\"text-muted-foreground mb-6\">\n              Please select a topic from Topics\n            </p>\n            <Link href=\"/topic-selector\">\n              <Button>Go to Topics</Button>\n            </Link>\n          </div>\n        </div>\n      </main>\n    )\n  }\n\n  return (\n    <main className=\"min-h-screen flex flex-col bg-background\">\n      <div className=\"flex-1 flex flex-col w-full mx-auto p-6 max-w-4xl\">\n        <Breadcrumb className=\"mb-6\">\n          <BreadcrumbList>\n            <BreadcrumbItem>\n              <BreadcrumbLink href=\"/dashboard\">Dashboard</BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbLink href=\"/topic-selector\">Topics</BreadcrumbLink>\n            </BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>{decodeURIComponent(topic)}</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n\n        <div className=\"mb-6\">\n          <TypographyH1>{decodeURIComponent(topic)}</TypographyH1>\n        </div>\n\n        {/* Interest Tags Input */}\n        <div className=\"mb-6 max-w-2xl\">\n          <div className=\"relative\">\n            <div className=\"flex flex-wrap items-center gap-2 p-2 pl-3 border border-input rounded-md bg-background focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2\">\n              {/* Display saved interests as tags */}\n              {savedInterests.map((interest, index) => (\n                <motion.div\n                  key={index}\n                  initial={{ opacity: 0, scale: 0.8 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  exit={{ opacity: 0, scale: 0.8 }}\n                  className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-primary text-primary-foreground text-sm font-medium\"\n                >\n                  <span>{interest}</span>\n                  <button\n                    onClick={() => {\n                      const newInterests = savedInterests.filter((_, i) => i !== index)\n                      setSavedInterests(newInterests)\n                      if (user?.id) {\n                        if (newInterests.length > 0) {\n                          updateUserCurrentInterest(user.id, newInterests.join(', '))\n                        }\n                      }\n                    }}\n                    className=\"hover:opacity-70 transition-opacity\"\n                    type=\"button\"\n                  >\n                    <X size={14} />\n                  </button>\n                </motion.div>\n              ))}\n\n              {/* Input field */}\n              <input\n                type=\"text\"\n                placeholder={savedInterests.length === 0 ? \"Add your interests/hobbies/fandoms...\" : \"Add another interest...\"}\n                value={currentInterestInput}\n                onChange={(e) => setCurrentInterestInput(e.target.value)}\n                onKeyPress={(e) => {\n                  if (e.key === 'Enter' && currentInterestInput.trim() && user?.id) {\n                    e.preventDefault()\n                    const newInterest = currentInterestInput.trim()\n                    const updatedInterests = [...savedInterests, newInterest]\n                    setSavedInterests(updatedInterests)\n                    setCurrentInterestInput('')\n                    updateUserCurrentInterest(user.id, updatedInterests.join(', '))\n                  }\n                }}\n                className=\"flex-1 min-w-[200px] bg-transparent outline-none text-sm\"\n              />\n\n              {/* Enter key indicator */}\n              {currentInterestInput.trim().length > 0 && (\n                <motion.div\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"flex items-center gap-1 text-xs text-muted-foreground ml-auto\"\n                >\n                  <Kbd className=\"text-xs px-1.5 py-0.5\">Enter</Kbd>\n                </motion.div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {error && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n          >\n            <Alert variant=\"destructive\" className=\"mb-4\">\n              <AlertDescription className=\"flex items-center justify-between\">\n                <span>{error}</span>\n                <Button\n                  onClick={initializeLesson}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"ml-4\"\n                >\n                  Retry\n                </Button>\n              </AlertDescription>\n            </Alert>\n          </motion.div>\n        )}\n\n        {highlightData.examWrongSections.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"mb-4\"\n          >\n            <p className=\"text-sm text-foreground/80\">\n              ðŸ Most recent practice exam\n              {highlightData.examWrongSections.length > 0\n                ? `: ${formatSectionList(highlightData.examWrongSections)}`\n                : ''}\n            </p>\n          </motion.div>\n        )}\n        {highlightData.quizWrongSections.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"mb-4\"\n          >\n            <p className=\"text-sm text-foreground/80\">\n              ðŸŽ Most recent quiz\n              {highlightData.quizWrongSections.length > 0\n                ? `: ${formatSectionList(highlightData.quizWrongSections)}`\n                : ''}\n            </p>\n          </motion.div>\n        )}\n\n        {/* Messages */}\n        <div className=\"flex-1 overflow-y-auto space-y-4 mb-6 rounded-lg p-4\">\n          {messages.length === 0 && !initialized && !isLoading && (\n            <div className=\"flex items-center justify-center h-full\">\n              <div className=\"text-center\">\n                <p className=\"text-muted-foreground animate-pulse\">\n                  Loading your lesson...\n                </p>\n              </div>\n            </div>\n          )}\n\n          {messages.map((message, idx) => {\n            return (\n              <motion.div\n                key={idx}\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.2 }}\n                className={`flex ${\n                  message.role === 'user'\n                    ? 'justify-end'\n                    : 'justify-start'\n                }`}\n              >\n                <div\n                  className={`px-4 py-3 rounded-lg ${\n                    message.role === 'user'\n                      ? 'bg-primary text-primary-foreground max-w-2xl'\n                      : 'text-foreground w-full'\n                  }`}\n                >\n                  {message.role === 'assistant' ? (\n                    <div className=\"text-base leading-relaxed max-w-none prose prose-invert\n                      [&_h1]:text-3xl [&_h1]:font-bold [&_h1]:leading-tight [&_h1:not(:first-child)]:mt-12 [&_h1:not(:first-child)]:mb-6\n                      [&_h2]:text-2xl [&_h2]:font-semibold [&_h2]:leading-snug [&_h2:not(:first-child)]:mb-4 [&_h2:not(:first-child)]:border-t [&_h2:not(:first-child)]:border-border/20 [&_h2:not(:first-child)]:pt-8 [&_h2:not(:first-child)]:mt-0\n                      [&_h3]:text-lg [&_h3]:font-semibold [&_h3]:leading-snug [&_h3:not(:first-child)]:mt-7 [&_h3:not(:first-child)]:mb-3\n                      [&_p]:my-4 [&_p]:text-base [&_p]:leading-relaxed [&_p]:text-foreground/90\n                      [&_ul]:my-5 [&_ul]:ml-5 [&_ul>li]:my-2.5 [&_ul>li]:text-base [&_ul>li]:leading-relaxed\n                      [&_ol]:my-5 [&_ol]:ml-5 [&_ol>li]:my-2.5 [&_ol>li]:text-base [&_ol>li]:leading-relaxed\n                      [&_a]:text-primary [&_a]:underline [&_a]:underline-offset-2 [&_a:hover]:text-primary/80 [&_a:hover]:no-underline\n                      [&_hr]:my-8 [&_hr]:border-border/30\n                      [&_img]:rounded-lg [&_img]:my-6 [&_img]:shadow-md\n                      [&_code]:bg-secondary/50 [&_code]:text-foreground [&_code]:px-1.5 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-sm [&_code]:font-mono\n                      [&_pre]:bg-secondary/30 [&_pre]:border [&_pre]:border-border/50 [&_pre]:p-4 [&_pre]:rounded-lg [&_pre]:overflow-x-auto [&_pre]:my-5 [&_pre_code]:bg-transparent [&_pre_code]:text-foreground\n                      [&_blockquote]:border-l-4 [&_blockquote]:border-primary/30 [&_blockquote]:pl-4 [&_blockquote]:italic [&_blockquote]:my-5 [&_blockquote]:text-foreground/80\n                      [&_table]:w-full [&_table]:border-collapse [&_table]:my-5 [&_table]:text-sm\n                      [&_th]:border [&_th]:border-border [&_th]:p-3 [&_th]:text-left [&_th]:font-semibold [&_th]:text-foreground\n                      [&_td]:border [&_td]:border-border [&_td]:p-3 [&_td]:text-foreground/90\">\n                      <ReactMarkdown\n                        remarkPlugins={[remarkGfm]}\n                        components={{\n                          p: ({ children }) => {\n                            // Check if this paragraph contains the loading placeholder\n                            const text = typeof children === 'string' ? children :\n                              Array.isArray(children) ? children.join('') : String(children)\n\n                            if (text.includes('[LOADING_METAPHORS]')) {\n                              return (\n                                <div className=\"flex flex-col items-center justify-center py-8 gap-3\">\n                                  <div className=\"w-24 h-24\">\n                                    <Lottie animationData={textLoadingAnimation} loop={true} />\n                                  </div>\n                                  <p className=\"text-sm text-muted-foreground\">Personalizing metaphors for your interests...</p>\n                                </div>\n                              )\n                            }\n                            return <p>{children}</p>\n                          },\n                          h1: ({ children }) => {\n                            let text = ''\n                            if (typeof children === 'string') {\n                              text = children\n                            } else if (Array.isArray(children)) {\n                              text = children\n                                .map((c) => {\n                                  if (typeof c === 'string') return c\n                                  if (c?.props?.children) {\n                                    if (typeof c.props.children === 'string') return c.props.children\n                                    if (Array.isArray(c.props.children)) {\n                                      return c.props.children.filter(x => typeof x === 'string').join('')\n                                    }\n                                  }\n                                  return ''\n                                })\n                                .join('')\n                            }\n\n                            // Skip if this h1 matches the topic name (avoid duplicate)\n                            const decodedTopic = topic ? decodeURIComponent(topic) : ''\n                            const normalizedText = text.trim().toLowerCase()\n                            const normalizedTopic = decodedTopic.trim().toLowerCase()\n                            if (normalizedText === normalizedTopic) {\n                              return null\n                            }\n\n                            return (\n                              <TypographyH1>\n                                {children}\n                              </TypographyH1>\n                            )\n                          },\n                          h2: ({ children }) => {\n                            let text = ''\n                            if (typeof children === 'string') {\n                              text = children\n                            } else if (Array.isArray(children)) {\n                              text = children\n                                .map((c) => {\n                                  if (typeof c === 'string') return c\n                                  if (c?.props?.children) {\n                                    if (typeof c.props.children === 'string') return c.props.children\n                                    if (Array.isArray(c.props.children)) {\n                                      return c.props.children.filter(x => typeof x === 'string').join('')\n                                    }\n                                  }\n                                  return ''\n                                })\n                                .join('')\n                            }\n\n                            currentSectionRef.current = text\n                            return (\n                              <TypographyH2>\n                                {children}\n                              </TypographyH2>\n                            )\n                          },\n                          h3: ({ children }) => {\n                            let text = ''\n                            if (typeof children === 'string') {\n                              text = children\n                            } else if (Array.isArray(children)) {\n                              text = children\n                                .map((c) => {\n                                  if (typeof c === 'string') return c\n                                  if (c?.props?.children) {\n                                    if (typeof c.props.children === 'string') return c.props.children\n                                    if (Array.isArray(c.props.children)) {\n                                      return c.props.children.filter(x => typeof x === 'string').join('')\n                                    }\n                                  }\n                                  return ''\n                                })\n                                .join('')\n                            }\n\n                            currentSectionRef.current = text\n                            return (\n                              <TypographyH3>\n                                {children}\n                              </TypographyH3>\n                            )\n                          },\n                          p: ({ children }) => {\n                            const { quizWrong, examWrong, recentlyCorrect, recovered } =\n                              getHighlightFlags(currentSectionRef.current)\n\n                            const showIcon = quizWrong || examWrong || recentlyCorrect || recovered\n                            const icons =\n                              (quizWrong ? 'ðŸŽ' : '') + (examWrong ? 'ðŸ' : '')\n\n                            return (\n                              <div className={`transition-colors ${showIcon ? 'relative pl-10' : ''}`}>\n                                {showIcon && (\n                                  <span className=\"absolute left-0 top-1 w-8 flex items-center justify-center text-base leading-none\">\n                                    {icons}\n                                  </span>\n                                )}\n                                <p className=\"m-0\">{children}</p>\n                              </div>\n                            )\n                          },\n                          ul: ({ children }) => {\n                            const { quizWrong, examWrong, recentlyCorrect, recovered } =\n                              getHighlightFlags(currentSectionRef.current)\n\n                            const showIcon = quizWrong || examWrong || recentlyCorrect || recovered\n                            const icons =\n                              (quizWrong ? 'ðŸŽ' : '') + (examWrong ? 'ðŸ' : '')\n                            return (\n                              <div className={`transition-colors ${showIcon ? 'relative pl-10' : ''}`}>\n                                {showIcon && (\n                                  <span className=\"absolute left-0 top-1 w-8 flex items-center justify-center text-base leading-none\">\n                                    {icons}\n                                  </span>\n                                )}\n                                <ul>{children}</ul>\n                              </div>\n                            )\n                          },\n                          ol: ({ children }) => {\n                            const { quizWrong, examWrong, recentlyCorrect, recovered } =\n                              getHighlightFlags(currentSectionRef.current)\n\n                            const showIcon = quizWrong || examWrong || recentlyCorrect || recovered\n                            const icons =\n                              (quizWrong ? 'ðŸŽ' : '') + (examWrong ? 'ðŸ' : '')\n                            return (\n                              <div className={`transition-colors ${showIcon ? 'relative pl-10' : ''}`}>\n                                {showIcon && (\n                                  <span className=\"absolute left-0 top-1 w-8 flex items-center justify-center text-base leading-none\">\n                                    {icons}\n                                  </span>\n                                )}\n                                <ol>{children}</ol>\n                              </div>\n                            )\n                          },\n                          thead: ({ children }) => {\n                            return (\n                              <thead>\n                                {children}\n                              </thead>\n                            )\n                          },\n                          th: ({ children }) => {\n                            return (\n                              <th className=\"border-b-2 border-border\">\n                                {children}\n                              </th>\n                            )\n                          },\n                        }}\n                      >\n                        {message.content}\n                      </ReactMarkdown>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm whitespace-pre-wrap leading-relaxed\">\n                      {message.content}\n                    </p>\n                  )}\n                </div>\n              </motion.div>\n            )\n          })}\n\n          {isLoading && <PulseSpinner message=\"Loading your lesson...\" fullScreen={false} />}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input */}\n        <div className=\"-mx-6 px-6 pl-12 pr-32\">\n          <SimplePromptInput\n            onSubmit={handleSendMessage}\n            placeholder=\"Ask a follow-up question...\"\n            isLoading={isLoading || !initialized}\n          />\n        </div>\n\n        {initialized && messages.length > 0 && (\n          <div className=\"mt-6 pt-4 border-t border-border -mx-6 px-6 pl-12 pr-32\">\n            <Link\n              href={`/quizzer?topic=${encodeURIComponent(decodedTopic)}${domain ? `&domain=${encodeURIComponent(domain)}` : ''}`}\n            >\n              <Button variant=\"minimal\" className=\"w-full\">\n                Take Quiz on This Topic â†’\n              </Button>\n            </Link>\n          </div>\n        )}\n\n        {/* Interests Modal - Only show if no interests saved */}\n        {savedInterests.length === 0 && (\n          <Dialog open={showInterestsModal} onOpenChange={setShowInterestsModal}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Tell us about your interests</DialogTitle>\n                <DialogDescription>\n                  Share your hobbies, fandoms, or interests so we can personalize your lessons with relevant examples.\n                </DialogDescription>\n              </DialogHeader>\n\n              {/* Interest Tags Input - Same as topic selector */}\n              <div className=\"relative\">\n                <div className=\"flex flex-wrap items-center gap-2 p-2 pl-3 border border-input rounded-md bg-background focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2\">\n                  {/* Display saved interests as tags */}\n                  {savedInterests.map((interest, index) => (\n                    <motion.div\n                      key={index}\n                      initial={{ opacity: 0, scale: 0.8 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                      exit={{ opacity: 0, scale: 0.8 }}\n                      className=\"flex items-center gap-1 px-2 py-1 rounded-full bg-primary text-primary-foreground text-sm font-medium\"\n                    >\n                      <span>{interest}</span>\n                      <button\n                        onClick={() => {\n                          const newInterests = savedInterests.filter((_, i) => i !== index)\n                          setSavedInterests(newInterests)\n                          if (user?.id && newInterests.length > 0) {\n                            updateUserCurrentInterest(user.id, newInterests.join(', '))\n                          }\n                        }}\n                        className=\"hover:opacity-70 transition-opacity\"\n                        type=\"button\"\n                      >\n                        <X size={14} />\n                      </button>\n                    </motion.div>\n                  ))}\n\n                  {/* Input field */}\n                  <input\n                    type=\"text\"\n                    placeholder={savedInterests.length === 0 ? \"Add your interests/hobbies/fandoms...\" : \"Add another interest...\"}\n                    value={currentInterestInput}\n                    onChange={(e) => setCurrentInterestInput(e.target.value)}\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter' && currentInterestInput.trim() && user?.id) {\n                        e.preventDefault()\n                        const newInterest = currentInterestInput.trim()\n                        const updatedInterests = [...savedInterests, newInterest]\n                        setSavedInterests(updatedInterests)\n                        setCurrentInterestInput('')\n                        updateUserCurrentInterest(user.id, updatedInterests.join(', '))\n                      }\n                    }}\n                    className=\"flex-1 min-w-[200px] bg-transparent outline-none text-sm\"\n                  />\n\n                  {/* Enter key indicator */}\n                  {currentInterestInput.trim().length > 0 && (\n                    <motion.div\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      className=\"flex items-center gap-1 text-xs text-muted-foreground ml-auto\"\n                    >\n                      <Kbd className=\"text-xs px-1.5 py-0.5\">Enter</Kbd>\n                    </motion.div>\n                  )}\n                </div>\n              </div>\n\n              <DialogFooter className=\"flex-col-reverse sm:flex-row gap-3 sm:gap-0\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setShowInterestsModal(false)\n                  }}\n                >\n                  Skip for now\n                </Button>\n                <Button\n                  onClick={() => {\n                    setShowInterestsModal(false)\n                  }}\n                  disabled={savedInterests.length === 0}\n                >\n                  Continue\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        )}\n      </div>\n    </main>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/expandable-domain-analysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DomainPerformance' is defined but never used.","line":10,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expandedDomains' is assigned a value but never used.","line":81,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleDomain' is assigned a value but never used.","line":91,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4904,4907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4904,4907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4953,4956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4953,4956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useMemo, useState } from 'react'\nimport { motion, AnimatePresence } from 'motion/react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Separator } from '@/components/ui/separator'\nimport { Badge } from '@/components/ui/badge'\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion'\nimport { CheckCircle2, XCircle, Circle } from 'lucide-react'\nimport type { DomainPerformance } from '@/lib/priority-calculator'\n\ninterface Question {\n  id: number\n  question: string\n  options: string[]\n  correct_answer: string\n  explanation?: string\n  domain: string\n  is_org_psych?: boolean\n  source_file?: string\n}\n\ninterface DomainResult {\n  domainNumber?: number\n  domainName: string\n  type?: string\n  percentageWrong: number\n  domainWeight: number\n  priorityScore: number\n  totalQuestionsInDomain?: number\n  totalWrongInDomain?: number\n}\n\ninterface ExpandableDomainAnalysisProps {\n  allResults: DomainResult[]\n  examQuestions: Question[]\n  selectedAnswers: Record<number, string>\n  orgPsychPerformance?: {\n    percentageWrong: number\n    priorityScore: number\n  }\n  title?: string | null\n  description?: string | null\n  showOnlyWrong?: boolean\n  showSourceFile?: boolean\n  // Optional scored-status map per question index to avoid recomputing\n  scoredStatusByIndex?: Record<number, 'correct' | 'wrong' | 'skipped'>\n}\n\nconst BRAND_COLORS = {\n  softSage: '#bdd1ca',\n  olive: '#788c5d',\n  coral: '#d87758',\n  dustyRose: '#c46685',\n  lavenderGray: '#cbc9db',\n  softBlue: '#6a9bcc',\n}\n\nexport function ExpandableDomainAnalysis({\n  allResults,\n  examQuestions,\n  selectedAnswers,\n  orgPsychPerformance,\n  title,\n  description,\n  showOnlyWrong = false,\n  showSourceFile = false,\n  scoredStatusByIndex,\n}: ExpandableDomainAnalysisProps) {\n  const resolvedTitle = title === undefined ? 'Domain Analysis' : title\n  const resolvedDescription =\n    description === undefined\n      ? 'Click on a domain to see all practice exam questions and your performance'\n      : description\n\n  const hasTitle = typeof resolvedTitle === 'string' && resolvedTitle.trim().length > 0\n  const hasDescription =\n    typeof resolvedDescription === 'string' && resolvedDescription.trim().length > 0\n  const shouldRenderHeader = hasTitle || hasDescription\n\n  const [expandedDomains, setExpandedDomains] = useState<string[]>([])\n\n  const questionIndexLookup = useMemo(() => {\n    const map = new Map<Question, number>()\n    examQuestions.forEach((question, index) => {\n      map.set(question, index)\n    })\n    return map\n  }, [examQuestions])\n\n  const toggleDomain = (domainName: string) => {\n    setExpandedDomains((prev) =>\n      prev.includes(domainName)\n        ? prev.filter((d) => d !== domainName)\n        : [...prev, domainName]\n    )\n  }\n\n  const getDomainQuestions = (domainName: string, domainNumber?: number): Question[] => {\n    return examQuestions.filter((q) => {\n      if (domainName === 'Organizational Psychology') {\n        return q.is_org_psych === true\n      }\n\n      if (!q.domain) return false\n\n      if (domainNumber) {\n        const match = q.domain.match(/Domain\\s*(\\d+)/i)\n        if (match && parseInt(match[1], 10) === domainNumber) {\n          return true\n        }\n      }\n\n      const normalizedName = domainName.split(': ')[1] || domainName\n      return q.domain.includes(normalizedName)\n    })\n  }\n\n  const getPriorityColor = (correctPct: number): string => {\n    if (correctPct >= 70) return BRAND_COLORS.softSage\n    if (correctPct >= 40) return BRAND_COLORS.olive\n    return BRAND_COLORS.coral\n  }\n\n  const getPriorityLabel = (correctPct: number): string => {\n    if (correctPct >= 70) return 'Low'\n    if (correctPct >= 40) return 'Medium'\n    return 'High'\n  }\n\n  const getSelectedAnswerForQuestion = (question: Question) => {\n    if (!question) return undefined\n\n    const index = questionIndexLookup.get(question)\n    if (typeof index !== 'undefined') {\n      return selectedAnswers[index]\n    }\n\n    if (typeof question.id !== 'undefined') {\n      const answerById = selectedAnswers[question.id]\n      if (typeof answerById !== 'undefined') {\n        return answerById\n      }\n\n      if (typeof question.id === 'number' && question.id > 0) {\n        const zeroBasedAnswer = selectedAnswers[question.id - 1]\n        if (typeof zeroBasedAnswer !== 'undefined') {\n          return zeroBasedAnswer\n        }\n      }\n    }\n\n    return undefined\n  }\n\n  const getQuestionStatus = (question: Question) => {\n    const index = questionIndexLookup.get(question)\n    if (typeof index === 'number' && scoredStatusByIndex && scoredStatusByIndex[index]) {\n      return scoredStatusByIndex[index]\n    }\n\n    const selectedAnswer = getSelectedAnswerForQuestion(question)\n    const isScored =\n      typeof question.isScored === 'boolean'\n        ? question.isScored\n        : typeof (question as any).scored === 'boolean'\n        ? (question as any).scored\n        : true\n\n    if (!isScored) return 'unscored'\n\n    if (!selectedAnswer || selectedAnswer === 'skipped') {\n      return 'skipped'\n    }\n\n    if (selectedAnswer === question.correct_answer) {\n      return 'correct'\n    }\n\n    return 'wrong'\n  }\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'correct':\n        return <CheckCircle2 size={16} className=\"text-green-600 flex-shrink-0\" />\n      case 'wrong':\n        return <XCircle size={16} className=\"text-red-600 flex-shrink-0\" />\n      case 'skipped':\n        return <Circle size={16} className=\"text-amber-600 flex-shrink-0\" />\n      case 'unscored':\n        return <Circle size={16} className=\"text-slate-500 flex-shrink-0\" />\n      default:\n        return null\n    }\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'correct':\n        return 'rgba(34, 197, 94, 0.05)'\n      case 'wrong':\n        return 'rgba(239, 68, 68, 0.05)'\n      case 'skipped':\n        return 'rgba(217, 119, 16, 0.05)'\n      case 'unscored':\n        return 'rgba(148, 163, 184, 0.08)'\n      default:\n        return 'transparent'\n    }\n  }\n\n  const getAnswerLabel = (question: Question, answer?: string) => {\n    if (!answer) return null\n    const optionIndex = question.options.findIndex((opt) => opt === answer)\n    if (optionIndex === -1) return answer\n    const optionLetter = String.fromCharCode(65 + optionIndex)\n    return `${optionLetter}. ${answer}`\n  }\n\n  const getStatusDisplay = (status: string) => {\n    switch (status) {\n      case 'correct':\n        return { label: 'Correct', color: 'text-green-600' }\n      case 'wrong':\n        return { label: 'Incorrect', color: 'text-red-600' }\n      case 'skipped':\n        return { label: 'Skipped', color: 'text-amber-600' }\n      case 'unscored':\n        return { label: 'Unscored', color: 'text-muted-foreground' }\n      default:\n        return { label: 'Unknown', color: 'text-muted-foreground' }\n    }\n  }\n\n  return (\n    <Card>\n      {shouldRenderHeader && (\n        <>\n          <CardHeader>\n            {hasTitle && <CardTitle className=\"text-2xl\">{resolvedTitle}</CardTitle>}\n            {hasDescription && <CardDescription>{resolvedDescription}</CardDescription>}\n          </CardHeader>\n          <Separator />\n        </>\n      )}\n      <CardContent className=\"pt-6\">\n        <Accordion type=\"single\" collapsible className=\"w-full\">\n          {/* Regular Domains */}\n          {allResults\n            .filter((domain) => domain.domainNumber !== undefined)\n            .map((domain) => {\n              const domainQuestions = getDomainQuestions(domain.domainName, domain.domainNumber)\n              const calculatedTotal = domain.totalQuestionsInDomain ?? 0\n              const calculatedWrong = domain.totalWrongInDomain ?? 0\n\n              // Fallback to question-based counts only if calculator data is missing\n              const totalInDomain =\n                calculatedTotal > 0 ? calculatedTotal : domainQuestions.length\n              const wrongInDomain =\n                calculatedTotal > 0\n                  ? calculatedWrong\n                  : domainQuestions.filter(\n                (q) => getQuestionStatus(q) !== 'correct'\n              ).length\n              const correctInDomain = totalInDomain - wrongInDomain\n              const correctPct = totalInDomain > 0 ? Math.round((correctInDomain / totalInDomain) * 100) : 0\n              const wrongPct = totalInDomain > 0 ? 100 - correctPct : 0\n              const priorityColor = getPriorityColor(correctPct)\n              const priorityLabel = getPriorityLabel(correctPct)\n\n              return (\n                <AccordionItem key={domain.domainName} value={domain.domainName}>\n                  <AccordionTrigger className=\"hover:no-underline\">\n                    <div className=\"flex items-center justify-between w-full mr-4\">\n                      <div className=\"flex items-center gap-4 flex-1\">\n                        <div className=\"text-left\">\n                          <div className=\"font-semibold\">\n                            {domain.domainName.split(': ')[1] || domain.domainName}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {correctInDomain}/{totalInDomain} correct ({correctPct}%)\n                          </div>\n                        </div>\n                      </div>\n                      <Badge style={{ backgroundColor: priorityColor, color: '#ffffff', borderColor: priorityColor }}>\n                        {priorityLabel}\n                      </Badge>\n                    </div>\n                  </AccordionTrigger>\n                  <AccordionContent>\n                    <div className=\"space-y-3 pt-4\">\n                      <div className=\"grid grid-cols-2 gap-4 mb-6 p-4 bg-muted/50 rounded-lg\">\n                        <div>\n                          <div className=\"text-sm text-muted-foreground\">Performance</div>\n                          <div className=\"text-2xl font-bold\">{correctPct}%</div>\n                        </div>\n                        <div>\n                          <div className=\"text-sm text-muted-foreground\">Weight</div>\n                          <div className=\"text-2xl font-bold\">{Math.round(domain.domainWeight * 100)}%</div>\n                        </div>\n                        <div>\n                          <div className=\"text-sm text-muted-foreground\">% Wrong</div>\n                          <div className=\"text-2xl font-bold\">{wrongPct}%</div>\n                        </div>\n                        <div>\n                          <div className=\"text-sm text-muted-foreground\">Priority Score</div>\n                          <div className=\"text-2xl font-bold\">{domain.priorityScore.toFixed(2)}</div>\n                        </div>\n                      </div>\n\n                      {/* Questions List - Nested Accordion */}\n                      <Accordion type=\"single\" collapsible className=\"w-full space-y-2\">\n                        {domainQuestions.length === 0 && (\n                          <p className=\"text-sm text-muted-foreground px-3 py-2 rounded border border-dashed border-border\">\n                            No questions from this exam were tagged to this domain.\n                          </p>\n                        )}\n                        {domainQuestions\n                          .filter((question) => {\n                            if (!showOnlyWrong) return true\n                            const status = getQuestionStatus(question)\n                            return status === 'wrong' || status === 'skipped'\n                          })\n                          .map((question, idx) => {\n                          const status = getQuestionStatus(question)\n                          const selectedAnswer = getSelectedAnswerForQuestion(question)\n                          const selectedAnswerLabel = getAnswerLabel(question, selectedAnswer)\n                          const correctAnswerLabel = getAnswerLabel(question, question.correct_answer)\n                          const statusDisplay = getStatusDisplay(status)\n\n                          return (\n                            <motion.div\n                              key={question.id}\n                              initial={{ opacity: 0, x: -10 }}\n                              animate={{ opacity: 1, x: 0 }}\n                              transition={{ delay: idx * 0.05 }}\n                            >\n                              <AccordionItem\n                                value={`q-${question.id}`}\n                                className=\"border border-border rounded-lg\"\n                                style={{ backgroundColor: getStatusColor(status) }}\n                              >\n                                <AccordionTrigger className=\"hover:no-underline px-3 py-2\">\n                                  <div className=\"flex items-start gap-3 flex-1\">\n                                    {getStatusIcon(status)}\n                                    <div className=\"flex-1 min-w-0 text-left\">\n                                      <div className=\"font-medium text-sm\">\n                                        Q{question.id}: {question.question.substring(0, 60)}\n                                        {question.question.length > 60 ? '...' : ''}\n                                      </div>\n                                    </div>\n                                  </div>\n                                </AccordionTrigger>\n                                <AccordionContent className=\"px-3 pb-3\">\n                                  <div className=\"space-y-4\">\n                                    {/* Full Question */}\n                                    <div>\n                                      <h4 className=\"font-semibold text-sm mb-2\">Question</h4>\n                                      <p className=\"text-sm text-foreground\">{question.question}</p>\n                                    </div>\n\n                                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-muted/30 rounded-lg\">\n                                      <div>\n                                        <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Your Answer</div>\n                                        <div\n                                          className={`font-semibold mt-1 ${\n                                            status === 'correct'\n                                              ? 'text-green-600'\n                                              : status === 'skipped'\n                                                ? 'text-muted-foreground'\n                                                : 'text-red-600'\n                                          }`}\n                                        >\n                                          {selectedAnswerLabel || 'Skipped'}\n                                        </div>\n                                      </div>\n                                      <div>\n                                        <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Correct Answer</div>\n                                        <div className=\"font-semibold mt-1 text-green-700\">\n                                          {correctAnswerLabel || question.correct_answer}\n                                        </div>\n                                      </div>\n                                      <div>\n                                        <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Result</div>\n                                        <div className={`font-semibold mt-1 ${statusDisplay.color}`}>\n                                          {statusDisplay.label}\n                                        </div>\n                                      </div>\n                                    </div>\n\n                                    {/* All Options */}\n                                    <div>\n                                      <h4 className=\"font-semibold text-sm mb-2\">Options</h4>\n                                      <div className=\"space-y-1\">\n                                        {question.options.map((option, optIdx) => {\n                                          const isCorrect = option === question.correct_answer\n                                          const isSelected = selectedAnswer === option\n                                          const optionLetter = String.fromCharCode(65 + optIdx)\n\n                                          return (\n                                            <div\n                                              key={optIdx}\n                                              className={`text-sm p-2 rounded flex items-start gap-2 ${\n                                                isCorrect ? 'bg-green-100/50 text-green-900' : ''\n                                              } ${\n                                                isSelected && !isCorrect\n                                                  ? 'bg-red-100/50 text-red-900'\n                                                  : ''\n                                              }`}\n                                            >\n                                              <span className=\"font-semibold flex-shrink-0\">{optionLetter}.</span>\n                                              <span className=\"break-words\">\n                                                {option}\n                                                {isCorrect && <span className=\"font-semibold ml-2\">âœ“ Correct</span>}\n                                                {isSelected && !isCorrect && (\n                                                  <span className=\"font-semibold ml-2\">âœ— Your answer</span>\n                                                )}\n                                              </span>\n                                            </div>\n                                          )\n                                        })}\n                                      </div>\n                                    </div>\n\n                                    {/* Explanation or Source File */}\n                                    {showSourceFile && question.source_file ? (\n                                      <div>\n                                        <h4 className=\"font-semibold text-sm mb-2\">Source File</h4>\n                                        <p className=\"text-sm text-foreground bg-muted/50 p-3 rounded\">\n                                          {question.source_file}\n                                        </p>\n                                      </div>\n                                    ) : question.explanation ? (\n                                      <div>\n                                        <h4 className=\"font-semibold text-sm mb-2\">Explanation</h4>\n                                        <p className=\"text-sm text-foreground bg-muted/50 p-3 rounded\">\n                                          {question.explanation}\n                                        </p>\n                                      </div>\n                                    ) : null}\n                                  </div>\n                                </AccordionContent>\n                              </AccordionItem>\n                            </motion.div>\n                          )\n                        })}\n                      </Accordion>\n                    </div>\n                  </AccordionContent>\n                </AccordionItem>\n              )\n            })}\n\n          {/* Organizational Psychology */}\n          {orgPsychPerformance && (() => {\n            const orgQuestions = getDomainQuestions('Organizational Psychology')\n            const wrongCount = orgQuestions.filter(\n              (q) => getQuestionStatus(q) !== 'correct'\n            ).length\n            const correctCount = orgQuestions.length - wrongCount\n\n            return (\n              <AccordionItem value=\"Organizational Psychology\">\n                <AccordionTrigger className=\"hover:no-underline\">\n                  <div className=\"flex items-center justify-between w-full mr-4\">\n                    <div className=\"flex items-center gap-4 flex-1\">\n                      <div className=\"text-left\">\n                        <div className=\"font-semibold\">Organizational Psychology</div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {`${correctCount}/${orgQuestions.length} correct (${\n                            orgQuestions.length > 0\n                              ? Math.round((correctCount / orgQuestions.length) * 100)\n                              : 0\n                          }%)`}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Badge\n                        style={{\n                          backgroundColor: getPriorityColor(\n                            Math.round(\n                              (1 - (orgPsychPerformance.percentageWrong || 0) / 100) * 100\n                            )\n                          ),\n                          color: '#ffffff',\n                          borderColor: getPriorityColor(\n                            Math.round(\n                              (1 - (orgPsychPerformance.percentageWrong || 0) / 100) * 100\n                            )\n                          ),\n                        }}\n                      >\n                        {getPriorityLabel(\n                          Math.round(\n                            (1 - (orgPsychPerformance.percentageWrong || 0) / 100) * 100\n                          )\n                        )}\n                      </Badge>\n                    </div>\n                  </div>\n                </AccordionTrigger>\n                <AccordionContent>\n                  <div className=\"space-y-3 pt-4\">\n                    <div className=\"grid grid-cols-2 gap-4 mb-6 p-4 bg-muted/50 rounded-lg\">\n                      <div>\n                        <div className=\"text-sm text-muted-foreground\">Performance</div>\n                        <div className=\"text-2xl font-bold\">\n                          {Math.round(\n                            (1 - (orgPsychPerformance.percentageWrong || 0) / 100) * 100\n                          )}\n                          %\n                        </div>\n                      </div>\n                      <div>\n                        <div className=\"text-sm text-muted-foreground\">Weight</div>\n                        <div className=\"text-2xl font-bold\">21%</div>\n                      </div>\n                      <div>\n                        <div className=\"text-sm text-muted-foreground\">% Wrong</div>\n                        <div className=\"text-2xl font-bold\">\n                          {(orgPsychPerformance.percentageWrong || 0).toFixed(1)}%\n                        </div>\n                      </div>\n                      <div>\n                        <div className=\"text-sm text-muted-foreground\">Priority Score</div>\n                        <div className=\"text-2xl font-bold\">\n                          {(orgPsychPerformance.priorityScore || 0).toFixed(2)}\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Organizational Psychology Questions List - Nested Accordion */}\n                    <Accordion type=\"single\" collapsible className=\"w-full space-y-2\">\n                      {orgQuestions.length === 0 && (\n                        <p className=\"text-sm text-muted-foreground px-3 py-2 rounded border border-dashed border-border\">\n                          No org psych questions were included in this exam.\n                        </p>\n                      )}\n                      {orgQuestions\n                        .filter((question) => {\n                          if (!showOnlyWrong) return true\n                          const status = getQuestionStatus(question)\n                          return status === 'wrong' || status === 'skipped'\n                        })\n                        .map((question, idx) => {\n                        const status = getQuestionStatus(question)\n                        const selectedAnswer = getSelectedAnswerForQuestion(question)\n                        const selectedAnswerLabel = getAnswerLabel(question, selectedAnswer)\n                        const correctAnswerLabel = getAnswerLabel(question, question.correct_answer)\n                        const statusDisplay = getStatusDisplay(status)\n\n                        return (\n                          <motion.div\n                            key={question.id}\n                            initial={{ opacity: 0, x: -10 }}\n                            animate={{ opacity: 1, x: 0 }}\n                            transition={{ delay: idx * 0.05 }}\n                          >\n                            <AccordionItem\n                              value={`org-q-${question.id}`}\n                              className=\"border border-border rounded-lg\"\n                              style={{ backgroundColor: getStatusColor(status) }}\n                            >\n                              <AccordionTrigger className=\"hover:no-underline px-3 py-2\">\n                                <div className=\"flex items-start gap-3 flex-1\">\n                                  {getStatusIcon(status)}\n                                  <div className=\"flex-1 min-w-0 text-left\">\n                                    <div className=\"font-medium text-sm\">\n                                      Q{question.id}: {question.question.substring(0, 60)}\n                                      {question.question.length > 60 ? '...' : ''}\n                                    </div>\n                                  </div>\n                                </div>\n                              </AccordionTrigger>\n                              <AccordionContent className=\"px-3 pb-3\">\n                                <div className=\"space-y-4\">\n                                  {/* Full Question */}\n                                  <div>\n                                    <h4 className=\"font-semibold text-sm mb-2\">Question</h4>\n                                    <p className=\"text-sm text-foreground\">{question.question}</p>\n                                  </div>\n\n                                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-muted/30 rounded-lg\">\n                                    <div>\n                                      <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Your Answer</div>\n                                      <div\n                                        className={`font-semibold mt-1 ${\n                                          status === 'correct'\n                                            ? 'text-green-600'\n                                            : status === 'skipped'\n                                              ? 'text-muted-foreground'\n                                              : 'text-red-600'\n                                        }`}\n                                      >\n                                        {selectedAnswerLabel || 'Skipped'}\n                                      </div>\n                                    </div>\n                                    <div>\n                                      <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Correct Answer</div>\n                                      <div className=\"font-semibold mt-1 text-green-700\">\n                                        {correctAnswerLabel || question.correct_answer}\n                                      </div>\n                                    </div>\n                                    <div>\n                                      <div className=\"text-xs uppercase tracking-wide text-muted-foreground\">Result</div>\n                                      <div className={`font-semibold mt-1 ${statusDisplay.color}`}>\n                                        {statusDisplay.label}\n                                      </div>\n                                    </div>\n                                  </div>\n\n                                  {/* All Options */}\n                                  <div>\n                                    <h4 className=\"font-semibold text-sm mb-2\">Options</h4>\n                                    <div className=\"space-y-1\">\n                                      {question.options.map((option, optIdx) => {\n                                        const isCorrect = option === question.correct_answer\n                                        const isSelected = selectedAnswer === option\n                                        const optionLetter = String.fromCharCode(65 + optIdx)\n\n                                        return (\n                                          <div\n                                            key={optIdx}\n                                            className={`text-sm p-2 rounded flex items-start gap-2 ${\n                                              isCorrect ? 'bg-green-100/50 text-green-900' : ''\n                                            } ${\n                                              isSelected && !isCorrect\n                                                ? 'bg-red-100/50 text-red-900'\n                                                : ''\n                                            }`}\n                                          >\n                                            <span className=\"font-semibold flex-shrink-0\">\n                                              {optionLetter}.\n                                            </span>\n                                            <span className=\"break-words\">\n                                              {option}\n                                              {isCorrect && (\n                                                <span className=\"font-semibold ml-2\">âœ“ Correct</span>\n                                              )}\n                                              {isSelected && !isCorrect && (\n                                                <span className=\"font-semibold ml-2\">\n                                                  âœ— Your answer\n                                                </span>\n                                              )}\n                                            </span>\n                                          </div>\n                                        )\n                                      })}\n                                    </div>\n                                  </div>\n\n                                  {/* Explanation or Source File */}\n                                  {showSourceFile && question.source_file ? (\n                                    <div>\n                                      <h4 className=\"font-semibold text-sm mb-2\">Source File</h4>\n                                      <p className=\"text-sm text-foreground bg-muted/50 p-3 rounded\">\n                                        {question.source_file}\n                                      </p>\n                                    </div>\n                                  ) : question.explanation ? (\n                                    <div>\n                                      <h4 className=\"font-semibold text-sm mb-2\">Explanation</h4>\n                                      <p className=\"text-sm text-foreground bg-muted/50 p-3 rounded\">\n                                        {question.explanation}\n                                      </p>\n                                    </div>\n                                  ) : null}\n                                </div>\n                              </AccordionContent>\n                            </AccordionItem>\n                          </motion.div>\n                        )\n                      })}\n                    </Accordion>\n                  </div>\n                </AccordionContent>\n              </AccordionItem>\n            )\n          })()}\n        </Accordion>\n      </CardContent>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/fourth-bento-animation.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":73,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I&apos;m panicking. I'm scrolling on insta. \n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I&lsquo;m panicking. I'm scrolling on insta. \n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I&#39;m panicking. I'm scrolling on insta. \n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I&rsquo;m panicking. I'm scrolling on insta. \n            "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":73,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I'm panicking. I&apos;m scrolling on insta. \n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I'm panicking. I&lsquo;m scrolling on insta. \n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I'm panicking. I&#39;m scrolling on insta. \n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2126,2215],"text":"\n              My exam is in a week. I'm panicking. I&rsquo;m scrolling on insta. \n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":77,"column":13,"nodeType":"JSXOpeningElement","endLine":81,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @next/next/no-img-element */\n\"use client\";\n\nimport {\n  Reasoning,\n  ReasoningContent,\n  ReasoningResponse,\n} from \"@/components/ui/reasoning\";\nimport { AnimatePresence, motion, useInView } from \"motion/react\";\nimport Image from \"next/image\";\nimport { useEffect, useRef, useState } from \"react\";\n\nexport function ReasoningBasic() {\n  const reasoningText = `Itâ€™s okay to feel worried, tired, and bored. Can notice thoughts while still moving forward. What will it mean for you to say you passed?`;\n\n  return (\n    <Reasoning>\n      <ReasoningContent className=\"\">\n        <ReasoningResponse text={reasoningText} />\n      </ReasoningContent>\n    </Reasoning>\n  );\n}\n\nexport function FourthBentoAnimation() {\n  const ref = useRef(null);\n  const isInView = useInView(ref);\n  const [shouldAnimate, setShouldAnimate] = useState(false);\n\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout;\n    if (isInView) {\n      timeoutId = setTimeout(() => {\n        setShouldAnimate(true);\n      }, 1000);\n    } else {\n      setShouldAnimate(false);\n    }\n\n    return () => {\n      if (timeoutId) clearTimeout(timeoutId);\n    };\n  }, [isInView]);\n\n  return (\n    <div\n      ref={ref}\n      className=\"w-full h-full p-4 flex flex-col items-center justify-center gap-5\"\n    >\n      <div className=\"pointer-events-none absolute bottom-0 left-0 h-20 w-full bg-gradient-to-t from-background to-transparent z-20\"></div>\n      <motion.div\n        className=\"max-w-md mx-auto w-full flex flex-col gap-2\"\n        animate={{\n          y: shouldAnimate ? -75 : 0,\n        }}\n        transition={{\n          type: \"spring\",\n          stiffness: 300,\n          damping: 20,\n        }}\n      >\n        <div className=\"flex items-end justify-end gap-3\">\n          <motion.div\n            className=\"max-w-[280px] brand-dusty-rose-bg text-white p-4 rounded-2xl ml-auto shadow-[0_0_10px_rgba(0,0,0,0.05)]\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{\n              duration: 0.3,\n              ease: \"easeOut\",\n            }}\n          >\n            <p className=\"text-sm\">\n              My exam is in a week. I'm panicking. I'm scrolling on insta. \n            </p>\n          </motion.div>\n          <div className=\"flex items-center bg-background rounded-full w-fit border border-border flex-shrink-0\">\n            <img\n              src=\"https://randomuser.me/api/portraits/women/79.jpg\"\n              alt=\"User Avatar\"\n              className=\"size-8 rounded-full flex-shrink-0\"\n            />\n          </div>\n        </div>\n        <div className=\"flex items-start gap-2\">\n          <div className=\"flex items-center bg-background rounded-full size-10 flex-shrink-0 justify-center shadow-[0_0_10px_rgba(0,0,0,0.05)] border border-border\">\n            <Image\n              src=\"/images/logo.png\"\n              alt=\"Logo\"\n              width={16}\n              height={16}\n              className=\"size-4 invert dark:invert-0\"\n            />\n          </div>\n\n          <div className=\"relative\">\n            <AnimatePresence mode=\"wait\">\n              {!shouldAnimate ? (\n                <motion.div\n                  key=\"dots\"\n                  className=\"absolute left-0 top-0 bg-background p-4 rounded-2xl border border-border\"\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  exit={{ opacity: 0, x: -10 }}\n                  transition={{\n                    duration: 0.2,\n                    ease: \"easeOut\",\n                  }}\n                >\n                  <div className=\"flex gap-1\">\n                    {[0, 1, 2].map((index) => (\n                      <motion.div\n                        key={index}\n                        className=\"w-2 h-2 bg-primary/50 rounded-full\"\n                        animate={{ y: [0, -5, 0] }}\n                        transition={{\n                          duration: 0.6,\n                          repeat: Infinity,\n                          delay: index * 0.2,\n                          ease: \"easeInOut\",\n                        }}\n                      />\n                    ))}\n                  </div>\n                </motion.div>\n              ) : (\n                <motion.div\n                  key=\"response\"\n                  layout\n                  className=\"absolute left-0 top-0 md:min-w-[300px] min-w-[220px] p-4 bg-accent border border-border rounded-xl shadow-[0_0_10px_rgba(0,0,0,0.05)]\"\n                  initial={{ opacity: 0, x: 10 }}\n                  animate={{\n                    opacity: 1,\n                    x: 0,\n                  }}\n                  exit={{ opacity: 0, x: 20 }}\n                  transition={{\n                    duration: 0.3,\n                    ease: \"easeOut\",\n                  }}\n                >\n                  <ReasoningBasic />\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </motion.div>\n    </div>\n  );\n\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/project-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'video' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":8},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":35,"column":11,"nodeType":"JSXOpeningElement","endLine":39,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowRight } from \"lucide-react\";\nimport { motion } from \"motion/react\";\n\ninterface ProjectCardProps {\n  href?: string;\n  title: string;\n  description: string;\n  dates?: string;\n  tags?: string[];\n  image?: string;\n  video?: string;\n  links?: Array<{\n    icon?: React.ReactNode;\n    title: string;\n    href: string;\n  }>;\n}\n\nexport const ProjectCard = ({\n  href,\n  title,\n  description,\n  dates,\n  tags,\n  image,\n  video,\n  links,\n}: ProjectCardProps) => {\n  return (\n    <Link href={href || \"#\"}>\n      <div className=\"group relative overflow-hidden rounded-lg border border-border/50 bg-gradient-to-br from-secondary/30 to-secondary/10 backdrop-blur-sm p-4 hover:border-primary/40 hover:shadow-lg transition-all duration-300 cursor-pointer\">\n        {image && (\n          <img\n            src={image}\n            alt={title}\n            className=\"h-40 w-full rounded-lg object-cover mb-4\"\n          />\n        )}\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"font-semibold text-lg group-hover:text-primary transition-colors\">\n                {title}\n              </h3>\n              {dates && <span className=\"text-xs text-muted-foreground whitespace-nowrap ml-2\">{dates}</span>}\n            </div>\n            <p className=\"mt-2 text-sm text-muted-foreground\">{description}</p>\n            {tags && tags.length > 0 && (\n              <div className=\"mt-3 flex flex-wrap gap-1\">\n                {tags.map((tag) => (\n                  <Badge key={tag} variant=\"secondary\" className=\"px-2 py-1 text-xs\">\n                    {tag}\n                  </Badge>\n                ))}\n              </div>\n            )}\n            {links && links.length > 0 && (\n              <div className=\"mt-4 flex flex-wrap gap-2\">\n                {links.map((link) => (\n                  <Link\n                    key={link.title}\n                    href={link.href}\n                    target=\"_blank\"\n                    className=\"flex items-center gap-1 text-xs text-primary hover:underline\"\n                  >\n                    {link.title}\n                    <ArrowRight size={12} />\n                  </Link>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </Link>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/resume-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":29,"column":9,"nodeType":"JSXOpeningElement","endLine":33,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { motion } from \"motion/react\";\n\ninterface ResumeCardProps {\n  logoUrl?: string;\n  altText?: string;\n  title: string;\n  subtitle?: string;\n  href?: string;\n  badges?: string[];\n  period?: string;\n  description?: string;\n}\n\nexport const ResumeCard = ({\n  logoUrl,\n  altText,\n  title,\n  subtitle,\n  href,\n  badges,\n  period,\n  description,\n}: ResumeCardProps) => {\n  const content = (\n    <div className=\"flex items-center gap-4\">\n      {logoUrl && (\n        <img\n          src={logoUrl}\n          alt={altText}\n          className=\"relative h-12 w-12 rounded-md object-cover\"\n        />\n      )}\n      <div className=\"flex-1\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"font-semibold leading-none\">{title}</h3>\n          {period && <span className=\"text-sm text-muted-foreground\">{period}</span>}\n        </div>\n        {subtitle && <p className=\"text-sm text-muted-foreground\">{subtitle}</p>}\n        {description && (\n          <p className=\"mt-2 text-sm text-muted-foreground whitespace-pre-line\">{description}</p>\n        )}\n        {badges && badges.length > 0 && (\n          <div className=\"mt-2 flex flex-wrap gap-1\">\n            {badges.map((badge) => (\n              <Badge key={badge} variant=\"secondary\" className=\"px-1 py-0 text-xs\">\n                {badge}\n              </Badge>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  if (href) {\n    return (\n      <Link href={href} target=\"_blank\">\n        {content}\n      </Link>\n    );\n  }\n\n  return content;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/sections/company-showcase.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":24,"column":15,"nodeType":"JSXOpeningElement","endLine":33,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { siteConfig } from \"@/lib/config\"\nimport { ArrowRight } from \"lucide-react\"\nimport Link from \"next/link\"\n\nexport function CompanyShowcase() {\n  const { companyShowcase } = siteConfig\n  return (\n    <section id=\"company\" className=\"flex flex-col items-center justify-center gap-10 py-10 pt-20 w-full relative px-6\">\n      <p className=\"text-center text-muted-foreground font-medium md:text-left\">{companyShowcase.title}</p>\n\n      <div className=\"grid w-full max-w-7xl grid-cols-2 md:grid-cols-4 overflow-hidden border-y border-border items-center justify-center z-20\">\n        {companyShowcase.companyLogos.map((logo: { id: number; name: string; src: string }) => (\n          <Link\n            href=\"/portfolio\"\n            key={logo.id}\n            className=\"group w-full h-28 flex items-center justify-center relative p-4\n                       before:absolute before:-left-1 before:top-0 before:z-10 before:h-screen before:w-px before:bg-border\n                       after:absolute after:-top-1 after:left-0 after:z-10 after:h-px after:w-screen after:bg-border\"\n          >\n            <div className={`transition-all duration-300 ease-[cubic-bezier(0.165,0.84,0.44,1)]\n                            translate-y-0 group-hover:-translate-y-4 flex items-center justify-center w-full h-full ${\n                              logo.id === 6 ? '-translate-y-3' : ''\n                            }`}>\n              <img\n                src={logo.src}\n                alt={logo.name}\n                className={`w-auto object-contain opacity-80 group-hover:opacity-100 transition-opacity dark:invert ${\n                  logo.id === 2 ? 'h-11 md:h-12' :\n                  logo.id === 5 ? 'h-11 md:h-13' :\n                  [4, 6].includes(logo.id) ? 'h-14 md:h-16' :\n                  'h-10 md:h-12'\n                }`}\n              />\n            </div>\n\n            <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100\n                            translate-y-8 group-hover:translate-y-4 transition-all duration-300 ease-[cubic-bezier(0.165,0.84,0.44,1)]\">\n              <span className=\"flex items-center gap-2 text-sm font-medium\">\n                Learn More <ArrowRight className=\"w-4 h-4\" />\n              </span>\n            </div>\n          </Link>\n        ))}\n      </div>\n    </section>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/sections/footer-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tablet' is assigned a value but never used.","line":10,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMediaQuery } from \"@/hooks/use-media-query\"\nimport { siteConfig } from \"@/lib/config\"\nimport { ChevronRightIcon } from \"@radix-ui/react-icons\"\nimport Image from \"next/image\"\nimport Link from \"next/link\"\nimport { Icons } from \"@/components/icons\"\nexport function FooterSection() {\n  const tablet = useMediaQuery(\"(max-width: 1024px)\")\n\n  return (\n    <footer id=\"footer\" className=\"w-full pb-0\">\n      <div className=\"flex flex-col md:flex-row md:items-center md:justify-between p-10\">\n        <div className=\"flex flex-col items-start justify-start gap-y-5 max-w-xs mx-0\">\n          <Link href=\"/\" className=\"flex items-center gap-2\">\n            <Image\n              src=\"/images/logo.png\"\n              alt=\"Logo\"\n              width={32}\n              height={32}\n              className=\"size-8 invert dark:invert-0\"\n            />\n            <p className=\"text-xl font-semibold text-primary\">thePsychology.ai</p>\n          </Link>\n          <p className=\"tracking-tight text-muted-foreground font-medium\">{siteConfig.hero.description}</p>\n          <div className=\"flex items-center gap-2 dark:hidden\">\n            <Icons.soc2 className=\"size-12\" />\n            <Icons.hipaa className=\"size-12\" />\n            <Icons.gdpr className=\"size-12\" />\n          </div>\n          <div className=\"dark:flex items-center gap-2 hidden\">\n            <Icons.soc2Dark className=\"size-12\" />\n            <Icons.hipaaDark className=\"size-12\" />\n            <Icons.gdprDark className=\"size-12\" />\n          </div>\n        </div>\n        <div className=\"pt-5 md:w-1/2\">\n          <div className=\"flex flex-col items-start justify-start md:flex-row md:items-center md:justify-between gap-y-5 lg:pl-10\">\n            {siteConfig.footerLinks.map((column, columnIndex) => (\n              <ul key={columnIndex} className=\"flex flex-col gap-y-2\">\n                <li className=\"mb-2 text-sm font-semibold text-primary\">{column.title}</li>\n                {column.links.map((link) => (\n                  <li\n                    key={link.id}\n                    className=\"group inline-flex cursor-pointer items-center justify-start gap-1 text-[15px]/snug text-muted-foreground\"\n                  >\n                    <Link href={link.url}>{link.title}</Link>\n                    <div className=\"flex size-4 items-center justify-center border border-border rounded translate-x-0 transform opacity-0 transition-all duration-300 ease-out group-hover:translate-x-1 group-hover:opacity-100\">\n                      <ChevronRightIcon className=\"h-4 w-4 \" />\n                    </div>\n                  </li>\n                ))}\n              </ul>\n            ))}\n          </div>\n        </div>\n      </div>\n    </footer>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/sections/navbar.tsx","messages":[{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":151,"column":19,"nodeType":"JSXOpeningElement","endLine":154,"endColumn":20},{"ruleId":"@next/next/no-html-link-for-pages","severity":2,"message":"Do not use an `<a>` element to navigate to `/`. Use `<Link />` from `next/link` instead. See: https://nextjs.org/docs/messages/no-html-link-for-pages","line":269,"column":21,"nodeType":"JSXOpeningElement","endLine":272,"endColumn":22}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { NavMenu } from \"@/components/nav-menu\";\r\nimport { AnimatedThemeToggler } from \"@/components/ui/animated-theme-toggler\";\r\nimport { siteConfig } from \"@/lib/config\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useAuth } from \"@/context/auth-context\";\r\nimport { Menu, X } from \"lucide-react\";\r\nimport { AnimatePresence, motion, useScroll } from \"motion/react\";\r\nimport Image from \"next/image\";\r\nimport Link from \"next/link\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst INITIAL_WIDTH = \"70rem\";\r\nconst MAX_WIDTH = \"800px\";\r\n\r\n// Animation variants\r\nconst overlayVariants = {\r\n  hidden: { opacity: 0 },\r\n  visible: { opacity: 1 },\r\n  exit: { opacity: 0 },\r\n};\r\n\r\nconst drawerVariants = {\r\n  hidden: { opacity: 0, y: 100 },\r\n  visible: {\r\n    opacity: 1,\r\n    y: 0,\r\n    rotate: 0,\r\n    transition: {\r\n      type: \"spring\" as const,\r\n      damping: 15,\r\n      stiffness: 200,\r\n      staggerChildren: 0.03,\r\n    },\r\n  },\r\n  exit: {\r\n    opacity: 0,\r\n    y: 100,\r\n    transition: { duration: 0.1 },\r\n  },\r\n};\r\n\r\nconst drawerMenuContainerVariants = {\r\n  hidden: { opacity: 0 },\r\n  visible: { opacity: 1 },\r\n};\r\n\r\nconst drawerMenuVariants = {\r\n  hidden: { opacity: 0 },\r\n  visible: { opacity: 1 },\r\n};\r\n\r\nexport function Navbar() {\r\n  const { scrollY } = useScroll();\r\n  const { user, signOut } = useAuth();\r\n  const [hasScrolled, setHasScrolled] = useState(false);\r\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n  const [activeSection, setActiveSection] = useState(\"hero\");\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  // Set mounted flag to prevent hydration mismatch\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      const sections = siteConfig.nav.links.map((item) =>\r\n        item.href.substring(1),\r\n      );\r\n\r\n      for (const section of sections) {\r\n        const element = document.getElementById(section);\r\n        if (element) {\r\n          const rect = element.getBoundingClientRect();\r\n          if (rect.top <= 150 && rect.bottom >= 150) {\r\n            setActiveSection(section);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    handleScroll();\r\n\r\n    return () => window.removeEventListener(\"scroll\", handleScroll);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = scrollY.on(\"change\", (latest) => {\r\n      setHasScrolled(latest > 10);\r\n    });\r\n    return unsubscribe;\r\n  }, [scrollY]);\r\n\r\n  const toggleDrawer = () => setIsDrawerOpen((prev) => !prev);\r\n  const handleOverlayClick = () => setIsDrawerOpen(false);\r\n\r\n  return (\r\n    <header\r\n      className={cn(\r\n        \"sticky z-50 mx-4 flex justify-center transition-all duration-300 md:mx-0\",\r\n        hasScrolled ? \"top-6\" : \"top-4 mx-0\",\r\n      )}\r\n    >\r\n      <motion.div\r\n        initial={{ width: INITIAL_WIDTH }}\r\n        animate={{ width: hasScrolled ? MAX_WIDTH : INITIAL_WIDTH }}\r\n        transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }}\r\n      >\r\n        <div\r\n          className={cn(\r\n            \"mx-auto max-w-7xl rounded-2xl transition-all duration-300  xl:px-0\",\r\n            hasScrolled\r\n              ? \"px-2 border border-border backdrop-blur-lg bg-background/75\"\r\n              : \"shadow-none px-7\",\r\n          )}\r\n        >\r\n          <div className=\"flex h-[56px] items-center justify-between p-4\">\r\n            <Link href={user ? \"/dashboard\" : \"/\"} className=\"flex items-center gap-3\">\r\n              <Image\r\n                src=\"/images/logo.png\"\r\n                alt=\"Logo\"\r\n                width={40}\r\n                height={40}\r\n                className=\"size-7 md:size-10 invert dark:invert-0\"\r\n              />\r\n              <p className=\"text-lg font-semibold text-primary\">thePsychology.ai</p>\r\n            </Link>\r\n\r\n            <NavMenu isLoggedIn={!!user} />\r\n\r\n            <div className=\"flex flex-row items-center gap-1 md:gap-3 shrink-0\">\r\n              <div className=\"flex items-center space-x-6\">\r\n                {mounted && user ? (\r\n                  <button\r\n                    onClick={async () => {\r\n                      try {\r\n                        await signOut()\r\n                      } catch (err) {\r\n                        console.error('Logout failed:', err)\r\n                      }\r\n                    }}\r\n                    className=\"border border-foreground/40 h-8 hidden md:flex items-center justify-center text-sm font-normal tracking-wide rounded-sm text-foreground w-fit px-4 hover:bg-foreground/5 hover:border-foreground/60 transition-colors\"\r\n                  >\r\n                    Logout\r\n                  </button>\r\n                ) : mounted ? (\r\n                  <a\r\n                    className=\"border border-foreground/40 h-8 hidden md:flex items-center justify-center text-sm font-normal tracking-wide rounded-sm text-foreground w-fit px-4 hover:bg-foreground/5 hover:border-foreground/60 transition-colors cursor-pointer\"\r\n                    href=\"/#get-started\"\r\n                  >\r\n                    Try for free\r\n                  </a>\r\n                ) : null}\r\n              </div>\r\n              <AnimatedThemeToggler />\r\n              <button\r\n                className=\"md:hidden border border-border size-8 rounded-md cursor-pointer flex items-center justify-center\"\r\n                onClick={toggleDrawer}\r\n              >\r\n                {isDrawerOpen ? (\r\n                  <X className=\"size-5\" />\r\n                ) : (\r\n                  <Menu className=\"size-5\" />\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Mobile Drawer */}\r\n      <AnimatePresence>\r\n        {isDrawerOpen && (\r\n          <>\r\n            <motion.div\r\n              className=\"fixed inset-0 bg-black/50 backdrop-blur-sm\"\r\n              initial=\"hidden\"\r\n              animate=\"visible\"\r\n              exit=\"exit\"\r\n              variants={overlayVariants}\r\n              transition={{ duration: 0.2 }}\r\n              onClick={handleOverlayClick}\r\n            />\r\n\r\n            <motion.div\r\n              className=\"fixed inset-x-0 w-[95%] mx-auto bottom-3 bg-background border border-border p-4 rounded-xl shadow-lg\"\r\n              initial=\"hidden\"\r\n              animate=\"visible\"\r\n              exit=\"exit\"\r\n              variants={drawerVariants}\r\n            >\r\n              {/* Mobile menu content */}\r\n              <div className=\"flex flex-col gap-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Link href=\"/\" className=\"flex items-center gap-3\">\r\n                    <Image\r\n                      src=\"/images/logo.png\"\r\n                      alt=\"Logo\"\r\n                      width={40}\r\n                      height={40}\r\n                      className=\"size-7 md:size-10 invert dark:invert-0\"\r\n                    />\r\n                    <p className=\"text-lg font-semibold text-primary\">\r\n                      thePsychology.ai\r\n                    </p>\r\n                  </Link>\r\n                  <button\r\n                    onClick={toggleDrawer}\r\n                    className=\"border border-border rounded-md p-1 cursor-pointer\"\r\n                  >\r\n                    <X className=\"size-5\" />\r\n                  </button>\r\n                </div>\r\n\r\n                <motion.ul\r\n                  className=\"flex flex-col text-sm mb-4 border border-border rounded-md\"\r\n                  variants={drawerMenuContainerVariants}\r\n                >\r\n                  <AnimatePresence>\r\n                    {siteConfig.nav.links.map((item) => (\r\n                      <motion.li\r\n                        key={item.id}\r\n                        className=\"p-2.5 border-b border-border last:border-b-0\"\r\n                        variants={drawerMenuVariants}\r\n                      >\r\n                        <a\r\n                          href={item.href}\r\n                          onClick={(e) => {\r\n                            e.preventDefault();\r\n                            const element = document.getElementById(\r\n                              item.href.substring(1),\r\n                            );\r\n                            element?.scrollIntoView({ behavior: \"smooth\" });\r\n                            setIsDrawerOpen(false);\r\n                          }}\r\n                          className={`underline-offset-4 hover:text-primary/80 transition-colors ${\r\n                            activeSection === item.href.substring(1)\r\n                              ? \"text-primary font-medium\"\r\n                              : \"text-primary/60\"\r\n                          }`}\r\n                        >\r\n                          {item.name}\r\n                        </a>\r\n                      </motion.li>\r\n                    ))}\r\n                  </AnimatePresence>\r\n                </motion.ul>\r\n\r\n                {/* Action buttons */}\r\n                <div className=\"flex flex-col gap-2\">\r\n                  {mounted && user ? (\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          await signOut()\r\n                        } catch (err) {\r\n                          console.error('Logout failed:', err)\r\n                        }\r\n                      }}\r\n                      className=\"bg-secondary h-8 flex items-center justify-center text-sm font-normal tracking-wide rounded-full text-primary-foreground dark:text-secondary-foreground w-full px-4 shadow-[inset_0_1px_2px_rgba(255,255,255,0.25),0_3px_3px_-1.5px_rgba(16,24,40,0.06),0_1px_1px_rgba(16,24,40,0.08)] border border-white/[0.12] hover:bg-secondary/80 transition-all ease-out active:scale-95\"\r\n                    >\r\n                      Logout\r\n                    </button>\r\n                  ) : mounted ? (\r\n                    <a\r\n                      href=\"/#get-started\"\r\n                      className=\"bg-secondary h-8 flex items-center justify-center text-sm font-normal tracking-wide rounded-full text-primary-foreground dark:text-secondary-foreground w-full px-4 shadow-[inset_0_1px_2px_rgba(255,255,255,0.25),0_3px_3px_-1.5px_rgba(16,24,40,0.06),0_1px_1px_rgba(16,24,40,0.08)] border border-white/[0.12] hover:bg-secondary/80 transition-all ease-out active:scale-95 cursor-pointer\"\r\n                    >\r\n                      Try for free\r\n                    </a>\r\n                  ) : null}\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </header>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/sections/signup-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tierInfo' is assigned a value but never used.","line":36,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2402,2405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2402,2405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":193,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5884,5925],"text":"We&apos;ll use this to sign in to your account"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5884,5925],"text":"We&lsquo;ll use this to sign in to your account"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5884,5925],"text":"We&#39;ll use this to sign in to your account"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5884,5925],"text":"We&rsquo;ll use this to sign in to your account"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { Check } from 'lucide-react'\nimport { motion } from 'motion/react'\nimport { SectionHeader } from '@/components/section-header'\n\ntype PricingTier = '7-Day Free Trial' | 'Pro' | 'Pro + Coaching'\ntype SignupStep = 'email' | 'goals' | 'password' | 'confirmation'\n\nexport function SignupSection() {\n  const router = useRouter()\n  const [step, setStep] = useState<SignupStep>('email')\n  const [selectedTier, setSelectedTier] = useState<PricingTier | null>(null)\n  const [email, setEmail] = useState('')\n  const [timeline, setTimeline] = useState('')\n  const [goalAfterLicensure, setGoalAfterLicensure] = useState('')\n  const [examDate, setExamDate] = useState('')\n  const [password, setPassword] = useState('')\n  const [confirmPassword, setConfirmPassword] = useState('')\n  const [error, setError] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n\n  // Check for pre-selected tier from pricing section\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const tier = sessionStorage.getItem('selectedTier') as PricingTier | null\n      if (tier) {\n        setSelectedTier(tier)\n        sessionStorage.removeItem('selectedTier')\n      }\n    }\n  }, [])\n\n  const tierInfo = {\n    '7-Day Free Trial': {\n      price: '$0',\n      description: 'Try the program free for 7 days. Limited to one topic.',\n      features: ['Diagnostic Exam', 'Prioritizing Focus', 'Custom Study (1 Topic)'],\n    },\n    'Pro': {\n      price: '$20/month',\n      description: 'Unlimited access to all topics and recovery tools.',\n      features: ['Diagnostic Exam', 'Prioritizing Focus', 'Custom Study (All Topics)', 'Recovery Tools'],\n    },\n    'Pro + Coaching': {\n      price: '$200/month',\n      description: 'Everything in Pro + 2 calls per month with Dr. Anders Chan.',\n      features: ['Everything in Pro', '2Ã— 45-min calls/month', 'Personal study plan', 'Priority support'],\n    },\n  }\n\n  const handleEmailSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n\n    if (!email) {\n      setError('Email is required')\n      return\n    }\n\n    if (!email.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/)) {\n      setError('Please enter a valid email address')\n      return\n    }\n\n    const existingUsers = JSON.parse(localStorage.getItem('users') || '[]')\n    if (existingUsers.some((u: any) => u.email === email)) {\n      setError('This email is already registered')\n      return\n    }\n\n    setStep('goals')\n  }\n\n  const handleGoalsSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setStep('password')\n  }\n\n  const handlePasswordSubmit = (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n\n    if (!password) {\n      setError('Password is required')\n      return\n    }\n\n    if (password.length < 8) {\n      setError('Password must be at least 8 characters long')\n      return\n    }\n\n    if (password !== confirmPassword) {\n      setError('Passwords do not match')\n      return\n    }\n\n    setStep('confirmation')\n  }\n\n  const handleCreateAccount = async () => {\n    setIsLoading(true)\n    setError('')\n\n    try {\n      const existingUsers = JSON.parse(localStorage.getItem('users') || '[]')\n\n      const newUser = {\n        id: Date.now().toString(),\n        email,\n        password,\n        tier: selectedTier,\n        createdAt: new Date().toISOString(),\n        trialExpiresAt: selectedTier === '7-Day Free Trial'\n          ? new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()\n          : null,\n        goals: {\n          timeline: timeline || null,\n          goalAfterLicensure: goalAfterLicensure || null,\n          examDate: examDate || null,\n        },\n      }\n\n      existingUsers.push(newUser)\n      localStorage.setItem('users', JSON.stringify(existingUsers))\n\n      localStorage.setItem('currentUser', JSON.stringify({\n        id: newUser.id,\n        email: newUser.email,\n        tier: newUser.tier,\n        trialExpiresAt: newUser.trialExpiresAt,\n      }))\n\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      router.push('/app')\n    } catch (err) {\n      setError('Failed to create account. Please try again.')\n      console.error(err)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleBack = () => {\n    if (step === 'email') {\n      // On back from email, we should probably stay here or allow going back somehow\n      // For now, let's just allow resetting the email\n      setEmail('')\n      setError('')\n    } else if (step === 'goals') {\n      setStep('email')\n      setTimeline('')\n      setGoalAfterLicensure('')\n      setExamDate('')\n      setError('')\n    } else if (step === 'password') {\n      setStep('goals')\n      setPassword('')\n      setConfirmPassword('')\n      setError('')\n    } else if (step === 'confirmation') {\n      setStep('password')\n    }\n  }\n\n  return (\n    <section id=\"get-started\" className=\"flex flex-col items-center justify-center gap-10 pb-10 w-full relative py-20\">\n      <SectionHeader>\n        <h2 className=\"text-3xl md:text-4xl font-medium tracking-tighter text-center text-balance\">\n          Get Started Today\n        </h2>\n        <p className=\"text-muted-foreground text-center text-balance font-medium\">\n          Create your account and choose your learning plan\n        </p>\n      </SectionHeader>\n\n      <div className=\"w-full max-w-2xl px-6\">\n        <motion.div\n          key={step}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3 }}\n        >\n          {/* Step 1: Email */}\n          {step === 'email' && (\n            <div className=\"space-y-6 max-w-md mx-auto\">\n              <div className=\"space-y-2\">\n                <h3 className=\"text-xl font-semibold\">Step 1: Enter Your Email</h3>\n                <p className=\"text-muted-foreground\">We'll use this to sign in to your account</p>\n              </div>\n\n              {selectedTier && (\n                <div className=\"p-4 rounded-lg bg-secondary/50 border border-border\">\n                  <p className=\"text-sm font-medium text-muted-foreground\">Selected Plan</p>\n                  <p className=\"text-lg font-semibold mt-1\">{selectedTier}</p>\n                </div>\n              )}\n\n              <form onSubmit={handleEmailSubmit} className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium mb-2\">\n                    Email Address\n                  </label>\n                  <input\n                    type=\"email\"\n                    id=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"you@example.com\"\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                {error && (\n                  <motion.div\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-3\"\n                  >\n                    <p className=\"text-sm text-destructive\">{error}</p>\n                  </motion.div>\n                )}\n\n                <div className=\"flex gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={handleBack}\n                    className=\"flex-1 h-12 bg-secondary text-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Back\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"flex-1 h-12 bg-primary text-primary-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Continue\n                  </button>\n                </div>\n              </form>\n            </div>\n          )}\n\n          {/* Step 2: Goals */}\n          {step === 'goals' && (\n            <div className=\"space-y-6 max-w-md mx-auto\">\n              <div className=\"space-y-2\">\n                <h3 className=\"text-xl font-semibold\">Step 2: Share Your Goals (Optional)</h3>\n                <p className=\"text-muted-foreground\">Help us understand your EPPP journey</p>\n              </div>\n\n              <div className=\"p-4 rounded-lg bg-secondary/50 border border-border\">\n                <p className=\"text-sm font-medium text-muted-foreground\">Email</p>\n                <p className=\"text-foreground\">{email}</p>\n              </div>\n\n              <form onSubmit={handleGoalsSubmit} className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"timeline\" className=\"block text-sm font-medium mb-2\">\n                    When do you plan to take the EPPP?\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"timeline\"\n                    value={timeline}\n                    onChange={(e) => setTimeline(e.target.value)}\n                    placeholder=\"e.g., In 3 months, Next summer, etc.\"\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"goalAfterLicensure\" className=\"block text-sm font-medium mb-2\">\n                    What are your goals after licensure?\n                  </label>\n                  <input\n                    type=\"text\"\n                    id=\"goalAfterLicensure\"\n                    value={goalAfterLicensure}\n                    onChange={(e) => setGoalAfterLicensure(e.target.value)}\n                    placeholder=\"e.g., Private practice, Clinical research, etc.\"\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                <div>\n                  <label htmlFor=\"examDate\" className=\"block text-sm font-medium mb-2\">\n                    Do you have a scheduled exam date?\n                  </label>\n                  <input\n                    type=\"date\"\n                    id=\"examDate\"\n                    value={examDate}\n                    onChange={(e) => setExamDate(e.target.value)}\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                <p className=\"text-xs text-muted-foreground\">\n                  These fields are optional and help us personalize your study plan\n                </p>\n\n                <div className=\"flex gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={handleBack}\n                    className=\"flex-1 h-12 bg-secondary text-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Back\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"flex-1 h-12 bg-primary text-primary-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Continue\n                  </button>\n                </div>\n              </form>\n            </div>\n          )}\n\n          {/* Step 3: Password */}\n          {step === 'password' && (\n            <div className=\"space-y-6 max-w-md mx-auto\">\n              <div className=\"space-y-2\">\n                <h3 className=\"text-xl font-semibold\">Step 3: Create Password</h3>\n                <p className=\"text-muted-foreground\">This will secure your account</p>\n              </div>\n\n              <div className=\"p-4 rounded-lg bg-secondary/50 border border-border space-y-2\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Email</p>\n                  <p className=\"text-foreground\">{email}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Plan</p>\n                  <p className=\"text-foreground\">{selectedTier}</p>\n                </div>\n              </div>\n\n              <form onSubmit={handlePasswordSubmit} className=\"space-y-4\">\n                <div>\n                  <label htmlFor=\"password\" className=\"block text-sm font-medium mb-2\">\n                    Password\n                  </label>\n                  <input\n                    type=\"password\"\n                    id=\"password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    placeholder=\"Enter a strong password\"\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    At least 8 characters\n                  </p>\n                </div>\n\n                <div>\n                  <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium mb-2\">\n                    Confirm Password\n                  </label>\n                  <input\n                    type=\"password\"\n                    id=\"confirmPassword\"\n                    value={confirmPassword}\n                    onChange={(e) => setConfirmPassword(e.target.value)}\n                    placeholder=\"Confirm your password\"\n                    className=\"w-full px-4 py-3 rounded-lg border border-border bg-background focus:outline-none focus:ring-2 focus:ring-primary\"\n                  />\n                </div>\n\n                {error && (\n                  <motion.div\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-3\"\n                  >\n                    <p className=\"text-sm text-destructive\">{error}</p>\n                  </motion.div>\n                )}\n\n                <div className=\"flex gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={handleBack}\n                    className=\"flex-1 h-12 bg-secondary text-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Back\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"flex-1 h-12 bg-primary text-primary-foreground rounded-lg font-medium hover:opacity-90 transition-opacity\"\n                  >\n                    Continue\n                  </button>\n                </div>\n              </form>\n            </div>\n          )}\n\n          {/* Step 4: Confirmation */}\n          {step === 'confirmation' && (\n            <div className=\"space-y-6 max-w-md mx-auto\">\n              <div className=\"space-y-2\">\n                <h3 className=\"text-xl font-semibold\">Step 4: Review Your Account</h3>\n                <p className=\"text-muted-foreground\">\n                  {selectedTier === '7-Day Free Trial'\n                    ? 'Your trial starts now and expires in 7 days'\n                    : 'Welcome to your new plan'}\n                </p>\n              </div>\n\n              <div className=\"space-y-3 p-4 rounded-lg bg-secondary/50 border border-border\">\n                <div className=\"pb-3 border-b border-border\">\n                  <p className=\"text-sm font-medium text-muted-foreground\">Email</p>\n                  <p className=\"text-foreground mt-1\">{email}</p>\n                </div>\n                <div className=\"pb-3 border-b border-border\">\n                  <p className=\"text-sm font-medium text-muted-foreground\">Plan</p>\n                  <p className=\"text-foreground font-semibold mt-1\">{selectedTier}</p>\n                </div>\n                {selectedTier === '7-Day Free Trial' && (\n                  <div>\n                    <p className=\"text-sm font-medium text-muted-foreground\">Trial Expires</p>\n                    <p className=\"text-foreground mt-1\">\n                      {new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <button\n                onClick={handleCreateAccount}\n                disabled={isLoading}\n                className=\"w-full h-12 bg-primary text-primary-foreground rounded-lg font-medium hover:opacity-90 transition-opacity disabled:opacity-50\"\n              >\n                {isLoading ? 'Creating Account...' : 'Create Account & Get Started'}\n              </button>\n\n              <p className=\"text-xs text-muted-foreground text-center\">\n                By creating an account, you agree to our Terms of Service and Privacy Policy\n              </p>\n            </div>\n          )}\n        </motion.div>\n      </div>\n    </section>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/animated-beam.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'controlXOffset' and 'useMidpointControlY'. Either include them or remove the dependency array.","line":114,"column":6,"nodeType":"ArrayExpression","endLine":123,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [containerRef, fromRef, toRef, curvature, startXOffset, startYOffset, endXOffset, endYOffset, controlXOffset, useMidpointControlY]","fix":{"range":[3045,3175],"text":"[containerRef, fromRef, toRef, curvature, startXOffset, startYOffset, endXOffset, endYOffset, controlXOffset, useMidpointControlY]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { RefObject, useEffect, useId, useState } from \"react\"\nimport { motion } from \"motion/react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface AnimatedBeamProps {\n  className?: string\n  containerRef: RefObject<HTMLElement | null>\n  fromRef: RefObject<HTMLElement | null>\n  toRef: RefObject<HTMLElement | null>\n  curvature?: number\n  reverse?: boolean\n  duration?: number\n  delay?: number\n  pathColor?: string\n  pathWidth?: number\n  pathOpacity?: number\n  gradientStartColor?: string\n  gradientStopColor?: string\n  repeat?: number\n  controlXOffset?: number\n  useMidpointControlY?: boolean\n  startXOffset?: number\n  startYOffset?: number\n  endXOffset?: number\n  endYOffset?: number\n}\n\nexport const AnimatedBeam: React.FC<AnimatedBeamProps> = ({\n  className,\n  containerRef,\n  fromRef,\n  toRef,\n  curvature = 0,\n  reverse = false,\n  duration = Math.random() * 3 + 4,\n  delay = 0,\n  pathColor = \"gray\",\n  pathWidth = 2,\n  pathOpacity = 0.2,\n  gradientStartColor = \"#ffaa40\",\n  gradientStopColor = \"#9c40ff\",\n  repeat = Infinity,\n  controlXOffset = 0,\n  useMidpointControlY = false,\n  startXOffset = 0,\n  startYOffset = 0,\n  endXOffset = 0,\n  endYOffset = 0,\n}) => {\n  const id = useId()\n  const [pathD, setPathD] = useState(\"\")\n  const [svgDimensions, setSvgDimensions] = useState({ width: 0, height: 0 })\n\n  const gradientCoordinates = reverse\n    ? {\n        x1: [\"90%\", \"-10%\"],\n        x2: [\"100%\", \"0%\"],\n        y1: [\"0%\", \"0%\"],\n        y2: [\"0%\", \"0%\"],\n      }\n    : {\n        x1: [\"10%\", \"110%\"],\n        x2: [\"0%\", \"100%\"],\n        y1: [\"0%\", \"0%\"],\n        y2: [\"0%\", \"0%\"],\n      }\n\n  useEffect(() => {\n    const updatePath = () => {\n      if (containerRef.current && fromRef.current && toRef.current) {\n        const containerRect = containerRef.current.getBoundingClientRect()\n        const rectA = fromRef.current.getBoundingClientRect()\n        const rectB = toRef.current.getBoundingClientRect()\n\n        const svgWidth = containerRect.width\n        const svgHeight = containerRect.height\n        setSvgDimensions({ width: svgWidth, height: svgHeight })\n\n        const startX =\n          rectA.left - containerRect.left + rectA.width / 2 + startXOffset\n        const startY =\n          rectA.top - containerRect.top + rectA.height / 2 + startYOffset\n        const endX =\n          rectB.left - containerRect.left + rectB.width / 2 + endXOffset\n        const endY =\n          rectB.top - containerRect.top + rectB.height / 2 + endYOffset\n\n        const controlX = (startX + endX) / 2 + controlXOffset\n        const baseY = useMidpointControlY ? (startY + endY) / 2 : startY\n        const controlY = baseY - curvature\n        const d = `M ${startX},${startY} Q ${\n          controlX\n        },${controlY} ${endX},${endY}`\n        setPathD(d)\n      }\n    }\n\n    const resizeObserver = new ResizeObserver(() => {\n      updatePath()\n    })\n\n    if (containerRef.current) {\n      resizeObserver.observe(containerRef.current)\n    }\n\n    updatePath()\n\n    return () => {\n      resizeObserver.disconnect()\n    }\n  }, [\n    containerRef,\n    fromRef,\n    toRef,\n    curvature,\n    startXOffset,\n    startYOffset,\n    endXOffset,\n    endYOffset,\n  ])\n\n  return (\n    <svg\n      fill=\"none\"\n      width={svgDimensions.width}\n      height={svgDimensions.height}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className={cn(\n        \"pointer-events-none absolute top-0 left-0 transform-gpu stroke-2\",\n        className\n      )}\n      viewBox={`0 0 ${svgDimensions.width} ${svgDimensions.height}`}\n    >\n      <path\n        d={pathD}\n        stroke={pathColor}\n        strokeWidth={pathWidth}\n        strokeOpacity={pathOpacity}\n        strokeLinecap=\"round\"\n      />\n      <path\n        d={pathD}\n        strokeWidth={pathWidth}\n        stroke={`url(#${id})`}\n        strokeOpacity=\"1\"\n        strokeLinecap=\"round\"\n      />\n      <defs>\n        <motion.linearGradient\n          className=\"transform-gpu\"\n          id={id}\n          gradientUnits={\"userSpaceOnUse\"}\n          initial={{\n            x1: \"0%\",\n            x2: \"0%\",\n            y1: \"0%\",\n            y2: \"0%\",\n          }}\n          animate={{\n            x1: gradientCoordinates.x1,\n            x2: gradientCoordinates.x2,\n            y1: gradientCoordinates.y1,\n            y2: gradientCoordinates.y2,\n          }}\n          transition={{\n            delay,\n            duration,\n            ease: [0.16, 1, 0.3, 1],\n            repeat,\n            repeatDelay: 0,\n          }}\n        >\n          <stop stopColor={gradientStartColor} stopOpacity=\"0\"></stop>\n          <stop stopColor={gradientStartColor}></stop>\n          <stop offset=\"32.5%\" stopColor={gradientStopColor}></stop>\n          <stop\n            offset=\"100%\"\n            stopColor={gradientStopColor}\n            stopOpacity=\"0\"\n          ></stop>\n        </motion.linearGradient>\n      </defs>\n    </svg>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/bento-grid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ReactNode } from \"react\"\nimport { ArrowRightIcon } from \"@radix-ui/react-icons\"\nimport Link from \"next/link\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\nexport function BentoGrid({\n  children,\n  className,\n}: {\n  children: ReactNode\n  className?: string\n}) {\n  return (\n    <div\n      className={cn(\n        \"grid w-full auto-rows-[22rem] grid-cols-3 gap-4\",\n        className\n      )}\n    >\n      {children}\n    </div>\n  )\n}\n\nexport function BentoCard({\n  name,\n  className,\n  background,\n  Icon,\n  description,\n  href,\n  cta,\n  onClick,\n  classNameHeader,\n  showHeader = true,\n  style,\n}: {\n  name: string\n  className: string\n  background: ReactNode\n  Icon: any\n  description: string\n  href: string\n  cta: string\n  onClick?: () => void\n  classNameHeader?: string\n  showHeader?: boolean\n  style?: React.CSSProperties\n}) {\n  const content = (\n    <>\n      <div>{background}</div>\n      {showHeader && (\n        <div className={cn(\"pointer-events-none z-10 flex transform-gpu flex-col gap-1 p-6 transition-all duration-300 group-hover:-translate-y-10\", classNameHeader)}>\n          <Icon className=\"h-12 w-12 origin-left transform-gpu text-neutral-700 transition-all duration-300 ease-in-out group-hover:scale-75 dark:text-neutral-300\" />\n          <h3 className=\"text-xl font-semibold text-neutral-700 dark:text-neutral-300\">\n            {name}\n          </h3>\n          <p className=\"max-w-lg text-neutral-400\">{description}</p>\n        </div>\n      )}\n\n      {cta && (\n        <div\n          className={cn(\n            \"pointer-events-none absolute bottom-0 flex w-full translate-y-10 transform-gpu flex-row items-center p-4 opacity-0 transition-all duration-300 group-hover:translate-y-0 group-hover:opacity-100\"\n          )}\n        >\n          <div className=\"flex items-center gap-2 text-sm font-medium text-neutral-700 dark:text-neutral-300\">\n            {cta}\n            <ArrowRightIcon className=\"h-4 w-4\" />\n          </div>\n        </div>\n      )}\n      <div className=\"pointer-events-none absolute inset-0 transform-gpu transition-all duration-300 group-hover:bg-black/[.03] group-hover:dark:bg-neutral-800/10\" />\n    </>\n  )\n\n  const cardClasses = cn(\n    \"group relative col-span-3 flex flex-col justify-between overflow-hidden rounded-xl cursor-pointer\",\n    // light styles\n    \"bg-white [box-shadow:0_0_0_1px_rgba(0,0,0,.03),0_2px_4px_rgba(0,0,0,.05),0_12px_24px_rgba(0,0,0,.05)]\",\n    // dark styles\n    \"transform-gpu dark:bg-black dark:[border:1px_solid_rgba(255,255,255,.1)] dark:[box-shadow:0_-20px_80px_-20px_#ffffff1f_inset]\",\n    className\n  )\n\n  if (onClick) {\n    return (\n      <div\n        key={name}\n        className={cardClasses}\n        onClick={onClick}\n        style={style}\n      >\n        {content}\n      </div>\n    )\n  }\n\n  if (href === \"#\") {\n    return (\n      <div\n        key={name}\n        className={cardClasses}\n        style={style}\n      >\n        {content}\n      </div>\n    )\n  }\n\n  return (\n    <Link\n      key={name}\n      href={href}\n      className={cardClasses}\n      style={style}\n    >\n      {content}\n    </Link>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/breathing-animation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cycleTimeoutRef' is assigned a value but never used.","line":14,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport React, { useEffect, useRef, useState } from 'react'\nimport Lottie, { LottieRefCurrentProps } from 'lottie-react'\n\ninterface BreathingAnimationProps {\n  speed?: number // 1 = normal speed, adjust for 4 breaths per minute\n}\n\nexport function BreathingAnimation({ speed = 0.15 }: BreathingAnimationProps) {\n  const lottieRef = useRef<LottieRefCurrentProps>(null)\n  const [animationData, setAnimationData] = useState<any>(null)\n  const [isReversed, setIsReversed] = useState(false)\n  const cycleTimeoutRef = useRef<NodeJS.Timeout | null>(null)\n\n  useEffect(() => {\n    // Load the animation JSON from public folder\n    fetch('/animations/breathe-ripple.json')\n      .then((res) => res.json())\n      .then((data) => setAnimationData(data))\n      .catch((err) => console.error('Failed to load animation:', err))\n  }, [])\n\n  useEffect(() => {\n    if (lottieRef.current) {\n      // Set direction: 1 = forward, -1 = reverse\n      lottieRef.current.setDirection(isReversed ? -1 : 1)\n    }\n  }, [isReversed])\n\n  // Variable speed animation: normal for 6 seconds, then slow for last 1.5 seconds\n  useEffect(() => {\n    if (!lottieRef.current || !animationData) return\n\n    const lottie = lottieRef.current\n    const normalSpeed = speed\n    const slowSpeed = speed * 0.4 // Slow down to 40% speed for natural hold at end\n\n    // Only start from beginning on first play (when not reversed yet)\n    if (!isReversed) {\n      lottie.stop()\n      lottie.goToAndPlay(0, true)\n      lottie.setSpeed(normalSpeed)\n    } else {\n      // When reversing, continue from current position\n      lottie.play()\n      lottie.setSpeed(normalSpeed)\n    }\n\n    // After 6 seconds, slow down for the last 1.5 seconds\n    const slowdownTimeout = setTimeout(() => {\n      lottie.setSpeed(slowSpeed)\n    }, 6000)\n\n    // After 7.5 seconds total, toggle direction (this triggers smooth transition)\n    const reverseTimeout = setTimeout(() => {\n      setIsReversed((prev) => !prev)\n    }, 7500)\n\n    return () => {\n      clearTimeout(slowdownTimeout)\n      clearTimeout(reverseTimeout)\n    }\n  }, [isReversed, animationData, speed])\n\n  if (!animationData) {\n    return <div className=\"w-full h-full\" />\n  }\n\n  return (\n    <div className=\"w-full h-full flex items-center justify-center\">\n      <Lottie\n        lottieRef={lottieRef}\n        animationData={animationData}\n        style={{ width: '100%', height: '100%' }}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/confetti.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":10,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":10,"endColumn":24,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[208,282],"text":"type ConfettiProps = React.HTMLAttributes<HTMLCanvasElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { forwardRef, useImperativeHandle, useRef, useEffect } from \"react\"\nimport confetti from \"canvas-confetti\"\n\nexport interface ConfettiRef {\n  fire: (options?: confetti.Options) => void\n}\n\ninterface ConfettiProps extends React.HTMLAttributes<HTMLCanvasElement> {}\n\nexport const Confetti = forwardRef<ConfettiRef, ConfettiProps>(\n  ({ className, ...props }, ref) => {\n    const canvasRef = useRef<HTMLCanvasElement>(null)\n    const confettiRef = useRef<confetti.CreateTypes | null>(null)\n\n    useEffect(() => {\n      if (canvasRef.current) {\n        confettiRef.current = confetti.create(canvasRef.current, {\n          resize: true,\n          useWorker: true,\n        })\n      }\n\n      return () => {\n        confettiRef.current?.reset()\n      }\n    }, [])\n\n    useImperativeHandle(ref, () => ({\n      fire: (options = {}) => {\n        const defaultOptions: confetti.Options = {\n          particleCount: 100,\n          spread: 70,\n          origin: { y: 0.6 },\n          ...options,\n        }\n        confettiRef.current?.(defaultOptions)\n      },\n    }))\n\n    return (\n      <canvas\n        ref={canvasRef}\n        className={className}\n        {...props}\n      />\n    )\n  }\n)\n\nConfetti.displayName = \"Confetti\"\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/feedback-input-box.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":188,"column":15,"nodeType":"JSXOpeningElement","endLine":192,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport { ArrowUp, Paperclip, X } from 'lucide-react'\nimport { AnimatePresence, motion } from 'framer-motion'\nimport { cn } from '@/lib/utils'\n\ninterface FeedbackInputBoxProps {\n  onSend: (message: string, file?: File | null) => Promise<void> | void\n  isLoading?: boolean\n  placeholder?: string\n  className?: string\n}\n\nconst supportStyles = `\n  *:focus-visible {\n    outline-offset: 0 !important;\n    --ring-offset: 0 !important;\n  }\n  textarea::-webkit-scrollbar {\n    width: 6px;\n  }\n  textarea::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  textarea::-webkit-scrollbar-thumb {\n    background-color: #444444;\n    border-radius: 3px;\n  }\n  textarea::-webkit-scrollbar-thumb:hover {\n    background-color: #555555;\n  }\n`\n\nexport function FeedbackInputBox({\n  onSend,\n  isLoading = false,\n  placeholder = 'Type your feedback here...',\n  className,\n}: FeedbackInputBoxProps) {\n  const [value, setValue] = useState('')\n  const [file, setFile] = useState<File | null>(null)\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null)\n  const [error, setError] = useState<string | null>(null)\n  const [isDragging, setIsDragging] = useState(false)\n  const uploadInputRef = useRef<HTMLInputElement>(null)\n\n  useEffect(() => {\n    if (typeof document === 'undefined') return\n    const styleElement = document.createElement('style')\n    styleElement.setAttribute('data-feedback-input-box', '')\n    styleElement.innerText = supportStyles\n    document.head.appendChild(styleElement)\n    return () => {\n      document.head.removeChild(styleElement)\n    }\n  }, [])\n\n  const hasContent = value.trim().length > 0 || !!file\n\n  useEffect(() => {\n    return () => {\n      if (previewUrl) {\n        URL.revokeObjectURL(previewUrl)\n      }\n    }\n  }, [previewUrl])\n\n  const processFile = useCallback(\n    (incomingFile: File) => {\n      if (!incomingFile.type.startsWith('image/')) {\n        setError('Only image files are allowed.')\n        return\n      }\n      const maxSizeBytes = 10 * 1024 * 1024\n      if (incomingFile.size > maxSizeBytes) {\n        setError('Image must be 10MB or smaller.')\n        return\n      }\n      setError(null)\n      setFile(incomingFile)\n      if (previewUrl) {\n        URL.revokeObjectURL(previewUrl)\n      }\n      setPreviewUrl(URL.createObjectURL(incomingFile))\n    },\n    [previewUrl]\n  )\n\n  const handleFiles = useCallback(\n    (fileList: FileList | null) => {\n      if (!fileList || fileList.length === 0) return\n      processFile(fileList[0])\n    },\n    [processFile]\n  )\n\n  const handleSubmit = useCallback(async () => {\n    if (!hasContent || isLoading) return\n\n    try {\n      await onSend(value.trim(), file)\n      setValue('')\n      setFile(null)\n      if (previewUrl) {\n        URL.revokeObjectURL(previewUrl)\n        setPreviewUrl(null)\n      }\n    } catch (err) {\n      console.error('Feedback submission failed:', err)\n    }\n  }, [onSend, value, file, hasContent, isLoading, previewUrl])\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n      event.preventDefault()\n      handleSubmit()\n    }\n  }\n\n  const handlePaste = (event: React.ClipboardEvent<HTMLTextAreaElement>) => {\n    const items = event.clipboardData?.items\n    if (!items) return\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i]\n      if (item.type.startsWith('image/')) {\n        const pastedFile = item.getAsFile()\n        if (pastedFile) {\n          event.preventDefault()\n          processFile(pastedFile)\n          break\n        }\n      }\n    }\n  }\n\n  const handleDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault()\n    event.stopPropagation()\n    setIsDragging(true)\n  }\n\n  const handleDragLeave = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault()\n    event.stopPropagation()\n    setIsDragging(false)\n  }\n\n  const handleDrop = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault()\n    event.stopPropagation()\n    setIsDragging(false)\n    const droppedFiles = event.dataTransfer?.files\n    if (droppedFiles && droppedFiles.length > 0) {\n      processFile(droppedFiles[0])\n    }\n  }\n\n  const borderClasses = useMemo(\n    () =>\n      cn(\n        'rounded-3xl border border-[#444444] bg-[#1F2023] p-3 shadow-[0_8px_30px_rgba(0,0,0,0.24)] transition-colors duration-300',\n        isDragging && 'border-white/40 bg-white/5',\n        isLoading && 'opacity-60 cursor-not-allowed',\n        className\n      ),\n    [isDragging, isLoading, className]\n  )\n\n  return (\n    <div\n      className={borderClasses}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n    >\n      <AnimatePresence>\n        {file && previewUrl && (\n          <motion.div\n            key={previewUrl}\n            initial={{ opacity: 0, scale: 0.98 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.98 }}\n            transition={{ duration: 0.15 }}\n            className=\"mb-3\"\n          >\n            <div className=\"relative inline-block\">\n              <img\n                src={previewUrl}\n                alt={file.name}\n                className=\"h-20 w-20 rounded-2xl object-cover border border-white/10\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setFile(null)\n                  if (previewUrl) {\n                    URL.revokeObjectURL(previewUrl)\n                    setPreviewUrl(null)\n                  }\n                }}\n                className=\"absolute -right-2 -top-2 rounded-full bg-black/70 p-1 text-white transition hover:bg-black\"\n                aria-label=\"Remove screenshot\"\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <textarea\n        value={value}\n        onChange={event => setValue(event.target.value)}\n        onKeyDown={handleKeyDown}\n        onPaste={handlePaste}\n        placeholder={placeholder}\n        disabled={isLoading}\n        rows={1}\n        className={cn(\n          'flex w-full min-h-[48px] resize-none rounded-2xl bg-transparent text-base leading-relaxed text-gray-100 placeholder:text-gray-500',\n          'px-2 py-1',\n          'border-none outline-none focus-visible:ring-0',\n          'max-h-[240px] overflow-y-auto',\n          'disabled:cursor-not-allowed disabled:opacity-60'\n        )}\n      />\n\n      <div className=\"mt-2 flex items-center justify-between\">\n        <button\n          type=\"button\"\n          className={cn(\n            'flex h-9 w-9 items-center justify-center rounded-full text-[#9CA3AF] transition-colors',\n            'hover:bg-gray-600/30 hover:text-[#D1D5DB]'\n          )}\n          onClick={() => uploadInputRef.current?.click()}\n          disabled={isLoading}\n          aria-label=\"Attach screenshot\"\n        >\n          <Paperclip className=\"h-5 w-5\" />\n          <input\n            ref={uploadInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            className=\"hidden\"\n            onChange={event => {\n              handleFiles(event.target.files)\n              if (event.target) {\n                event.target.value = ''\n              }\n            }}\n          />\n        </button>\n\n        <button\n          type=\"button\"\n          onClick={handleSubmit}\n          disabled={isLoading || !hasContent}\n          className={cn(\n            'flex h-9 w-9 items-center justify-center rounded-full transition-all duration-200',\n            hasContent && !isLoading\n              ? 'bg-white text-[#1F2023] hover:bg-white/90'\n              : 'bg-gray-600/30 text-gray-400 cursor-not-allowed'\n          )}\n          aria-label=\"Send feedback\"\n        >\n          <ArrowUp className=\"h-4 w-4\" />\n        </button>\n      </div>\n\n      {error && (\n        <p className=\"mt-2 text-sm text-red-400\" role=\"alert\">\n          {error}\n        </p>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/input.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":28,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[73,150],"text":"type InputProps = React.InputHTMLAttributes<HTMLInputElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => (\n    <input\n      type={type}\n      className={cn(\n        \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/loading-animation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[384,387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[384,387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport React, { useEffect, useRef, useState } from 'react'\nimport Lottie, { LottieRefCurrentProps } from 'lottie-react'\n\ninterface LoadingAnimationProps {\n  size?: 'sm' | 'md' | 'lg'\n}\n\nexport function LoadingAnimation({ size = 'md' }: LoadingAnimationProps) {\n  const lottieRef = useRef<LottieRefCurrentProps>(null)\n  const [animationData, setAnimationData] = useState<any>(null)\n\n  useEffect(() => {\n    // Load the animation JSON from public folder\n    fetch('/animations/loading.json')\n      .then((res) => res.json())\n      .then((data) => setAnimationData(data))\n      .catch((err) => console.error('Failed to load animation:', err))\n  }, [])\n\n  const sizeMap = {\n    sm: '80px',\n    md: '120px',\n    lg: '160px',\n  }\n\n  if (!animationData) {\n    return <div style={{ width: sizeMap[size], height: sizeMap[size] }} />\n  }\n\n  return (\n    <div style={{ width: sizeMap[size], height: sizeMap[size] }}>\n      <Lottie\n        lottieRef={lottieRef}\n        animationData={animationData}\n        loop\n        autoplay\n        style={{ width: '100%', height: '100%' }}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/number-ticker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'animationRef' is assigned a value but never used.","line":20,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useEffect, useRef } from \"react\"\nimport { motion } from \"motion/react\"\n\ninterface NumberTickerProps {\n  value: number\n  duration?: number\n  decimals?: number\n  className?: string\n}\n\nexport function NumberTicker({\n  value,\n  duration = 2,\n  decimals = 0,\n  className,\n}: NumberTickerProps) {\n  const ref = useRef<HTMLSpanElement>(null)\n  const animationRef = useRef<{ current: number }>({ current: 0 })\n\n  useEffect(() => {\n    const element = ref.current\n    if (!element) return\n\n    const start = parseFloat(element.innerText)\n    const end = value\n    const range = end - start\n    const increment = range / (duration * 100)\n    let current = start\n\n    const timer = setInterval(() => {\n      current += increment\n      if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {\n        current = end\n        clearInterval(timer)\n      }\n      element.innerText = current.toFixed(decimals)\n    }, duration * 10)\n\n    return () => clearInterval(timer)\n  }, [value, duration, decimals])\n\n  return (\n    <motion.span\n      ref={ref}\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      className={className}\n    >\n      {value}\n    </motion.span>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[73,159],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/components/ui/toggle-group.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToggleGroupContext' is assigned a value but never used.","line":10,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'variant' is defined but never used.","line":21,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'size' is defined but never used.","line":21,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  />\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <ToggleGroupPrimitive.Item\n    ref={ref}\n    className={cn(\n      toggleVariants({\n        variant,\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n))\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/config.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":271,"column":136,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[10967,10977],"text":". It&apos;s an "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[10967,10977],"text":". It&lsquo;s an "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[10967,10977],"text":". It&#39;s an "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[10967,10977],"text":". It&rsquo;s an "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":271,"column":476,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11311,11342],"text":"&apos;for the people, by the people'"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11311,11342],"text":"&lsquo;for the people, by the people'"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11311,11342],"text":"&#39;for the people, by the people'"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11311,11342],"text":"&rsquo;for the people, by the people'"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":271,"column":506,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[11311,11342],"text":"'for the people, by the people&apos;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[11311,11342],"text":"'for the people, by the people&lsquo;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[11311,11342],"text":"'for the people, by the people&#39;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[11311,11342],"text":"'for the people, by the people&rsquo;"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { FirstBentoAnimation } from \"@/components/first-bento-animation\"\nimport { SecondBentoAnimation } from \"@/components/second-bento-animation\"\nimport { ThirdBentoAnimation } from \"@/components/third-bento-animation\"\nimport { FourthBentoAnimation } from \"@/components/fourth-bento-animation\"\n\nexport const Highlight = ({\n  children,\n  className,\n}: {\n  children: React.ReactNode\n  className?: string\n}) => {\n  return (\n    <span\n      className={cn(\n        \"p-1 py-0.5 font-medium dark:font-semibold text-brand-coral\",\n        className\n      )}\n    >\n      {children}\n    </span>\n  )\n}\n\nexport const BLUR_FADE_DELAY = 0.15\n\nexport const siteConfig = {\n  name: \"thePsychology.ai\",\n  description: \"Master the EPPP Quickly\",\n  cta: \"Get Started\",\n  url: process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\",\n  keywords: [\"EPPP\", \"Psychology\", \"Exam Prep\", \"AI Learning\"],\n  links: {\n    email: \"support@thepsychology.ai\",\n    twitter: \"https://twitter.com/thepsychologyai\",\n    discord: \"https://discord.gg/thepsychologyai\",\n    github: \"https://github.com/thepsychologyai\",\n    instagram: \"https://instagram.com/thepsychologyai\",\n  },\n  nav: {\n    links: [\n      { id: 1, name: \"About\", href: \"/portfolio\" },\n      { id: 2, name: \"How it Works\", href: \"#bento\" },\n      { id: 4, name: \"Pricing\", href: \"#get-started\" },\n    ],\n  },\n  hero: {\n    badgeIcon: (\n      <svg\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"dark:fill-white fill-[#364153]\"\n      >\n        <path d=\"M7.62758 1.09876C7.74088 1.03404 7.8691 1 7.99958 1C8.13006 1 8.25828 1.03404 8.37158 1.09876L13.6216 4.09876C13.7363 4.16438 13.8316 4.25915 13.8979 4.37347C13.9642 4.48779 13.9992 4.6176 13.9992 4.74976C13.9992 4.88191 13.9642 5.01172 13.8979 5.12604C13.8316 5.24036 13.7363 5.33513 13.6216 5.40076L8.37158 8.40076C8.25828 8.46548 8.13006 8.49952 7.99958 8.49952C7.8691 8.49952 7.74088 8.46548 7.62758 8.40076L2.37758 5.40076C2.26287 5.33513 2.16753 5.24036 2.10123 5.12604C2.03492 5.01172 2 4.88191 2 4.74976C2 4.6176 2.03492 4.48779 2.10123 4.37347C2.16753 4.25915 2.26287 4.16438 2.37758 4.09876L7.62758 1.09876Z\" />\n        <path d=\"M2.56958 7.23928L2.37758 7.34928C2.26287 7.41491 2.16753 7.50968 2.10123 7.624C2.03492 7.73831 2 7.86813 2 8.00028C2 8.13244 2.03492 8.26225 2.10123 8.37657C2.16753 8.49089 2.26287 8.58566 2.37758 8.65128L7.62758 11.6513C7.74088 11.716 7.8691 11.75 7.99958 11.75C8.13006 11.75 8.25828 11.716 8.37158 11.6513L13.6216 8.65128C13.7365 8.58573 13.8321 8.49093 13.8986 8.3765C13.965 8.26208 14 8.13211 14 7.99978C14 7.86745 13.965 7.73748 13.8986 7.62306C13.8321 7.50864 13.7365 7.41384 13.6216 7.34828L13.4296 7.23828L9.11558 9.70328C8.77568 9.89744 8.39102 9.99956 7.99958 9.99956C7.60814 9.99956 7.22347 9.89744 6.88358 9.70328L2.56958 7.23928Z\" />\n        <path d=\"M2.37845 10.5993L2.57045 10.4893L6.88445 12.9533C7.22435 13.1474 7.60901 13.2496 8.00045 13.2496C8.39189 13.2496 8.77656 13.1474 9.11645 12.9533L13.4305 10.4883L13.6225 10.5983C13.7374 10.6638 13.833 10.7586 13.8994 10.8731C13.9659 10.9875 14.0009 11.1175 14.0009 11.2498C14.0009 11.3821 13.9659 11.5121 13.8994 11.6265C13.833 11.7409 13.7374 11.8357 13.6225 11.9013L8.37245 14.9013C8.25915 14.966 8.13093 15 8.00045 15C7.86997 15 7.74175 14.966 7.62845 14.9013L2.37845 11.9013C2.2635 11.8357 2.16795 11.7409 2.10148 11.6265C2.03501 11.5121 2 11.3821 2 11.2498C2 11.1175 2.03501 10.9875 2.10148 10.8731C2.16795 10.7586 2.2635 10.6638 2.37845 10.5983V10.5993Z\" />\n      </svg>\n    ),\n    badge: \"19% to 588 in 30 days\",\n    title: \"Master the EPPP Quickly\",\n    description: \"AI developed by psychologists to save your time, money, and sanity.\",\n    cta: {\n      primary: { text: \"Start free\", href: \"/#get-started\" },\n      secondary: { text: \"Login\", href: \"/login\" },\n    },\n  },\n  companyShowcase: {\n    title: \"Practitioner-built. Proven in clinics, classrooms, and real exams\",\n    companyLogos: [\n      { id: 1, name: \"David Geffen School of Medicine\", src: \"/dgsom.png\" },\n      { id: 2, name: \"NYU Langone Health\", src: \"/nyu.png\" },\n      { id: 3, name: \"Montefiore\", src: \"/monte.png\" },\n      { id: 4, name: \"Einstein\", src: \"/einstein.png\" },\n      { id: 5, name: \"UCLA Health\", src: \"/ucla.png\" },\n      { id: 6, name: \"LIU Post\", src: \"/liu.png\" },\n      { id: 7, name: \"Pratt Institute\", src: \"/pratt.png\" },\n      { id: 8, name: \"Brooklyn Center for Psychotherapy\", src: \"/bcp.png\" },\n    ],\n  },\n  bentoSection: {\n    title: \"Examples\",\n    description: \"Conversational demonstration\",\n    items: [\n      {\n        id: 1,\n        content: <FirstBentoAnimation />,\n        title: \"Study What Matters\",\n        description: \"We show you the highest-yield topics so every hour moves your score.\",\n      },\n      {\n        id: 2,\n        content: <ThirdBentoAnimation />,\n        title: \"Make It Stick\",\n        description:\n          \"Turns dense theory into customized and clear examples.\",\n      },\n      {\n        id: 3,\n        content: <FourthBentoAnimation />,\n        title: \"Replenish\",\n        description:\n          \"Improve focus and reduce burnout while learning relevant EPPP topics (ACT, MI, and CBT-I).\",\n      },\n      {\n        id: 4,\n        content: <SecondBentoAnimation />,\n        title: \"Frictionless Studying\",\n        description: \"Everything you need. Nothing you donâ€™t\",\n      },\n    ],\n  },\n  featureSection: {\n    title: \"Everything You Need to Pass\",\n    description: \"Comprehensive tools and resources designed specifically for EPPP success\",\n    items: [\n      {\n        id: 1,\n        title: \"Multimodal Learning\",\n        description: \"Learn through text, audio, and video - choose what works best for you\",\n        icon: \"ðŸ“š\",\n      },\n      {\n        id: 2,\n        title: \"Adaptive Practice\",\n        description: \"Smart quizzes that focus on your weak areas and track your progress\",\n        icon: \"ðŸŽ¯\",\n      },\n      {\n        id: 3,\n        title: \"Mobile Friendly\",\n        description: \"Study anywhere, anytime on any device with our responsive platform\",\n        icon: \"ðŸ“±\",\n      },\n      {\n        id: 4,\n        title: \"Expert Support\",\n        description: \"Get personalized coaching from Dr. Anders Chan, who scored 588\",\n        icon: \"ðŸ‘¨â€âš•ï¸\",\n      },\n    ],\n  },\n  quoteSection: {\n    quote:\n      \"I poured $1k and a month into studying and passed on my first try. This is the program that gives you everything I did and wish I had for a fraction of the time, cost, and stress.\",\n    author: {\n      name: \"Anders H. Chan, Psy.D.\",\n      role: \"Founder - thePsychology.ai\",\n      image: \"/images/anders-chan.png\",\n    },\n  },\n  pricing: {\n    title: \"Study Efficiently Today\",\n    description: \"Choose your learning plan\",\n    pricingItems: [\n      {\n        name: \"7-Day Free Trial\",\n        href: \"/#get-started\",\n        price: \"$0\",\n        period: \"week\",\n        yearlyPrice: \"n/a\",\n        features: [\"Diagnostic Exam\", \"Prioritizing Focus\", \"Custom Study (1 Topic/Domain)\"],\n        featuresLabel: \"Includes:\",\n        description: \"Limited to one topic per domain.\",\n        buttonText: \"Select\",\n        buttonColor: \"bg-primary text-primary-foreground\",\n        isPopular: true,\n        displayPrice: \"$0/week\",\n      },\n      {\n        name: \"Pro\",\n        href: \"/#get-started\",\n        price: \"$20\",\n        period: \"month\",\n        yearlyPrice: \"$200\",\n        features: [\"Diagnostic Exam\", \"Prioritizing Focus\", \"Custom Study (All Topics)\", \"Recovery Tools\"],\n        featuresLabel: \"Everything includes:\",\n        description: \"Unlimited access to all topics and tools.\",\n        buttonText: \"Select\",\n        buttonColor: \"bg-primary text-primary-foreground\",\n        isPopular: false,\n      },\n      {\n        name: \"Pro + Coaching\",\n        href: \"/#get-started\",\n        price: \"$200\",\n        period: \"month\",\n        yearlyPrice: \"$2000\",\n        features: [\"Everything in Pro\", \"2Ã— 45-min calls/month\", \"Personal study plan\", \"Priority support\"],\n        featuresLabel: \"Everything in Pro plus:\",\n        description: \"Pro + 2 1-on-1 calls/month with Dr. Chan\",\n        buttonText: \"Select\",\n        buttonColor: \"bg-primary text-primary-foreground\",\n        isPopular: false,\n      },\n    ],\n  },\n  testimonials: [\n    {\n      id: \"1\",\n      name: \"Dr. Sarah Mitchell\",\n      role: \"Clinical Psychologist\",\n      img: \"https://randomuser.me/api/portraits/women/44.jpg\",\n      description: (\n        <p>\n          The <Highlight className=\"text-brand-soft-blue dark:text-brand-sage\">adaptive quizzes</Highlight> were a game-changer for me. They identified my weak areas and\n          helped me focus my study time effectively. Passed on my first attempt!\n        </p>\n      ),\n    },\n    {\n      id: \"2\",\n      name: \"Michael Chen\",\n      role: \"Psychology Graduate\",\n      img: \"https://randomuser.me/api/portraits/men/32.jpg\",\n      description: (\n        <p>\n          I loved the <Highlight className=\"text-brand-coral dark:text-brand-soft-blue\">multimodal learning approach</Highlight>. Being able to switch between text, audio, and\n          video kept me engaged and helped me retain information better.\n        </p>\n      ),\n    },\n    {\n      id: \"3\",\n      name: \"Dr. Emily Rodriguez\",\n      role: \"School Psychologist\",\n      img: \"https://randomuser.me/api/portraits/women/68.jpg\",\n      description: (\n        <p>\n          The <Highlight className=\"text-brand-dusty-rose dark:text-brand-olive\">coaching sessions with Dr. Chan</Highlight> were invaluable. His insights and study strategies\n          made all the difference in my preparation.\n        </p>\n      ),\n    },\n    {\n      id: \"4\",\n      name: \"Anders Chan\",\n      role: \"Founder of thePsychology.ai\",\n      img: \"/images/anders-chan.png\",\n      description: (\n        <p>\n          I scored a 19% on my first practice diagnostic exam. Poured $1,000 and a month of intense studying, and{\" \"}\n          <Highlight className=\"text-brand-soft-blue dark:text-brand-coral\">I got a 588 on my first try.</Highlight> This program is what I wish I had for a fraction of the\n          time, cost, and stress.\n        </p>\n      ),\n    },\n    {\n      id: \"5\",\n      name: \"Jessica Thompson\",\n      role: \"Counseling Psychologist\",\n      img: \"https://randomuser.me/api/portraits/women/90.jpg\",\n      description: (\n        <p>\n          The <Highlight className=\"text-brand-coral dark:text-brand-dusty-rose\">mobile-friendly platform</Highlight> allowed me to study during my commute and lunch breaks.\n          Made the most of every spare moment!\n        </p>\n      ),\n    },\n    {\n      id: \"6\",\n      name: \"Dr. Menon\",\n      role: \"Licensed Psychologist\",\n      img: \"/images/user-icon.svg\",\n      description: (\n        <p>\n          thePsychology.ai is truly <Highlight className=\"text-brand-olive dark:text-brand-lavender-gray\">one-of-a-kind</Highlight>. It's an <Highlight className=\"text-brand-olive dark:text-brand-lavender-gray\">innovative, effective, and affordable</Highlight> tool for EPPP preparation. The platform makes dense material feel engaging and manageable, and it clearly reflects a design philosophy of being <Highlight className=\"text-brand-olive dark:text-brand-lavender-gray\">'for the people, by the people'</Highlight>.\n        </p>\n      ),\n    },\n  ],\n  faqSection: {\n    title: \"Questions People Actually Ask\",\n    description:\n      \"FAQs\",\n    faQitems: [\n      {\n        id: 1,\n        question: \"What is ThePsychology.ai?\",\n      answer:\n          \"A study coach powered by APIs that is helping psychologists increase their chances of passing the EPPP quickly (designed for 1 month) with less stress, zero data leaks, and minimal screen time. View this as an AI-augmented textbook where your learning is customized to your preferences\",\n      },\n      {\n        id: 2,\n        question: \"How is it different from other EPPP tools?\",\n        answer:\n          \"We donâ€™t just dump info â€” we prioritize what matters. No filler. No guessing. No burnout. This program helps you study smarter, not longer. This is built by psychologists, not corporations. If we as psychologists are to practice what we preach, we must also bring psychological principles in our learning. \",\n      },\n      {\n        id: 3,\n        question: \"What about the environment?\",\n        answer:\n          \"We are committed to awareness of consumption and consequently eco-efficiency with AI use (e.g., running smaller models locally where possible). One month on our system uses 96% less energy than six months of traditional prep. Thatâ€™s about 50 kg of COâ‚‚ saved per person.\",\n      },\n      {\n        id: 4,\n        question: \"What happens to my data?\",\n        answer: \"Your dataâ€™s yours. Export it. Delete it. Done. We use the data only to improve your training plan, no other agenda.\",\n      },\n      {\n        id: 5,\n        question: \"Is there a free trial available?\",\n        answer:\n          \"Yes, we offer a 7-day free trial that gives you full access to all features. No credit card is required to start your trial.\",\n      },\n\n      \n    ],\n  },\n  ctaSection: {\n    id: \"cta\",\n    title: \"Study quickly and affordably\",\n    backgroundImage: \"/agent-cta-background.png\",\n    button: { text: \"Start Your 7-Day Free Trial Today\", href: \"#\" },\n    subtext: \"Cancel anytime, no questions asked\",\n  },\n  footerLinks: [\n    {\n      title: \"Company\",\n      links: [\n        { id: 1, title: \"About\", url: \"/portfolio\" },\n        { id: 2, title: \"Contact\", url: \"#\" },\n        { id: 3, title: \"Blog\", url: \"#\" },\n        { id: 4, title: \"Story\", url: \"#\" },\n      ],\n    },\n    {\n      title: \"Products\",\n      links: [\n        { id: 5, title: \"Company\", url: \"#\" },\n        { id: 6, title: \"Product\", url: \"#\" },\n        { id: 7, title: \"Press\", url: \"#\" },\n        { id: 8, title: \"More\", url: \"#\" },\n      ],\n    },\n    {\n      title: \"Resources\",\n      links: [\n        { id: 9, title: \"Press\", url: \"#\" },\n        { id: 10, title: \"Careers\", url: \"#\" },\n        { id: 11, title: \"Newsletters\", url: \"#\" },\n        { id: 12, title: \"More\", url: \"#\" },\n      ],\n    },\n  ],\n}\n\nexport type SiteConfig = typeof siteConfig\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/dashboard-utils.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'currentDate' is never reassigned. Use 'const' instead.","line":114,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":114,"endColumn":18,"fix":{"range":[3216,3249],"text":"const currentDate = new Date(today)"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'topicsByDomain' is assigned a value but never used.","line":130,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { getAllQuizResults, QuizResult } from './quiz-results-storage'\n\nexport interface StudyStats {\n  totalQuizzes: number\n  averageScore: number\n  studyStreak: number\n  lastStudyDate: Date | null\n  bestPerformingDomain: string\n  recentScores: number[]\n  weakTopics: { topic: string; score: number }[]\n  lastStudiedTopic: string | null\n  studyDays: Date[]\n}\n\nexport function calculateStudyStats(): StudyStats {\n  const allResults = getAllQuizResults()\n\n  if (allResults.length === 0) {\n    return {\n      totalQuizzes: 0,\n      averageScore: 0,\n      studyStreak: 0,\n      lastStudyDate: null,\n      bestPerformingDomain: '',\n      recentScores: [],\n      weakTopics: [],\n      lastStudiedTopic: null,\n      studyDays: [],\n    }\n  }\n\n  // Sort by timestamp (most recent first)\n  const sortedResults = [...allResults].sort((a, b) => b.timestamp - a.timestamp)\n\n  // Calculate total quizzes\n  const totalQuizzes = allResults.length\n\n  // Calculate average score\n  const totalScore = allResults.reduce((sum, result) => sum + (result.score / result.totalQuestions) * 100, 0)\n  const averageScore = Math.round(totalScore / totalQuizzes)\n\n  // Get recent scores (last 10)\n  const recentScores = sortedResults\n    .slice(0, 10)\n    .map(result => Math.round((result.score / result.totalQuestions) * 100))\n    .reverse() // Oldest to newest for chart\n\n  // Calculate study streak\n  const studyStreak = calculateStreak(allResults)\n\n  // Get last study date\n  const lastStudyDate = sortedResults.length > 0 ? new Date(sortedResults[0].timestamp) : null\n\n  // Get last studied topic\n  const lastStudiedTopic = sortedResults.length > 0 ? sortedResults[0].topic : null\n\n  // Calculate best performing domain\n  const domainScores = calculateDomainScores(allResults)\n  const bestPerformingDomain = domainScores.length > 0\n    ? domainScores.sort((a, b) => b.score - a.score)[0].domain\n    : ''\n\n  // Find weak topics (< 60%)\n  const topicScores = calculateTopicScores(allResults)\n  const weakTopics = topicScores\n    .filter(t => t.score < 60)\n    .sort((a, b) => a.score - b.score)\n    .slice(0, 5)\n\n  // Get unique study days\n  const studyDays = getUniqueStudyDays(allResults)\n\n  return {\n    totalQuizzes,\n    averageScore,\n    studyStreak,\n    lastStudyDate,\n    bestPerformingDomain,\n    recentScores,\n    weakTopics,\n    lastStudiedTopic,\n    studyDays,\n  }\n}\n\nfunction calculateStreak(results: QuizResult[]): number {\n  if (results.length === 0) return 0\n\n  // Get unique study dates (dates with at least one quiz)\n  const studyDates = results\n    .map(r => {\n      const date = new Date(r.timestamp)\n      date.setHours(0, 0, 0, 0)\n      return date.getTime()\n    })\n    .filter((date, index, self) => self.indexOf(date) === index)\n    .sort((a, b) => b - a) // Most recent first\n\n  if (studyDates.length === 0) return 0\n\n  // Check if today or yesterday is in the list\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n  const yesterday = new Date(today)\n  yesterday.setDate(yesterday.getDate() - 1)\n\n  const mostRecentStudy = studyDates[0]\n  if (mostRecentStudy !== today.getTime() && mostRecentStudy !== yesterday.getTime()) {\n    return 0 // Streak is broken\n  }\n\n  // Count consecutive days\n  let streak = 0\n  let currentDate = new Date(today)\n  currentDate.setHours(0, 0, 0, 0)\n\n  for (const studyDate of studyDates) {\n    if (studyDate === currentDate.getTime()) {\n      streak++\n      currentDate.setDate(currentDate.getDate() - 1)\n    } else if (studyDate < currentDate.getTime()) {\n      break // Gap found\n    }\n  }\n\n  return streak\n}\n\nfunction calculateDomainScores(results: QuizResult[]): { domain: string; score: number }[] {\n  const topicsByDomain: Record<number, string> = {\n    0: 'Biological Bases',\n    1: 'Cognitive-Affective',\n    2: 'Social & Cultural',\n    3: 'Growth & Lifespan',\n    4: 'Assessment & Diagnosis',\n    5: 'Treatment & Intervention',\n    6: 'Research & Statistics',\n    7: 'Ethical & Legal',\n  }\n\n  const topicsToDomain: Record<string, string> = {\n    'Neurotransmitters & Receptors': 'Biological Bases',\n    'Brain Anatomy & Function': 'Biological Bases',\n    'Nervous System Organization': 'Biological Bases',\n    'Psychopharmacology': 'Biological Bases',\n    'Sleep & Circadian Rhythms': 'Biological Bases',\n    'Classical & Operant Conditioning': 'Cognitive-Affective',\n    'Observational Learning': 'Cognitive-Affective',\n    'Memory Systems & Encoding': 'Cognitive-Affective',\n    'Attention & Consciousness': 'Cognitive-Affective',\n    'Motivation & Emotion': 'Cognitive-Affective',\n    'Social Cognition & Attitudes': 'Social & Cultural',\n    'Group Dynamics & Conformity': 'Social & Cultural',\n    'Cultural Psychology': 'Social & Cultural',\n    'Organizational Psychology': 'Social & Cultural',\n    'Diversity & Multicultural Issues': 'Social & Cultural',\n    'Physical Development': 'Growth & Lifespan',\n    'Cognitive Development': 'Growth & Lifespan',\n    'Psychosocial Development': 'Growth & Lifespan',\n    'Moral Development': 'Growth & Lifespan',\n    'Aging & Late Adulthood': 'Growth & Lifespan',\n    'Psychological Testing Principles': 'Assessment & Diagnosis',\n    'Intelligence Assessment': 'Assessment & Diagnosis',\n    'Personality Assessment': 'Assessment & Diagnosis',\n    'Clinical Diagnosis & Psychopathology': 'Assessment & Diagnosis',\n    'Substance Use Disorders': 'Assessment & Diagnosis',\n    'Cognitive-Behavioral Therapies': 'Treatment & Intervention',\n    'Psychodynamic Therapies': 'Treatment & Intervention',\n    'Humanistic & Experiential Therapies': 'Treatment & Intervention',\n    'Group & Family Therapy': 'Treatment & Intervention',\n    'Evidence-Based Interventions': 'Treatment & Intervention',\n    'Research Design & Methodology': 'Research & Statistics',\n    'Experimental vs Non-Experimental': 'Research & Statistics',\n    'Descriptive Statistics': 'Research & Statistics',\n    'Inferential Statistics': 'Research & Statistics',\n    'Effect Size & Power': 'Research & Statistics',\n    'Ethical Principles & Guidelines': 'Ethical & Legal',\n    'Confidentiality & Privacy': 'Ethical & Legal',\n    'Informed Consent': 'Ethical & Legal',\n    'Competence & Boundaries': 'Ethical & Legal',\n    'Legal Liability & Licensing': 'Ethical & Legal',\n  }\n\n  const domainScores: Record<string, { total: number; count: number }> = {}\n\n  results.forEach(result => {\n    const domain = topicsToDomain[result.topic] || 'Unknown'\n    if (!domainScores[domain]) {\n      domainScores[domain] = { total: 0, count: 0 }\n    }\n    const percentage = (result.score / result.totalQuestions) * 100\n    domainScores[domain].total += percentage\n    domainScores[domain].count += 1\n  })\n\n  return Object.entries(domainScores).map(([domain, { total, count }]) => ({\n    domain,\n    score: Math.round(total / count),\n  }))\n}\n\nfunction calculateTopicScores(results: QuizResult[]): { topic: string; score: number }[] {\n  const topicScores: Record<string, { total: number; count: number }> = {}\n\n  results.forEach(result => {\n    if (!topicScores[result.topic]) {\n      topicScores[result.topic] = { total: 0, count: 0 }\n    }\n    const percentage = (result.score / result.totalQuestions) * 100\n    topicScores[result.topic].total += percentage\n    topicScores[result.topic].count += 1\n  })\n\n  return Object.entries(topicScores).map(([topic, { total, count }]) => ({\n    topic,\n    score: Math.round(total / count),\n  }))\n}\n\nfunction getUniqueStudyDays(results: QuizResult[]): Date[] {\n  const dates = results\n    .map(r => {\n      const date = new Date(r.timestamp)\n      date.setHours(0, 0, 0, 0)\n      return date.getTime()\n    })\n    .filter((date, index, self) => self.indexOf(date) === index)\n    .sort((a, b) => a - b)\n    .map(timestamp => new Date(timestamp))\n\n  return dates\n}\n\nexport interface StudyPaceInfo {\n  pace: 'On track' | 'Behind' | 'Ahead' | 'Unknown'\n  topicsPerWeek: number\n  daysRemaining: number\n  topicsCompleted: number\n  totalTopics: number\n}\n\nexport function calculateStudyPace(examDate: string | null, completedTopics: number): StudyPaceInfo {\n  const totalTopics = 56\n\n  if (!examDate) {\n    return {\n      pace: 'Unknown',\n      topicsPerWeek: 0,\n      daysRemaining: 0,\n      topicsCompleted: completedTopics,\n      totalTopics,\n    }\n  }\n\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n  const exam = new Date(examDate)\n  exam.setHours(0, 0, 0, 0)\n\n  const daysRemaining = Math.max(0, Math.ceil((exam.getTime() - today.getTime()) / (1000 * 60 * 60 * 24)))\n  const weeksRemaining = daysRemaining / 7\n\n  if (weeksRemaining <= 0) {\n    return {\n      pace: 'Unknown',\n      topicsPerWeek: 0,\n      daysRemaining: 0,\n      topicsCompleted: completedTopics,\n      totalTopics,\n    }\n  }\n\n  const topicsRemaining = totalTopics - completedTopics\n  const topicsPerWeek = Math.ceil(topicsRemaining / weeksRemaining)\n\n  // Calculate pace based on ideal progress\n  const idealCompletedTopics = (totalTopics * (1 - weeksRemaining / (daysRemaining / 7)))\n\n  let pace: 'On track' | 'Behind' | 'Ahead' = 'On track'\n  if (completedTopics < idealCompletedTopics * 0.9) {\n    pace = 'Behind'\n  } else if (completedTopics > idealCompletedTopics * 1.1) {\n    pace = 'Ahead'\n  }\n\n  return {\n    pace,\n    topicsPerWeek,\n    daysRemaining,\n    topicsCompleted: completedTopics,\n    totalTopics,\n  }\n}\n\n// Daily goal management\nexport function getDailyGoal(): number {\n  if (typeof window === 'undefined') return 2\n  const goal = localStorage.getItem('dailyQuizGoal')\n  return goal ? parseInt(goal, 10) : 2\n}\n\nexport function setDailyGoal(goal: number): void {\n  if (typeof window === 'undefined') return\n  // Validate goal is between 1 and 7\n  const validatedGoal = Math.max(1, Math.min(7, Math.round(goal)))\n  localStorage.setItem('dailyQuizGoal', validatedGoal.toString())\n}\n\nexport function getTodayQuizCount(): number {\n  const allResults = getAllQuizResults()\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n\n  return allResults.filter(result => {\n    const resultDate = new Date(result.timestamp)\n    resultDate.setHours(0, 0, 0, 0)\n    return resultDate.getTime() === today.getTime()\n  }).length\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/dev-exam-results-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89,92],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89,92],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[283,286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[283,286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { randomUUID } from 'crypto'\n\nexport interface DevExamResultRecord {\n  questions: any[]\n  selected_answers: Record<number, string>\n  flagged_questions: Record<number, boolean>\n  score: number\n  total_questions: number\n  exam_type: string\n  exam_mode: string\n  top_priorities: any\n  all_results: any\n  user_id?: string\n  created_at: string\n}\n\ntype GlobalWithExamStore = typeof globalThis & {\n  __devExamResultsStore?: Map<string, DevExamResultRecord>\n}\n\nconst globalWithStore = globalThis as GlobalWithExamStore\n\nif (!globalWithStore.__devExamResultsStore) {\n  globalWithStore.__devExamResultsStore = new Map()\n}\n\nconst store = globalWithStore.__devExamResultsStore!\n\nexport function saveDevExamResult(record: DevExamResultRecord): string {\n  const id = (typeof randomUUID === 'function' ? randomUUID() : `local-${Date.now()}`)\n  store.set(id, record)\n  return id\n}\n\nexport function getDevExamResult(id: string): DevExamResultRecord | null {\n  return store.get(id) ?? null\n}\n\nfunction getRecordTimestamp(record: DevExamResultRecord): number {\n  if (!record?.created_at) return 0\n  const time = new Date(record.created_at).getTime()\n  return Number.isFinite(time) ? time : 0\n}\n\nexport function getDevExamResultsForUser(\n  userId: string\n): Array<{ id: string; record: DevExamResultRecord }> {\n  if (!userId) return []\n\n  const results: Array<{ id: string; record: DevExamResultRecord }> = []\n\n  for (const [id, record] of store.entries()) {\n    if (record.user_id !== userId) continue\n    results.push({ id, record })\n  }\n\n  return results.sort(\n    (a, b) => getRecordTimestamp(b.record) - getRecordTimestamp(a.record)\n  )\n}\n\nexport function getLatestDevExamResultForUser(\n  userId: string\n): { id: string; record: DevExamResultRecord } | null {\n  const [latest] = getDevExamResultsForUser(userId)\n  return latest || null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/exam-file-manager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[701,704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[701,704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1251,1254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1251,1254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1346,1349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1346,1349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'examType' is defined but never used.","line":117,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":11}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Exam File Manager\n * Handles loading and parsing exam .md files from GitHub\n */\n\nexport interface ExamFileMetadata {\n  exam_id: string\n  exam_type: 'diagnostic' | 'practice'\n  generated_at: string\n  question_count: number\n  version: number\n}\n\nexport interface Question {\n  id: number\n  question: string\n  options: string[]\n  correct_answer: string\n  explanation: string\n  domain: string\n  difficulty: 'easy' | 'medium' | 'hard'\n  isScored?: boolean\n  knId?: string\n  type?: string\n}\n\nexport interface ExamData {\n  metadata: ExamFileMetadata\n  questions: Question[]\n}\n\n/**\n * Parse frontmatter from markdown file\n */\nexport function parseFrontmatter(content: string): { metadata: Record<string, any>; body: string } {\n  const match = content.match(/^---\\n([\\s\\S]*?)\\n---\\n([\\s\\S]*)$/)\n  if (!match) {\n    throw new Error('Invalid frontmatter format')\n  }\n\n  const metadataStr = match[1]\n  const body = match[2]\n\n  // Parse YAML manually (simple key: value format)\n  const metadata: Record<string, any> = {}\n  metadataStr.split('\\n').forEach(line => {\n    const [key, ...valueParts] = line.split(':')\n    if (key && valueParts.length > 0) {\n      const value = valueParts.join(':').trim()\n      // Remove quotes if present\n      let parsedValue: any = value.replace(/^['\"]|['\"]$/g, '')\n      // Parse numbers\n      if (!isNaN(parsedValue as any)) {\n        parsedValue = Number(parsedValue)\n      }\n      // Parse booleans\n      if (parsedValue === 'true') parsedValue = true\n      if (parsedValue === 'false') parsedValue = false\n      metadata[key.trim()] = parsedValue\n    }\n  })\n\n  return { metadata, body }\n}\n\n/**\n * Parse exam data from markdown content\n */\nexport function parseExamFile(content: string): ExamData {\n  const { metadata, body } = parseFrontmatter(content)\n\n  // Parse JSON questions from body\n  const questions = JSON.parse(body).questions || JSON.parse(body)\n\n  return {\n    metadata: metadata as ExamFileMetadata,\n    questions: questions as Question[],\n  }\n}\n\n/**\n * Format exam data as markdown with frontmatter\n */\nexport function formatExamFile(metadata: ExamFileMetadata, questions: Question[]): string {\n  const frontmatter = `---\nexam_id: ${metadata.exam_id}\nexam_type: ${metadata.exam_type}\ngenerated_at: ${metadata.generated_at}\nquestion_count: ${metadata.question_count}\nversion: ${metadata.version}\n---`\n\n  const body = JSON.stringify({ questions }, null, 2)\n\n  return `${frontmatter}\\n\\n${body}`\n}\n\n/**\n * Get exam file path from exam_id\n */\nexport function getExamFilePath(exam_id: string, exam_type: 'diagnostic' | 'practice'): string {\n  return `exams/${exam_type}/${exam_id}.md`\n}\n\n/**\n * Get GitHub raw content URL\n */\nexport function getGitHubRawUrl(repoOwner: string, repoName: string, filePath: string): string {\n  return `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}`\n}\n\n/**\n * List available exam files in a directory\n * This would typically be done by checking the Git repository\n */\nexport async function getAvailableExamFiles(\n  examType: 'diagnostic' | 'practice'\n): Promise<string[]> {\n  // This function would need access to the git repository\n  // For now, it returns an empty array - will be implemented with actual file listing\n  // Can be done via:\n  // 1. GitHub API to list files in directory\n  // 2. Reading from local filesystem in development\n  // 3. Pre-computed list from build process\n  return []\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/exam-result-saver.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[735,738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[735,738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Utility for saving exam results to unified question tracking system\n * Called after exams complete to record which questions were answered correctly/incorrectly\n */\n\nimport {\n  saveQuestionResult,\n  addSectionResult,\n  resolveSectionResult,\n  QuestionResult,\n  SectionResult,\n} from './unified-question-results'\n\nexport interface ExamQuestion {\n  id?: string\n  question: string\n  correct_answer: string\n  topic?: string\n  domain?: string\n  // New fields for source tracking and org psych integration\n  source_file?: string\n  source_folder?: string\n  question_type?: 'standard' | 'distinction' | 'difficult'\n  is_org_psych?: boolean\n  knId?: string\n  difficulty?: 'easy' | 'medium' | 'hard'\n  isScored?: boolean\n  [key: string]: any\n}\n\nexport interface ExamResultsSummary {\n  examType: 'diagnostic' | 'practice' | 'quiz'\n  topic: string\n  domain: string\n  selectedAnswers: Record<number, string>\n  questions: ExamQuestion[]\n  sessionId?: string\n}\n\n/**\n * Save exam results to the unified tracking system\n * This records which questions were answered correctly/incorrectly\n * for the purpose of tracking learning progress and showing green apples\n */\nexport function saveExamResults(summary: ExamResultsSummary): void {\n  if (typeof window === 'undefined') return\n\n  const { examType, topic, domain, selectedAnswers, questions, sessionId } = summary\n\n  console.log(`[Exam Result Saver] Saving ${examType} exam results for topic: ${topic}`)\n\n  questions.forEach((question, index) => {\n    const selectedAnswer = selectedAnswers[index]\n    if (!selectedAnswer) {\n      // Skip unanswered questions\n      return\n    }\n\n    const isCorrect = selectedAnswer === question.correct_answer\n\n    // Create question result record\n    const questionResult: QuestionResult = {\n      questionId: question.id || `${topic}_q${index}`,\n      question: question.question,\n      examType,\n      topic,\n      domain,\n      selectedAnswer,\n      correctAnswer: question.correct_answer,\n      isCorrect,\n      timestamp: Date.now(),\n      sessionId,\n    }\n\n    saveQuestionResult(questionResult)\n\n    // If question was answered incorrectly, mark the topic's section as needing review\n    if (!isCorrect) {\n      // For now, we track at the topic level\n      // In the future, this could be enhanced to track specific sections\n      const sectionResult: SectionResult = {\n        sectionName: 'Main Content', // Placeholder - could be enhanced to specific sections\n        topicName: topic,\n        domain,\n        wrongCount: 1,\n        lastAttempted: Date.now(),\n        isResolved: false,\n      }\n      addSectionResult(sectionResult)\n    } else {\n      // If question was answered correctly, check if this resolves any sections\n      // This marks the section as \"mastered\" since user got a question right\n      resolveSectionResult(topic, 'Main Content')\n    }\n  })\n\n  console.log(\n    `[Exam Result Saver] Saved ${questions.length} question results for ${topic}`\n  )\n}\n\n/**\n * Get summary statistics for exam results\n */\nexport function getExamStats(topic: string) {\n  // This can be used to display statistics about exam performance\n  // Implementation would depend on the unified results system\n  return {\n    topic,\n    // Stats would go here\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/pre-generated-exams.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PreGeneratedExam' is defined but never used.","line":28,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":196,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":196,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { createClient } from '@supabase/supabase-js'\n\n// Types\ninterface Question {\n  id: number\n  question: string\n  options: string[]\n  correct_answer: string\n  explanation: string\n  domain: string\n  difficulty: 'easy' | 'medium' | 'hard'\n  isScored?: boolean\n  knId?: string\n  type?: string\n  // New fields for source tracking and org psych integration\n  source_file?: string\n  source_folder?: string\n  question_type?: 'standard' | 'distinction' | 'difficult'\n  is_org_psych?: boolean\n}\n\ninterface ExamQuestions {\n  questions: Question[]\n}\n\ninterface PreGeneratedExam {\n  id: string\n  user_id: string\n  exam_type: 'diagnostic' | 'practice'\n  questions: ExamQuestions\n  generated_at: string\n  expires_at: string\n  used: boolean\n  created_at: string\n}\n\n// Initialize Supabase client\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.warn('Supabase credentials missing - pre-generated exams will not work')\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null\n\n/**\n * Get a pre-generated exam for a user\n * Returns null if no valid pre-gen exists\n * Marks exam as used when retrieved\n */\nexport async function getPreGeneratedExam(\n  userId: string,\n  examType: 'diagnostic' | 'practice'\n): Promise<ExamQuestions | null> {\n  if (!supabase) {\n    console.warn('Supabase not initialized - cannot fetch pre-generated exam')\n    return null\n  }\n\n  try {\n    // Fetch unused, non-expired exam\n    const { data, error } = await supabase\n      .from('pre_generated_exams')\n      .select('id, questions, expires_at')\n      .eq('user_id', userId)\n      .eq('exam_type', examType)\n      .eq('used', false)\n      .gt('expires_at', new Date().toISOString())\n      .order('created_at', { ascending: false })\n      .limit(1)\n      .single()\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        // No rows returned - this is normal\n        return null\n      }\n      console.error('Error fetching pre-generated exam:', error)\n      return null\n    }\n\n    if (!data) {\n      return null\n    }\n\n    // Mark as used\n    await supabase.from('pre_generated_exams').update({ used: true }).eq('id', data.id)\n\n    return data.questions\n  } catch (err) {\n    console.error('Error in getPreGeneratedExam:', err)\n    return null\n  }\n}\n\n/**\n * Save a pre-generated exam for a user\n */\nexport async function savePreGeneratedExam(\n  userId: string,\n  examType: 'diagnostic' | 'practice',\n  questions: ExamQuestions\n): Promise<boolean> {\n  if (!supabase) {\n    console.warn('Supabase not initialized - cannot save pre-generated exam')\n    return false\n  }\n\n  try {\n    const expiresAt = new Date()\n    expiresAt.setDate(expiresAt.getDate() + 7) // 7 day expiration\n\n    const { error } = await supabase.from('pre_generated_exams').insert({\n      user_id: userId,\n      exam_type: examType,\n      questions,\n      expires_at: expiresAt.toISOString(),\n      used: false,\n    })\n\n    if (error) {\n      console.error('Error saving pre-generated exam:', error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error('Error in savePreGeneratedExam:', err)\n    return false\n  }\n}\n\n/**\n * Check if a valid pre-generated exam exists for a user\n */\nexport async function hasValidPreGeneratedExam(\n  userId: string,\n  examType: 'diagnostic' | 'practice'\n): Promise<boolean> {\n  if (!supabase) {\n    return false\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('pre_generated_exams')\n      .select('id', { count: 'exact' })\n      .eq('user_id', userId)\n      .eq('exam_type', examType)\n      .eq('used', false)\n      .gt('expires_at', new Date().toISOString())\n      .limit(1)\n\n    if (error) {\n      console.error('Error checking for pre-generated exam:', error)\n      return false\n    }\n\n    return (data?.length ?? 0) > 0\n  } catch (err) {\n    console.error('Error in hasValidPreGeneratedExam:', err)\n    return false\n  }\n}\n\n/**\n * Trigger background pre-generation of next exam\n * Called from the prioritizer page after exam completion\n * Uses improved job queue for better reliability\n */\nexport async function triggerBackgroundPreGeneration(\n  userId: string,\n  lastExamType: 'diagnostic' | 'practice'\n): Promise<void> {\n  try {\n    // Determine next exam type\n    const nextExamType = lastExamType === 'diagnostic' ? 'practice' : 'diagnostic'\n\n    // Check if we already have a valid pre-gen for this type\n    const hasExisting = await hasValidPreGeneratedExam(userId, nextExamType)\n    if (hasExisting) {\n      console.log(`Pre-generated ${nextExamType} exam already exists`)\n      return\n    }\n\n    // Use improved job queue handler if available (client-side)\n    if (typeof window !== 'undefined') {\n      try {\n        const { enqueueExamGeneration } = await import('./background-job-handler')\n        enqueueExamGeneration(userId, nextExamType)\n        console.log(`[Pre-Gen] Queued ${nextExamType} exam generation for user ${userId}`)\n        return\n      } catch (err) {\n        console.warn('Job queue handler not available, falling back to direct fetch')\n      }\n    }\n\n    // Fire-and-forget background generation (fallback)\n    // DISABLED: This tries to write to filesystem which doesn't work on Vercel\n    // Exams are now pre-generated and committed to git in /exams directory\n    console.log('[Pre-Gen] Background generation disabled - using pre-generated exams from /exams directory')\n    // fetch('/api/pre-generate-exam', {\n    //   method: 'POST',\n    //   headers: {\n    //     'Content-Type': 'application/json',\n    //   },\n    //   body: JSON.stringify({\n    //     userId,\n    //     examType: nextExamType,\n    //   }),\n    // }).catch((err) => {\n    //   console.error('Background pre-generation failed (non-critical):', err)\n    // })\n  } catch (err) {\n    console.error('Error triggering background pre-generation:', err)\n  }\n}\n\n/**\n * Clean up expired exams (should be called periodically or via cron)\n * Deletes exams that are:\n * 1. Marked as used AND created more than 1 day ago\n * 2. Expired (expires_at < now)\n */\nexport async function cleanupExpiredExams(): Promise<number> {\n  if (!supabase) {\n    console.warn('Supabase not initialized - cannot cleanup exams')\n    return 0\n  }\n\n  try {\n    const oneDayAgo = new Date()\n    oneDayAgo.setDate(oneDayAgo.getDate() - 1)\n    const now = new Date()\n\n    // Delete used exams older than 1 day\n    const { data: usedDeleted, error: usedError } = await supabase\n      .from('pre_generated_exams')\n      .delete()\n      .eq('used', true)\n      .lt('created_at', oneDayAgo.toISOString())\n\n    // Delete expired exams\n    const { data: expiredDeleted, error: expiredError } = await supabase\n      .from('pre_generated_exams')\n      .delete()\n      .lt('expires_at', now.toISOString())\n\n    if (usedError) {\n      console.error('Error deleting used exams:', usedError)\n    }\n    if (expiredError) {\n      console.error('Error deleting expired exams:', expiredError)\n    }\n\n    const count = (usedDeleted?.length ?? 0) + (expiredDeleted?.length ?? 0)\n    if (count > 0) {\n      console.log(`Cleaned up ${count} pre-generated exams`)\n    }\n    return count\n  } catch (err) {\n    console.error('Error in cleanupExpiredExams:', err)\n    return 0\n  }\n}\n\n/**\n * Mark a specific exam as used\n * (utility function for more control)\n */\nexport async function markExamAsUsed(examId: string): Promise<boolean> {\n  if (!supabase) {\n    console.warn('Supabase not initialized')\n    return false\n  }\n\n  try {\n    const { error } = await supabase\n      .from('pre_generated_exams')\n      .update({ used: true })\n      .eq('id', examId)\n\n    if (error) {\n      console.error('Error marking exam as used:', error)\n      return false\n    }\n\n    return true\n  } catch (err) {\n    console.error('Error in markExamAsUsed:', err)\n    return false\n  }\n}\n\n/**\n * Get pre-generation stats for a user (for analytics/debugging)\n */\nexport async function getPreGenStats(userId: string): Promise<{\n  totalGenerated: number\n  totalUsed: number\n  unexpiredUnused: number\n  expiredCount: number\n} | null> {\n  if (!supabase) {\n    return null\n  }\n\n  try {\n    const now = new Date().toISOString()\n\n    const { data, error } = await supabase.from('pre_generated_exams').select('*').eq('user_id', userId)\n\n    if (error) {\n      console.error('Error fetching pre-gen stats:', error)\n      return null\n    }\n\n    if (!data) {\n      return { totalGenerated: 0, totalUsed: 0, unexpiredUnused: 0, expiredCount: 0 }\n    }\n\n    const totalGenerated = data.length\n    const totalUsed = data.filter((e) => e.used).length\n    const unexpiredUnused = data.filter((e) => !e.used && e.expires_at > now).length\n    const expiredCount = data.filter((e) => e.expires_at <= now).length\n\n    return {\n      totalGenerated,\n      totalUsed,\n      unexpiredUnused,\n      expiredCount,\n    }\n  } catch (err) {\n    console.error('Error in getPreGenStats:', err)\n    return null\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/priority-calculator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'questionText' is defined but never used.","line":37,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2964,2967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2964,2967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3017,3020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3017,3020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3063,3066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3063,3066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3114,3117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3114,3117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalQuestions' is defined but never used.","line":409,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":409,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":590,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":590,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20581,20584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20581,20584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":636,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":636,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22212,22215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22212,22215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Priority Calculator\n// Calculates priority scores based on: (% wrong in domain) Ã— (domain weight)\n// Used by: prioritizer to rank domains and recommend topics\n\nimport { KN_BY_DOMAIN, DOMAIN_WEIGHTS, KN_DATA, type KnowledgeStatement } from \"./kn-data\"\nimport { KN_TOPIC_MAPPING } from \"./kn-topic-mapping\"\nimport type { WrongAnswer } from \"./quiz-results-storage\"\nimport type { PriorityDomainRecommendation, WrongKNInfo, RecommendedTopic } from \"./priority-storage\"\nimport { EPPP_DOMAINS } from \"./eppp-data\"\n\nconst DOMAIN_NAMES: Record<number, string> = {\n  1: \"Biological Bases of Behavior\",\n  2: \"Cognitive-Affective Bases of Behavior\",\n  3: \"Social Psychology & Cultural Aspects\",\n  4: \"Growth & Lifespan Development\",\n  5: \"Assessment, Diagnosis & Psychopathology\",\n  6: \"Treatment & Intervention\",\n  7: \"Research Methods & Statistics\",\n  8: \"Ethical, Legal & Professional Issues\",\n}\n\nexport interface DomainPerformance {\n  domainNumber: number\n  domainName: string\n  domainWeight: number\n  totalQuestionsInDomain: number\n  totalWrongInDomain: number\n  percentageWrong: number\n  priorityScore: number // percentageWrong * domainWeight\n  wrongSourceFiles: string[] // source files from incorrect/skipped questions\n}\n\n/**\n * Parse question/wrong answer to determine which domain/KN it belongs to\n * Strategy: Search for domain number in question text or use QuizResults metadata\n */\nexport function getKNFromQuestion(questionId: number, questionText: string): string | null {\n  // For diagnostic exams, questionId directly maps to KN (Q1=KN1, Q2=KN2, etc.)\n  if (questionId >= 1 && questionId <= 71) {\n    return `KN${questionId}`\n  }\n\n  // For practice exams, we need to infer from the question or domain metadata\n  // This would require additional metadata in the question structure\n  // For now, return null and handle at the prioritizer level\n  return null\n}\n\n/**\n * Calculate domain performance based on wrong answers\n * Counts actual questions from the exam and calculates performance based on responses submitted\n */\nexport function calculateDomainPerformance(\n  wrongAnswers: (WrongAnswer & { domain?: string; source_file?: string })[],\n  allQuestions?: Array<{ domain?: string; is_org_psych?: boolean; isScored?: boolean; scored?: boolean }>\n): DomainPerformance[] {\n  const domainData: Record<number, { wrong: number; total: number; wrongKNs: Set<string>; wrongFiles: Set<string> }> = {}\n\n  // Initialize domain data - count actual questions from exam if provided, otherwise use reasonable defaults\n  for (let i = 1; i <= 8; i++) {\n    domainData[i] = {\n      wrong: 0,\n      total: 0,\n      wrongKNs: new Set(),\n      wrongFiles: new Set(),\n    }\n  }\n\n  // Count total questions per domain from the exam\n  if (allQuestions) {\n    for (const question of allQuestions) {\n      // Skip org psych questions - count them separately\n      if (question.is_org_psych === true) {\n        continue\n      }\n\n      const isScored =\n        typeof (question as any).isScored === 'boolean'\n          ? (question as any).isScored\n          : typeof (question as any).scored === 'boolean'\n          ? (question as any).scored\n          : true\n      if (!isScored) continue\n\n      // Extract domain number from domain metadata\n      let domain: number | null = null\n      if (question.domain) {\n        const match = question.domain.match(/Domain (\\d+)/)\n        domain = match ? parseInt(match[1]) : null\n      }\n\n      if (domain && domain >= 1 && domain <= 8) {\n        domainData[domain].total++\n      }\n    }\n  }\n\n  // Use hardcoded defaults only if we don't have actual question data\n  if (allQuestions === undefined || domainData[1].total === 0) {\n    const PRACTICE_EXAM_QUESTION_COUNTS: Record<number, number> = {\n      1: 23,\n      2: 29,\n      3: 25,\n      4: 27,\n      5: 36,\n      6: 34,\n      7: 18,\n      8: 33,\n    }\n    for (let i = 1; i <= 8; i++) {\n      domainData[i].total = PRACTICE_EXAM_QUESTION_COUNTS[i]\n    }\n  }\n\n  // Count wrong answers per domain\n  for (const wrongAnswer of wrongAnswers) {\n    // SKIP org psych questions - they are tracked separately in calculateOrgPsychPerformance\n    if (wrongAnswer.is_org_psych === true) {\n      continue\n    }\n\n    // First try to get domain from domain metadata\n    let domain: number | null = null\n\n    if (wrongAnswer.domain) {\n      // Extract domain number from domain name like \"Domain 1: Biological Bases of Behavior\"\n      const match = wrongAnswer.domain.match(/Domain (\\d+)/)\n      domain = match ? parseInt(match[1]) : null\n    }\n\n    // Fallback: Try to extract KN from questionId for diagnostic exams\n    if (!domain) {\n      const knId = `KN${wrongAnswer.questionId}`\n      const kn = KN_DATA[knId]\n      if (kn) {\n        domain = kn.domain\n      }\n    }\n\n    if (domain && domain >= 1 && domain <= 8) {\n      domainData[domain].wrong++\n      if (wrongAnswer.source_file) {\n        domainData[domain].wrongFiles.add(wrongAnswer.source_file)\n      }\n    }\n  }\n\n  // Calculate performance metrics\n  const performance: DomainPerformance[] = []\n\n  for (let i = 1; i <= 8; i++) {\n    const data = domainData[i]\n    // Avoid division by zero\n    const percentageWrong = data.total > 0 ? (data.wrong / data.total) * 100 : 0\n    const domainWeight = DOMAIN_WEIGHTS[i]\n    const priorityScore = (percentageWrong / 100) * domainWeight * 100 // (% wrong as decimal) Ã— weight Ã— 100\n\n    performance.push({\n      domainNumber: i,\n      domainName: DOMAIN_NAMES[i],\n      domainWeight: domainWeight * 100, // Convert to percentage for display\n      totalQuestionsInDomain: data.total,\n      totalWrongInDomain: data.wrong,\n      percentageWrong: Math.round(percentageWrong * 100) / 100, // Round to 2 decimals\n      priorityScore: Math.round(priorityScore * 100) / 100, // Round to 2 decimals\n      wrongSourceFiles: Array.from(data.wrongFiles), // Include source files from incorrect/skipped questions\n    })\n  }\n\n  return performance\n}\n\n/**\n * Get top 3 priority domains sorted by priority score (highest first)\n */\nexport function getTopPriorityDomains(performance: DomainPerformance[]): DomainPerformance[] {\n  return performance.sort((a, b) => b.priorityScore - a.priorityScore).slice(0, 3)\n}\n\n/**\n * Get wrong KNs for a specific domain\n */\nexport function getWrongKNsForDomain(\n  domainNumber: number,\n  wrongAnswers: (WrongAnswer & { knId?: string })[]\n): WrongKNInfo[] {\n  const wrongKNs = wrongAnswers\n    .map((answer) => {\n      // Use knId from question if available (practice exams), else fall back to questionId (diagnostic exams)\n      const knId = answer.knId || `KN${answer.questionId}`\n      const kn = KN_DATA[knId]\n      return kn && kn.domain === domainNumber ? { knId, kn } : null\n    })\n    .filter((item): item is { knId: string; kn: KnowledgeStatement } => item !== null)\n\n  // Deduplicate and calculate percentage wrong\n  const uniqueWrongKNs = new Map<string, KnowledgeStatement>()\n  wrongKNs.forEach(({ knId, kn }) => {\n    uniqueWrongKNs.set(knId, kn)\n  })\n\n  return Array.from(uniqueWrongKNs.entries()).map(([knId, kn]) => ({\n    knId,\n    knName: kn.name,\n    percentageWrong: 100, // If it appears in wrongAnswers, it was completely wrong\n  }))\n}\n\n/**\n * Get recommended topics for a domain based on wrong KNs\n */\nexport function getRecommendedTopicsForDomain(domainNumber: number, wrongKNs: WrongKNInfo[]): string[] {\n  const topicIds = new Set<string>()\n\n  // Get all topics mapped to wrong KNs\n  wrongKNs.forEach((wrongKN) => {\n    const mappedTopics = KN_TOPIC_MAPPING[wrongKN.knId] || []\n    mappedTopics.forEach((topicId) => topicIds.add(topicId))\n  })\n\n  // If no specific topics from wrong KNs, get all topics for this domain\n  if (topicIds.size === 0) {\n    const knIds = KN_BY_DOMAIN[domainNumber] || []\n    knIds.forEach((knId) => {\n      const mappedTopics = KN_TOPIC_MAPPING[knId] || []\n      mappedTopics.forEach((topicId) => topicIds.add(topicId))\n    })\n  }\n\n  return Array.from(topicIds)\n}\n\n/**\n * Convert topic IDs to RecommendedTopic objects with topic names and domain IDs\n * Strips leading numbers from topic names (e.g., \"1 Brain Regions\" â†’ \"Brain Regions\")\n */\nexport function convertTopicIdsToTopicNames(topicIds: string[]): RecommendedTopic[] {\n  const recommendedTopics: RecommendedTopic[] = []\n\n  topicIds.forEach((topicId) => {\n    // Find the domain that contains this topic ID\n    const domain = EPPP_DOMAINS.find((d) => {\n      const [domainPart] = topicId.split('-')\n      return d.id === domainPart || d.id.includes(domainPart)\n    })\n\n    if (domain) {\n      // Extract topic index from topicId (format: \"domainId-index\")\n      const parts = topicId.split('-')\n      const topicIndex = parseInt(parts[parts.length - 1])\n\n      if (topicIndex >= 0 && topicIndex < domain.topics.length) {\n        const topicName = domain.topics[topicIndex].name\n        // Strip leading number if present (e.g., \"1 Brain Regions\" â†’ \"Brain Regions\")\n        const cleanedName = topicName.replace(/^\\d+\\s+/, '')\n\n        recommendedTopics.push({\n          topicName: cleanedName,\n          domainId: domain.id,\n        })\n      }\n    }\n  })\n\n  return recommendedTopics\n}\n\n/**\n * Extract organizational psychology topics from source file names\n * Directly uses source file names as topic names instead of trying to match to EPPP_DOMAINS\n * This ensures all source files from incorrect org psych answers appear as recommendations\n * e.g., \"2 Theories of Motivation.md\" â†’ \"Theories of Motivation\"\n */\nexport function extractOrgPsychTopicsFromSourceFiles(sourceFiles: string[]): RecommendedTopic[] {\n  const orgPsychDomain = EPPP_DOMAINS.find((d) => d.id === '3-5-6')\n  if (!orgPsychDomain) return []\n\n  const recommendedTopics: RecommendedTopic[] = []\n  const addedTopics = new Set<string>()\n\n  sourceFiles.forEach((sourceFile) => {\n    if (!sourceFile) return\n\n    // Support both bare filenames and full paths from questionsGPT/exams\n    // e.g., \"/.../5 6 Organizational Leadership.json\" â†’ \"5 6 Organizational Leadership\"\n    const parts = sourceFile.split(/[\\\\/]/)\n    const fileName = parts[parts.length - 1] || sourceFile\n    const baseName = fileName.replace(/\\.(json|md)$/i, '')\n\n    // Clean topic name for display and topic-teacher (strip domain prefixes)\n    // e.g., \"5 6 Organizational Leadership\" â†’ \"Organizational Leadership\"\n    const cleanedName = baseName.replace(/^[\\d\\s]+/, '')\n\n    // Use source file name directly as topic (don't try to match to EPPP_DOMAINS topics)\n    // This ensures all source files from wrong answers appear as recommendations\n    if (!addedTopics.has(cleanedName)) {\n      addedTopics.add(cleanedName)\n      // Convert to kebab-case for topic-content-v3-test format\n      const topicContentFormat = convertToTopicContentFormat(cleanedName)\n      recommendedTopics.push({\n        topicName: cleanedName,\n        // Keep a human-readable filename (no path, no extension) for display\n        sourceFile: baseName,\n        domainId: '3-5-6',\n        topicContentFormat, // For use in links to topic-content-v3-test\n      })\n    }\n  })\n\n  return recommendedTopics\n}\n\n/**\n * Convert filename to kebab-case format for topic-content-v3-test links\n * e.g., \"Brain Regions and Functions\" â†’ \"brain-regions-and-functions\"\n */\nfunction convertToTopicContentFormat(topicName: string): string {\n  return topicName\n    .toLowerCase()\n    .replace(/[&]/g, 'and')\n    .replace(/[^\\w\\s-]/g, '')\n    .trim()\n    .replace(/\\s+/g, '-')\n}\n\n/**\n * Convert source file names to RecommendedTopic objects for regular domains\n * Directly uses source file names as topic names instead of trying to match to EPPP_DOMAINS\n * This ensures all source files from incorrect answers appear as recommendations\n * e.g., \"1 Brain Regions.md\" â†’ topic name \"Brain Regions\"\n */\nexport function convertSourceFilesToTopicNames(sourceFiles: string[], domainNumber: number): RecommendedTopic[] {\n  const domain = EPPP_DOMAINS.find((d) => {\n    // Find domain by matching domain number in the id\n    const idStart = d.id.split('-')[0]\n    return idStart === String(domainNumber)\n  })\n\n  if (!domain) return []\n\n  const recommendedTopics: RecommendedTopic[] = []\n  const addedTopics = new Set<string>()\n\n  sourceFiles.forEach((sourceFile) => {\n    if (!sourceFile) return\n\n    // Support both bare filenames and full paths from questionsGPT/exams\n    // e.g., \"/.../1 Brain Regions.md\" or \".json\"\n    const parts = sourceFile.split(/[\\\\/]/)\n    const fileName = parts[parts.length - 1] || sourceFile\n    const baseName = fileName.replace(/\\.(json|md)$/i, '')\n\n    // Strip domain prefix to get clean topic name\n    // e.g., \"1 Brain Regions\" â†’ \"Brain Regions\"\n    const cleanTopicName = baseName.replace(/^[\\d\\s]+/, '')\n\n    // Use source file name directly as topic (don't try to match to EPPP_DOMAINS topics)\n    // This ensures all source files from wrong answers appear as recommendations\n    if (!addedTopics.has(cleanTopicName)) {\n      addedTopics.add(cleanTopicName)\n      // Convert to kebab-case for topic-content-v3-test format\n      const topicContentFormat = convertToTopicContentFormat(cleanTopicName)\n      recommendedTopics.push({\n        topicName: cleanTopicName,\n        // Keep a human-readable filename (no path, no extension) for display\n        sourceFile: baseName,\n        domainId: domain.id,\n        topicContentFormat, // For use in links to topic-content-v3-test\n      })\n    }\n  })\n\n  return recommendedTopics\n}\n\n/**\n * Convert recommendedTopics back to topic IDs for matching in topic-selector\n * Matches topic names against EPPP_DOMAINS to find their indices\n * Returns IDs like [\"1-0\", \"1-2\", \"2-3\"] that topic-selector can use for badges\n */\nexport function convertRecommendedTopicsToIds(recommendedTopics: RecommendedTopic[]): string[] {\n  const topicIds: string[] = []\n\n  recommendedTopics.forEach((rec) => {\n    const domain = EPPP_DOMAINS.find((d) => d.id === rec.domainId)\n    if (!domain) return\n\n    // Find the topic index by matching the name\n    const topicIndex = domain.topics.findIndex((t) => {\n      // Try exact match (strip leading numbers from both)\n      const cleanTopicName = t.name.replace(/^[\\d\\s]+/, '')\n      const cleanRecName = rec.topicName.replace(/^[\\d\\s]+/, '')\n      return cleanTopicName.toLowerCase() === cleanRecName.toLowerCase()\n    })\n\n    if (topicIndex !== -1) {\n      topicIds.push(`${rec.domainId}-${topicIndex}`)\n    }\n  })\n\n  return topicIds\n}\n\n/**\n * Build priority domain recommendations (used by prioritizer)\n */\nexport function buildPriorityRecommendations(\n  wrongAnswers: WrongAnswer[],\n  totalQuestions: number\n): PriorityDomainRecommendation[] {\n  const performance = calculateDomainPerformance(wrongAnswers)\n  const topPriorities = getTopPriorityDomains(performance)\n\n  return topPriorities.map((perf) => {\n    const wrongKNs = getWrongKNsForDomain(perf.domainNumber, wrongAnswers)\n    const recommendedTopicIds = getRecommendedTopicsForDomain(perf.domainNumber, wrongKNs)\n    const recommendedTopics = convertTopicIdsToTopicNames(recommendedTopicIds)\n\n    return {\n      domainNumber: perf.domainNumber,\n      domainName: perf.domainName,\n      domainWeight: perf.domainWeight / 100, // Convert back to decimal\n      percentageWrong: perf.percentageWrong,\n      priorityScore: perf.priorityScore,\n      wrongKNs,\n      recommendedTopicIds,\n      recommendedTopics,\n    }\n  })\n}\n\n/**\n * Get all domain results (including non-priority domains)\n */\nexport function getAllDomainResults(wrongAnswers: WrongAnswer[]): PriorityDomainRecommendation[] {\n  const performance = calculateDomainPerformance(wrongAnswers)\n\n  return performance.map((perf) => {\n    const wrongKNs = getWrongKNsForDomain(perf.domainNumber, wrongAnswers)\n    const recommendedTopicIds = getRecommendedTopicsForDomain(perf.domainNumber, wrongKNs)\n    const recommendedTopics = convertTopicIdsToTopicNames(recommendedTopicIds)\n\n    return {\n      domainNumber: perf.domainNumber,\n      domainName: perf.domainName,\n      domainWeight: perf.domainWeight / 100, // Convert back to decimal\n      percentageWrong: perf.percentageWrong,\n      priorityScore: perf.priorityScore,\n      wrongKNs,\n      recommendedTopicIds,\n      recommendedTopics,\n    }\n  })\n}\n\n/**\n * Calculate overall score improvement suggestion\n * Returns array of recommendations to improve the score\n */\nexport function getImprovementSuggestions(performance: DomainPerformance[]): {\n  domain: string\n  focusAreas: string[]\n}[] {\n  const topThree = getTopPriorityDomains(performance)\n\n  return topThree.map((domain) => {\n    const suggestions: string[] = []\n\n    if (domain.percentageWrong > 50) {\n      suggestions.push(\"This is a major weak area - recommend intensive study\")\n    } else if (domain.percentageWrong > 30) {\n      suggestions.push(\"This domain needs focused review\")\n    } else if (domain.percentageWrong > 10) {\n      suggestions.push(\"Minor gaps detected - targeted practice recommended\")\n    }\n\n    return {\n      domain: domain.domainName,\n      focusAreas: suggestions,\n    }\n  })\n}\n\n/**\n * Calculate organizational psychology performance\n * Org psych comprises 21% of the exam and is distributed across domains 2, 3, 5, 6\n */\nexport interface OrgPsychPerformance {\n  label: string\n  weight: number\n  totalQuestionsInOrgPsych: number\n  totalWrongInOrgPsych: number\n  percentageWrong: number\n  priorityScore: number // percentageWrong * weight\n  wrongSourceFiles: string[]\n}\n\nexport function calculateOrgPsychPerformance(\n  wrongAnswers: (WrongAnswer & { is_org_psych?: boolean; source_file?: string })[],\n  allQuestions?: Array<{ is_org_psych?: boolean }>\n): OrgPsychPerformance {\n  const ORG_PSYCH_WEIGHT = 0.21 // 21% of exam\n\n  const orgPsychWrong = wrongAnswers.filter((a) => a.is_org_psych === true)\n  const wrongSourceFiles = new Set(orgPsychWrong.map((a) => a.source_file).filter(Boolean))\n\n  // Count total org psych questions from the exam\n  let totalOrgPsychQuestions = 0\n  if (allQuestions) {\n    totalOrgPsychQuestions = allQuestions.filter((q) => q.is_org_psych === true).length\n  }\n\n  // Fall back to hardcoded count if we don't have actual question data\n  if (totalOrgPsychQuestions === 0) {\n    totalOrgPsychQuestions = 44 // Based on practice exam generation\n  }\n\n  const percentageWrong = totalOrgPsychQuestions > 0 ? (orgPsychWrong.length / totalOrgPsychQuestions) * 100 : 0\n  const priorityScore = (percentageWrong / 100) * ORG_PSYCH_WEIGHT * 100 // (% wrong as decimal) Ã— weight Ã— 100\n\n  return {\n    label: \"Organizational Psychology\",\n    weight: ORG_PSYCH_WEIGHT * 100, // Convert to percentage (21%)\n    totalQuestionsInOrgPsych: totalOrgPsychQuestions,\n    totalWrongInOrgPsych: orgPsychWrong.length,\n    percentageWrong: Math.round(percentageWrong * 100) / 100, // Round to 2 decimals\n    priorityScore: Math.round(priorityScore * 100) / 100, // Round to 2 decimals\n    wrongSourceFiles: Array.from(wrongSourceFiles),\n  }\n}\n\n/**\n * Get top 3 priority areas from all 9 areas (8 domains + org psych)\n * Ranks all areas by priority score and returns top 3\n */\nexport interface PriorityArea {\n  label: string\n  type: 'domain' | 'org_psych'\n  domainNumber?: number\n  weight: number\n  percentageWrong: number\n  priorityScore: number\n  wrongKNs?: WrongKNInfo[]\n  wrongSourceFiles?: string[]\n}\n\nexport function getTopPriorityAreas(\n  domainPerformance: DomainPerformance[],\n  orgPsychPerformance: OrgPsychPerformance\n): PriorityArea[] {\n  // Convert domain performance to priority areas\n  const domainAreas: PriorityArea[] = domainPerformance.map((perf) => ({\n    label: perf.domainName,\n    type: 'domain',\n    domainNumber: perf.domainNumber,\n    weight: perf.domainWeight,\n    percentageWrong: perf.percentageWrong,\n    priorityScore: perf.priorityScore,\n    wrongSourceFiles: perf.wrongSourceFiles || [],\n  }))\n\n  // Add org psych as a priority area\n  const orgPsychArea: PriorityArea = {\n    label: orgPsychPerformance.label,\n    type: 'org_psych',\n    weight: orgPsychPerformance.weight,\n    percentageWrong: orgPsychPerformance.percentageWrong,\n    priorityScore: orgPsychPerformance.priorityScore,\n    wrongSourceFiles: orgPsychPerformance.wrongSourceFiles,\n  }\n\n  // Combine all 9 areas and rank by priority score\n  const allAreas = [...domainAreas, orgPsychArea]\n  return allAreas.sort((a, b) => b.priorityScore - a.priorityScore).slice(0, 3)\n}\n\n/**\n * Main priority calculation function\n * Called after exam completion to determine priority areas\n */\nexport function calculatePriorities(examResults: {\n  questions: Array<{\n    knId?: string\n    is_org_psych?: boolean\n    source_file?: string\n    correct_answer?: string\n    isScored?: boolean\n    scored?: boolean\n    domain?: string\n    [key: string]: any\n  }>\n  selectedAnswers: Record<number, string>\n  totalQuestions: number\n}) {\n  // Convert exam results to wrong answers format (scored questions only)\n  const wrongAnswers: Array<WrongAnswer & { is_org_psych?: boolean; source_file?: string }> = []\n  let scoredQuestionCount = 0\n  let scoredCorrectCount = 0\n\n  examResults.questions.forEach((question, index) => {\n    const selectedAnswer = examResults.selectedAnswers[index]\n    const isScored =\n      typeof question.isScored === 'boolean'\n        ? question.isScored\n        : typeof question.scored === 'boolean'\n        ? question.scored\n        : true\n\n    const isCorrect = selectedAnswer === question.correct_answer\n\n    if (isScored) {\n      scoredQuestionCount++\n      if (isCorrect) scoredCorrectCount++\n\n      // Include incorrect or skipped scored questions\n      if (!isCorrect) {\n        wrongAnswers.push({\n          questionId: index + 1,\n          domain: question.domain,\n          is_org_psych: question.is_org_psych,\n          source_file: question.source_file,\n          ...question,\n        })\n      }\n    }\n  })\n\n  // Calculate domain and org psych performance, passing actual questions for accurate totals\n  const domainPerformance = calculateDomainPerformance(wrongAnswers, examResults.questions)\n  const orgPsychPerformance = calculateOrgPsychPerformance(wrongAnswers, examResults.questions)\n\n  // Get top 3 priority areas (8 domains + org psych)\n  const topPriorityAreas = getTopPriorityAreas(domainPerformance, orgPsychPerformance)\n\n  // Get detailed recommendations for top 3 areas (including org psych if it ranks in top 3)\n  const topPriorities: any[] = topPriorityAreas.map((area) => {\n    if (area.type === 'org_psych') {\n      // Extract org psych topics from wrong source files\n      const recommendedTopics = extractOrgPsychTopicsFromSourceFiles(area.wrongSourceFiles || [])\n      const recommendedTopicIds = convertRecommendedTopicsToIds(recommendedTopics)\n\n      return {\n        type: 'org_psych',\n        domainName: area.label,\n        domainWeight: area.weight / 100,\n        percentageWrong: area.percentageWrong,\n        priorityScore: area.priorityScore,\n        wrongSourceFiles: area.wrongSourceFiles || [],\n        wrongKNs: [],\n        recommendedTopicIds,\n        recommendedTopics,\n      }\n    } else {\n      // Regular domain - use source files for recommended topics\n      const wrongKNs = getWrongKNsForDomain(area.domainNumber!, wrongAnswers)\n      const recommendedTopics = convertSourceFilesToTopicNames(area.wrongSourceFiles || [], area.domainNumber!)\n      const recommendedTopicIds = convertRecommendedTopicsToIds(recommendedTopics)\n\n      return {\n        type: 'domain',\n        domainNumber: area.domainNumber!,\n        domainName: area.label,\n        domainWeight: area.weight / 100,\n        percentageWrong: area.percentageWrong,\n        priorityScore: area.priorityScore,\n        wrongKNs,\n        recommendedTopicIds,\n        recommendedTopics,\n        wrongSourceFiles: area.wrongSourceFiles,\n      }\n    }\n  })\n\n  // Get all domain results\n  const allResults = getAllDomainResults(wrongAnswers)\n\n  // Sanity: scoredCorrect + wrongAnswers.length should equal scoredQuestionCount\n  const sanityMismatch = scoredCorrectCount + wrongAnswers.length !== scoredQuestionCount\n  if (sanityMismatch) {\n    console.warn('[Priorities] Scored question count mismatch:', {\n      scoredQuestionCount,\n      scoredCorrectCount,\n      wrongCount: wrongAnswers.length,\n    })\n  }\n\n  return {\n    topPriorities,\n    allResults,\n    topPriorityAreas,\n    orgPsychPerformance,\n    score: scoredCorrectCount,\n    totalQuestions: scoredQuestionCount,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/topic-content-manager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1202,1205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1202,1205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1473,1476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1473,1476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6126,6129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6126,6129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9372,9375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9372,9375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13189,13192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13189,13192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { readFileSync, readdirSync, existsSync } from 'fs'\nimport path from 'path'\n\nexport interface TopicContentMetadata {\n  topic_name: string\n  domain: string\n  slug: string\n  generated_at: string\n  model: string\n  version: number\n}\n\nexport interface TopicContent {\n  metadata: TopicContentMetadata\n  content: string\n  baseContent: string // Content without personalization placeholder\n}\n\n// Maps domain IDs to actual folder names in topic-content-v3-test\nconst DOMAIN_FOLDER_MAP: Record<string, string> = {\n  '1': '1 Biological Bases of Behavior : Physiological Psychology and Psychopharmacology',\n  '2': '2 Cognitive-Affective Bases : Learning and Memory',\n  '3-social': '3 Social Psychology',\n  '3-cultural': '3 Cultural',\n  '4': '4 Growth  : Lifespan Development',\n  '5-assessment': '5 Assessment',\n  '5-diagnosis': '5 Diagnosis  : Psychopathology',\n  '5-test': '5 Test Construction',\n  '6': '6 Treatment : Intervention',\n  '7': '7 Research Methods : Statistics',\n  '8': '8 Ethical  : Legal  : Professional Issues',\n  '3-5-6': '2 3 5 6 Organizational Psychology',\n}\n\n/**\n * Parse YAML frontmatter from markdown file\n */\nfunction parseFrontmatter(\n  content: string\n): { metadata: Record<string, any>; content: string } {\n  const frontmatterRegex = /^---\\n([\\s\\S]*?)\\n---\\n([\\s\\S]*)$/\n  const match = content.match(frontmatterRegex)\n\n  if (!match) {\n    return { metadata: {}, content }\n  }\n\n  const [, frontmatterText, body] = match\n  const metadata: Record<string, any> = {}\n\n  frontmatterText.split('\\n').forEach((line) => {\n    const [key, ...valueParts] = line.split(': ')\n    const value = valueParts.join(': ')\n    if (key && value) {\n      metadata[key.trim()] = value.trim().replace(/^[\"']|[\"']$/g, '')\n    }\n  })\n\n  return { metadata, content: body.trim() }\n}\n\n/**\n * Get the domain folder name from domain ID.\n */\nfunction getDomainFolder(domainId: string): string {\n  return DOMAIN_FOLDER_MAP[domainId] || domainId\n}\n\n/**\n * Normalize a topic name or filename to a slug used for lookups.\n * Strips leading numbers and spaces so both:\n *   - \"Organizational Leadership\"\n *   - \"5 6 Organizational Leadership\"\n * map to the same slug.\n */\nfunction slugifyTopicName(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/^[\\d\\s]+/, '') // remove leading numeric prefixes like \"5 \" or \"5 6 \"\n    .replace(/[&]/g, 'and')\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '')\n}\n\n/**\n * Resolve the actual markdown file path for a topic.\n *\n * Behaviors:\n * - If a domain ID is provided, search that domain folder first.\n * - Always fall back to scanning all known domain folders so links that\n *   omit the domain (e.g., from quiz results) still work.\n */\nfunction resolveTopicFilePath(\n  topicName: string,\n  domain?: string | null,\n  rootDirName: string = 'topic-content-v3-test',\n): string | null {\n  const slug = slugifyTopicName(topicName)\n  const rootDir = path.join(process.cwd(), rootDirName)\n\n  // Build ordered list of folders to search: requested domain (if any) first,\n  // then all other known domain folders.\n  const searchFolders: string[] = []\n  let domainFolder: string | null = null\n\n  if (domain) {\n    const mapped = getDomainFolder(domain)\n    if (mapped) {\n      domainFolder = mapped\n      searchFolders.push(mapped)\n    }\n  }\n\n  for (const folder of Object.values(DOMAIN_FOLDER_MAP)) {\n    if (folder && folder !== domainFolder && !searchFolders.includes(folder)) {\n      searchFolders.push(folder)\n    }\n  }\n\n  for (const folder of searchFolders) {\n    const baseDir = path.join(rootDir, folder)\n\n    // 1) Direct slug match (for legacy kebab-case filenames)\n    const directPath = path.join(baseDir, `${slug}.md`)\n    if (existsSync(directPath)) {\n      return directPath\n    }\n\n    // 2) Scan directory and match by normalized slug of each filename\n    let entries: ReturnType<typeof readdirSync>\n    try {\n      entries = readdirSync(baseDir, { withFileTypes: true })\n    } catch {\n      continue\n    }\n\n    for (const entry of entries) {\n      if (!entry.isFile() || !entry.name.endsWith('.md')) continue\n      const baseName = entry.name.slice(0, -3) // drop \".md\"\n      const candidateSlug = slugifyTopicName(baseName)\n      if (candidateSlug === slug) {\n        return path.join(baseDir, entry.name)\n      }\n    }\n  }\n\n  return null\n}\n\n/**\n * Remove {{M}}...{{/M}} markers while leaving the inner metaphor text intact.\n */\nexport function stripMetaphorMarkers(content: string): string {\n  return content.replace(/\\{\\{\\/?M\\}\\}/g, '')\n}\n\n/**\n * Load pre-generated topic content from filesystem\n */\nexport function loadTopicContent(\n  topicName: string,\n  domain: string\n): TopicContent | null {\n  try {\n    const filePath = resolveTopicFilePath(topicName, domain)\n    const domainFolder = getDomainFolder(domain)\n    const slug = slugifyTopicName(topicName)\n\n    if (!filePath) {\n      console.error(\n        `[Topic Content Manager] âŒ Could not resolve file for topic \"${topicName}\" in domain \"${domain}\"`\n      )\n      return null\n    }\n\n    console.log(`[Topic Content Manager] Attempting to load from: ${filePath}`)\n    console.log(`[Topic Content Manager] Working directory: ${process.cwd()}`)\n    console.log(`[Topic Content Manager] Topic: \"${topicName}\", Domain: \"${domain}\"`)\n    console.log(`[Topic Content Manager] Computed slug: \"${slug}\", Domain folder: \"${domainFolder}\"`)\n\n    const fileContent = readFileSync(filePath, 'utf-8')\n    const { metadata, content } = parseFrontmatter(fileContent)\n\n    // Remove personalization placeholder and keep as baseContent\n    const baseContent = content.replace(/\\n*## {{PERSONALIZED_EXAMPLES}}.*?(?=##|$)/s, '')\n\n    console.log(`[Topic Content Manager] âœ… Successfully loaded content for ${topicName}`)\n\n    return {\n      metadata: metadata as TopicContentMetadata,\n      content,\n      baseContent: baseContent.trim(),\n    }\n  } catch (error) {\n    console.error(`[Topic Content Manager] âŒ Failed to load topic content for ${topicName}:`, error)\n    console.error(`[Topic Content Manager] Error details:`, {\n      name: (error as Error).name,\n      message: (error as Error).message,\n      code: (error as any).code,\n    })\n    return null\n  }\n}\n\n/**\n * Merge base content with personalized examples\n */\nexport function mergePersonalizedContent(\n  baseContent: string,\n  personalizedExamples: string\n): string {\n  // Insert personalized examples at the placeholder\n  return baseContent.replace(\n    '{{PERSONALIZED_EXAMPLES}}',\n    personalizedExamples\n  )\n}\n\n/**\n * Extract the personalization section from full content\n */\nexport function getPersonalizationSection(content: string): string {\n  const match = content.match(/## {{PERSONALIZED_EXAMPLES}}\\n\\n([\\s\\S]*?)(?=##|$)/)\n  return match ? match[1].trim() : ''\n}\n\n/**\n * Check if topic content exists\n */\nexport function topicContentExists(\n  topicName: string,\n  domain: string\n): boolean {\n  try {\n    const filePath = resolveTopicFilePath(topicName, domain)\n    if (!filePath) return false\n    readFileSync(filePath, 'utf-8')\n    return true\n  } catch {\n    return false\n  }\n}\n\n/**\n * Load the full content (without removing personalization section) - used for follow-up Q&A\n */\nexport function loadFullTopicContent(\n  topicName: string,\n  domain: string\n): string | null {\n  try {\n    const filePath = resolveTopicFilePath(topicName, domain)\n    if (!filePath) return null\n    const fileContent = readFileSync(filePath, 'utf-8')\n    const { content } = parseFrontmatter(fileContent)\n\n    // Return the full content body (without frontmatter)\n    return content\n  } catch (error) {\n    console.error(`Failed to load full topic content for ${topicName}:`, error)\n    return null\n  }\n}\n\n/**\n * Load pre-generated topic content specifically from the free-contentGPT folder.\n * Used for free-tier users so they only see the curated free topics.\n */\nexport function loadFreeTopicContent(\n  topicName: string,\n  domain: string\n): TopicContent | null {\n  try {\n    const filePath = resolveTopicFilePath(topicName, domain, 'free-contentGPT')\n    const domainFolder = getDomainFolder(domain)\n    const slug = slugifyTopicName(topicName)\n\n    if (!filePath) {\n      console.error(\n        `[Topic Content Manager] âŒ Could not resolve FREE file for topic \"${topicName}\" in domain \"${domain}\"`\n      )\n      return null\n    }\n\n    console.log(`[Topic Content Manager] Attempting to load FREE content from: ${filePath}`)\n    console.log(`[Topic Content Manager] Working directory: ${process.cwd()}`)\n    console.log(`[Topic Content Manager] Topic: \"${topicName}\", Domain: \"${domain}\"`)\n    console.log(`[Topic Content Manager] Computed slug: \"${slug}\", Domain folder: \"${domainFolder}\"`)\n\n    const fileContent = readFileSync(filePath, 'utf-8')\n    const { metadata, content } = parseFrontmatter(fileContent)\n\n    const baseContent = content.replace(/\\n*## {{PERSONALIZED_EXAMPLES}}.*?(?=##|$)/s, '')\n\n    console.log(`[Topic Content Manager] âœ… Successfully loaded FREE content for ${topicName}`)\n\n    return {\n      metadata: metadata as TopicContentMetadata,\n      content,\n      baseContent: baseContent.trim(),\n    }\n  } catch (error) {\n    console.error(`[Topic Content Manager] âŒ Failed to load FREE topic content for ${topicName}:`, error)\n    console.error(`[Topic Content Manager] Error details:`, {\n      name: (error as Error).name,\n      message: (error as Error).message,\n      code: (error as any).code,\n    })\n    return null\n  }\n}\n\n/**\n * Extract all marked metaphors from content\n * Returns array of objects with original text and position\n */\nfunction extractMarkedMetaphors(content: string): Array<{ text: string; startIndex: number; endIndex: number }> {\n  const metaphors: Array<{ text: string; startIndex: number; endIndex: number }> = []\n  const regex = /\\{\\{M\\}\\}(.*?)\\{\\{\\/M\\}\\}/gs\n\n  let match\n  while ((match = regex.exec(content)) !== null) {\n    metaphors.push({\n      text: match[1],\n      startIndex: match.index,\n      endIndex: match.index + match[0].length,\n    })\n  }\n\n  return metaphors\n}\n\n/**\n * Replace marked metaphors inline with personalized versions (FAST approach)\n *\n * This function finds {{M}}...{{/M}} markers and replaces ONLY those metaphors\n * with personalized ones, leaving all other content untouched.\n *\n * @param baseContent - Content with {{M}}...{{/M}} marked metaphors\n * @param userInterests - User's interests as a comma-separated string\n * @param topicName - The name of the topic (for context)\n * @returns Promise resolving to content with personalized metaphors\n */\nexport async function replaceMetaphors(\n  baseContent: string,\n  userInterests: string,\n  topicName: string\n): Promise<string> {\n  const apiKey = process.env.OPENAI_API_KEY\n  if (!apiKey) {\n    console.warn('[Metaphor Replacement] OPENAI_API_KEY not set, returning content without markers')\n    return stripMetaphorMarkers(baseContent)\n  }\n\n  // Extract all marked metaphors\n  const markedMetaphors = extractMarkedMetaphors(baseContent)\n\n  if (markedMetaphors.length === 0) {\n    console.log('[Metaphor Replacement] No marked metaphors found, returning original content')\n    return baseContent\n  }\n\n  console.log(`[Metaphor Replacement] Found ${markedMetaphors.length} marked metaphors to personalize`)\n\n  // Build prompt with just the metaphors to replace\n  const metaphorList = markedMetaphors.map((m, i) => `${i + 1}. \"${m.text}\"`).join('\\n')\n\n  const INLINE_METAPHOR_PROMPT = `You are personalizing metaphors for a psychology student studying \"${topicName}\".\n\nStudent's Interests: ${userInterests}\n\nIMPORTANT: If the student mentions media/pop culture (like \"The Office\", \"Star Wars\", \"Harry Potter\", etc.), interpret these as the well-known TV shows, movies, or franchises - NOT literal meanings. For example:\n- \"The Office\" = the popular TV comedy series about office workers\n- \"Star Wars\" = the science fiction film franchise\n- \"Harry Potter\" = the fantasy book/film series\n- etc.\n\nBelow are ${markedMetaphors.length} generic metaphors/analogies from the lesson. Replace each one with a version that relates to the student's interests.\n\nGeneric Metaphors:\n${metaphorList}\n\nInstructions:\n- Keep the same educational purpose and clarity\n- Make it relatable to their interests: ${userInterests}\n- Use specific characters, scenes, or concepts from their mentioned shows/movies/books\n- Keep the same length (don't make them longer)\n- Return ONLY the replacement metaphors, numbered 1-${markedMetaphors.length}\n- Do NOT include any other text or explanation\n\nReturn format:\n1. [your personalized metaphor for #1]\n2. [your personalized metaphor for #2]\n...and so on.`\n\n  try {\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model: 'gpt-4.1-mini',\n        max_tokens: 2000,\n        messages: [\n          {\n            role: 'user',\n            content: INLINE_METAPHOR_PROMPT,\n          },\n        ],\n      }),\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      throw new Error(`OpenAI API error (${response.status}): ${errorText}`)\n    }\n\n    const data: any = await response.json()\n    const text = data.choices?.[0]?.message?.content\n    if (!text || typeof text !== 'string') {\n      throw new Error('No text content in OpenAI response')\n    }\n\n    // Parse the numbered responses\n    const personalizedMetaphors: string[] = []\n    const lines = text.split('\\n')\n\n    for (const line of lines) {\n      const match = line.match(/^\\d+\\.\\s*(.+)$/)\n      if (match) {\n        personalizedMetaphors.push(match[1].trim())\n      }\n    }\n\n    if (personalizedMetaphors.length !== markedMetaphors.length) {\n      console.warn(`[Metaphor Replacement] Expected ${markedMetaphors.length} metaphors but got ${personalizedMetaphors.length}, using original`)\n      return baseContent\n    }\n\n    // Replace metaphors in reverse order to preserve indices\n    let result = baseContent\n    for (let i = markedMetaphors.length - 1; i >= 0; i--) {\n      const original = markedMetaphors[i]\n      const replacement = personalizedMetaphors[i]\n\n      // Replace the entire {{M}}...{{/M}} block with just the personalized text\n      result = result.substring(0, original.startIndex) + replacement + result.substring(original.endIndex)\n    }\n\n    console.log(`[Metaphor Replacement] Successfully personalized ${personalizedMetaphors.length} metaphors`)\n    return result\n\n  } catch (error) {\n    console.error('Error replacing metaphors:', error)\n    // Fallback: return original content with markers removed\n    return stripMetaphorMarkers(baseContent)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/anderschan/thepsychology-ai/src/lib/user-management.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1394,1397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1394,1397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'feature' is defined but never used.","line":83,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":60}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface User {\n  id: string\n  email: string\n  tier: '7-Day Free Trial' | 'Pro' | 'Pro + Coaching'\n  createdAt: string\n  trialExpiresAt: string | null\n}\n\nexport function getCurrentUser(): User | null {\n  if (typeof window === 'undefined') return null\n\n  const userStr = localStorage.getItem('currentUser')\n  if (!userStr) return null\n\n  try {\n    return JSON.parse(userStr)\n  } catch {\n    return null\n  }\n}\n\nexport function isTrialExpired(user: User): boolean {\n  if (!user.trialExpiresAt) return false\n\n  const expiryDate = new Date(user.trialExpiresAt)\n  const now = new Date()\n\n  return now > expiryDate\n}\n\nexport function getTrialDaysRemaining(user: User): number {\n  if (!user.trialExpiresAt) return 0\n\n  const expiryDate = new Date(user.trialExpiresAt)\n  const now = new Date()\n\n  if (now > expiryDate) return 0\n\n  const daysRemaining = Math.ceil((expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\n  return Math.max(0, daysRemaining)\n}\n\nexport function logout(): void {\n  if (typeof window === 'undefined') return\n\n  localStorage.removeItem('currentUser')\n  window.location.href = '/'\n}\n\nexport function login(email: string, password: string): User | null {\n  if (typeof window === 'undefined') return null\n\n  const usersStr = localStorage.getItem('users')\n  if (!usersStr) return null\n\n  try {\n    const users = JSON.parse(usersStr)\n    const user = users.find((u: any) => u.email === email && u.password === password)\n\n    if (!user) return null\n\n    // Check if free trial has expired\n    if (user.tier === '7-Day Free Trial' && isTrialExpired(user)) {\n      return null\n    }\n\n    // Set current user\n    const currentUser: User = {\n      id: user.id,\n      email: user.email,\n      tier: user.tier,\n      createdAt: user.createdAt,\n      trialExpiresAt: user.trialExpiresAt,\n    }\n\n    localStorage.setItem('currentUser', JSON.stringify(currentUser))\n    return currentUser\n  } catch {\n    return null\n  }\n}\n\nexport function canAccessFeature(user: User | null, feature: 'all-topics' | 'recovery'): boolean {\n  if (!user) return false\n\n  // Free trial users cannot access all topics or recovery\n  if (user.tier === '7-Day Free Trial') {\n    return false\n  }\n\n  // Pro and Pro + Coaching can access all features\n  return true\n}\n\nexport function getTopicLimit(user: User | null): number {\n  if (!user) return 0\n\n  // Free trial limited to 1 topic\n  if (user.tier === '7-Day Free Trial') {\n    return 1\n  }\n\n  // Pro and Pro + Coaching have unlimited topics\n  return Infinity\n}\n","usedDeprecatedRules":[]}]